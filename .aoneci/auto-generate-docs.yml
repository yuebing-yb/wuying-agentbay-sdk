# AgentBay SDK Auto Documentation Generation Pipeline
name: "AgentBay SDK Auto-generate Documentation"

params:
  auto_commit_enabled:
    name: Enable Auto Commit Documentation
    type: boolean
    default: true
    description: "Whether to automatically commit generated documentation to current MR branch"
  
  python_docs_enabled:
    name: Enable Python Documentation Generation
    type: boolean
    default: true
  
  typescript_docs_enabled:
    name: Enable TypeScript Documentation Generation
    type: boolean
    default: true
  
  golang_docs_enabled:
    name: Enable Golang Documentation Generation
    type: boolean
    default: true
  
  llms_docs_enabled:
    name: Enable AI Assistant Documentation Generation
    type: boolean
    default: true
    description: "Generate llms.txt and llms-full.txt files"
  
  runs_on_resources:
    name: Resource Specification
    description: "Runtime container resource specification"
    default: "4-16Gi"
    options:
      - "4-16Gi"
      - "8-32Gi"
      - "16-64Gi"

jobs:
  # Auto documentation generation job
  auto-generate-docs:
    continue-on-error: false
    name: "Auto Generate Documentation"
    runs-on:
      - "${{params.runs_on_resources}}"
    image: alios-8u
    timeout: 45m
    retry:
      max: 2
      when:
        - runner_system_failure
        - stuck_or_timeout_failure
    
    steps:
      - uses: checkout
        inputs:
          fetch-depth: 0
          username: 'wuying-ai-team'
          # ‰ΩøÁî® private-token ‰ª•ÊîØÊåÅ push Êìç‰Ωú
          token: ${{secrets.PRIVATE_TOKEN}}
      
      # Check if it's a CI bot commit to avoid infinite loops
      - id: check-ci-loop
        name: "Check CI Loop"
        continue-on-error: false
        run: |
          echo "üîç Checking if this is a CI bot commit..."
          
          # Get latest commit information
          LATEST_COMMIT_MESSAGE=$(git log -1 --pretty=format:"%s" | cat)
          LATEST_COMMIT_AUTHOR=$(git log -1 --pretty=format:"%ae" | cat)
          
          echo "Latest commit message: $LATEST_COMMIT_MESSAGE"
          echo "Latest commit author: $LATEST_COMMIT_AUTHOR"
          
          # Check if it's a CI bot commit
          if [[ "$LATEST_COMMIT_MESSAGE" == *"ü§ñ Auto-generate documentation"* ]] || \
             [[ "$LATEST_COMMIT_AUTHOR" == "wuying-ai-team@alibabacloud.com" ]]; then
            echo "‚ö†Ô∏è  Detected CI bot commit, skipping documentation generation to avoid infinite loop"
            echo "CI_LOOP_DETECTED=true" >> $AONE_CI_ENV
            exit 1
          else
            echo "‚úÖ Not a CI bot commit, continuing with documentation generation"
            echo "CI_LOOP_DETECTED=false" >> $AONE_CI_ENV
          fi
      
      # ËÆæÁΩÆÂ§öËØ≠Ë®ÄÁéØÂ¢É
      - uses: setup-env
        inputs:
          python-version: '3.11'
          node-version: '18'
          go-version: '1.24.3'
          npm-cache: true
          pip-cache: true
          go-mod-cache: true
          go-cache: true
      
      # Create temporary documentation directory
      - id: setup-temp-docs
        name: "Setup Temporary Documentation Directory"
        run: |
          # Check if it's a CI bot commit
          if [ "$CI_LOOP_DETECTED" = "true" ]; then
            echo "‚ö†Ô∏è Detected CI bot commit, skipping temporary documentation directory creation"
            exit 0
          fi
          
          echo "üìÅ Creating CI/CD temporary documentation directory..."
          
          # Use workspace directory instead of /tmp to ensure sharing between steps
          TEMP_DOCS_DIR="$PWD/.temp-docs"
          mkdir -p "$TEMP_DOCS_DIR"/{python,typescript,golang,llms}
          
          echo "‚úÖ Temporary documentation directory created: $TEMP_DOCS_DIR"
          echo "TEMP_DOCS_DIR=$TEMP_DOCS_DIR" >> $AONE_CI_ENV
          
          # Display directory structure
          echo "üìã Temporary directory structure:"
          tree "$TEMP_DOCS_DIR" || ls -la "$TEMP_DOCS_DIR"
      
      # Generate Python API documentation
      - id: generate-python-docs
        name: "Generate Python API Documentation"
        when: ${{params.python_docs_enabled}}
        run: |
          # Check if it's a CI bot commit or Python documentation generation is disabled
          if [ "$CI_LOOP_DETECTED" = "true" ]; then
            echo "‚ö†Ô∏è Detected CI bot commit, skipping Python API documentation generation"
            exit 0
          fi
          
          echo "üêç Starting Python API documentation generation..."
          echo "  - CI_LOOP_DETECTED: ${CI_LOOP_DETECTED:-not set}"
          cd python
          
          # Install dependencies
          python -m pip config set global.timeout 300
          python -m pip config set global.retries 3
          python -m pip install --upgrade pip
          # Install additional dependencies required for documentation generation
          pip install docspec pyyaml pydoc-markdown
          
          # Generate documentation
          python scripts/generate_api_docs.py
          
          # Verify generated documentation
          if [ -d "docs/api" ]; then
            echo "üìã Verifying generated API documentation:"
            find docs/api -name "*.md" | head -5 | while read file; do
              echo "  - $file"
            done
          else
            echo "‚ö†Ô∏è Generated API documentation directory not found: docs/api"
          fi
          
          # Copy generated Python API documentation to temporary directory
          cd ..
          if [ -d "python/docs/api" ]; then
            echo "üìã Copying generated Python API documentation to temporary directory..."
            # Ensure temporary directory exists
            mkdir -p "$TEMP_DOCS_DIR/python"
            cp -r python/docs/api "$TEMP_DOCS_DIR/python/" 2>/dev/null || true
            
            # Display copied files
            COPIED_FILES=$(find "$TEMP_DOCS_DIR/python" -type f 2>/dev/null || true)
            if [ -n "$COPIED_FILES" ]; then
              echo "‚úÖ Python API documentation copied to temporary directory:"
              echo "$COPIED_FILES"
            else
              echo "‚ö†Ô∏è No Python API documentation was copied"
            fi
          else
            echo "‚ö†Ô∏è Generated Python API documentation directory not found: python/docs/api"
          fi
          tree "$TEMP_DOCS_DIR" || ls -la "$TEMP_DOCS_DIR"
          echo "‚úÖ Python API documentation generation completed and staged"
      
      # Generate TypeScript API documentation
      - id: generate-typescript-docs
        name: "Generate TypeScript API Documentation"
        when: ${{params.typescript_docs_enabled}}
        run: |
          # Check if it's a CI bot commit or TypeScript documentation generation is disabled
          if [ "$CI_LOOP_DETECTED" = "true" ]; then
            echo "‚ö†Ô∏è Detected CI bot commit, skipping TypeScript API documentation generation"
            exit 0
          fi
          
          echo "üìò Starting TypeScript API documentation generation..."
          cd typescript
          
          # Configure npm timeout and retry strategy
          npm config set fetch-timeout 300000
          npm config set fetch-retry-mintimeout 20000
          npm config set fetch-retry-maxtimeout 120000
          
          # Install dependencies
          npm ci --prefer-offline --no-audit
          
          # Generate documentation
          npm run docs:generate
          
          # Verify generated documentation
          if [ -d "docs/api" ]; then
            echo "üìã Verifying generated API documentation:"
            find docs/api -name "*.md" | head -5 | while read file; do
              echo "  - $file"
            done
          else
            echo "‚ö†Ô∏è Generated API documentation directory not found: docs/api"
          fi
          
          # Copy generated TypeScript API documentation to temporary directory
          cd ..
          if [ -d "typescript/docs/api" ]; then
            echo "üìã Copying generated TypeScript API documentation to temporary directory..."
            # Ensure temporary directory exists
            mkdir -p "$TEMP_DOCS_DIR/typescript"
            cp -r typescript/docs/api "$TEMP_DOCS_DIR/typescript/" 2>/dev/null || true
            
            # Display copied files
            COPIED_FILES=$(find "$TEMP_DOCS_DIR/typescript" -type f 2>/dev/null || true)
            if [ -n "$COPIED_FILES" ]; then
              echo "‚úÖ TypeScript API documentation copied to temporary directory:"
              echo "$COPIED_FILES"
            else
              echo "‚ö†Ô∏è No TypeScript API documentation was copied"
            fi
          else
            echo "‚ö†Ô∏è Generated TypeScript API documentation directory not found: typescript/docs/api"
          fi
          tree "$TEMP_DOCS_DIR" || ls -la "$TEMP_DOCS_DIR"
          echo "‚úÖ TypeScript API documentation generation completed and staged"
      
      
      
      # Generate AI Assistant documentation
      - id: generate-llms-docs
        name: "Generate AI Assistant Documentation"
        when: ${{params.llms_docs_enabled}}
        run: |
          # Check if it's a CI bot commit or AI Assistant documentation generation is disabled
          if [ "$CI_LOOP_DETECTED" = "true" ]; then
            echo "‚ö†Ô∏è Detected CI bot commit, skipping AI Assistant documentation generation"
            exit 0
          fi
          
          echo "ü§ñ Starting AI Assistant documentation generation..."
          
          # Install necessary dependencies
          pip install markdown beautifulsoup4 tiktoken pyyaml
          
          # Generate llms.txt and llms-full.txt
          python scripts/build_llms_txt.py
          tree "$TEMP_DOCS_DIR" || ls -la "$TEMP_DOCS_DIR"
          # Copy generated AI Assistant documentation to temporary directory
          for llms_file in "llms.txt" "llms-full.txt"; do
            if [ -f "$llms_file" ]; then
              echo "üìã Copying AI Assistant documentation to temporary directory: $llms_file"
              # Ensure temporary directory exists
              mkdir -p "$TEMP_DOCS_DIR/llms"
              cp "$llms_file" "$TEMP_DOCS_DIR/llms/"
              echo "‚úÖ Copied $llms_file"
            fi
          done
          
          echo "‚úÖ AI Assistant documentation generation completed and staged"
      

      # Generate Golang API documentation
      - id: generate-golang-docs
        name: "Generate Golang API Documentation"
        when: ${{params.golang_docs_enabled}}
        run: |
          # Check if it's a CI bot commit or Golang documentation generation is disabled
          if [ "$CI_LOOP_DETECTED" = "true" ]; then
            echo "‚ö†Ô∏è Detected CI bot commit, skipping Golang API documentation generation"
            exit 0
          fi

          echo "üêπ Starting Golang API documentation generation..."
          cd golang
          
          # Configure Go environment
          export GOPROXY=https://goproxy.cn,direct
          export GOSUMDB=sum.golang.org
          echo "‚úÖ Go environment configured: GOPROXY=$GOPROXY"
          
          # Download dependencies
          go mod download
          go mod verify
          
          # Generate documentation
          go run scripts/generate_api_docs.go
          
          # Verify generated documentation
          if [ -d "docs/api" ]; then
            echo "üìã Verifying generated API documentation:"
            find docs/api -name "*.md" | head -5 | while read file; do
              echo "  - $file"
            done
          else
            echo "‚ö†Ô∏è Generated API documentation directory not found: docs/api"
          fi
          
          # Copy generated Golang API documentation to temporary directory
          cd ..
          if [ -d "golang/docs/api" ]; then
            echo "üìã Copying generated Golang API documentation to temporary directory..."
            # Ensure temporary directory exists
            mkdir -p "$TEMP_DOCS_DIR/golang"
            cp -r golang/docs/api "$TEMP_DOCS_DIR/golang/" 2>/dev/null || true
            
            # Display copied files
            COPIED_FILES=$(find "$TEMP_DOCS_DIR/golang" -type f 2>/dev/null || true)
            if [ -n "$COPIED_FILES" ]; then
              echo "‚úÖ Golang API documentation copied to temporary directory:"
              echo "$COPIED_FILES"
            else
              echo "‚ö†Ô∏è No Golang API documentation was copied"
            fi
          else
            echo "‚ö†Ô∏è Generated Golang API documentation directory not found: golang/docs/api"
          fi
          
          tree "$TEMP_DOCS_DIR" || ls -la "$TEMP_DOCS_DIR"
          echo "‚úÖ Golang API documentation generation completed and staged"
      
      # Copy documentation from temporary directory to project directory and stage
      - id: copy-and-stage-docs
        name: "Copy Documentation to Project and Stage"
        run: |
          # Check if it's a CI bot commit
          if [ "$CI_LOOP_DETECTED" == "true" ]; then
            echo "‚ö†Ô∏è Detected CI bot commit, skipping documentation copy and staging"
            exit 0
          fi
          
          echo "üìã Copying documentation from temporary directory to project directory and staging..."
          
          # Check if temporary directory exists with files
          if [ ! -d "$TEMP_DOCS_DIR" ]; then
            echo "‚ö†Ô∏è Temporary documentation directory does not exist: $TEMP_DOCS_DIR"
            exit 0
          fi
          
          echo "üìÅ Temporary directory contents:"
          find "$TEMP_DOCS_DIR" -type f 2>/dev/null || echo "Temporary directory is empty"
          
          # Copy and stage Python API documentation
          if [ -d "$TEMP_DOCS_DIR/python/api" ] && [ "$(find "$TEMP_DOCS_DIR/python/api" -type f 2>/dev/null)" ]; then
            echo "üìã Copying Python API documentation to project directory..."
            mkdir -p python/docs/api
            cp -r "$TEMP_DOCS_DIR/python/api"/* python/docs/api/ 2>/dev/null || true
            git add python/docs/api/
            echo "‚úÖ Python API documentation copied and staged"
          fi
          
          # Copy and stage TypeScript API documentation
          if [ -d "$TEMP_DOCS_DIR/typescript/api" ] && [ "$(find "$TEMP_DOCS_DIR/typescript/api" -type f 2>/dev/null)" ]; then
            echo "üìã Copying TypeScript API documentation to project directory..."
            mkdir -p typescript/docs/api
            cp -r "$TEMP_DOCS_DIR/typescript/api"/* typescript/docs/api/ 2>/dev/null || true
            git add typescript/docs/api/
            echo "‚úÖ TypeScript API documentation copied and staged"
          fi
          
          # Copy and stage Golang API documentation
          if [ -d "$TEMP_DOCS_DIR/golang/api" ] && [ "$(find "$TEMP_DOCS_DIR/golang/api" -type f 2>/dev/null)" ]; then
            echo "üìã Copying Golang API documentation to project directory..."
            mkdir -p golang/docs/api
            cp -r "$TEMP_DOCS_DIR/golang/api"/* golang/docs/api/ 2>/dev/null || true
            git add golang/docs/api/
            echo "‚úÖ Golang API documentation copied and staged"
          fi
          
          # Copy and stage AI Assistant documentation
          if [ -d "$TEMP_DOCS_DIR/llms" ] && [ "$(find "$TEMP_DOCS_DIR/llms" -type f 2>/dev/null)" ]; then
            echo "üìã Copying AI Assistant documentation to project directory..."
            cp "$TEMP_DOCS_DIR/llms"/* . 2>/dev/null || true
            git add llms.txt llms-full.txt 2>/dev/null || true
            echo "‚úÖ AI Assistant documentation copied and staged"
          fi
          
          # Display final staging area status
          STAGED_FILES=$(git diff --cached --name-only)
          if [ -n "$STAGED_FILES" ]; then
            echo ""
            echo "üìä Final staging area statistics:"
            echo "$STAGED_FILES"
            
            # Categorized statistics
            PYTHON_COUNT=$(echo "$STAGED_FILES" | grep "python/docs/api" | wc -l || echo "0")
            TYPESCRIPT_COUNT=$(echo "$STAGED_FILES" | grep "typescript/docs/api/" | wc -l || echo "0")
            GOLANG_COUNT=$(echo "$STAGED_FILES" | grep "golang/docs/api/" | wc -l || echo "0")
            LLMS_COUNT=$(echo "$STAGED_FILES" | grep -E "(llms\.txt|llms-full\.txt)" | wc -l || echo "0")
            
            echo "üêç Python documentation: $PYTHON_COUNT files"
            echo "üìò TypeScript documentation: $TYPESCRIPT_COUNT files"
            echo "üêπ Golang documentation: $GOLANG_COUNT files"
            echo "ü§ñ AI Assistant documentation: $LLMS_COUNT files"
            echo "üìÅ Final generated documentation directory structure:"
            for doc_dir in "python/docs/api" "typescript/docs/api" "golang/docs/api"; do
              if [ -d "$doc_dir" ]; then
                echo "üìÇ $doc_dir:"
                find "$doc_dir" -type f -name "*.md" | head -10 | sed 's/^/  /'
              fi
            done
            for llms_file in "llms.txt" "llms-full.txt"; do
              if [ -f "$llms_file" ]; then
                echo "üìÑ $llms_file: $(wc -l < "$llms_file") lines"
              fi
            done
          else
            echo "‚ö†Ô∏è No files were staged"
          fi
      # Commit documentation changes
      - id: commit-docs
        name: "Commit Documentation Changes"
        run: |
          # Check if it's a CI bot commit or auto commit is disabled
          if [ "$CI_LOOP_DETECTED" = true ]; then
            echo "‚ö†Ô∏è Detected CI bot commit, skipping documentation commit"
            exit 0
          fi
          
          # Check if auto commit is enabled (enabled by default)
          if [ "${{params.auto_commit_enabled}}" != "true" ]; then
            echo "‚ÑπÔ∏è Auto commit is disabled, skipping"
            exit 0
          fi
          
          tree "$TEMP_DOCS_DIR" || ls -la "$TEMP_DOCS_DIR"
          echo "üì§ Starting to check and commit documentation changes..."
          
          # Configure Git user information (authentication handled by checkout component)
          git config --global user.name "wuying-ai-team"
          git config --global user.email "wuying-ai-team@alibabacloud.com"
          echo "‚úÖ Git user configuration completed"
          
          # Check if there are files in staging area (documentation copied from temporary directory has been added to staging area)
          STAGED_FILES=$(git diff --cached --name-only)
          
          if [ -z "$STAGED_FILES" ]; then
            echo "‚ÑπÔ∏è  No files in staging area, skipping commit step"
            echo "üìã Checking temporary directory status:"
            find "$TEMP_DOCS_DIR" -type f 2>/dev/null || echo "Temporary directory is empty"
            exit 0
          fi
          
          echo "üìã Documentation files in staging area:"
          echo "$STAGED_FILES"
          
          # Since files are copied from controlled temporary directory, they should all be documentation-related files
          # But still perform validation to ensure safety
          NON_DOC_FILES=$(echo "$STAGED_FILES" | grep -v -E "(python/docs/api/|typescript/docs/api/|golang/docs/api/|llms\.txt|llms-full\.txt)" || true)
          if [ -n "$NON_DOC_FILES" ]; then
            echo "‚ö†Ô∏è  Warning: Found unexpected file types:"
            echo "$NON_DOC_FILES"
            echo "üìã These files will not be committed"
            
            # Reset staging area, keep only documentation files
            git reset HEAD
            DOC_FILES=$(echo "$STAGED_FILES" | grep -E "(python/docs/api/|typescript/docs/api/|golang/docs/api/|llms\.txt|llms-full\.txt)" || true)
            if [ -n "$DOC_FILES" ]; then
              echo "$DOC_FILES" | while read -r file; do
                if [ -n "$file" ] && [ -f "$file" ]; then
                  echo "‚ûï Re-staging documentation file: $file"
                  git add "$file"
                fi
              done
            fi
            
            # Re-check staging area
            STAGED_FILES=$(git diff --cached --name-only)
            if [ -z "$STAGED_FILES" ]; then
              echo "‚ÑπÔ∏è  No valid documentation files to commit, skipping commit step"
              exit 0
            fi
          fi
          
          echo "üìù Preparing to commit the following documentation files:"
          echo "$STAGED_FILES"
          
          # Save current branch name and target branch
          CURRENT_BRANCH=$(git branch --show-current)
          TARGET_BRANCH="${{git.merge_request.targetBranch}}"
          
          # Handle manual trigger case where target branch is null/empty
          if [ -z "$TARGET_BRANCH" ] || [ "$TARGET_BRANCH" = "null" ]; then
            TARGET_BRANCH="main"
            echo "‚ö†Ô∏è Target branch is null/empty (manual trigger), defaulting to main branch"
          fi
          
          TIMESTAMP=$(date +"%Y%m%d_%H%M%S")
          DOC_BRANCH="docs/auto-generate-${TIMESTAMP}"
          
          echo "üåø Current branch: $CURRENT_BRANCH"
          echo "üéØ Target branch: $TARGET_BRANCH" 
          echo "üìÑ Documentation branch: $DOC_BRANCH"
          
          # Create clean documentation branch based on target branch
          echo "üåø Creating clean documentation branch..."
          git fetch origin "$TARGET_BRANCH" || echo "‚ö†Ô∏è Unable to fetch target branch, using current state"
          
          # Create new documentation branch based on target branch
          if git show-ref --verify --quiet "refs/remotes/origin/$TARGET_BRANCH"; then
            echo "‚úÖ Creating documentation branch based on remote target branch origin/$TARGET_BRANCH"
            git checkout -b "$DOC_BRANCH" "origin/$TARGET_BRANCH"
          else
            echo "‚ö†Ô∏è Remote target branch does not exist, creating documentation branch based on current HEAD"
            git checkout -b "$DOC_BRANCH"
          fi
          
          # Copy documentation files to new branch
          echo "üìã Applying documentation files to clean branch..."
          
          # Re-copy documentation files to new branch
          if [ -d "$TEMP_DOCS_DIR/python/api" ] && [ "$(find "$TEMP_DOCS_DIR/python/api" -type f 2>/dev/null)" ]; then
            echo "üìã Applying Python API documentation..."
            mkdir -p python/docs/api
            cp -r "$TEMP_DOCS_DIR/python/api"/* python/docs/api/ 2>/dev/null || true
            git add python/docs/api/
          fi
          
          if [ -d "$TEMP_DOCS_DIR/typescript/api" ] && [ "$(find "$TEMP_DOCS_DIR/typescript/api" -type f 2>/dev/null)" ]; then
            echo "üìã Applying TypeScript API documentation..."
            mkdir -p typescript/docs/api
            cp -r "$TEMP_DOCS_DIR/typescript/api"/* typescript/docs/api/ 2>/dev/null || true
            git add typescript/docs/api/
          fi
          
          if [ -d "$TEMP_DOCS_DIR/golang/api" ] && [ "$(find "$TEMP_DOCS_DIR/golang/api" -type f 2>/dev/null)" ]; then
            echo "üìã Applying Golang API documentation..."
            mkdir -p golang/docs/api
            cp -r "$TEMP_DOCS_DIR/golang/api"/* golang/docs/api/ 2>/dev/null || true
            git add golang/docs/api/
          fi
          
          if [ -d "$TEMP_DOCS_DIR/llms" ] && [ "$(find "$TEMP_DOCS_DIR/llms" -type f 2>/dev/null)" ]; then
            echo "üìã Applying AI Assistant documentation..."
            cp "$TEMP_DOCS_DIR/llms"/* . 2>/dev/null || true
            git add llms.txt llms-full.txt 2>/dev/null || true
          fi
          
          # Check if there are files to commit
          FINAL_STAGED_FILES=$(git diff --cached --name-only)
          if [ -z "$FINAL_STAGED_FILES" ]; then
            echo "‚ÑπÔ∏è  No documentation changes on clean branch, skipping commit"
            git checkout "$CURRENT_BRANCH"
            git branch -D "$DOC_BRANCH"
            exit 0
          fi
          
          echo "üìù Preparing to commit the following documentation files on clean branch:"
          echo "$FINAL_STAGED_FILES"
          
          # Create commit message
          COMMIT_MESSAGE="ü§ñ Auto-generate documentation

          - Update API documentation (based on source code changes)
          - Regenerate AI Assistant documentation (llms.txt, llms-full.txt)
          - Sync documentation with latest code changes

          Generator: wuying-ai-team
          Trigger branch: ${{git.branch}}
          Commit ID: ${{git.commitId}}"
          
          # Commit documentation changes on clean branch
          git commit -m "$COMMIT_MESSAGE"
          echo "‚úÖ Documentation changes committed on clean branch $DOC_BRANCH"
          
          # Push documentation branch to remote and create CR review
          git push origin "$DOC_BRANCH"
          echo "‚úÖ Documentation branch pushed to remote"
          
          # Use git push refs/for syntax to create CR review
          echo "üîÑ Pushing to CR review system..."
          git push origin "HEAD:refs/for/$TARGET_BRANCH" || {
            echo "‚ö†Ô∏è Failed to push using refs/for, trying alternative methods..."
            
            # If refs/for fails, try using git command to create MR
            if command -v git-review >/dev/null 2>&1; then
              echo "üìã Using git-review to create review..."
              git review -t "$CR_TITLE" -m "$CR_DESCRIPTION" || echo "‚ö†Ô∏è git-review creation failed"
            else
              echo "üìã git-review not available, logging CR information for subsequent processing..."
            fi
          }
          
          # Switch back to original branch
          git checkout "$CURRENT_BRANCH"
          echo "üîÑ Switched back to original branch: $CURRENT_BRANCH"
          
          # Output CR creation results
          echo ""
          echo "‚úÖ Documentation branch and CR review creation completed!"
          echo "üìã CR review information:"
          echo "  - Source branch: $DOC_BRANCH"
          echo "  - Target branch: $TARGET_BRANCH"
          echo "  - Title: $CR_TITLE"
          echo "  - Included files: $(echo "$FINAL_STAGED_FILES" | wc -l) documentation files"
          echo ""
          echo "üîç Please review and process this CR in the code review system:"
          echo "   - Check documentation content accuracy"
          echo "   - Confirm API documentation is synchronized with code"
          echo "   - Verify AI Assistant documentation completeness"
          echo "   - Approve and merge to $TARGET_BRANCH branch after review"
