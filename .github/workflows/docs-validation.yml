name: Documentation Validation

on:
  push:
    branches: [ main, develop ]
    paths:
      - 'python/agentbay/**/*.py'
      - 'typescript/src/**/*.ts'
      - 'golang/pkg/**/*.go'
      - 'python/scripts/generate_api_docs.py'
      - 'typescript/scripts/enhance-typedoc-output.ts'
      - 'golang/scripts/generate_api_docs.go'
      - 'scripts/doc-metadata.yaml'
  pull_request:
    branches: [ main, develop ]
    paths:
      - 'python/agentbay/**/*.py'
      - 'typescript/src/**/*.ts'
      - 'golang/pkg/**/*.go'
      - 'python/scripts/generate_api_docs.py'
      - 'typescript/scripts/enhance-typedoc-output.ts'
      - 'golang/scripts/generate_api_docs.go'
      - 'scripts/doc-metadata.yaml'

jobs:
  validate-python-docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          cd python
          pip install poetry
          poetry install
      
      - name: Generate Python documentation
        run: |
          cd python
          poetry run python scripts/generate_api_docs.py
      
      - name: Validate documentation quality
        run: |
          python scripts/validate_documentation_quality.py
      
      - name: Validate code examples
        run: |
          python scripts/validate_code_examples.py
      
      - name: Check documentation links
        run: |
          python scripts/check_doc_links.py

  validate-typescript-docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: Install dependencies
        run: |
          cd typescript
          npm ci
      
      - name: Generate TypeScript documentation
        run: |
          cd typescript
          npm run generate:docs
      
      - name: Check for documentation changes
        run: |
          if [ -n "$(git status --porcelain typescript/docs/)" ]; then
            echo "Documentation is out of date. Please run 'npm run generate:docs'"
            exit 1
          fi

  validate-golang-docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.21'
      
      - name: Generate Golang documentation
        run: |
          cd golang
          go run scripts/generate_api_docs.go
      
      - name: Check for documentation changes
        run: |
          if [ -n "$(git status --porcelain golang/docs/)" ]; then
            echo "Documentation is out of date. Please run 'go run scripts/generate_api_docs.go'"
            exit 1
          fi

