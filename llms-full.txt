# AgentBay SDK Repository



<div align="center">

[![PyPI Downloads](https://img.shields.io/pypi/dm/wuying-agentbay-sdk?label=PyPI%20Downloads&logo=python&logoColor=white&cacheSeconds=86400)](https://pypi.org/project/wuying-agentbay-sdk/)
[![NPM Downloads](https://img.shields.io/npm/dm/wuying-agentbay-sdk?label=NPM%20Downloads&logo=npm)](https://www.npmjs.com/package/wuying-agentbay-sdk)
[![Go Report Card](https://goreportcard.com/badge/github.com/aliyun/wuying-agentbay-sdk/golang)](https://goreportcard.com/report/github.com/aliyun/wuying-agentbay-sdk/golang)
[![License](https://img.shields.io/badge/License-Apache%202.0-blue)](https://github.com/aliyun/wuying-agentbay-sdk/blob/main/LICENSE)

</div>

<p align="center">
  <picture>
    <source media="(prefers-color-scheme: dark)" srcset="./assets/Agentbay-dark.png" width="800px">
    <source media="(prefers-color-scheme: light)" srcset="./assets/Agentbay-light.png" width="800px">
    <img src="./assets/Agentbay-light.png" alt="AgentBay" width="800px" />
  </picture>
</p>

<p align="center">
  <b>The Cloud Sandbox Built for AI Agents</b>
  <br>
  <a href="docs/guides/browser-use/README.md">Browser</a> ¬∑
  <a href="docs/guides/computer-use/README.md">Desktop</a> ¬∑
  <a href="docs/guides/mobile-use/README.md">Mobile</a> ¬∑
  <a href="docs/guides/codespace/README.md">Code</a>
</p>

---

## üì¶ Installation

| Language | Install Command | Documentation |
|----------|----------------|---------------|
| Python | `pip install wuying-agentbay-sdk` | [Python Docs](python/README.md) |
| TypeScript | `npm install wuying-agentbay-sdk` | [TypeScript Docs](typescript/README.md) |
| Golang | `go get github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay` | [Golang Docs](golang/README.md) |

## üöÄ Prerequisites

Before using the SDK, you need to:

1. Register an Alibaba Cloud account: [https://aliyun.com](https://aliyun.com)
2. Get APIKEY credentials: [AgentBay Console](https://agentbay.console.aliyun.com/service-management)
3. Set environment variable:
   - For Linux/MacOS:
     ```bash
     export AGENTBAY_API_KEY=your_api_key_here
     ```
   - For Windows:
     ```cmd
     setx AGENTBAY_API_KEY your_api_key_here
     ```

## üöÄ Quick Start

### Python (Sync)
```python
from agentbay import AgentBay, CreateSessionParams

# Create session and execute code
agent_bay = AgentBay()
session = agent_bay.create(CreateSessionParams(image_id="code_latest")).session
result = session.code.run_code("print('Hello AgentBay')", "python")
if result.success:
    print(result.result)  # Hello AgentBay

# Clean up
agent_bay.delete(session)
```

### Python (Async)
```python
import asyncio
from agentbay import AsyncAgentBay, CreateSessionParams

async def main():
    # Create session and execute code
    agent_bay = AsyncAgentBay()
    session = (await agent_bay.create(CreateSessionParams(image_id="code_latest"))).session
    result = await session.code.run_code("print('Hello AgentBay')", "python")
    if result.success:
        print(result.result)  # Hello AgentBay

    # Clean up
    await agent_bay.delete(session)

if __name__ == "__main__":
    asyncio.run(main())
```

### TypeScript
```typescript
import { AgentBay } from 'wuying-agentbay-sdk';

// Create session and execute code
const agentBay = new AgentBay();
const session = (await agentBay.create({ imageId: "code_latest" })).session;
const result = await session.code.runCode("print('Hello AgentBay')", "python");
if (result.success) {
    console.log(result.result);  // Hello AgentBay
}

// Clean up
await agentBay.delete(session);
```

### Golang
```go
import "github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay"

// Create session and execute code
client, _ := agentbay.NewAgentBay("", nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("code_latest"))
session := result.Session

res, _ := session.Code.RunCode("print('Hello AgentBay')", "python")
fmt.Println(res.Output)  // Hello AgentBay

// Clean up
client.Delete(session, false)
```

## üîÑ Python Sync vs Async API

AgentBay Python SDK provides both synchronous and asynchronous APIs to suit different application needs.

| Feature | Sync API (`AgentBay`) | Async API (`AsyncAgentBay`) |
|---------|-----------------------|-----------------------------|
| **Import** | `from agentbay import AgentBay` | `from agentbay import AsyncAgentBay` |
| **Best for** | Scripts, simple tools, CLI apps | Web servers (FastAPI/Django), high-concurrency apps |
| **Blocking** | Yes, blocks thread until complete | No, allows other tasks to run |
| **Usage** | `client.create(...)` | `await client.create(...)` |

## üéØ Use Cases

<table>
<tr>
<td width="50%" align="center" valign="top">
  <img src="./assets/Browser Use@2x.png" width="460px" alt="Browser Use"/>
  <h3>üåê Browser Use</h3>
  <p>Automate web operations including content scraping, testing, and workflows. Cross-browser compatible with natural language control and remote access.</p>
  <p><a href="docs/guides/browser-use/README.md">Learn more ‚Üí</a></p>
</td>
<td width="50%" align="center" valign="top">
  <img src="./assets/Computer Use@2x.png" width="460px" alt="Computer Use"/>
  <h3>üñ•Ô∏è Computer Use</h3>
  <p>Cloud desktop environment for enterprise application automation. Standardized interfaces enable legacy software automation with intelligent resource scheduling.</p>
  <p><a href="docs/guides/computer-use/README.md">Learn more ‚Üí</a></p>
</td>
</tr>
<tr>
<td width="50%" align="center" valign="top">
  <img src="./assets/Mobile Use@2x.png" width="460px" alt="Mobile Use"/>
  <h3>üì± Mobile Use</h3>
  <p>Cloud-based mobile environment for intelligent app automation. Precise UI recognition and control with parallel task processing for testing scenarios.</p>
  <p><a href="docs/guides/mobile-use/README.md">Learn more ‚Üí</a></p>
</td>
<td width="50%" align="center" valign="top">
  <img src="./assets/Code Space@2x.png" width="460px" alt="Code Space"/>
  <h3>üíª Code Space</h3>
  <p>Professional cloud development environment supporting multi-language code generation, compilation, and debugging. Secure, intelligent automated programming experience.</p>
  <p><a href="docs/guides/codespace/README.md">Learn more ‚Üí</a></p>
</td>
</tr>
</table>

## üìö Documentation

**[Complete Documentation](docs/README.md)** - Full guides, tutorials, and API references

### üëã Choose Your Learning Path

**üÜï New Users** - If you're new to AgentBay or cloud development:
- [Quick Start Tutorial](docs/quickstart/README.md) - Get started in 5 minutes
- [Core Concepts](docs/quickstart/basic-concepts.md) - Understand cloud environments and sessions

**üöÄ Experienced Users** - Already familiar with browser automation, computer use, mobile testing, or cloud development environments:
- Choose your environment:
  - üåê [Browser Automation](docs/guides/browser-use/README.md) - Web scraping, testing, form filling with stealth capabilities
  - üñ•Ô∏è [Computer/Windows Automation](docs/guides/computer-use/README.md) - Desktop UI automation and window management
  - üì± [Mobile Automation](docs/guides/mobile-use/README.md) - Android UI testing and gesture automation
  - üíª [CodeSpace](docs/guides/codespace/README.md) - Cloud-based code execution environments
- [Feature Guides](docs/guides/README.md) - Complete feature introduction
- **API Reference** - Comprehensive API documentation with examples
  - [Python API Reference](python/docs/api/) - Auto-generated from source code
  - [TypeScript API Reference](typescript/docs/api/) - Auto-generated from source code
  - [Golang API Reference](golang/docs/api/) - Auto-generated from source code
  - üìù All API docs include complete runnable examples and actual output
- [Cookbook](cookbook/README.md) - Real-world examples and recipes

## üîß Core Features

### üéõÔ∏è Session Management
- **Session Creation & Lifecycle** - Create, manage, and delete cloud environments
- **Environment Configuration** - Configure SDK settings, regions, and endpoints  
- **Session Monitoring** - Monitor session status and health validation

### üõ†Ô∏è Common Modules
- **Command Execution** - Execute Shell commands in cloud environments
- **File Operations** - Upload, download, and manage cloud files
- **Data Persistence** - Save and retrieve data across sessions
- **Context Management** - Synchronize data and maintain state

### üéØ Scenario-Based Features
- **Computer Use** - General automation and desktop operations
- **Browser Use** - Web automation, scraping, and browser control  
- **CodeSpace** - Code execution and development environment
- **Mobile Use** - Mobile device simulation and control

## ü§ñ AI-Assisted Development

If you're using AI coding assistants (Claude, Cursor, GitHub Copilot, etc.) to develop with AgentBay SDK, you can use [llms.txt](./llms.txt) and [llms-full.txt](./llms-full.txt) as context for better code suggestions:

- **[llms.txt](./llms.txt)** - Concise documentation index (~900 tokens) for quick reference
- **[llms-full.txt](./llms-full.txt)** - Complete documentation corpus (~140k tokens) for comprehensive context

These files contain the full SDK documentation across all languages (Python, TypeScript, Golang), API references, and cookbook examples. Simply reference them in your AI assistant to get better understanding of the SDK's architecture and APIs.

## üÜò Get Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)

## üìû Contact

Welcome to visit our product website and join our community!

- üåê **AgentBay International Website**: [https://www.alibabacloud.com/product/agentbay](https://www.alibabacloud.com/product/agentbay)  
- üá®üá≥ **AgentBay China Website (Chinese)**: [https://www.aliyun.com/product/agentbay](https://www.aliyun.com/product/agentbay)  
- üí¨ **Discord Community**: [Join on Discord](https://discord.gg/kW55nTcT)  
- üíº **DingTalk Group**: [Click to join](https://qr.dingtalk.com/action/joingroup?code=v1,k1,ZlCDtu+p3xq2MqVoIA3nYrvEWA21Gq86N91t9OuythQ=&_dt_no_comment=1&origin=11)

## üìÑ License

This project is licensed under the Apache License 2.0 - see the [LICENSE](LICENSE) file for details.



---



# AgentBay SDK Documentation Center

> Complete documentation and development guides for the AgentBay SDK

## üìñ Getting Started

### New to AgentBay
- [Installation Guide](quickstart/installation.md) - SDK installation and environment setup
- [Basic Concepts](quickstart/basic-concepts.md) - Understand cloud environments and sessions
- [First Session](quickstart/first-session.md) - 5-minute quick start with hands-on examples


## üîß Feature Guides

- [Feature Guides Overview](guides/README.md) - Complete feature guides introduction

### Common Features (All Environments)
- [Common Features Guide](guides/common-features/README.md) - Features available across all environments

#### Basics
- [Session Management](guides/common-features/basics/session-management.md) - Cloud environment lifecycle management
- [Command Execution](guides/common-features/basics/command-execution.md) - Execute shell commands and scripts
- [File Operations](guides/common-features/basics/file-operations.md) - File upload, download, and management
- [Data Persistence](guides/common-features/basics/data-persistence.md) - Cross-session data storage

#### Advanced
- [Custom Images](guides/common-features/advanced/custom-images.md) - Create tailored environments with specific configurations
- [Session Link Access](guides/common-features/advanced/session-link-access.md) - Session connectivity and URL generation
- [VPC Sessions](guides/common-features/advanced/vpc-sessions.md) - Secure isolated network environments
- [Agent Modules](guides/common-features/advanced/agent-modules.md) - AI-powered task automation
- [OSS Integration](guides/common-features/advanced/oss-integration.md) - Object Storage Service integration

#### Configuration
- [SDK Configuration](guides/common-features/configuration/sdk-configuration.md) - Configuration options and settings

#### Use Cases
- [Use Cases Overview](guides/common-features/use-cases/README.md) - Common use case scenarios and implementations
- [Session Info Use Cases](guides/common-features/use-cases/session-info-use-cases.md) - Session information and connectivity patterns
- [Session Link Use Cases](guides/common-features/use-cases/session-link-use-cases.md) - Connect external tools to cloud sessions

### Environment-Specific Features

#### [Browser Use](guides/browser-use/README.md)
Complete browser automation for web scraping, testing, and form filling.

- [Core Features](guides/browser-use/core-features.md) - Basic browser operations
- [Advanced Features](guides/browser-use/advance-features.md) - Advanced browser capabilities
- [Code Examples](guides/browser-use/code-example.md) - Practical code samples
- [Browser Extensions](guides/browser-use/browser-extensions.md) - Extension management
- [Browser Replay](guides/browser-use/browser-replay.md) - Session replay functionality
- [Integrations](guides/browser-use/integrations.md) - Third-party integrations

**Key Capabilities:**
- [Browser Context](guides/browser-use/core-features/browser-context.md) - Context management
- [Browser Proxies](guides/browser-use/core-features/browser-proxies.md) - Network proxy configuration
- [CAPTCHA Handling](guides/browser-use/core-features/captcha.md) - Automated CAPTCHA solving
- [Extension Support](guides/browser-use/core-features/extension.md) - Browser extension management
- [Browser Fingerprint](guides/browser-use/core-features/browser-fingerprint.md) - Simulate browser fingerprint
- [Call for User](guides/browser-use/core-features/call-for-user.md) - User interaction requests
- [Page Agent](guides/browser-use/advance-features/page-use-agent.md) - AI-driven page operations

#### [Computer Use](guides/computer-use/README.md)
Windows desktop automation for application control and window management.

- [Computer Application Management](guides/computer-use/computer-application-management.md) - Application control and management
- [Computer UI Automation](guides/computer-use/computer-ui-automation.md) - Desktop UI interaction and automation
- [Window Management](guides/computer-use/window-management.md) - Window operations and focus management
- [Browser Capabilities by Image Type](guides/computer-use/browser-capabilities-by-image-type.md) - Understanding browser support across different images

**Key Capabilities:**
- Application Management (start, stop, list applications)
- Window Operations (maximize, minimize, resize, close)
- Focus Management
- Desktop Automation Workflows

#### [Mobile Use](guides/mobile-use/README.md)
Mobile UI automation for app testing and gesture-based interactions.

- [Mobile Application Management](guides/mobile-use/mobile-application-management.md) - Mobile app control and management
- [Mobile UI Automation](guides/mobile-use/mobile-ui-automation.md) - Mobile UI interaction and automation
- [ADB Connection](guides/mobile-use/adb-connection.md) - ADB connection and debugging capabilities
- [Mobile Session Configuration](guides/mobile-use/mobile-session-configuration.md) - Advanced mobile session configuration options

**Key Capabilities:**
- UI Element Detection
- Click Operations and Text Input
- Key Events and Swipe Gestures
- Screenshot Capture
- Mobile Application Management
- ADB Connection and Debugging

#### [CodeSpace](guides/codespace/README.md)
Development environment for code execution and scripting.

- [Code Execution](guides/codespace/code-execution.md) - Python and JavaScript code execution

**Key Capabilities:**
- Python and JavaScript Code Execution
- Shell Command Execution
- File System Operations
- Development Tools Integration
- Package Management (pip, npm, etc.)

#### Agent Module
An AI-powered Agent to complete tasks descibed in natural language

- [Agent Guide](guides/common-features/advanced/agent-modules.md) - Agent task execution guide

**Key Capabilities:**
- Office Automation: Word/Excel/PowerPoint automation
- File Operations: Create/Delete/Move/Copy files and folders
- Infomation Gathering: Gather information from the Internet
- Text Edition: Using notepad to edit text file

## üìö API Reference

- [Python SDK](../python/README.md) - Python version documentation
- [TypeScript SDK](../typescript/README.md) - TypeScript version documentation
- [Golang SDK](../golang/README.md) - Golang version documentation

## üöÄ Learning Paths

Choose the appropriate learning path based on your experience level:

### üÜï Complete Beginners
Start from the basics and build your knowledge step by step:
1. [Basic Concepts](quickstart/basic-concepts.md) - Understand core concepts
2. [Installation Guide](quickstart/installation.md) - Environment setup
3. [First Session](quickstart/first-session.md) - Hands-on practice
4. [Feature Guides](guides/README.md) - Explore specific features as needed

### üöÄ Experienced Developers
Already familiar with browser automation, computer use, or mobile testing? Start here:

**Quick Start (5 minutes):**
1. [Installation](quickstart/installation.md) - Set up your preferred SDK (Python/TypeScript/Golang)
2. Choose your environment based on your use case:
   - üåê [Browser Automation](guides/browser-use/README.md) - Web scraping, testing, form filling with stealth capabilities
   - üñ•Ô∏è [Computer/Windows Automation](guides/computer-use/README.md) - Desktop UI automation and window management
   - üì± [Mobile Automation](guides/mobile-use/README.md) - Android UI testing and gesture automation
   - üíª [CodeSpace](guides/codespace/README.md) - Cloud-based code execution environments

**What makes AgentBay different:**
- [Session Link](guides/common-features/advanced/session-link-access.md) - Direct URL access to services running in cloud sessions
- [Agent Modules](guides/common-features/advanced/agent-modules.md) - AI-powered automation capabilities
- [VPC Sessions](guides/common-features/advanced/vpc-sessions.md) - Secure isolated network environments

**Need more details?** See [Advanced Features](guides/common-features/advanced/README.md) or language-specific API docs: [Python](../python/README.md) | [TypeScript](../typescript/README.md) | [Golang](../golang/README.md)

## üìû Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues) - Report bugs or request features

---

üí° **Tip**: We recommend starting with the [Quick Start Tutorial](quickstart/README.md), then exploring specific feature guides as needed.




# Feature Guides

Welcome to the AgentBay SDK Feature Guides. This documentation provides comprehensive guides for using AgentBay SDK features across different environments and scenarios.

## Navigation

### Common Features

Features available across all environments:

**Basics**
- [Session Management](common-features/basics/session-management.md) - Create, connect, and manage cloud sessions
- [Command Execution](common-features/basics/command-execution.md) - Execute shell commands and scripts
- [File Operations](common-features/basics/file-operations.md) - Upload, download, and manipulate files
- [Data Persistence](common-features/basics/data-persistence.md) - Persistent data storage and synchronization

**Configuration**
- [SDK Configuration](common-features/configuration/sdk-configuration.md) - SDK settings and environment variables

**Advanced**
- [Custom Images](common-features/advanced/custom-images.md) - Create tailored environments with specific configurations
- [Session Link Access](common-features/advanced/session-link-access.md) - Session connectivity and URL generation
- [VPC Sessions](common-features/advanced/vpc-sessions.md) - Virtual private cloud session configuration
- [Agent Modules](common-features/advanced/agent-modules.md) - AI-driven automation capabilities
- [OSS Integration](common-features/advanced/oss-integration.md) - Object Storage Service integration

### Async Programming

Core concepts for building high-performance applications:


### Environment-Specific Features

**[Browser Use](browser-use/README.md)**
- [Core Features](browser-use/core-features.md) - Basic browser automation features
  - [Browser Fingerprint](browser-use/core-features/browser-fingerprint.md) - Simulate browser fingerprint
  - [Browser Context](browser-use/core-features/browser-context.md) - Isolated browser contexts
  - [Browser Proxies](browser-use/core-features/browser-proxies.md) - Proxy configuration
  - [CAPTCHA Handling](browser-use/core-features/captcha.md) - CAPTCHA solving strategies
  - [Extensions](browser-use/core-features/extension.md) - Browser extension support
  - [Call for User](browser-use/core-features/call-for-user.md) - User interaction handling
- [Advanced Features](browser-use/advance-features.md) - Advanced browser capabilities
  - [Page Agent](browser-use/advance-features/page-use-agent.md) - AI-powered page automation
- [Browser Extensions](browser-use/browser-extensions.md) - Extension development
- [Browser Replay](browser-use/browser-replay.md) - Session recording and replay
- [Code Examples](browser-use/code-example.md) - Browser automation code examples
- [Integrations](browser-use/integrations.md) - Third-party tool integrations

**[Computer Use](computer-use/README.md)**
- [Computer UI Automation](computer-use/computer-ui-automation.md) - Desktop UI interaction
- [Window Management](computer-use/window-management.md) - Window control and manipulation
- [Computer Application Management](computer-use/computer-application-management.md) - Application lifecycle management

**[Mobile Use](mobile-use/README.md)**
- [Mobile UI Automation](mobile-use/mobile-ui-automation.md) - Mobile UI interaction
- [Mobile Application Management](mobile-use/mobile-application-management.md) - App lifecycle management
- [ADB Connection](mobile-use/adb-connection.md) - Android Debug Bridge connectivity

**[CodeSpace](codespace/README.md)**
- [Code Execution](codespace/code-execution.md) - Running code in cloud environments

## Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Main Documentation](../README.md)




# AgentBay AIBrowser Guide

Welcome to the AgentBay AIBrowser Guides! This provides complete functionality introduction and best practices for experienced developers.

> **üí° Async API Support**: This guide uses synchronous API. For async patterns, see:

## üéØ Quick Navigation

- [Example](code-example.md) - Index for examples demonstrating core & advance features
- [Core Features](core-features.md) - Essential browser features and typical workflows
- [Advance Features](advance-features.md) - Advanced configuration and capabilities
- [Integrations](integrations.md) - Seamlessly weave with community tools and frameworks, extending your automation reach

## üöÄ What is AgentBay AIBrowser?

Agentbay AIBrowser is a managed platform for running headless/non-headless browsers at scale. It provides infrastructure to create and manage sessions, initialize browser instances, and allocate the underlying hardware resources on demand. It is designed for webpage automation scenarios such as filling out forms, simulating user actions, and orchestrating complex multi-step tasks across modern, dynamic websites.

The Agentbay AIBrowser API offers simple primitives to control browsers, practical utilities to create/manage sessions, and advanced AI capabilities to execute tasks described in natural language.

### Key Features

- Automation framework compatibility: Highly compatible with Playwright and Puppeteer via CDP
- Secure and scalable infrastructure: Managed sessions, isolation, and elastic resource allocation
- Observability: Session Replay, Session Inspector, and Live Mode for real-time debugging
- Advanced capabilities: Context management, IP proxy, and stealth/fingerprinting options
- AI-powered PageUseAgent: Execute natural-language tasks for complex web workflows
- Rich APIs: Clean primitives for sessions, browser lifecycle, and agent operations

### Quick Start (Python)

Below is a minimal, runnable example showing how to initialize the browser via the AgentBay Python SDK and drive it using Playwright over CDP. It follows the same flow as the reference example in `python/docs/examples/browser/visit_aliyun.py`.

Prerequisites:
- Set your API key: `export AGENTBAY_API_KEY=your_api_key`
- Install dependencies: `pip install wuying-agentbay-sdk playwright`
- Install Playwright browsers: `python -m playwright install chromium`

```python
import os
import asyncio
from agentbay import AgentBay
from agentbay import CreateSessionParams
from agentbay import BrowserOption
from playwright.async_api import async_playwright

async def main():
    api_key = os.getenv("AGENTBAY_API_KEY")
    if not api_key:
        raise RuntimeError("AGENTBAY_API_KEY environment variable not set")

    agent_bay = AgentBay(api_key=api_key)

    # Create a session (use an image with browser preinstalled)
    params = CreateSessionParams(image_id="browser_latest")
    session_result = agent_bay.create(params)
    if not session_result.success:
        raise RuntimeError(f"Failed to create session: {session_result.error_message}")

    session = session_result.session

    # Initialize browser (supports stealth, proxy, fingerprint, etc. via BrowserOption)
    ok = await session.browser.initialize_async(BrowserOption())
    if not ok:
        raise RuntimeError("Browser initialization failed")

    endpoint_url = session.browser.get_endpoint_url()

    # Connect Playwright over CDP and automate
    async with async_playwright() as p:
        browser = await p.chromium.connect_over_cdp(endpoint_url)
        context = browser.contexts[0]
        page = await context.new_page()
        await page.goto("https://www.aliyun.com")
        print("Title:", await page.title())
        await browser.close()

    session.delete()

if __name__ == "__main__":
    asyncio.run(main())
```

### Quick Start (Golang)

Below is a minimal, runnable example showing how to initialize the browser via the AgentBay Golang SDK and drive it using Playwright over CDP.

Prerequisites:
- Set your API key: `export AGENTBAY_API_KEY=your_api_key`
- Install Golang SDK: `go get github.com/aliyun/wuying-agentbay-sdk/golang`
- Install Playwright for Go: `go get github.com/playwright-community/playwright-go`
- Install Playwright browsers: `go run github.com/playwright-community/playwright-go/cmd/playwright@latest install chromium`

```go
package main

import (
	"fmt"
	"log"
	"os"

	"github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay"
	"github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay/browser"
	"github.com/playwright-community/playwright-go"
)

func main() {
	apiKey := os.Getenv("AGENTBAY_API_KEY")
	if apiKey == "" {
		log.Fatal("AGENTBAY_API_KEY environment variable not set")
	}

	// Authenticate with API key
	agentBay := agentbay.NewAgentBay(apiKey)

	// Create a session (use an image with browser preinstalled)
	params := &agentbay.CreateSessionParams{
		ImageId: "browser_latest",
	}
	sessionResult, err := agentBay.Create(params)
	if err != nil {
		log.Fatalf("Failed to create session: %v", err)
	}
	if !sessionResult.Success {
		log.Fatalf("Failed to create session: %s", sessionResult.ErrorMessage)
	}

	session := sessionResult.Session
	defer session.Delete()

	// Initialize browser (supports stealth, proxy, fingerprint, etc. via BrowserOption)
	ok, err := session.Browser.Initialize(browser.NewBrowserOption())
	if err != nil || !ok {
		log.Fatalf("Browser initialization failed: %v", err)
	}

	endpointURL, err := session.Browser.GetEndpointURL()
	if err != nil {
		log.Fatalf("Failed to get endpoint URL: %v", err)
	}

	// Connect Playwright over CDP and automate
	pw, err := playwright.Run()
	if err != nil {
		log.Fatalf("Failed to start Playwright: %v", err)
	}
	defer pw.Stop()

	browser, err := pw.Chromium.ConnectOverCDP(endpointURL)
	if err != nil {
		log.Fatalf("Failed to connect over CDP: %v", err)
	}
	defer browser.Close()

	contexts := browser.Contexts()
	if len(contexts) == 0 {
		log.Fatal("No browser contexts available")
	}
	context := contexts[0]

	page, err := context.NewPage()
	if err != nil {
		log.Fatalf("Failed to create new page: %v", err)
	}

	_, err = page.Goto("https://www.aliyun.com")
	if err != nil {
		log.Fatalf("Failed to navigate: %v", err)
	}

	title, err := page.Title()
	if err != nil {
		log.Fatalf("Failed to get title: %v", err)
	}
	fmt.Println("Title:", title)
}
```

First, the script authenticates by building an `AgentBay` client with your API key, establishing a trusted channel to the platform. 

Then it provisions a fresh execution environment by creating a session with a browser-enabled image, ensuring the necessary runtime is available. 

After that, the session‚Äôs browser is initialized with `BrowserOption()`, bringing up a remote browser instance ready for automation. 

Next, it retrieves the CDP endpoint URL via `get_endpoint_url()` and connects to it using Playwright‚Äôs `connect_over_cdp`, bridging your local code to the remote browser. 

Now, with a live connection established, the code opens a new page, navigates to a website, and can freely inspect or manipulate the DOM just like a local browser. 

Finally, when all work is complete, the session is explicitly deleted to release the allocated resources.

Key Browser APIs:
- `Browser.initialize(option: BrowserOption) -> bool` / `initialize_async(...)`: Start the browser instance for a session
- `Browser.get_endpoint_url() -> str`: Return CDP WebSocket endpoint; use with Playwright `connect_over_cdp`
- `Browser.is_initialized() -> bool`: Check if the browser is ready

## Basic Configurations

Sometimes the web needs a different mask and a different stage. By shaping the browser's identity and canvas, you can coax sites to reveal the experience meant for a specific device class or audience. Here we'll set a custom user agent and a precise viewport, then watch the page respond.

```python
import os
import asyncio
from agentbay import AgentBay
from agentbay import CreateSessionParams
from agentbay import BrowserOption, BrowserViewport
from playwright.async_api import async_playwright

CUSTOM_UA = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36"

async def main():
    agent_bay = AgentBay(api_key=os.environ["AGENTBAY_API_KEY"])  # first, authenticate

    params = CreateSessionParams(image_id="browser_latest")       # then, provision a browser-ready session
    result = agent_bay.create(params)
    if not result.success:
        raise RuntimeError(result.error_message)

    session = result.session

    # after that, define how the browser should look and feel
    option = BrowserOption(
        user_agent=CUSTOM_UA,                    # present ourselves with a custom identity
        viewport=BrowserViewport(width=1366, height=768),  # and stand on a stage sized like a common laptop
    )

    ok = await session.browser.initialize_async(option)
    if not ok:
        raise RuntimeError("Browser initialization failed")

    endpoint_url = session.browser.get_endpoint_url()      # now, discover the CDP doorway

    async with async_playwright() as p:
        browser = await p.chromium.connect_over_cdp(endpoint_url)  # step through and take control
        context = browser.contexts[0]
        page = await context.new_page()

        await page.goto("https://www.whatismybrowser.com/detect/what-is-my-user-agent")
        # verify our new voice and our new stage
        ua = await page.evaluate("navigator.userAgent")
        w = await page.evaluate("window.innerWidth")
        h = await page.evaluate("window.innerHeight")
        print("Effective UA:", ua)
        print("Viewport:", w, "x", h)

        await browser.close()

    session.delete()  # finally, bow out and free the stage

if __name__ == "__main__":
    asyncio.run(main())
```

**Golang:**

```go
package main

import (
	"fmt"
	"log"
	"os"

	"github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay"
	"github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay/browser"
	"github.com/playwright-community/playwright-go"
)

const CUSTOM_UA = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36"

func main() {
	// First, authenticate
	agentBay := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"))

	// Then, provision a browser-ready session
	params := &agentbay.CreateSessionParams{
		ImageId: "browser_latest",
	}
	result, err := agentBay.Create(params)
	if err != nil || !result.Success {
		log.Fatalf("Failed to create session: %v", err)
	}
	session := result.Session
	defer session.Delete()

	// After that, define how the browser should look and feel
	option := browser.NewBrowserOption()
	option.UserAgent = &CUSTOM_UA                     // present ourselves with a custom identity
	option.Viewport = &browser.BrowserViewport{       // and stand on a stage sized like a common laptop
		Width:  1366,
		Height: 768,
	}

	ok, err := session.Browser.Initialize(option)
	if err != nil || !ok {
		log.Fatalf("Browser initialization failed: %v", err)
	}

	// Now, discover the CDP doorway
	endpointURL, err := session.Browser.GetEndpointURL()
	if err != nil {
		log.Fatalf("Failed to get endpoint URL: %v", err)
	}

	// Step through and take control
	pw, err := playwright.Run()
	if err != nil {
		log.Fatalf("Failed to start Playwright: %v", err)
	}
	defer pw.Stop()

	browserInstance, err := pw.Chromium.ConnectOverCDP(endpointURL)
	if err != nil {
		log.Fatalf("Failed to connect over CDP: %v", err)
	}
	defer browserInstance.Close()

	context := browserInstance.Contexts()[0]
	page, err := context.NewPage()
	if err != nil {
		log.Fatalf("Failed to create page: %v", err)
	}

	_, err = page.Goto("https://www.whatismybrowser.com/detect/what-is-my-user-agent")
	if err != nil {
		log.Fatalf("Failed to navigate: %v", err)
	}

	// Verify our new voice and our new stage
	ua, err := page.Evaluate("navigator.userAgent")
	if err != nil {
		log.Fatalf("Failed to get user agent: %v", err)
	}
	w, err := page.Evaluate("window.innerWidth")
	if err != nil {
		log.Fatalf("Failed to get window width: %v", err)
	}
	h, err := page.Evaluate("window.innerHeight")
	if err != nil {
		log.Fatalf("Failed to get window height: %v", err)
	}

	fmt.Printf("Effective UA: %v\n", ua)
	fmt.Printf("Viewport: %v x %v\n", w, h)
}
```

First we authenticate and create a session that knows how to host a browser. Then, instead of accepting the default identity, we dress the browser in a chosen user agent and set a viewport that mirrors a familiar laptop screen. After that, we breathe life into the browser with `initialize_async`, request the CDP endpoint, and cross the bridge with Playwright. Now the page loads under our chosen disguise and dimensions; a quick glance at `navigator.userAgent` and the window size confirms the transformation. And when the scene is over, we close the curtain by deleting the session, returning the resources so another performance can begin.

### Browser Type Selection

> **Note:** The `browser_type` / `browserType` option is only available for **computer use images**. For standard browser images, Chromium is used by default.

By default, the browser initializes with Chromium, but when using computer use images, you can choose to use Chrome instead. This is useful when you need specific Chrome features or want to match a particular browser environment. Simply set the `browser_type` parameter in `BrowserOption`:

**Python:**
```python
from agentbay import BrowserOption
from agentbay import CreateSessionParams

# Create session with computer use image
params = CreateSessionParams(image_id="browser_latest")
result = agent_bay.create(params)
session = result.session

# Use Chrome instead of Chromium
option = BrowserOption(browser_type="chrome")
await session.browser.initialize_async(option)

# Or explicitly use Chromium (default)
option = BrowserOption(browser_type="chromium")
await session.browser.initialize_async(option)
```

**TypeScript:**
```typescript
import { CreateSessionParams } from '@wuying-org/agentbay-sdk';

// Create session with computer use image
const params = new CreateSessionParams({ imageId: 'browser_latest' });
const result = await agentBay.create(params);
const session = result.session;

// Use Chrome instead of Chromium (simple approach)
await session.browser.initializeAsync({ browserType: 'chrome' });

// Or explicitly use Chromium
await session.browser.initializeAsync({ browserType: 'chromium' });

// Or use default (undefined - let browser image decide)
await session.browser.initializeAsync({});
```

**Golang:**
```go
import (
	"github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay"
	"github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay/browser"
)

// Create session with computer use image
params := &agentbay.CreateSessionParams{
	ImageId: "browser_latest",
}
result, err := agentBay.Create(params)
if err != nil {
	// handle error
}
session := result.Session

// Use Chrome instead of Chromium
option := browser.NewBrowserOption()
chromeType := "chrome"
option.BrowserType = &chromeType

success, err := session.Browser.Initialize(option)
if err != nil || !success {
	// handle error
}

// Or explicitly use Chromium
chromiumType := "chromium"
option2 := browser.NewBrowserOption()
option2.BrowserType = &chromiumType

success, err = session.Browser.Initialize(option2)

// Or leave as default (nil, browser decides)
option3 := browser.NewBrowserOption()
// option3.BrowserType is nil by default

success, err = session.Browser.Initialize(option3)
```

The `browser_type` (Python), `browserType` (TypeScript), or `BrowserType` (Golang) option accepts:
- `"chromium"`: Uses the open-source Chromium browser
- `"chrome"`: Uses Google Chrome browser (only available in computer use images)
- `None`/`undefined`/`nil` (default): Lets the browser image decide which browser to use

If you want to explore more configurable capabilities, see Core Features: [core-features.md](core-features.md).

## Utilizing PageUseAgent

PageUseAgent lets you speak to the browser in natural language and have it carry out intent-driven actions. Instead of meticulously crafting selectors and sequences, you describe the goal; the agent interprets it, maps it to DOM operations, and executes the steps reliably‚Äîwith optional timeouts, iframe awareness, and variable injection for dynamic prompts.

Below we‚Äôll search for a book on Google. First we bring a browser to life and open Google, then we ask the agent to perform the task: type the query and open the first result.

```python
import os
import asyncio
from agentbay import AgentBay
from agentbay import CreateSessionParams
from agentbay import BrowserOption
from agentbay import ActOptions
from playwright.async_api import async_playwright

BOOK_QUERY = "The Pragmatic Programmer"

async def main():
    agent_bay = AgentBay(api_key=os.environ["AGENTBAY_API_KEY"])  # authenticate

    params = CreateSessionParams(image_id="browser_latest")       # provision session with browser image
    result = agent_bay.create(params)
    if not result.success:
        raise RuntimeError(result.error_message)
    session = result.session

    # initialize the remote browser
    if not await session.browser.initialize_async(BrowserOption()):
        raise RuntimeError("Browser initialization failed")

    endpoint_url = session.browser.get_endpoint_url()

    async with async_playwright() as p:
        browser = await p.chromium.connect_over_cdp(endpoint_url)
        context = browser.contexts[0]
        page = await context.new_page()

        # step onto the stage
        await page.goto("https://www.google.com")

        # ask the agent to act: type the book name into the search box
        act_result = await session.browser.agent.act_async(ActOptions(
            action=f"Type '{BOOK_QUERY}' into the search box and submit",
        ), page)
        print("act_result:", act_result.success, act_result.message)

        # let the agent open the first result
        open_first = await session.browser.agent.act_async(ActOptions(
            action="Click the first result in the search results",
        ), page)
        print("open_first:", open_first.success, open_first.message)

        # pause briefly to observe
        await page.wait_for_timeout(5000)
        await browser.close()

    session.delete()

if __name__ == "__main__":
    asyncio.run(main())
```

First we create and initialize a browser session as before; then, rather than hand-writing selectors, we simply tell the agent what to do‚Äîtype a query and proceed to the first result. After that, the agent translates our intent into concrete interactions on the page. Now the browser flows from search box to results like a guided hand. Finally, we close the browser and release the session.

About `PageUseAgent.act`:
- Can interpolate dynamic values using `variables` for reusable prompts
- Operates on the active Playwright page by resolving its `context_id` and `page_id` under the hood
- Returns a structured `ActResult` with `success`, `message`, useful for logging and recovery flows

If you want to explore full capability of PageUseAgent, or other more advance features, see Advance Features: [advance-features.md](advance-features.md).

### Limitations

PageUseAgent does not include a long-horizon planner and won‚Äôt orchestrate multi-step schedules by itself. It relies on your invoker (or a higher-level agent) to break a project into steps and call `act` or other PageUseAgent method for each one. Its strength is in precise, atomic web operations‚Äîclicking, filling, scrolling, etc.‚Äîexecuted quickly and consistently. This narrow focus is deliberate: it prioritizes throughput and accuracy of each step while leaving complex task planning and branching logic to external controllers.










# PageUseAgent Guide 

An AI-powered, natural-language web agent that performs precise, reliable page operations via AgentBay‚Äôs managed browser. It exposes simple SDK methods to navigate, observe, act, extract.

- Works with natural language instructions
- Supports structured extraction via Pydantic schemas
- Uses MCP tools under the hood (no local browser needed)
- Optional Playwright CDP connection for advanced scenarios

## Table of Contents

- [PageUseAgent Guide](#pageuseagent-guide)
  - [Table of Contents](#table-of-contents)
  - [Quick Start](#quick-start)
    - [Prerequisites](#prerequisites)
    - [Minimal Example](#minimal-example)
  - [Architecture Overview](#architecture-overview)
  - [Core APIs](#core-apis)
    - [Navigation](#navigation)
    - [Screenshot](#screenshot)
    - [Observe](#observe)
    - [Act](#act)
    - [Extract](#extract)
    - [Close Session](#close-session)
  - [End-to-End Examples](#end-to-end-examples)
    - [1) Recipe Site (Search + Extract)](#1-recipe-site-search--extract)
    - [2) Apple Purchase Flow (Sequence of Acts)](#2-apple-purchase-flow-sequence-of-acts)
    - [3) Amazon Demo (Observe ‚Üí Act ‚Üí Assert)](#3-amazon-demo-observe--act--assert)
  - [Error Handling and Debug](#error-handling-and-debug)
  - [Best Practices](#best-practices)
  - [FAQ](#faq)

---

## Quick Start

### Prerequisites

- Python 3.10+
- Install: `pip install wuying-agentbay-sdk`
- Set environment variable `AGENTBAY_API_KEY`

### Minimal Example

```python
import os
import asyncio
from pydantic import BaseModel, Field
from agentbay import AgentBay
from agentbay import CreateSessionParams
from agentbay import BrowserOption
from agentbay import BrowserAgent, ActOptions, ExtractOptions

class Product(BaseModel):
    name: str = Field(..., description="Product name")
    price: str | None = Field(None, description="Price text")
    link: str = Field(..., description="Relative product link like /products/abc")

class ProductList(BaseModel):
    products: list[Product]

async def main():
    agent_bay = AgentBay(api_key=os.getenv("AGENTBAY_API_KEY"))

    # Create a browser session
    params = CreateSessionParams(image_id="browser_latest")  # your image id
    session_result = agent_bay.create(params)
    if not session_result.success:
        print(f"Create session failed: {session_result.error_message}")
        return
    session = session_result.session

    # Initialize managed browser
    ok = await session.browser.initialize_async(BrowserOption())
    if not ok:
        print("Browser initialization failed")
        return

    agent: BrowserAgent = session.browser.agent

    # Navigate
    print(await agent.navigate_async("https://example.com"))

    # Act (natural language)
    await agent.act_async(action_input=ActOptions(action="go to products or shop page"))

    # Extract structured data
    ok, data = await agent.extract_async(
        options=ExtractOptions(
            instruction="Extract all products with name, optional price, and relative link",
            schema=ProductList,
            use_text_extract=True
        )
    )
    if ok:
        print(f"Extracted {len(data.products)} products")
    else:
        print("Extraction failed")

    # Clean up
    await agent.close_async()
    session.delete()

if __name__ == "__main__":
    asyncio.run(main())
```

Notes:
- `page` is optional; `None` uses the current managed page.
- `image_id` depends on your backend catalog (e.g., `browser_latest`).

---

## Architecture Overview

- Your code calls `BrowserAgent` (SDK).
- SDK invokes MCP tools within the managed browser image:
  - `page_use_navigate`
  - `page_use_observe`
  - `page_use_act`
  - `page_use_extract`
  - `page_use_screenshot`
  - `page_use_close_session`
- No local browser needed. Optionally, you can connect via Playwright CDP to the managed browser for custom checks.

---

## Core APIs

### Navigation

```python
# Sync
def navigate(self, url: str) -> str

# Async
async def navigate_async(self, url: str) -> str
```

- Description: Navigates the managed page to the given URL.
- Returns: Result message string.

Example:
```python
await agent.navigate_async("https://example.com")
```

---

### Screenshot

```python
# Sync
def screenshot(self, page=None, full_page=True, quality=80, clip=None, timeout=None) -> str

# Async
async def screenshot_async(self, page=None, full_page=True, quality=80, clip=None, timeout=None) -> str
```

- Returns: A base64-encoded PNG.
  - By default, the MCP tool wraps it as a data URL like `data:image/png;base64,<...>`.
  - If you call lower-level internals (e.g., CDP or event bus) you may receive raw base64 without the `data:image/...` prefix.
- `page` is optional; the managed page is used by default.

Parameters:
- full_page (bool): Capture the full scrollable page (default True).
- quality (int): 0‚Äì100, for JPEG format only (default 80).
- clip (dict | None): Clipping region with keys {x, y, width, height}. If provided, `full_page` is ignored.
- timeout (int | None): Operation timeout in ms.

Example (robust decode for both formats):
```python
data = await agent.screenshot_async()
if data.startswith("data:image/"):
    header, encoded = data.split(",", 1)
    png_bytes = base64.b64decode(encoded)
else:
    png_bytes = base64.b64decode(data)
```

---

### Observe

```python
# Options
class ObserveOptions:
    def __init__(self, instruction: str, iframes: bool | None = None, dom_settle_timeout_ms: int | None = None)

# Result
class ObserveResult:
    def __init__(self, selector: str, description: str, method: str, arguments: dict)

# APIs
def observe(self, page, options: ObserveOptions) -> tuple[bool, list[ObserveResult]]
async def observe_async(self, page, options: ObserveOptions) -> tuple[bool, list[ObserveResult]]
```

- Description: Finds elements or actionable targets based on natural language.
- Returns: `(success, [ObserveResult])`

Example:
```python
ok, items = await agent.observe_async(
    options=ObserveOptions(
        instruction="find the Add to Cart button",
    )
)
```

---

### Act

```python
# Options
class ActOptions:
    def __init__(self, action: str, timeoutMS: int | None = None, iframes: bool | None = None,
                 dom_settle_timeout_ms: int | None = None, variables: dict[str, str] | None = None)

# Result
class ActResult:
    def __init__(self, success: bool, message: str, action: str)

# APIs
def act(self, action_input: Union[ObserveResult, ActOptions], page) -> ActResult
async def act_async(self, action_input: Union[ObserveResult, ActOptions], page) -> ActResult
```

- Description: Performs an action with NL instruction or using an `ObserveResult`.
- Returns: `ActResult(success, message, action)`

Examples:
```python
# Natural language
await agent.act_async(action_input=ActOptions(action="type 'ipad' in the search bar and press enter"))

# Act on observed element
ok, items = await agent.observe_async(options=ObserveOptions(instruction="find the sign in button"))
if ok and items:
    await agent.act_async(action_input=items[0])
```

---

### Extract

```python
# Generic Options
class ExtractOptions(Generic[T]):
    def __init__(self, instruction: str, schema: Type[T], use_text_extract: bool | None = None,
                 selector: str | None = None, iframe: bool | None = None,
                 dom_settle_timeout_ms: int | None = None, use_vision: bool | None = None)

# APIs
def extract(self, options: ExtractOptions[T], page) -> tuple[bool, T]
async def extract_async(self, options: ExtractOptions[T], page) -> tuple[bool, T]
```

- Description: Extracts structured data as a Pydantic model instance.
- Returns: `(success, model_instance)`
- Options:
  - use_text_extract (bool): Prefer text-based parsing when true (useful for text-heavy pages).
  - use_vision (bool): Attach a viewport screenshot to help the model interpret visually-indicated states (optional).
  - selector, iframe, dom_settle_timeout_ms: Narrow scope or tune stability.

Example:
```python
from pydantic import BaseModel

class Item(BaseModel):
    name: str
    price: str | None
    link: str

class ItemList(BaseModel):
    products: list[Item]

ok, result = await agent.extract_async(
    options=ExtractOptions(
        instruction="extract all products with name, price and link",
        schema=ItemList,
        use_text_extract=True,
        use_vision=True
    )
)
```

---

### Close Session

```python
async def close_async(self) -> bool
```

- Gracefully closes the remote browser agent session.

---

## End-to-End Examples

### 1) Recipe Site (Search + Extract)

```python
from pydantic import BaseModel, Field
from agentbay import ActOptions, ExtractOptions

class RecipeDetails(BaseModel):
    title: str = Field(..., description="Recipe title")
    total_ratings: int | None

await agent.navigate_async("https://www.allrecipes.com/")
await agent.act_async(action_input=ActOptions(action='type "chocolate chip cookies" in the search bar'))
await agent.act_async(action_input=ActOptions(action="press enter"))

ok, data = await agent.extract_async(
    options=ExtractOptions(
        instruction="extract the title and the total number of ratings from the first recipe",
        schema=RecipeDetails,
        use_text_extract=True,
    )
)
```

### 2) Apple Purchase Flow (Sequence of Acts)

```python
actions = [
    "click on the buy button",
    "select the Pro Max model",
    "select the natural titanium color",
    "select the 256GB storage option",
    "click on the 'select a smartphone' trade-in option",
    "select the iPhone 13 mini model from the dropdown",
    "select the iPhone 13 mini is in good condition",
]

for a in actions:
    await agent.act_async(action_input=ActOptions(action=a))
```

### 3) Amazon Demo (Observe ‚Üí Act ‚Üí Assert)

```python
from agentbay import ObserveOptions

ok, obs1 = await agent.observe_async(
    options=ObserveOptions(instruction="Find and click the 'Add to Cart' button")
)
if ok and obs1:
    await agent.act_async(action_input=obs1[0])

ok, obs2 = await agent.observe_async(
    options=ObserveOptions(instruction="Find and click the 'Proceed to checkout' button")
)
if ok and obs2:
    await agent.act_async(action_input=obs2[0])
```

---

## Error Handling and Debug

- Exceptions surfaced by the SDK:
  - `BrowserError`: SDK-side or tool invocation failures.
  - `AgentBayError`: Service-related errors (wrapped to `BrowserError` by default).

- Result types:
  - `ActResult`: `{ success: bool, message: str, action: str }`
  - `observe` returns `(success: bool, results: list[ObserveResult])`
  - `extract` returns `(success: bool, data: T)`

- MCP validation hints:
  - If you see Pydantic validation errors (e.g., dropdown indices must be >= 1), ensure your generated action JSON conforms to the tool schema.
  - Avoid passing extra fields not defined in the schema.

---

## Best Practices

- Write concise, unambiguous natural-language actions.
- For structured data, always define strict Pydantic schemas.
- Use `use_text_extract=True` for text-heavy pages; use DOM-based for structured layouts.
- Consider `use_vision=True` for visually-driven pages to improve robustness.
- Chain `Observe -> Act` when direct acting is ambiguous.
- Consider small waits between dependent steps on dynamic pages.

---

## FAQ

- Do I need Playwright locally?
  - The agent runs in a managed browser session. Local Playwright is optional for your custom checks via CDP.

- How do I pass variables into actions?
  - Use `ActOptions.variables` (dict) and ensure your backend/tooling supports placeholders.

- How do screenshots return?
  - By default, as a data URL `data:image/png;base64,<...>`. If you use lower-level internals, you may get raw base64 without the header.

- Observe vs Extract?
  - `observe` finds actionable elements; `extract` returns structured data based on your schema.
## üìö Related Guides

- [Browser Use Overview](../README.md) - Complete browser automation features
- [Session Management](../../common-features/basics/session-management.md) - Session lifecycle and configuration
- [Code Examples](../code-example.md) - PageUseAgent example code

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../../README.md)




# AIBrowser Advance Features

## PageUseAgent

- [PageUseagent](advance-features/page-use-agent.md) - An AI-powered, natural-language describing task supported web agent for precise, reliable page operations 
## üìö Related Guides

- [PageUseAgent Guide](advance-features/page-use-agent.md) - AI-powered web automation
- [Browser Use Overview](README.md) - Complete browser automation features
- [Core Features](core-features.md) - Browser core capabilities
- [Code Examples](code-example.md) - PageUseAgent example code

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../README.md)




# Browser Extension Management Guide

This guide covers how to use browser extensions with the AgentBay SDK for automated testing and browser automation workflows.

## Overview

The AgentBay SDK provides comprehensive browser extension management capabilities, allowing you to:

- Upload and manage browser extensions in the cloud
- Automatically synchronize extensions to browser sessions
- Test extension functionality in controlled environments
- Develop and iterate on extensions with cloud infrastructure

## Prerequisites

- AgentBay Python SDK installed (`pip install wuying-agentbay-sdk`)
- Valid AgentBay API key
- Browser extension packaged as ZIP file
- Basic understanding of browser automation concepts

## Quick Start

### 1. Basic Extension Upload and Usage

```python
from agentbay import AgentBay
from agentbay import ExtensionsService
from agentbay import CreateSessionParams, BrowserContext

# Initialize AgentBay and Extensions Service
agent_bay = AgentBay(api_key="your_api_key")
extensions_service = ExtensionsService(agent_bay)

# Upload your extension
extension = extensions_service.create("/path/to/your-extension.zip")
print(f"Extension uploaded: {extension.name} (ID: {extension.id})")

# Create browser session with extension
ext_option = extensions_service.create_extension_option([extension.id])

session_params = CreateSessionParams(
    labels={"purpose": "extension_testing"},
    browser_context=BrowserContext(
        context_id="extension_test_session",
        extension_option=ext_option
    )
)

# Create session - extension will be automatically synchronized
session_result = agent_bay.create(session_params)
session = session_result.session

# Extensions are now available at /tmp/extensions/ in the session
print("Extension session created successfully!")

# Clean up when done
extensions_service.cleanup()
```

### 2. Working with Multiple Extensions

```python
# Upload multiple extensions
extension_paths = [
    "/path/to/extension1.zip",
    "/path/to/extension2.zip",
    "/path/to/extension3.zip"
]

extension_ids = []
for path in extension_paths:
    ext = extensions_service.create(path)
    extension_ids.append(ext.id)
    print(f"‚úÖ Uploaded: {ext.name}")

# Create session with all extensions
ext_option = extensions_service.create_extension_option(extension_ids)

session_params = CreateSessionParams(
    browser_context=BrowserContext(
        context_id="multi_extension_session",
        extension_option=ext_option
    )
)

session = agent_bay.create(session_params).session
```

## Core Concepts

### Extension Context Management

The SDK automatically manages extension storage contexts:

- **Auto-creation**: If no context is specified, a unique context is created automatically
- **Context reuse**: Specify a context name to reuse existing extension storage
- **Automatic cleanup**: Contexts created by the service can be automatically cleaned up

```python
# Auto-generated context (recommended for simple use cases)
extensions_service = ExtensionsService(agent_bay)

# Named context (recommended for persistent extension management)
extensions_service = ExtensionsService(agent_bay, "my_project_extensions")

# Context will be created if it doesn't exist
```

### Extension Synchronization

Extensions are automatically synchronized to browser sessions:

- **Automatic sync**: No manual intervention required
- **File location**: Extensions available at `/tmp/extensions/{extension_id}/` in sessions
- **Session isolation**: Each session gets its own copy of extensions

## Common Workflows

### Extension Development and Testing

```python
class ExtensionDevelopmentWorkflow:
    def __init__(self, api_key: str):
        self.agent_bay = AgentBay(api_key=api_key)
        self.extensions_service = ExtensionsService(self.agent_bay, "dev_extensions")
        self.extension_id = None
    def upload_extension(self, extension_path: str) -> str:
        """Upload extension for development testing."""
        extension = self.extensions_service.create(extension_path)
        self.extension_id = extension.id
        print(f"‚úÖ Extension uploaded: {extension.name}")
        return extension.id

    def create_test_session(self) -> 'Session':
        """Create a browser session for testing."""
        ext_option = self.extensions_service.create_extension_option([self.extension_id])

        session_params = CreateSessionParams(
            labels={"purpose": "extension_development"},
            browser_context=BrowserContext(
                context_id="dev_session",
                extension_option=ext_option
            )
        )

        return self.agent_bay.create(session_params).session

    def update_and_test(self, new_extension_path: str):
        """Update extension and create new test session."""
        # Update existing extension
        updated_ext = self.extensions_service.update(self.extension_id, new_extension_path)
        print(f"‚úÖ Extension updated: {updated_ext.name}")

        # Create new test session with updated extension
        return self.create_test_session()

    def cleanup(self):
        """Clean up development resources."""
        if self.extension_id:
            self.extensions_service.delete(self.extension_id)
        self.extensions_service.cleanup()

# Usage
workflow = ExtensionDevelopmentWorkflow(api_key="your_api_key")
try:
    # Development cycle
    workflow.upload_extension("/path/to/extension-v1.zip")
    session1 = workflow.create_test_session()
    # Test extension functionality...

    # Update and test again
    session2 = workflow.update_and_test("/path/to/extension-v2.zip")
    # Test updated functionality...

finally:
    workflow.cleanup()
```

### Automated Extension Testing

```python
def run_extension_tests(extension_paths: List[str]) -> bool:
    """Run automated tests on multiple extensions."""

    agent_bay = AgentBay()
    extensions_service = ExtensionsService(agent_bay)

    try:
        # Upload all test extensions
        extension_ids = []
        for path in extension_paths:
            ext = extensions_service.create(path)
            extension_ids.append(ext.id)
            print(f"üì¶ Uploaded test extension: {ext.name}")

        # Create test session
        ext_option = extensions_service.create_extension_option(extension_ids)

        session_params = CreateSessionParams(
            labels={"test_type": "automated_extension_testing"},
            browser_context=BrowserContext(
                context_id="auto_test_session",
                extension_option=ext_option
            )
        )

        session = agent_bay.create(session_params).session

        # Wait for extension synchronization
        print("‚è≥ Waiting for extension synchronization...")

        # Run your extension tests here
        # Extensions are available at /tmp/extensions/ in the session
        test_results = run_test_suite(session)

        return test_results.all_passed

    except Exception as e:
        print(f"‚ùå Test failed: {e}")
        return False
    finally:
        extensions_service.cleanup()

# Usage
test_extensions = [
    "/path/to/test-extension-1.zip",
    "/path/to/test-extension-2.zip"
]

success = run_extension_tests(test_extensions)
print(f"Test result: {'‚úÖ PASSED' if success else '‚ùå FAILED'}")
```

## Best Practices

### 1. Context Management

‚úÖ **Do:**

- Use descriptive context names for persistent projects
- Let the service auto-generate contexts for simple use cases
- Always call `cleanup()` in finally blocks

‚ùå **Don't:**

- Hardcode context IDs in your application code
- Forget to clean up auto-created contexts
- Mix extensions from different projects in the same context

### 2. Extension File Management

‚úÖ **Do:**

- Use ZIP format for all extension packages
- Validate file existence before upload
- Include proper manifest.json in extensions
- Handle upload errors gracefully

‚ùå **Don't:**

- Upload uncompressed extension directories
- Skip file validation steps
- Ignore upload error responses

### 3. Session Management

‚úÖ **Do:**

- Use meaningful labels for sessions
- Wait for extension synchronization before testing
- Create one ExtensionOption per session

‚ùå **Don't:**

- Start testing immediately after session creation
- Reuse ExtensionOption across multiple sessions
- Forget to specify browser_context when using extensions

### 4. Error Handling

```python
from agentbay import AgentBayError

def robust_extension_workflow():
    extensions_service = None
    try:
        agent_bay = AgentBay()
        extensions_service = ExtensionsService(agent_bay, "production_extensions")
        # Validate extension file
        extension_path = "/path/to/production-extension.zip"
        if not os.path.exists(extension_path):
            raise FileNotFoundError(f"Extension not found: {extension_path}")

        # Upload with error handling
        extension = extensions_service.create(extension_path)
        print(f"‚úÖ Extension uploaded: {extension.id}")

        # Create session with validation
        ext_option = extensions_service.create_extension_option([extension.id])
        if not ext_option.validate():
            raise ValueError("Invalid extension configuration")
        session_params = CreateSessionParams(
            browser_context=BrowserContext(
                context_id="production_session",
                extension_option=ext_option
            )
        )

        session = agent_bay.create(session_params).session
        return session

    except FileNotFoundError as e:
        print(f"‚ùå File error: {e}")
        return None
    except AgentBayError as e:
        print(f"‚ùå AgentBay error: {e}")
        return None
    except Exception as e:
        print(f"‚ùå Unexpected error: {e}")
        return None
    finally:
        if extensions_service:
            extensions_service.cleanup()
```

## Troubleshooting

### Common Issues

**Extension not found in session:**

- Check that extension was uploaded successfully
- Verify session was created with proper ExtensionOption
- Wait for synchronization to complete before accessing files

**Upload failures:**

- Ensure file is in ZIP format
- Check file permissions and accessibility
- Verify API key and network connectivity

**Context errors:**

- Use unique context names to avoid conflicts
- Don't mix extensions from different sources
- Clean up contexts when no longer needed

### Debugging Tips

```python
# Enable verbose logging
import logging
logging.basicConfig(level=logging.DEBUG)

# Check extension list
extensions = extensions_service.list()
print(f"Available extensions: {[ext.name for ext in extensions]}")

# Validate extension option
ext_option = extensions_service.create_extension_option([extension.id])
print(f"Extension option valid: {ext_option.validate()}")
print(f"Extension option: {ext_option}")

# Check session creation result
session_result = agent_bay.create(session_params)
if not session_result.success:
    print(f"Session creation failed: {session_result.error_message}")
```

## Integration with Browser Automation

Extensions work seamlessly with browser automation tools:

```python
from playwright.sync_api import sync_playwright

# Create session with extensions
session = create_extension_session()

# Get browser endpoint
endpoint_url = session.browser.get_endpoint_url()

# Connect with Playwright
with sync_playwright() as p:
    browser = p.chromium.connect_over_cdp(endpoint_url)
    context = browser.contexts[0]
    page = await context.new_page()

    # Extensions are already loaded and available
    page.goto("https://example.com")

    # Your extension should be active here
    # Test extension functionality...

    browser.close()
```

## üìö Related Guides

- [Extension Management](core-features/extension.md) - Detailed extension management guide
- [Browser Context](core-features/browser-context.md) - Persistent browser state management
- [Browser Use Overview](README.md) - Complete browser automation features
- [Session Management](../common-features/basics/session-management.md) - Session lifecycle and configuration

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../README.md)




# Browser Replay Guide

This guide covers how to use AgentBay's built-in browser replay feature to capture browser interactions and replay them for debugging, documentation, or compliance purposes.

## Overview

AgentBay provides automatic browser replay capabilities for browser sessions, powered by the **rrweb** (record and replay the web) framework. This allows you to:

- üé• **Record all browser interactions** automatically with high fidelity
- üìä **Monitor user interactions** for compliance and training
- üêõ **Debug complex workflows** by reviewing detailed replays
- üîç **Analyze user behavior** with frame-by-frame precision

### Why rrweb?

rrweb is a modern, open-source solution that offers several advantages over traditional screen recording:

- **Precise DOM capture** - Records actual DOM changes, not just visual pixels
- **Efficient storage** - Only captures changes, resulting in smaller file sizes
- **Cross-platform compatibility** - Works consistently across different browsers and devices
- **Interactive replay** - Allows pausing, seeking, and step-by-step analysis
- **Event-based recording** - Captures incremental changes rather than full page snapshots

**Note:** rrweb focuses on DOM and user interaction recording. AgentBay enhances this with additional console and network monitoring capabilities.

## Quick Start

### 1. Enable Browser Replay

To enable browser replay, set `enable_browser_replay=True` when creating a session:

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams

# Create session with browser replay enabled
params = CreateSessionParams(
    image_id="browser_latest",
    enable_browser_replay=True,  # üé¨ Enable browser replay
)

result = agent_bay.create(params)
session = result.session
```

### 2. Perform Browser Operations

Once browser replay is enabled, all browser interactions will be automatically captured:

```python
from agentbay import BrowserOption
from playwright.sync_api import sync_playwright

# Initialize browser
browser = session.browser
browser.initialize(BrowserOption())
endpoint_url = browser.get_endpoint_url()

# All operations will be recorded
with sync_playwright() as p:
    playwright_browser = p.chromium.connect_over_cdp(endpoint_url)
    # Create a new page with default context
    default_context = playwright_browser.contexts[0]
    page = default_context.new_page()

    # These actions will be recorded
    page.goto("https://example.com")
    page.fill("input[name='search']", "AgentBay")
    page.click("button[type='submit']")

    page.close()
```

### 3. Replay Files Storage

Browser replay files are automatically generated and stored by the system. These files can be accessed through the [AgentBay CONSOLE](https://agentbay.console.aliyun.com/session-log) website.

## Browser Replay Details

### What Gets Captured

The browser replay captures information using rrweb's advanced recording capabilities, enhanced with additional monitoring:

  - ‚úÖ **DOM mutations** - Element changes, additions, removals, and CSS modifications
  - ‚úÖ **Console output** - Logs, errors, warnings, and debug messages
  - ‚úÖ **Network activity** - HTTP requests, API calls, and WebSocket connections


## Use Cases

### 1. Automated Testing

Record test execution for debugging failed tests:

```python
def run_test_with_replay():
    # Create session with browser replay
    params = CreateSessionParams(
        image_id="browser_latest",
        enable_browser_replay=True,
        labels={"test_type": "ui_automation", "replay": "enabled"}
    )

    session = agent_bay.create(params).session

    try:
        # Run your test - all actions will be recorded
        run_ui_test(session)
        print("Test completed - replay files generated for review")
    except Exception as e:
        # Test failed - replay files can help debug
        print(f"Test failed: {e}")
        print("Browser replay files are available for debugging")
    finally:
        agent_bay.delete(session)
```

### 2. User Journey Documentation

Record user workflows for documentation:

```python
def document_user_journey():
    params = CreateSessionParams(
        image_id="browser_latest",
        enable_browser_replay=True,
        labels={"purpose": "documentation", "workflow": "user_onboarding"}
    )

    session = agent_bay.create(params).session

    # Perform the user journey steps
    simulate_user_onboarding(session)

    print("User journey recorded - replay files generated for documentation")

    agent_bay.delete(session)
```

### 3. Compliance and Auditing

Record sessions for compliance purposes:

```python
def compliance_session():
    params = CreateSessionParams(
        image_id="browser_latest",
        enable_browser_replay=True,
        labels={
            "compliance": "SOX",
            "auditor": "external",
            "session_type": "compliance_check"
        }
    )

    session = agent_bay.create(params).session

    # Perform compliance-sensitive operations
    perform_financial_operations(session)

    print("Compliance operations recorded for audit trail")

    agent_bay.delete(session)
```

## Best Practices

### Performance Considerations

1. **Session Duration**: Longer sessions create larger recording files
2. **Resolution**: Higher resolution = larger files but better quality
3. **Activity Level**: More interactions = more data to record

### Security Considerations

1. **Sensitive Data**: Be aware that browser replay captures all visible content
2. **Session Access**: Control who can create sessions with replay enabled
3. **Label Management**: Use proper labels for categorizing and tracking replay sessions

## Troubleshooting

### Common Issues

**Browser replay not working:**
```python
# Verify that replay is enabled
if hasattr(session, 'enableBrowserReplay'):
    print(f"Browser replay enabled: {session.enableBrowserReplay}")
else:
    print("Browser replay not enabled - check session parameters")
```

**Session creation with replay fails:**
```python
# Check session parameters
params = CreateSessionParams(
    image_id="browser_latest",  # Must use browser image
    enable_browser_replay=True,         # Enable replay
    labels={"replay": "enabled"}
)
```

## Advanced Features

### Session Context and Metadata

Add context to your browser replay sessions using session labels:

```python
params = CreateSessionParams(
    image_id="browser_latest",
    enable_browser_replay=True,
    labels={
        "replay_purpose": "bug_reproduction",
        "bug_id": "ISSUE-1234",
        "user_id": "test_user_001",
        "test_environment": "staging",
        "browser_version": "chrome_latest"
    }
)
```

This metadata helps with session organization and tracking but does not affect the replay functionality itself.

## Example: Complete Browser Replay Workflow

Here's a complete example that demonstrates the full browser replay workflow:

```python
#!/usr/bin/env python3
"""Complete browser replay workflow example"""

import os
import time
from agentbay import AgentBay
from agentbay import CreateSessionParams
from agentbay import BrowserOption
from playwright.sync_api import sync_playwright

def complete_replay_workflow():
    # Initialize
    agent_bay = AgentBay(api_key=os.getenv("AGENTBAY_API_KEY"))

    # 1. Create session with browser replay
    params = CreateSessionParams(
        image_id="browser_latest",
        enable_browser_replay=True,
        labels={"example": "complete_workflow", "replay": "enabled"}
    )

    session = agent_bay.create(params).session
    print(f"‚úÖ Session created: {session.session_id}")
    print(f"üìπ Browser replay enabled: {session.enableBrowserReplay}")

    try:
        # 2. Perform browser operations
        browser = session.browser
        browser.initialize(BrowserOption())

        with sync_playwright() as p:
            playwright_browser = p.chromium.connect_over_cdp(browser.get_endpoint_url())
            # Create a new page with default context
            default_context = playwright_browser.contexts[0]
            page = default_context.new_page()

            # All interactions will be captured
            page.goto("https://example.com")
            page.click("a[href='#']")  # Example interaction
            time.sleep(2)

            page.close()
            playwright_browser.close()

        print("‚úÖ Browser operations completed - replay files generated")

    finally:
        # 3. Cleanup
        agent_bay.delete(session)
        print("‚úÖ Session cleaned up")

if __name__ == "__main__":
    complete_replay_workflow()
```
## üìö Related Guides

- [Browser Use Overview](README.md) - Complete browser automation features
- [Session Management](../common-features/basics/session-management.md) - Session lifecycle and configuration

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../README.md)




# Code Example

## Basic Use for AIBrowser

### Basic automation

- [Simple visit](../../../python/docs/examples/_async/browser-use/browser/visit_aliyun.py) - A minimal example showing how to initialize the browser with basic AIBrowser API call

- [Viewport and UserAgent (Python)](../../../python/docs/examples/_async/browser-use/browser/browser_viewport.py) - A python example showing how to initialize the browser with custom viewport and user-agent settings
- [Viewport and UserAgent (TypeScript)](../../../typescript/docs/examples/browser-use/browser/browser-viewport.ts) - A typescript example showing how to initialize the browser with custom viewport and user-agent settings

## Core Features

### Context

- [Cookie Persistence (Python)](../../../python/docs/examples/_async/browser-use/browser/browser_context_cookie_persistence.py) - Demonstrate how to persist cookies across multiple browser sessions using Browser Context
- [Cookie Persistence (TypeScript)](../../../typescript/docs/examples/browser-use/browser/browser-context-cookie-persistence.ts) - TypeScript version of cookie persistence example

### Extension

- [Basic Extension Usage (Python)](../../../python/docs/examples/_async/browser-use/extension/basic_extension_usage.py) - Basic extension upload and browser session creation with extensions
- [Basic Extension Usage (TypeScript)](../../../typescript/docs/examples/browser-use/extension-example/extension-example.ts) - Comprehensive extension management in TypeScript

### Upload/Download

### Fingerprint
- [Random fingerprint (Python)](../../../python/docs/examples/_async/browser-use/browser/browser_fingerprint_basic_usage.py) - A python example showing how to use browser with random fingerprint
- [Random fingerprint (TypeScript)](../../../typescript/docs/examples/browser-use/browser/browser-fingerprint-basic-usage.ts) - A typescript example showing how to use browser with random fingerprint
- [Fingerprint construct (Python)](../../../python/docs/examples/_async/browser-use/browser/browser_fingerprint_construct.py) - A python example showing how to construct browser fingerprint from file
- [Fingerprint construct (TypeScript)](../../../typescript/docs/examples/browser-use/browser/browser-fingerprint-construct.ts) - A typescript example showing how to construct browser fingerprint from file
- [Fingerprint local sync (Python)](../../../python/docs/examples/_async/browser-use/browser/browser_fingerprint_local_sync.py) - A python example showing how to sync local browser fingerprint to remote browser
- [Fingerprint local sync (TypeScript)](../../../typescript/docs/examples/browser-use/browser/browser-fingerprint-local-sync.ts) - A typescript example showing how to sync local browser fingerprint to remote browser
- [Fingerprint persistence (Python)](../../../python/docs/examples/_async/browser-use/browser/browser_fingerprint_persistence.py) - A python example showing how to persist browser fingerprint across sessions
- [Fingerprint persistence (TypeScript)](../../../typescript/docs/examples/browser-use/browser/browser-fingerprint-persistence.ts) - A typescript example showing how to persist browser fingerprint across sessions


### IPProxy
- [Browser Proxy (Python)](../../../python/docs/examples/_async/browser-use/browser/browser-proxies.py) - A python example showing how to configure custom and Wuying proxy servers for IP rotation

- [Browser Proxy (TypeScript)](../../../typescript/docs/examples/browser-use/browser/browser-proxies.ts) - A typescript example showing how to configure custom and Wuying proxy servers for IP rotation

### Captcha Resolving
- [CAPTCHA Resolution (Python)](../../../python/docs/examples/_async/browser-use/browser/captcha_tongcheng.py) - A python example showing how to use AIBrowser to automatically solve slider-type CAPTCHAs
- [CAPTCHA Resolution (TypeScript)](../../../typescript/docs/examples/browser-use/browser/captcha_tongcheng.ts) - A typescript example showing how to use AIBrowser to automatically solve slider-type CAPTCHAs

### Call For User
- [Call For User (Python)](../../../python/docs/examples/_async/browser-use/browser/call_for_user_jd.py) - A python example showing how to handle wuying-call-for-user messages that require human intervention during browser automation
- [Call For User (TypeScript)](../../../typescript/docs/examples/browser-use/browser/call_for_user_jd.ts) - A typescript example showing how to handle wuying-call-for-user messages that require human intervention during browser automation

## Advanced Features

### PageUseAgent

- [Aliyun search & help](../../../python/docs/examples/_async/browser-use/browser/search_agentbay_doc_by_agent.py) - Search on aliyun.com and open Help docs using PageUse Agent
- [Admin add product](../../../python/docs/examples/_async/browser-use/browser/admin_add_product.py) - Fill admin form fields via variables and submit
- [2048 GAME](../../../python/docs/examples/_async/browser-use/browser/game_2048.py) - Extract 2048 grid and play using a heuristic/minimax strategy
- [Sudoku GAME](../../../python/docs/examples/_async/browser-use/browser/game_sudoku.py) - Extract a 9x9 Sudoku board, solve locally, and fill results on page
- [Expense invoices upload](../../../python/docs/examples/_async/browser-use/browser/expense_upload_invoices.py) - Login, upload multiple PDFs to expense form, and submit
- [Alimeeting availability](../../../python/docs/examples/_async/browser-use/browser/alimeeting_availability.py) - Find available meeting rooms for a time window
- [Shop inspector](../../../python/docs/examples/_async/browser-use/browser/shop_inspector.py) - Batch crawl sites, extract product name/price/link and save to JSON
- [GV quick buy & seating](../../../python/docs/examples/_async/browser-use/browser/gv_quick_buy_seat.py) - Quick Buy flow on gv.com.sg and select a single seat

## üìö Related Guides

- [Browser Use Overview](README.md) - Complete browser automation features
- [Core Features](core-features.md) - Browser core capabilities
- [Advanced Features](advance-features.md) - PageUseAgent and advanced capabilities

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../README.md)




# Browser Command-Line Arguments Configuration Guide

---

## Overview

Browser Command-Line Arguments is a core feature of the AgentBay SDK that enables developers to customize browser launch parameters and control browser behavior. This functionality allows you to pass custom Chrome/Chromium command-line arguments to fine-tune browser settings, disable specific features, or enable experimental functionality for your automation needs.

## Key Features

### 1. Custom Command-Line Arguments
Configure Chrome/Chromium with specific command-line arguments.

### 2. Default Navigation URL
Set a default URL that the browser navigates to upon initialization.

## Configuration Of BrowserOption

### Command-Line Arguments (`cmdArgs`)
An array of Chrome/Chromium command-line arguments to customize browser behavior.

**Common Examples:**
- `--disable-features=PrivacySandboxSettings4` - Disable privacy sandbox
- `--disable-extensions-http-throttling` - Disable HTTP request throttling for extensions
- `--disable-background-timer-throttling` - Disable background timer throttling to prevent performance issues
- `--password-store=basic` - Use basic password storage instead of system keychain

### Default Navigate URL (`defaultNavigateUrl`)
The URL that the browser automatically navigates to after initialization. For Browser Initialize operations, it's **highly recommended** to use Chrome internal pages (e.g., `chrome://version/`, `chrome://settings/`) or extension pages instead of internet URLs. Navigating to internet pages during initialization may cause timeout of browser launch.


## Go Implementation

```go
package main

import (
	"fmt"
	"log"
	"os"
	"time"

	"github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay"
	"github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay/browser"
)

func main() {
	// Get API key from environment variable
	apiKey := os.Getenv("AGENTBAY_API_KEY")
	if apiKey == "" {
		log.Fatal("AGENTBAY_API_KEY environment variable is required")
	}

	// Initialize AgentBay client
	fmt.Println("Initializing AgentBay client...")
	agentBay, err := agentbay.NewAgentBay(apiKey)
	if err != nil {
		log.Fatalf("Error initializing AgentBay client: %v", err)
	}

	// Create session parameters
	fmt.Println("Creating a new session...")
	params := agentbay.NewCreateSessionParams().WithImageId("linux_latest")

	// Create a new session
	sessionResult, err := agentBay.Create(params)
	if err != nil {
		log.Fatalf("Error creating session: %v", err)
	}

	session := sessionResult.Session
	fmt.Printf("Session created with ID: %s\n", session.SessionID)

	// Defer session cleanup
	defer func() {
		fmt.Println("Cleaning up session...")
		if _, err := session.Delete(); err != nil {
			log.Printf("Warning: Error deleting session: %v", err)
		} else {
			fmt.Println("Session deleted successfully")
		}
	}()

	// Create browser option with custom command arguments and default navigate URL
	browserOption := browser.NewBrowserOption()
	browserOption.CmdArgs = []string{"--disable-features=PrivacySandboxSettings4"}
	defaultUrl := "chrome://version/"
	browserOption.DefaultNavigateUrl = &defaultUrl

	fmt.Println("Browser configuration:")
	fmt.Printf("- Command arguments: %v\n", browserOption.CmdArgs)
	if browserOption.DefaultNavigateUrl != nil {
		fmt.Printf("- Default navigate URL: %s\n", *browserOption.DefaultNavigateUrl)
	}

	// Initialize browser
	fmt.Println("Initializing browser...")
	success, err := session.Browser.Initialize(browserOption)
	if err != nil {
		log.Fatalf("Failed to initialize browser: %v", err)
	}

	if success {
		fmt.Println("Browser initialized successfully")
	} else {
		log.Fatal("Browser initialization failed")
	}

	// Wait for some time to allow user interaction
	fmt.Println("Waiting for 20 seconds...")
	time.Sleep(20 * time.Second)

	// Destroy browser
	fmt.Println("Destroying browser...")
	err = session.Browser.Destroy()
	if err != nil {
		log.Fatalf("Failed to destroy browser: %v", err)
	}
	fmt.Println("Browser destroyed successfully")

	fmt.Println("\n=== Browser Command Arguments Example Completed ===")
}
```

## Python Implementation

```python
import os
import asyncio

from agentbay import AgentBay
from agentbay import CreateSessionParams
from agentbay import BrowserOption
from playwright.async_api import async_playwright

async def main():
    # Get API key from environment variable
    api_key = os.getenv("AGENTBAY_API_KEY")
    if not api_key:
        print("Error: AGENTBAY_API_KEY environment variable not set")
        return

    # Initialize AgentBay client
    print("Initializing AgentBay client...")
    agent_bay = AgentBay(api_key=api_key)

    # Create a session
    print("Creating a new session...")
    params = CreateSessionParams(
        image_id="linux_latest"
    )
    session_result = agent_bay.create(params)

    if session_result.success:
        session = session_result.session
        print(f"Session created with ID: {session.session_id}")

        # Create browser option with custom command arguments and default navigate URL
        browser_option = BrowserOption(
            cmd_args=["--disable-features=PrivacySandboxSettings4"],
            default_navigate_url="chrome://version/",
        )

        print("Browser configuration:")
        print("- Command arguments:", browser_option.cmd_args)
        print("- Default navigate URL:", browser_option.default_navigate_url)

        if await session.browser.initialize_async(browser_option):
            print("Browser initialized successfully")
            
            # Get browser endpoint URL
            endpoint_url = session.browser.get_endpoint_url()
            print(f"endpoint_url = {endpoint_url}")

            # Use Playwright to connect and validate
            async with async_playwright() as p:
                browser = await p.chromium.connect_over_cdp(endpoint_url)
                context = browser.contexts[0]
                page = context.pages[0]

                try:
                    # Check if browser navigated to default URL
                    print("\n--- Check Default Navigation ---")
                    await asyncio.sleep(2)  # Wait for navigation
                    current_url = page.url
                    print(f"Current URL: {current_url}")
                    
                    if "chrome://version/" in current_url:
                        print("‚úì Browser successfully navigated to default URL")
                    else:
                        print("‚úó Browser did not navigate to default URL")

                    # Test command arguments effect by checking Chrome version page
                    if "chrome://version/" in current_url:
                        print("\n--- Check Chrome Version Info ---")
                        version_info = await page.evaluate("""
                            () => {
                                const versionElement = document.querySelector('#version');
                                const commandLineElement = document.querySelector('#command_line');
                                return {
                                    version: versionElement ? versionElement.textContent : 'Not found',
                                    commandLine: commandLineElement ? commandLineElement.textContent : 'Not found'
                                };
                            }
                        """)
                        
                        print(f"Chrome Version: {version_info['version']}")
                        print(f"Command Line: {version_info['commandLine']}")
                        
                        if "--disable-features=PrivacySandboxSettings4" in version_info['commandLine']:
                            print("‚úì Custom command argument found in browser")
                        else:
                            print("‚úó Custom command argument not found in browser")

                    await asyncio.sleep(3)
                finally:
                    await browser.close()
                    session.browser.destroy()
        else:
            print("Failed to initialize browser")

        # Clean up session
        agent_bay.delete(session)
    else:
        print("Failed to create session", session_result.error_message)

if __name__ == "__main__":
    asyncio.run(main())
```

## TypeScript Implementation

```typescript
import { AgentBay, CreateSessionParams } from 'wuying-agentbay-sdk';
import { BrowserOption } from 'wuying-agentbay-sdk';
import { chromium } from 'playwright';

async function main(): Promise<void> {
    // Get API key from environment variable
    const apiKey = process.env.AGENTBAY_API_KEY;
    if (!apiKey) {
        console.log('Error: AGENTBAY_API_KEY environment variable not set');
        return;
    }

    try {
        // Initialize AgentBay client
        console.log('Initializing AgentBay client...');
        const agentBay = new AgentBay({ apiKey });

        // Create a session
        console.log('Creating a new session...');
        const params: CreateSessionParams = {
            imageId: 'linux_latest',
        };
        const sessionResult = await agentBay.create(params);

        if (!sessionResult.success) {
            console.log('Failed to create session');
            return;
        }

        const session = sessionResult.session;
        console.log(`Session created with ID: ${session.sessionId}`);

        // Create browser option with custom command arguments and default navigate URL
        const browserOption: BrowserOption = {
            cmdArgs: ['--disable-features=PrivacySandboxSettings4'],
            defaultNavigateUrl: 'chrome://version/',
        };

        console.log('Browser configuration:');
        console.log('- Command arguments:', browserOption.cmdArgs);
        console.log('- Default navigate URL:', browserOption.defaultNavigateUrl);

        const initialized = await session.browser.initializeAsync(browserOption);
        if (initialized) {
            const endpointUrl = await session.browser.getEndpointUrl();
            console.log('endpoint_url =', endpointUrl);

            const browser = await chromium.connectOverCDP(endpointUrl);
            const context = browser.contexts()[0];
            const page = context.pages()[0];

            try {
                // Check if browser navigated to default URL
                console.log('\n--- Check Default Navigation ---');
                await page.waitForTimeout(2000); // Wait for navigation
                const currentUrl = page.url();
                console.log('Current URL:', currentUrl);
                
                if (currentUrl.includes('chrome://version/')) {
                    console.log('‚úì Browser successfully navigated to default URL');
                } else {
                    console.log('‚úó Browser did not navigate to default URL');
                }

                // Test command arguments effect by checking Chrome version page
                if (currentUrl.includes('chrome://version/')) {
                    console.log('\n--- Check Chrome Version Info ---');
                    const versionInfo = await page.evaluate(() => {
                        const versionElement = document.querySelector('#version');
                        const commandLineElement = document.querySelector('#command_line');
                        return {
                            version: versionElement ? versionElement.textContent : 'Not found',
                            commandLine: commandLineElement ? commandLineElement.textContent : 'Not found'
                        };
                    });
                    
                    console.log('Chrome Version:', versionInfo.version);
                    console.log('Command Line:', versionInfo.commandLine);
                    
                    if (versionInfo.commandLine.includes('--disable-features=PrivacySandboxSettings4')) {
                        console.log('‚úì Custom command argument found in browser');
                    } else {
                        console.log('‚úó Custom command argument not found in browser');
                    }
                }

                await page.waitForTimeout(3000);
            } finally {
                await browser.close();
            }
            await session.browser.destroy();
        }

        // Clean up session
        await agentBay.delete(session);
    } catch (error) {
        console.error('Error:', error);
    }
}

main().catch(console.error);
```


## Limitations

- **Chrome/Chromium Only**: Command arguments are specific to Chrome/Chromium browsers
- **Platform Differences**: Some arguments may behave differently across operating systems
- **Version Compatibility**: Certain arguments may not be available in all Chrome versions
- **Security Restrictions**: Some arguments may be restricted in certain environments

## üìö Related Guides

- [Browser Proxy Configuration](browser-proxies.md) - Configure proxy settings for browser sessions
- [Browser Context](browser-context.md) - Browser context management for cookies and sessions
- [Browser Fingerprint](browser-fingerprint.md) - Simulate browser fingerprint feature
- [Browser Use Overview](../README.md) - Complete browser automation features
- [Session Management](../../common-features/basics/session-management.md) - Session lifecycle and configuration

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../../README.md)




# Browser Context Guide

Browser Context is a core feature of the AgentBay SDK that enables persistent browser state management across multiple sessions. It allows you to maintain cookies, cache, local storage, and other browser data between sessions, significantly reducing anti-bot friction and speeding up web page navigation.

## Overview

A Browser Context represents a persistent browser environment that stores browser state such as:
- Cookies
- Cache
- Local storage
- Session storage
- Browser preferences
- Installed extensions (when used with Extension Management)

## Key Benefits

1. **Reduced Anti-Bot Friction**: By maintaining browser state, websites recognize your sessions as returning users rather than new visitors
2. **Faster Page Loads**: Cached resources and cookies reduce page load times
3. **Session Continuity**: Continue where you left off across multiple sessions
4. **Consistent User Experience**: Maintain user preferences and settings

## Python Implementation

### Basic Usage

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams, BrowserContext

# Initialize AgentBay client
agent_bay = AgentBay(api_key="your_api_key")

# Create or get a persistent context
context_result = agent_bay.context.get("my-browser-context", create=True)
context = context_result.context

# Create browser session with context
browser_context = BrowserContext(
    context_id=context.id,
    auto_upload=True
)

session_params = CreateSessionParams(
    image_id="browser-image-id",
    browser_context=browser_context
)

session_result = agent_bay.create(session_params)
session = session_result.session
```

### Cookie Persistence Example

```python
import time
from agentbay import AgentBay
from agentbay import CreateSessionParams, BrowserContext
from agentbay import BrowserOption
from playwright.sync_api import sync_playwright

# Initialize AgentBay
agent_bay = AgentBay(api_key="your_api_key")

# Create persistent context
context_result = agent_bay.context.get("cookie-demo-context", create=True)
context = context_result.context

# First session - set cookies
browser_context = BrowserContext(
    context_id=context.id,
    auto_upload=True
)

params = CreateSessionParams(
    image_id="browser-image-id",
    browser_context=browser_context
)

session1 = agent_bay.create(params).session

# Set cookies in first session
session1.browser.initialize(BrowserOption())
endpoint_url = session1.browser.get_endpoint_url()

with sync_playwright() as p:
    browser = p.chromium.connect_over_cdp(endpoint_url)
    context_p = browser.contexts[0] if browser.contexts else browser.new_context()
    page = context_p.new_page()
    
    # Navigate and set cookies
    page.goto("https://example.com")
    context_p.add_cookies([
        {
            "name": "session_cookie",
            "value": "session_value",
            "domain": "example.com",
            "path": "/",
        }
    ])
    
    browser.close()

# Delete first session with context sync
agent_bay.delete(session1, sync_context=True)

# Second session - verify cookies persist
session2 = agent_bay.create(params).session

# Check cookies in second session
session2.browser.initialize(BrowserOption())
endpoint_url2 = session2.browser.get_endpoint_url()

with sync_playwright() as p:
    browser = p.chromium.connect_over_cdp(endpoint_url2)
    context_p = browser.contexts[0] if browser.contexts else browser.new_context()
    
    # Verify cookies persist
    cookies = context_p.cookies()
    print(f"Persisted cookies: {cookies}")
    
    browser.close()
```

## TypeScript Implementation

### Basic Usage

```typescript
import { AgentBay, CreateSessionParams, BrowserContext } from 'wuying-agentbay-sdk';

// Initialize AgentBay client
const agentBay = new AgentBay({ apiKey: "your_api_key" });

// Create or get a persistent context
const contextResult = await agentBay.context.get("my-browser-context", true);
const context = contextResult.context;

// Create browser session with context
const browserContext: BrowserContext = {
    contextId: context.id,
    autoUpload: true
};

const params = new CreateSessionParams()
    .withImageId("browser-image-id")
    .withBrowserContext(browserContext);

const sessionResult = await agentBay.create(params);
const session = sessionResult.session;
```

### Cookie Persistence Example

```typescript
import { AgentBay, CreateSessionParams, BrowserContext, BrowserOption } from 'wuying-agentbay-sdk';
import { chromium } from 'playwright';

// Initialize AgentBay
const agentBay = new AgentBay({ apiKey: "your_api_key" });

// Create persistent context
const contextResult = await agentBay.context.get("cookie-demo-context", true);
const context = contextResult.context;

// First session - set cookies
const browserContext: BrowserContext = {
    contextId: context.id,
    autoUpload: true
};

const params = new CreateSessionParams()
    .withImageId("browser-image-id")
    .withBrowserContext(browserContext);

const session1 = (await agentBay.create(params)).session;

// Set cookies in first session
await session1.browser.initializeAsync(new BrowserOption());
const endpointUrl = session1.browser.getEndpointUrl();

const browser = await chromium.connectOverCDP(endpointUrl);
const contextP = browser.contexts()[0] || await browser.newContext();
const page = await contextP.newPage();

// Navigate and set cookies
await page.goto("https://example.com");
await contextP.addCookies([
    {
        name: "session_cookie",
        value: "session_value",
        domain: "example.com",
        path: "/",
    }
]);

await browser.close();

// Delete first session with context sync
await agentBay.delete(session1, true);

// Second session - verify cookies persist
const session2 = (await agentBay.create(params)).session;

// Check cookies in second session
await session2.browser.initializeAsync(new BrowserOption());
const endpointUrl2 = session2.browser.getEndpointUrl();

const browser2 = await chromium.connectOverCDP(endpointUrl2);
const contextP2 = browser2.contexts()[0] || await browser2.newContext();

// Verify cookies persist
const cookies = await contextP2.cookies();
console.log(`Persisted cookies: ${JSON.stringify(cookies)}`);

await browser2.close();
```

## Best Practices

1. **Use Descriptive Context Names**: Name your contexts based on their purpose (e.g., "ecommerce-scraping", "social-media-automation")
2. **Enable Auto Upload**: Set `auto_upload=True` to automatically synchronize browser data when sessions end
3. **Clean Up Resources**: Delete sessions when done to free up cloud resources
4. **Handle Errors Gracefully**: Implement proper error handling for context operations
5. **Reuse Contexts**: Reuse the same context across multiple sessions for continuity

## Advanced Features

### Context Synchronization Policies

You can customize how browser data is synchronized:

```python
from agentbay import SyncPolicy

# Create custom sync policy
policy = SyncPolicy(
    upload=True,
    extract=True,
    white_list=["/cookies.json", "/storage/"],
    black_list=["/cache/large_files/"]
)

# Use with context sync
context_sync = ContextSync.new(
    context_id=context.id,
    path="/browser-data",
    policy=policy
)
```

### Multiple Contexts

You can use multiple contexts for different purposes:

```python
# Create separate contexts for different websites
ecommerce_context = agent_bay.context.get("ecommerce-site", create=True).context
social_context = agent_bay.context.get("social-media", create=True).context

# Use different contexts for different sessions
ecommerce_session_params = CreateSessionParams(
    browser_context=BrowserContext(ecommerce_context.id, True)
)

social_session_params = CreateSessionParams(
    browser_context=BrowserContext(social_context.id, True)
)
```

## Error Handling

Common errors and how to handle them:

```python
try:
    context_result = agent_bay.context.get("my-context", create=True)
    if not context_result.success:
        print(f"Failed to create context: {context_result.error_message}")
        
    session_result = agent_bay.create(session_params)
    if not session_result.success:
        print(f"Failed to create session: {session_result.error_message}")
        
except Exception as e:
    print(f"An error occurred: {e}")
```

## üìö Related Guides

- [Extension Management](extension.md) - Browser extension integration
- [Data Persistence](../../common-features/basics/data-persistence.md) - Broader context management
- [Session Management](../../common-features/basics/session-management.md) - Session lifecycle and configuration
- [Browser Use Overview](../README.md) - Complete browser automation features

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../../README.md)



# Browser Fingerprint Guide

Browser fingerprinting is a crucial feature for web automation that helps avoid detection by anti-bot systems. AgentBay provides comprehensive fingerprint management capabilities including generation, customization, and persistence across sessions.

## Overview

AgentBay supports advanced browser fingerprint management with the following key capabilities:

- **Multiple Generation Methods**: Random generation, local browser sync, and custom construction
- **Fingerprint Persistence**: Maintain consistent fingerprints across multiple sessions
- **Context Management**: Persistent storage using browser and fingerprint contexts

## 1. Fingerprint Generation Methods

### 1.1 Random Fingerprint Generation

Generate random fingerprints based on specified criteria such as device type, operating system, and locale.

#### Features
- Automatic randomization of browser characteristics
- Configurable device types (desktop/mobile)
- Operating system selection (Windows, macOS, Linux, Android, iOS)
- Locale and language customization

#### Python Example

```python
import os
import asyncio
from agentbay import AgentBay
from agentbay import CreateSessionParams
from agentbay import BrowserOption, BrowserFingerprint
from playwright.async_api import async_playwright

async def random_fingerprint_example():
    # Initialize AgentBay client
    api_key = os.getenv("AGENTBAY_API_KEY")
    agent_bay = AgentBay(api_key=api_key)
    
    # Create session
    params = CreateSessionParams(image_id="browser_latest")
    session_result = agent_bay.create(params)
    
    if session_result.success:
        session = session_result.session
        
        # Configure random fingerprint
        browser_fingerprint = BrowserFingerprint(
            devices=["desktop"],
            operating_systems=["windows", "macos"],
            locales=["en-US", "zh-CN"]
        )
        
        # Enable stealth mode with random fingerprint
        browser_option = BrowserOption(
            use_stealth=True,
            fingerprint=browser_fingerprint
        )
        
        # Initialize browser
        if await session.browser.initialize_async(browser_option):
            endpoint_url = session.browser.get_endpoint_url()
            
            # Connect using Playwright
            async with async_playwright() as p:
                browser = await p.chromium.connect_over_cdp(endpoint_url)
                context = browser.contexts[0]
                page = await context.new_page()
                
                # Test fingerprint
                await page.goto("https://httpbin.org/user-agent")
                response = await page.evaluate("() => JSON.parse(document.body.textContent)")
                print(f"Random User Agent: {response.get('user-agent')}")
                
                # Check navigator properties
                nav_info = await page.evaluate("""
                    () => ({
                        platform: navigator.platform,
                        language: navigator.language,
                        hardwareConcurrency: navigator.hardwareConcurrency,
                        deviceMemory: navigator.deviceMemory
                    })
                """)
                
                print(f"Platform: {nav_info.get('platform')}")
                print(f"Language: {nav_info.get('language')}")
                print(f"CPU Cores: {nav_info.get('hardwareConcurrency')}")
                print(f"Device Memory: {nav_info.get('deviceMemory')} GB")
                
                await browser.close()
        
        # Clean up session
        agent_bay.delete(session)

if __name__ == "__main__":
    asyncio.run(random_fingerprint_example())
```

#### TypeScript Example

```typescript
import { AgentBay, CreateSessionParams } from 'wuying-agentbay-sdk';
import { BrowserOption, BrowserFingerprint } from 'wuying-agentbay-sdk';
import { chromium } from 'playwright';

async function randomFingerprintExample(): Promise<void> {
    // Get API key from environment variable
    const apiKey = process.env.AGENTBAY_API_KEY;
    if (!apiKey) {
        console.log("Error: AGENTBAY_API_KEY environment variable not set");
        return;
    }

    try {
        // Initialize AgentBay client
        console.log("Initializing AgentBay client...");
        const agentBay = new AgentBay({ apiKey });
        
        // Create session
        console.log("Creating a new session...");
        const params: CreateSessionParams = {
            imageId: "browser_latest"
        };
        const sessionResult = await agentBay.create(params);
        
        if (!sessionResult.success) {
            console.log("Failed to create session");
            return;
        }

        const session = sessionResult.session;
        console.log(`Session created with ID: ${session.sessionId}`);
        
        // Configure random fingerprint
        const browserFingerprint: BrowserFingerprint = {
            devices: ["desktop"],
            operatingSystems: ["windows"],
            locales: ["zh-CN", "zh"]
        };
        
        // Enable stealth mode with random fingerprint
        const browserOption: BrowserOption = {
            useStealth: true,
            fingerprint: browserFingerprint
        };
        
        // Initialize browser
        const initialized = await session.browser.initializeAsync(browserOption);
        if (!initialized) {
            console.log("Failed to initialize browser");
            return;
        }

        const endpointUrl = await session.browser.getEndpointUrl();
        console.log("endpoint_url =", endpointUrl);
        
        // Connect using Playwright
        const browser = await chromium.connectOverCDP(endpointUrl);
        const context = browser.contexts()[0];
        const page = await context.newPage();
        
        // Test fingerprint
        console.log("\n--- Check User Agent ---");
        await page.goto("https://httpbin.org/user-agent");
        const response = await page.evaluate(() => JSON.parse(document.body.textContent));
        const userAgent = response["user-agent"] || "";
        console.log(`User Agent: ${userAgent}`);

        // Check navigator properties
        console.log("\n--- Check Navigator Properties ---");
        const navInfo = await page.evaluate(() => ({
            platform: navigator.platform,
            language: navigator.language,
            languages: navigator.languages,
            webdriver: navigator.webdriver
        }));

        console.log(`Platform: ${navInfo.platform}`);
        console.log(`Language: ${navInfo.language}`);
        console.log(`Languages: ${navInfo.languages}`);
        console.log(`WebDriver: ${navInfo.webdriver}`);

        await page.waitForTimeout(3000);
        await browser.close();
        
        // Clean up session
        await agentBay.delete(session);
        console.log("Session cleaned up successfully");

    } catch (error) {
        console.error("Error in main function:", error);
    }
}

randomFingerprintExample().catch(console.error);
```

### 1.2 Local Browser Fingerprint Sync

Capture fingerprint characteristics from your local Chrome browser and apply them to remote sessions for consistent behavior.

#### Features
- Extract fingerprint from local Chrome installation
- Preserve exact browser characteristics
- Maintain consistency between local and remote environments
- Support for both headless and visible mode extraction

#### Python Example

```python
import os
import asyncio
from agentbay import AgentBay
from agentbay import CreateSessionParams
from agentbay import BrowserOption
from agentbay import BrowserFingerprintGenerator
from playwright.async_api import async_playwright

async def local_sync_fingerprint_example():
    # Initialize AgentBay client
    api_key = os.getenv("AGENTBAY_API_KEY")
    agent_bay = AgentBay(api_key=api_key)
    
    # Create session
    params = CreateSessionParams(image_id="browser_latest")
    session_result = agent_bay.create(params)
    
    if session_result.success:
        session = session_result.session
        
        # Generate fingerprint from local Chrome browser
        print("Extracting fingerprint from local Chrome browser...")
        fingerprint_generator = BrowserFingerprintGenerator(headless=False)
        fingerprint_format = await fingerprint_generator.generate_fingerprint()
        
        if not fingerprint_format:
            print("Failed to generate local fingerprint")
            return
        
        print("Local fingerprint extracted successfully")
        
        # Apply local fingerprint to remote browser
        browser_option = BrowserOption(
            use_stealth=True,
            fingerprint_format=fingerprint_format
        )
        
        # Initialize browser
        if await session.browser.initialize_async(browser_option):
            endpoint_url = session.browser.get_endpoint_url()
            
            # Connect using Playwright
            async with async_playwright() as p:
                browser = await p.chromium.connect_over_cdp(endpoint_url)
                context = browser.contexts[0]
                page = await context.new_page()
                
                # Verify fingerprint sync
                await page.goto("https://httpbin.org/user-agent")
                response = await page.evaluate("() => JSON.parse(document.body.textContent)")
                remote_ua = response.get('user-agent')
                local_ua = fingerprint_format.fingerprint.navigator.userAgent
                
                print(f"Local User Agent: {local_ua}")
                print(f"Remote User Agent: {remote_ua}")
                print(f"Fingerprint Sync: {'‚úì Success' if remote_ua == local_ua else '‚úó Failed'}")
                
                await browser.close()
        
        # Clean up session
        agent_bay.delete(session)

if __name__ == "__main__":
    asyncio.run(local_sync_fingerprint_example())
```

#### TypeScript Example

```typescript
import { AgentBay, CreateSessionParams } from 'wuying-agentbay-sdk';
import { BrowserOption, BrowserFingerprintGenerator } from 'wuying-agentbay-sdk';
import { chromium } from 'playwright';

async function localSyncFingerprintExample(): Promise<void> {
    const apiKey = process.env.AGENTBAY_API_KEY;
    if (!apiKey) {
        console.log("Error: AGENTBAY_API_KEY environment variable not set");
        return;
    }

    try {
        // Initialize AgentBay client
        console.log("Initializing AgentBay client...");
        const agentBay = new AgentBay({ apiKey });
        
        // Create session
        console.log("Creating a new session...");
        const params: CreateSessionParams = {
            imageId: "browser_latest"
        };
        const sessionResult = await agentBay.create(params);
        
        if (!sessionResult.success) {
            console.log("Failed to create session");
            return;
        }

        const session = sessionResult.session;
        console.log(`Session created with ID: ${session.sessionId}`);
        
        // Generate fingerprint from local Chrome browser
        console.log("Starting fingerprint generation");
        console.log("Extracting comprehensive browser fingerprint...");
        const fingerprintGenerator = new BrowserFingerprintGenerator();
        const fingerprintFormat = await fingerprintGenerator.generateFingerprint();
        
        if (!fingerprintFormat) {
            console.log("Failed to generate local fingerprint");
            return;
        }
        
        console.log("Fingerprint generation completed successfully!");
        console.log(`Fingerprint format: ${JSON.stringify(fingerprintFormat)}`);
        
        // Apply local fingerprint to remote browser
        const browserOption: BrowserOption = {
            useStealth: true,
            fingerprintFormat: fingerprintFormat
        };
        
        // Initialize browser
        const initialized = await session.browser.initializeAsync(browserOption);
        if (!initialized) {
            console.log("Failed to initialize browser");
            return;
        }

        const endpointUrl = await session.browser.getEndpointUrl();
        console.log("endpoint_url =", endpointUrl);
        
        // Connect using Playwright
        const browser = await chromium.connectOverCDP(endpointUrl);
        const context = browser.contexts()[0];
        const page = await context.newPage();
        
        // Verify fingerprint sync
        console.log("\n--- Check User Agent ---");
        await page.goto("https://httpbin.org/user-agent");
        const response = await page.evaluate(() => JSON.parse(document.body.textContent));
        const userAgent = response["user-agent"] || "";
        console.log(`User Agent: ${userAgent}`);

        console.log("Please check if User Agent is synced correctly by visiting https://httpbin.org/user-agent in local chrome browser.");

        await page.waitForTimeout(3000);
        await browser.close();
        
        // Clean up session
        await agentBay.delete(session);
        console.log("Session cleaned up successfully");

    } catch (error) {
        console.error("Error in main function:", error);
    }
}

localSyncFingerprintExample().catch(console.error);
```

### 1.3 Custom Fingerprint Construction

Load and apply custom fingerprint data from JSON files or construct fingerprints programmatically.

#### Features
- Load fingerprint from JSON files
- Construct fingerprints programmatically
- Full control over all fingerprint characteristics
- Reusable fingerprint configurations

#### Python Example

```python
import os
import asyncio
from agentbay import AgentBay
from agentbay import CreateSessionParams
from agentbay import BrowserOption
from agentbay import FingerprintFormat
from playwright.async_api import async_playwright

async def custom_fingerprint_example():
    # Initialize AgentBay client
    api_key = os.getenv("AGENTBAY_API_KEY")
    agent_bay = AgentBay(api_key=api_key)
    
    # Create session
    params = CreateSessionParams(image_id="browser_latest")
    session_result = agent_bay.create(params)
    
    if session_result.success:
        session = session_result.session
        
        # Load fingerprint from JSON file
        fingerprint_file = "path/to/custom_fingerprint.json"
        try:
            with open(fingerprint_file, "r") as f:
                fingerprint_format = FingerprintFormat.from_json(f.read())
            print("Custom fingerprint loaded from file")
        except FileNotFoundError:
            # Fallback: Use example fingerprint data
            print("Using example fingerprint data")
            # You can also construct fingerprint programmatically here
            # For demonstration, we'll use a simple approach
            return
        
        # Apply custom fingerprint to browser
        browser_option = BrowserOption(
            use_stealth=True,
            fingerprint_format=fingerprint_format
        )
        
        # Initialize browser
        if await session.browser.initialize_async(browser_option):
            endpoint_url = session.browser.get_endpoint_url()
            
            # Connect using Playwright
            async with async_playwright() as p:
                browser = await p.chromium.connect_over_cdp(endpoint_url)
                context = browser.contexts[0]
                page = await context.new_page()
                
                # Verify custom fingerprint
                await page.goto("https://httpbin.org/user-agent")
                response = await page.evaluate("() => JSON.parse(document.body.textContent)")
                remote_ua = response.get('user-agent')
                expected_ua = fingerprint_format.fingerprint.navigator.userAgent
                
                print(f"Expected User Agent: {expected_ua}")
                print(f"Remote User Agent: {remote_ua}")
                print(f"Custom Fingerprint: {'‚úì Applied' if remote_ua == expected_ua else '‚úó Failed'}")
                
                # Test additional properties
                screen_info = await page.evaluate("""
                    () => ({
                        width: screen.width,
                        height: screen.height,
                        colorDepth: screen.colorDepth,
                        pixelDepth: screen.pixelDepth
                    })
                """)
                
                print(f"Screen Resolution: {screen_info.get('width')}x{screen_info.get('height')}")
                print(f"Color Depth: {screen_info.get('colorDepth')}")
                
                await browser.close()
        
        # Clean up session
        agent_bay.delete(session)

if __name__ == "__main__":
    asyncio.run(custom_fingerprint_example())
```

#### TypeScript Example

```typescript
import { AgentBay, CreateSessionParams } from 'wuying-agentbay-sdk';
import { BrowserOption, FingerprintFormat } from 'wuying-agentbay-sdk';
import { chromium } from 'playwright';
import * as fs from 'fs';
import * as path from 'path';

async function generateFingerprintByFile(): Promise<FingerprintFormat> {
    /**
     * Generate fingerprint by file.
     */
    const fingerprintPath = path.join(__dirname, "../../../../../resource/fingerprint.example.json");
    const fingerprintData = fs.readFileSync(fingerprintPath, 'utf8');
    return FingerprintFormat.fromJson(fingerprintData);
}

async function customFingerprintExample(): Promise<void> {
    const apiKey = process.env.AGENTBAY_API_KEY;
    if (!apiKey) {
        console.log("Error: AGENTBAY_API_KEY environment variable not set");
        return;
    }

    try {
        // Initialize AgentBay client
        console.log("Initializing AgentBay client...");
        const agentBay = new AgentBay({ apiKey });
        
        // Create session
        console.log("Creating a new session...");
        const params: CreateSessionParams = {
            imageId: "browser_latest"
        };
        const sessionResult = await agentBay.create(params);
        
        if (!sessionResult.success) {
            console.log("Failed to create session");
            return;
        }

        const session = sessionResult.session;
        console.log(`Session created with ID: ${session.sessionId}`);
        
        // You can generate fingerprint by file or construct FingerprintFormat by yourself totally.
        const fingerprintFormat = await generateFingerprintByFile();
        
        // Apply custom fingerprint to browser
        const browserOption: BrowserOption = {
            useStealth: true,
            fingerprintFormat: fingerprintFormat
        };
        
        // Initialize browser
        const initialized = await session.browser.initializeAsync(browserOption);
        if (!initialized) {
            console.log("Failed to initialize browser");
            return;
        }

        const endpointUrl = await session.browser.getEndpointUrl();
        console.log("endpoint_url =", endpointUrl);
        
        // Connect using Playwright
        const browser = await chromium.connectOverCDP(endpointUrl);
        const context = browser.contexts()[0];
        const page = await context.newPage();
        
        // Verify custom fingerprint
        console.log("\n--- Check User Agent ---");
        await page.goto("https://httpbin.org/user-agent");
        const response = await page.evaluate(() => JSON.parse(document.body.textContent));
        const userAgent = response["user-agent"] || "";
        console.log(`User Agent: ${userAgent}`);
        
        // Verify that the user agent matches the fingerprint format
        if (fingerprintFormat.fingerprint?.navigator?.userAgent) {
            if (userAgent === fingerprintFormat.fingerprint.navigator.userAgent) {
                console.log("User Agent constructed correctly");
            } else {
                console.log("User Agent mismatch");
            }
        }

        await page.waitForTimeout(3000);
        await browser.close();
        
        // Clean up session
        await agentBay.delete(session);
        console.log("Session cleaned up successfully");

    } catch (error) {
        console.error("Error in main function:", error);
    }
}

customFingerprintExample().catch(console.error);
```

## 2. Fingerprint Persistence

Fingerprint persistence allows you to maintain consistent browser characteristics across multiple sessions by using browser contexts and fingerprint contexts.

### Features
- Persistent fingerprint storage across sessions
- Context-based fingerprint management
- Support for all fingerprint generation methods
- Automatic fingerprint loading and saving

### How It Works

1. **First Session**: Generate or apply a fingerprint with `fingerprint_persistent=True`
2. **Context Sync**: Save the session with `sync_context=True` to persist the fingerprint
3. **Subsequent Sessions**: Create new sessions with the same contexts to reuse the fingerprint

### Python Example (Random Fingerprint Persistence)

```python
import os
import time
import asyncio
from agentbay import AgentBay
from agentbay import CreateSessionParams, BrowserContext
from agentbay import BrowserOption, BrowserFingerprint, BrowserFingerprintContext
from playwright.async_api import async_playwright

async def fingerprint_persistence_example():
    # Initialize AgentBay client
    api_key = os.getenv("AGENTBAY_API_KEY")
    agent_bay = AgentBay(api_key=api_key)
    
    # Create browser context for persistence
    browser_context_name = f"persistent-browser-{int(time.time())}"
    browser_context_result = agent_bay.context.get(browser_context_name, create_if_not_exists=True)
    browser_context = BrowserContext(browser_context_result.context.id, auto_upload=True)
    
    # Create fingerprint context for persistence
    fingerprint_context_name = f"persistent-fingerprint-{int(time.time())}"
    fingerprint_context_result = agent_bay.context.get(fingerprint_context_name, create_if_not_exists=True)
    fingerprint_context = BrowserFingerprintContext(fingerprint_context_result.context.id)
    browser_context.fingerprint_context = fingerprint_context
    
    print(f"Created contexts - Browser: {browser_context.context_id}, Fingerprint: {fingerprint_context.fingerprint_context_id}")
    
    # === FIRST SESSION: Generate and persist fingerprint ===
    print("\n=== First Session: Generating and persisting fingerprint ===")
    
    params1 = CreateSessionParams(
        image_id="browser_latest",
        browser_context=browser_context
    )
    session1_result = agent_bay.create(params1)
    
    if session1_result.success:
        session1 = session1_result.session
        print(f"First session created: {session1.session_id}")
        
        # Configure random fingerprint with persistence
        browser_option1 = BrowserOption(
            use_stealth=True,
            fingerprint_persistent=True,  # Enable persistence
            fingerprint=BrowserFingerprint(
                devices=["desktop"],
                operating_systems=["windows"],
                locales=["en-US"]
            )
        )
        
        # Initialize browser and capture fingerprint
        if await session1.browser.initialize_async(browser_option1):
            endpoint_url1 = session1.browser.get_endpoint_url()
            
            async with async_playwright() as p:
                browser1 = await p.chromium.connect_over_cdp(endpoint_url1)
                context1 = browser1.contexts[0]
                page1 = await context1.new_page()
                
                # Capture first session fingerprint
                await page1.goto("https://httpbin.org/user-agent")
                response1 = await page1.evaluate("() => JSON.parse(document.body.textContent)")
                first_user_agent = response1.get('user-agent')
                print(f"First session User Agent: {first_user_agent}")
                
                await browser1.close()
        
        # Delete session with context sync to save fingerprint
        agent_bay.delete(session1, sync_context=True)
        print("First session deleted with fingerprint saved to context")
    
    # Wait for context sync to complete
    await asyncio.sleep(3)
    
    # === SECOND SESSION: Reuse persisted fingerprint ===
    print("\n=== Second Session: Reusing persisted fingerprint ===")
    
    params2 = CreateSessionParams(
        image_id="browser_latest",
        browser_context=browser_context  # Same context
    )
    session2_result = agent_bay.create(params2)
    
    if session2_result.success:
        session2 = session2_result.session
        print(f"Second session created: {session2.session_id}")
        
        # Configure browser to load persisted fingerprint
        browser_option2 = BrowserOption(
            use_stealth=True,
            fingerprint_persistent=True  # Will load saved fingerprint
            # No fingerprint parameter - will use persisted one
        )
        
        # Initialize browser with persisted fingerprint
        if await session2.browser.initialize_async(browser_option2):
            endpoint_url2 = session2.browser.get_endpoint_url()
            
            async with async_playwright() as p:
                browser2 = await p.chromium.connect_over_cdp(endpoint_url2)
                context2 = browser2.contexts[0]
                page2 = await context2.new_page()
                
                # Verify fingerprint persistence
                await page2.goto("https://httpbin.org/user-agent")
                response2 = await page2.evaluate("() => JSON.parse(document.body.textContent)")
                second_user_agent = response2.get('user-agent')
                print(f"Second session User Agent: {second_user_agent}")
                
                # Check if fingerprints match
                fingerprint_persisted = first_user_agent == second_user_agent
                print(f"Fingerprint Persistence: {'‚úì Success' if fingerprint_persisted else '‚úó Failed'}")
                
                if fingerprint_persisted:
                    print("üéâ Fingerprint successfully persisted across sessions!")
                
                await browser2.close()
        
        # Clean up second session
        agent_bay.delete(session2, sync_context=True)
        print("Second session deleted")
    
    # Clean up contexts
    try:
        agent_bay.context.delete(browser_context_result.context)
        agent_bay.context.delete(fingerprint_context_result.context)
        print("Contexts cleaned up")
    except Exception as e:
        print(f"Context cleanup warning: {e}")

if __name__ == "__main__":
    asyncio.run(fingerprint_persistence_example())
```

### TypeScript Example (Random Fingerprint Persistence)

```typescript
import { AgentBay, CreateSessionParams } from 'wuying-agentbay-sdk';
import { BrowserOption, BrowserFingerprint, BrowserContext, BrowserFingerprintContext } from 'wuying-agentbay-sdk';
import { chromium } from 'playwright';

// Global variables for persistent context and fingerprint context
let persistentContext: any = null;
let persistentFingerprintContext: any = null;

function getTestApiKey(): string {
    const apiKey = process.env.AGENTBAY_API_KEY;
    if (!apiKey) {
        throw new Error("AGENTBAY_API_KEY environment variable not set");
    }
    return apiKey;
}

function isWindowsUserAgent(userAgent: string): boolean {
    if (!userAgent) {
        return false;
    }
    const userAgentLower = userAgent.toLowerCase();
    const windowsIndicators = [
        'windows nt',
        'win32',
        'win64',
        'windows',
        'wow64'
    ];
    return windowsIndicators.some(indicator => userAgentLower.includes(indicator));
}

async function runAsFirstTime(): Promise<void> {
    console.log("====================");
    console.log("Run as first time");
    console.log("====================");

    const apiKey = getTestApiKey();
    const agentBay = new AgentBay({ apiKey });

    // Create a browser context for first time
    const sessionContextName = `test-browser-context-${Date.now()}`;
    const contextResult = await agentBay.context.get(sessionContextName, true);
    if (!contextResult.success || !contextResult.context) {
        console.log("Failed to create browser context");
        return;
    }

    persistentContext = contextResult.context;
    console.log(`Created browser context: ${persistentContext.name} (ID: ${persistentContext.id})`);

    // Create a browser fingerprint context for first time
    const fingerprintContextName = `test-browser-fingerprint-${Date.now()}`;
    const fingerprintContextResult = await agentBay.context.get(fingerprintContextName, true);
    if (!fingerprintContextResult.success || !fingerprintContextResult.context) {
        console.log("Failed to create fingerprint context");
        return;
    }

    persistentFingerprintContext = fingerprintContextResult.context;
    console.log(`Created fingerprint context: ${persistentFingerprintContext.name} (ID: ${persistentFingerprintContext.id})`);

    // Create session with BrowserContext and FingerprintContext
    console.log(`Creating session with browser context ID: ${persistentContext.id} ` +
                `and fingerprint context ID: ${persistentFingerprintContext.id}`);
    
    const fingerprintContext = new BrowserFingerprintContext(persistentFingerprintContext.id);
    const browserContext = new BrowserContext(persistentContext.id, true, undefined, fingerprintContext);
    
    const params = new CreateSessionParams()
        .withImageId("browser_latest")
        .withBrowserContext(browserContext);

    const sessionResult = await agentBay.create(params);
    if (!sessionResult.success || !sessionResult.session) {
        console.log(`Failed to create first session: ${sessionResult.errorMessage}`);
        return;
    }

    const session = sessionResult.session;
    console.log(`First session created with ID: ${session.sessionId}`);

    // Initialize browser with fingerprint persistent enabled and set fingerprint generation options
    const browserOption: BrowserOption = {
        useStealth: true,
        fingerprintPersistent: true,
        fingerprint: {
            devices: ["desktop"],
            operatingSystems: ["windows"],
            locales: ["zh-CN"]
        } as BrowserFingerprint
    };

    const initSuccess = await session.browser.initializeAsync(browserOption);
    if (!initSuccess) {
        console.log("Failed to initialize browser");
        return;
    }
    console.log("First session browser initialized successfully");

    // Get endpoint URL and test fingerprint
    const endpointUrl = await session.browser.getEndpointUrl();
    if (!endpointUrl) {
        console.log("Failed to get browser endpoint URL");
        return;
    }
    console.log(`First session browser endpoint URL: ${endpointUrl}`);

    // Connect with playwright, test first session fingerprint
    console.log("Opening https://httpbin.org/user-agent and test user agent...");
    const browser = await chromium.connectOverCDP(endpointUrl);
    const context = browser.contexts().length > 0 ? browser.contexts()[0] : await browser.newContext();

    const page = await context.newPage();
    await page.goto("https://httpbin.org/user-agent", { timeout: 60000 });
    const response = await page.evaluate(() => JSON.parse(document.body.textContent));
    const userAgent = response["user-agent"];
    console.log("user_agent =", userAgent);
    
    const isWindows = isWindowsUserAgent(userAgent);
    if (!isWindows) {
        console.log("Failed to get windows user agent");
        return;
    }

    await context.close();
    console.log("First session browser fingerprint check completed");

    // Delete first session with syncContext=true
    console.log("Deleting first session with syncContext=true...");
    const deleteResult = await agentBay.delete(session, { syncContext: true });
    console.log(`First session deleted successfully (RequestID: ${deleteResult.requestId})`);
}

async function runAsSecondTime(): Promise<void> {
    console.log("====================");
    console.log("Run as second time");
    console.log("====================");

    const apiKey = getTestApiKey();
    const agentBay = new AgentBay({ apiKey });

    // Create second session with same browser context and fingerprint context
    console.log(`Creating second session with same browser context ID: ${persistentContext.id} ` +
                `and fingerprint context ID: ${persistentFingerprintContext.id}`);
    
    const fingerprintContext = new BrowserFingerprintContext(persistentFingerprintContext.id);
    const browserContext = new BrowserContext(persistentContext.id, true, undefined, fingerprintContext);
    
    const params = new CreateSessionParams()
        .withImageId("browser_latest")
        .withBrowserContext(browserContext);

    const sessionResult = await agentBay.create(params);
    if (!sessionResult.success || !sessionResult.session) {
        console.log(`Failed to create second session: ${sessionResult.errorMessage}`);
        return;
    }

    const session = sessionResult.session;
    console.log(`Second session created with ID: ${session.sessionId}`);

    // Initialize browser with fingerprint persistent enabled but not specific fingerprint generation options
    const browserOption: BrowserOption = {
        useStealth: true,
        fingerprintPersistent: true
    };

    const initSuccess = await session.browser.initializeAsync(browserOption);
    if (!initSuccess) {
        console.log("Failed to initialize browser in second session");
        return;
    }
    console.log("Second session browser initialized successfully");

    // Get endpoint URL and test fingerprint persistence
    const endpointUrl = await session.browser.getEndpointUrl();
    if (!endpointUrl) {
        console.log("Failed to get browser endpoint URL in second session");
        return;
    }
    console.log(`Second session browser endpoint URL: ${endpointUrl}`);

    // Connect with playwright and test second session fingerprint
    const browser = await chromium.connectOverCDP(endpointUrl);
    const context = browser.contexts().length > 0 ? browser.contexts()[0] : await browser.newContext();
    const page = await context.newPage();
    await page.goto("https://httpbin.org/user-agent", { timeout: 60000 });
    const response = await page.evaluate(() => JSON.parse(document.body.textContent));
    const userAgent = response["user-agent"];
    console.log("user_agent =", userAgent);
    
    const isWindows = isWindowsUserAgent(userAgent);
    if (!isWindows) {
        console.log("Failed to get windows user agent in second session");
        return;
    }
    console.log("SUCCESS: fingerprint persisted correctly!");

    await context.close();
    console.log("Second session browser fingerprint check completed");

    // Delete second session with syncContext=true
    console.log("Deleting second session with syncContext=true...");
    const deleteResult = await agentBay.delete(session, { syncContext: true });
    console.log(`Second session deleted successfully (RequestID: ${deleteResult.requestId})`);
}

async function fingerprintPersistenceExample(): Promise<void> {
    /**
     * Test browser fingerprint persist across sessions with the same browser and fingerprint context.
     */
    try {
        await runAsFirstTime();
        await new Promise(resolve => setTimeout(resolve, 3000)); // Wait 3 seconds
        await runAsSecondTime();
    } catch (error) {
        console.error("Error in main function:", error);
    }
}

fingerprintPersistenceExample().catch(console.error);
```

### Persistence with Other Fingerprint Types

The fingerprint persistence feature works with all three generation methods:

#### Local Sync Persistence
```python
# First session: Generate from local browser and persist
browser_option = BrowserOption(
    use_stealth=True,
    fingerprint_persistent=True,
    fingerprint_format=local_fingerprint_format  # From BrowserFingerprintGenerator
)
```

#### Custom Fingerprint Persistence
```python
# First session: Load custom fingerprint and persist
browser_option = BrowserOption(
    use_stealth=True,
    fingerprint_persistent=True,
    fingerprint_format=custom_fingerprint_format  # From JSON file or constructed
)
```

## Best Practices

### 1. Browser Context Usage

**üí° Important**: Always use the pre-created browser context provided by AgentBay SDK.

```python
# ‚úÖ Correct - Use the existing context
browser = await p.chromium.connect_over_cdp(endpoint_url)
context = browser.contexts[0]  # Use the default context
page = await context.new_page()
```

```python
# ‚ùå Incorrect - Creating new context breaks stealth features
browser = await p.chromium.connect_over_cdp(endpoint_url)
context = await browser.new_context()  # Don't do this
page = await context.new_page()
```

### 2. Important Notice

All fingerprint generation methods require `use_stealth=True` configuration, otherwise fingerprint settings will not take effect. This is because fingerprint functionality depends on stealth mode to properly apply browser feature masking.

```python
# ‚úÖ Correct - Always enable stealth mode for fingerprints
browser_option = BrowserOption(
    use_stealth=True,  # Required for fingerprint to work
    fingerprint=BrowserFingerprint(
        devices=["desktop"],
        operating_systems=["windows"],
        locales=["en-US"]
    )
)

session = await agentbay.start_browser_session(
    browser_option=browser_option
)
```

```python
# ‚ùå Incorrect - Missing use_stealth=True
browser_option = BrowserOption(
    # use_stealth=True is missing!
    fingerprint=BrowserFingerprint(
        devices=["desktop"],
        operating_systems=["windows"],
        locales=["en-US"]
    )
)
# Fingerprint configuration will be ignored
```

### 3. Fingerprint Generation Strategy

#### Parameter Priority
When multiple fingerprint parameters are provided, the priority is:
1. `fingerprint_format` (customized generation)
2. `fingerprint` (random generation)

```python
# ‚úÖ Correct - Use fingerprint_format for specific fingerprints
browser_option = BrowserOption(
    use_stealth=True,
    fingerprint_format=my_fingerprint_format
    # fingerprint parameter will be ignored
)
```

```python
# ‚ùå Avoid - user_agent disables fingerprint features
browser_option = BrowserOption(
    use_stealth=True,
    user_agent="Custom User Agent",
    fingerprint=BrowserFingerprint(...)  # Will be ignored
)
```

### 4. Fingerprint Persistence Behavior

When fingerprint persistence is enabled (`fingerprint_persistent=True`), the system behaves differently based on the fingerprint configuration type:

#### Using `fingerprint` Parameter
When configured with the `fingerprint` parameter, the system will **prioritize persisted fingerprints** over generating new random ones:

```python
# First run - generates and persists a random fingerprint
browser_option = BrowserOption(
    use_stealth=True,
    fingerprint_persistent=True,
    fingerprint=BrowserFingerprint(
        devices=["desktop"],
        operating_systems=["windows"],
        locales=["en-US"]
    )
)

# Subsequent runs - uses the same persisted fingerprint
# The fingerprint parameter serves as a template but won't generate new random values
```

#### Using `fingerprint_format` Parameter
When configured with the `fingerprint_format` parameter, the system will **override existing persisted fingerprints** because the user has explicitly configured the fingerprint parameters :

```python
# This will replace any existing persisted fingerprint
browser_option = BrowserOption(
    use_stealth=True,
    fingerprint_persistent=True,
    fingerprint_format=custom_fingerprint_format  # Overrides persisted data
)
```

#### Behavior Summary

| Configuration Type | Persistence Behavior |
|-------------------|---------------------|
| `fingerprint` | Uses persisted fingerprint if exists, otherwise generates and persists new random fingerprint |
| `fingerprint_format` | Always uses provided fingerprint and overwrites any existing persisted data |

```python
# ‚úÖ Correct - Consistent fingerprint across sessions
browser_option = BrowserOption(
    use_stealth=True,
    fingerprint_persistent=True,
    fingerprint=BrowserFingerprint(devices=["desktop"])
)
# Will use the same fingerprint in all sessions

# ‚úÖ Correct - Force update persisted fingerprint
browser_option = BrowserOption(
    use_stealth=True,
    fingerprint_persistent=True,
    fingerprint_format=new_fingerprint_data
)
# Will replace existing fingerprint with new data
```

### 5. Device and OS Compatibility

Ensure device types match operating systems:

```python
# ‚úÖ Correct configurations
desktop_fingerprint = BrowserFingerprint(
    devices=["desktop"],
    operating_systems=["windows", "macos", "linux"]
)

mobile_fingerprint = BrowserFingerprint(
    devices=["mobile"],
    operating_systems=["android", "ios"]
)
```

```python
# ‚ùå Incorrect - mismatched device and OS
wrong_fingerprint = BrowserFingerprint(
    devices=["desktop"],
    operating_systems=["android", "ios"]  # Mobile OS with desktop device
)
```

### 6. Context Management for Persistence

- Create unique context names to avoid conflicts
- Use `sync_context=True` when deleting sessions to save fingerprints
- Clean up contexts after use to prevent resource leaks
- Wait for context sync to complete before creating new sessions

## Troubleshooting

### Common Issues

1. **Fingerprint Not Persisting**
   - Ensure `fingerprint_persistent=True` is set
   - Verify browser and fingerprint contexts are properly configured
   - Use `sync_context=True` when deleting sessions
   - Wait for context sync to complete

2. **Local Fingerprint Generation Fails**
   - Check if Chrome is installed and accessible
   - Try running with `headless=False` for debugging
   - Ensure sufficient permissions for browser automation

3. **Custom Fingerprint Loading Errors**
   - Verify JSON file format matches FingerprintFormat schema
   - Check file permissions and path accessibility
   - Validate fingerprint data completeness

## üìö Related Guides

- [Browser Proxies](browser-proxies.md) - IP rotation and proxy configuration
- [CAPTCHA Resolution](captcha.md) - Automatic CAPTCHA handling
- [Browser Context](browser-context.md) - Cookie and session management
- [Browser Use Overview](../README.md) - Complete browser automation features

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../../README.md)



# Browser Proxy Configuration Guide

---

## Overview

Browser Proxy is a core feature of the AgentBay SDK that enables developers to route browser traffic through proxy servers. This functionality is essential for scenarios requiring IP rotation, geographical distribution, or network anonymization. The AgentBay SDK supports both custom proxy servers and integrated Wuying Proxy Service.

## Key Features

### 1. Custom Proxy Support
Configure your own proxy servers with full control over routing and authentication:
- **Protocol Support**: HTTP, HTTPS, and SOCKS proxies
- **Authentication**: Optional username and password authentication
- **Flexible Configuration**: Support for various proxy server configurations

### 2. Wuying Proxy Service
Leverage Alibaba Cloud's integrated proxy service with advanced management features:
- **Restricted Strategy**: Uses fixed proxy nodes for consistent IP addresses
- **Polling Strategy**: Rotates through a pool of proxy nodes for IP diversity
- **Managed Infrastructure**: No need to maintain your own proxy servers

## Proxy Types and Strategies

### Custom Proxy
Suitable for users who have their own proxy infrastructure or specific proxy requirements.

**Configuration Options:**
- `type`: Set to `"custom"`
- `server`: Proxy server address (required)
- `username`: Authentication username (optional)
- `password`: Authentication password (optional)

### Wuying Proxy
Provided by the Wuying Proxy Service integrated in AgentBay SDK

**Restricted Strategy:**
- Uses fixed proxy nodes
- Provides stable IP addresses
- The IP remains stable for the lifetime of the session.

**Polling Strategy:**
- Rotates through a pool of proxy nodes
- Provides IP diversity for each request
- Suitable for scenarios requiring frequent IP changes
- Configurable pool size via `pollsize` parameter

## Python Implementation

### Basic Usage

```python
import os
import asyncio
from agentbay import AgentBay
from agentbay import CreateSessionParams
from agentbay import BrowserOption, BrowserProxy
from playwright.async_api import async_playwright

async def proxy_example():
    # Initialize AgentBay client
    api_key = os.getenv("AGENTBAY_API_KEY")
    agent_bay = AgentBay(api_key=api_key)

    # Create session
    params = CreateSessionParams(image_id="browser_latest")
    session_result = agent_bay.create(params)

    if session_result.success:
        session = session_result.session
        print(f"Session created successfully, Session ID: {session.session_id}")

        # Example 1: Custom Proxy Configuration
        # browser_proxy = BrowserProxy(
        #     proxy_type="custom",
        #     server="http://127.0.0.1:9090",
        #     username="username",
        #     password="password"
        # )

        # Example 2: Wuying Proxy - Polling Strategy
        browser_proxy = BrowserProxy(
            proxy_type="wuying",
            strategy="polling",
            pollsize=2
        )

        # Example 3: Wuying Proxy - Restricted Strategy
        # browser_proxy = BrowserProxy(
        #     proxy_type="wuying",
        #     strategy="restricted"
        # )

        # Create browser options with proxy configuration
        browser_option = BrowserOption(
            proxies=[browser_proxy]
        )

        # Initialize browser instance
        if await session.browser.initialize_async(browser_option):
            endpoint_url = session.browser.get_endpoint_url()
            print(f"Browser CDP endpoint: {endpoint_url}")

            # Use Playwright to connect to remote browser instance
            async with async_playwright() as p:
                browser = await p.chromium.connect_over_cdp(endpoint_url)
                context = browser.contexts[0]
                page = await context.new_page()

                # Verify proxy IP
                print("\n--- Starting proxy public IP check ---")
                await page.goto("https://httpbin.org/ip")

                try:
                    response = await page.evaluate("() => JSON.parse(document.body.textContent)")
                    public_ip = response.get("origin", "").strip()
                    print(f"Proxy public IP: {public_ip}")
                except Exception as e:
                    print(f"Failed to get proxy public IP: {e}")

                print("--- Proxy IP check completed ---\n")
                await page.wait_for_timeout(3000)
                await browser.close()

        # Clean up session
        agent_bay.delete(session)

if __name__ == "__main__":
    asyncio.run(proxy_example())
```

## TypeScript Implementation

### Basic Usage

```typescript
import { AgentBay, CreateSessionParams } from 'wuying-agentbay-sdk';
import { BrowserOption, BrowserProxy } from 'wuying-agentbay-sdk';
import { chromium } from 'playwright';

interface IpResponse {
    origin: string;
}

async function proxyExample(): Promise<void> {
    // Initialize AgentBay client
    const apiKey = process.env.AGENTBAY_API_KEY;
    if (!apiKey) {
        console.log('Error: AGENTBAY_API_KEY environment variable not set');
        return;
    }

    try {
        const agentBay = new AgentBay({ apiKey });

        // Create a session
        const params: CreateSessionParams = {
            imageId: 'browser_latest',
        };
        const sessionResult = await agentBay.create(params);

        if (!sessionResult.success) {
            console.log('Failed to create session');
            return;
        }

        const session = sessionResult.session;
        console.log(`Session created with ID: ${session.sessionId}`);

        // Example 1: Custom Proxy Configuration
        // const browserProxy: BrowserProxy = {
        //     type: 'custom',
        //     server: 'http://127.0.0.1:9090',
        //     username: 'username',
        //     password: 'password',
        //     toMap: function() {
        //         return {
        //             type: this.type,
        //             server: this.server,
        //             username: this.username,
        //             password: this.password
        //         };
        //     }
        // };

        // Example 2: Wuying Proxy - Polling Strategy
        const browserProxy: BrowserProxy = {
            type: 'wuying',
            strategy: 'polling',
            pollsize: 2,
            toMap: function() {
                return {
                    type: this.type,
                    strategy: this.strategy,
                    pollsize: this.pollsize
                };
            }
        };

        // Example 3: Wuying Proxy - Restricted Strategy
        // const browserProxy: BrowserProxy = {
        //     type: 'wuying',
        //     strategy: 'restricted',
        //     toMap: function() {
        //         return {
        //             type: this.type,
        //             strategy: this.strategy
        //         };
        //     }
        // };

        // Create browser option with proxy configuration
        const browserOption: BrowserOption = {
            proxies: [browserProxy]
        };

        const initialized = await session.browser.initializeAsync(browserOption);
        if (initialized) {
            const endpointUrl = session.browser.getEndpointUrl();
            console.log('endpoint_url =', endpointUrl);

            const browser = await chromium.connectOverCDP(endpointUrl);
            const context = browser.contexts()[0];
            const page = await context.newPage();

            try {
                // Verify proxy IP
                console.log('\n--- Check proxy public IP start ---');
                await page.goto('https://httpbin.org/ip');

                const response = await page.evaluate((): IpResponse => {
                    return JSON.parse(document.body.textContent || '{}');
                });
                const publicIp = response.origin || '';
                console.log('proxy public IP:', publicIp);
                console.log('--- Check proxy public IP end ---');

                await page.waitForTimeout(3000);
            } finally {
                await browser.close();
            }
        }

        // Clean up session
        await agentBay.delete(session);
    } catch (error) {
        console.error('Error:', error);
    }
}

proxyExample().catch(console.error);
```

## Best Practices

### 1. Proxy Selection Strategy

**Custom Proxy Usage:**
- Use when you have existing proxy infrastructure
- Ideal for specific geographic requirements
- Provides full control over proxy configuration

```python
# ‚úÖ Correct - Custom proxy with authentication
custom_proxy = BrowserProxy(
    proxy_type="custom",
    server="http://proxy.example.com:8080",
    username="your_username",
    password="your_password"
)
```

**Wuying Proxy Usage:**
- Use for managed proxy infrastructure
- Choose strategy based on your use case:
  - **Restricted**: For consistent IP requirements
  - **Polling**: For IP rotation needs

```python
# ‚úÖ Correct - Wuying proxy with appropriate strategy
wuying_proxy = BrowserProxy(
    proxy_type="wuying",
    strategy="polling",
    pollsize=3  # Adjust based on your needs
)
```

### 2. Error Handling and Monitoring

```python
async def robust_proxy_usage():
    try:
        # Initialize browser with proxy
        if await session.browser.initialize_async(browser_option):
            endpoint_url = session.browser.get_endpoint_url()
            
            async with async_playwright() as p:
                browser = await p.chromium.connect_over_cdp(endpoint_url)
                context = browser.contexts[0]
                page = await context.new_page()
                
                # Verify proxy is working
                await page.goto("https://httpbin.org/ip", timeout=30000)
                
                # Check if proxy is applied
                response = await page.evaluate("() => JSON.parse(document.body.textContent)")
                proxy_ip = response.get("origin", "").strip()
                
                if not proxy_ip:
                    raise Exception("Failed to detect proxy IP")
                    
                print(f"Successfully using proxy IP: {proxy_ip}")
                
                await browser.close()
        else:
            print("Browser initialization failed - check proxy configuration")
            
    except Exception as e:
        print(f"Proxy configuration error: {e}")
        # Implement fallback logic or retry mechanism
```

## Limitations
- **Single Proxy Support**: Although BrowserOption accepts an array in proxies, only the first proxy is currently applied per session.
- **Global Proxy Scope**: The proxy applies globally, meaning all browser requests will be routed through the proxy

## üìö Related Guides

- [Browser Context](browser-context.md) - Browser context management for cookies and sessions
- [Browser Fingerprint](browser-fingerprint.md) - Simulate browser fingerprint for web automation
- [Browser Use Overview](../README.md) - Complete browser automation features
- [Session Management](../../common-features/basics/session-management.md) - Session lifecycle and configuration

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../../README.md)




# Browser Screenshot API

The AgentBay SDK provides comprehensive screenshot capabilities across all supported languages. This document provides a summary of the API functionality and links to detailed documentation for each language implementation.

## Overview

The screenshot functionality allows you to capture web page content with enhanced options including full page capture, custom image formats, quality control, and proper handling of lazy-loaded content. All implementations follow the same design patterns and provide consistent behavior across languages.

## Key Features

All language implementations provide the following core features:

1. **Full Page Capture** - Ability to capture entire web pages including content below the fold
2. **Multiple Formats** - Support for both PNG and JPEG formats with customizable quality
3. **Enhanced Loading** - Wait for network idle state and handle lazy-loaded content
4. **Viewport Management** - Automatic viewport sizing for consistent screenshots
5. **Error Handling** - Comprehensive error handling with descriptive messages
6. **Custom Options** - Configurable timeout, animations, caret handling, and scale settings

## API Methods

### Python Implementation

The Python SDK provides two screenshot methods:

1. **Browser Agent Screenshot** - `session.browser.agent.screenshot()`
   - Returns base64 encoded data
   - Works with or without a page object
   - Suitable for agent-based workflows

2. **Direct Browser Screenshot** - `session.browser.screenshot(page)`
   - Returns raw bytes data
   - Requires a Playwright page object
   - Provides more control over the screenshot process

#### Detailed Documentation
- [Python Browser API Documentation](../../../../python/docs/api/async/async-browser.md#screenshot)

#### Example Usage
- [Python Browser Screenshot Example](../../../../python/docs/examples/_async/browser-use/browser/browser_screenshot.py)
- [Python Integration Tests](../../../../python/tests/integration/_async/test_browser_screenshot.py)
- [Python Unit Tests](../../../../python/tests/unit/shared/test_browser_screenshot.py)

### TypeScript Implementation

The TypeScript SDK provides similar functionality with full Playwright integration:

#### Method Signature
```typescript
async screenshot(page: any, fullPage: boolean = false, options: Record<string, any> = {}): Promise<Uint8Array>
```

#### Detailed Documentation
- [TypeScript Browser Source Code](../../../../typescript/src/browser/browser.ts) (Search for the `screenshot` method)

#### Example Usage
- [TypeScript Browser Screenshot Test](../../../../typescript/tests/unit/browser-screenshot.test.ts)
- [TypeScript Integration Test](../../../../typescript/tests/integration/browser-screenshot.integration.test.ts)

### Go Implementation

The Go SDK provides the same screenshot capabilities with proper error handling and Playwright integration:

#### Method Signature
```go
func (b *Browser) Screenshot(page interface{}, options *ScreenshotOptions) ([]byte, error)
```

#### Detailed Documentation
- [Go Browser Source Code](../../../../golang/pkg/agentbay/browser/browser.go) (Search for the `Screenshot` method)

#### Example Usage
- [Go Browser Test](../../../../golang/tests/pkg/unit/browser_test.go)
- [Go Integration Test](../../../../golang/tests/pkg/integration/browser_screenshot_integration_test.go)

## Cross-Language Consistency

The screenshot functionality maintains consistent behavior across all language implementations:

| Feature | Python | TypeScript | Go |
|---------|--------|------------|-----|
| Method Name | `screenshot` | `screenshot` | `Screenshot` |
| Full Page Capture | ‚úÖ | ‚úÖ | ‚úÖ |
| Image Format Support | PNG, JPEG | PNG, JPEG | PNG, JPEG |
| Quality Control | ‚úÖ | ‚úÖ | ‚úÖ |
| Timeout Configuration | ‚úÖ | ‚úÖ | ‚úÖ |
| Error Handling | BrowserError/RuntimeError | BrowserError/Error | error |
| Return Type (Direct) | bytes | Uint8Array | []byte |
| Return Type (Agent) | str (base64) | str (base64) | string (base64) |

## Common Parameters

All implementations support similar parameters:

| Parameter | Type | Description | Default |
|-----------|------|-------------|---------|
| `page` | Page object | Playwright page object (required for direct browser method) | N/A |
| `full_page` | boolean | Whether to capture the full scrollable page | false |
| `type` | string | Image type ('png' or 'jpeg') | 'png' |
| `quality` | integer | Quality of the image (0-100, jpeg only) | 0 |
| `timeout` | integer | Maximum time in milliseconds | 60000 |
| `animations` | string | How to handle animations | 'disabled' |
| `caret` | string | How to handle the caret | 'hide' |
| `scale` | string | Scale setting | 'css' |

## Enhanced Functionality

All implementations include enhanced functionality to ensure high-quality screenshots:

1. **Network Idle Waiting** - Waits for page to reach network idle state
2. **Content Scrolling** - Automatically scrolls to load lazy-loaded content
3. **Image Loading** - Ensures images with data-src attributes are properly loaded
4. **Viewport Adjustment** - Sets appropriate viewport size for consistent captures
5. **Error Recovery** - Comprehensive error handling with descriptive messages

## Usage Patterns

### Basic Screenshot
```python
# Python - Direct Browser
screenshot_data = await session.browser.screenshot(page)

# Python - Browser Agent
screenshot_data = await session.browser.agent.screenshot()
```

```typescript
// TypeScript
const screenshotData = await browser.screenshot(page);
```

```go
// Go
screenshotData, err := browser.Screenshot(page, nil)
```

### Full Page Screenshot
```python
# Python - Direct Browser
screenshot_data = await session.browser.screenshot(page, full_page=True)

# Python - Browser Agent
screenshot_data = await session.browser.agent.screenshot(full_page=True)
```

```typescript
// TypeScript
const screenshotData = await browser.screenshot(page, true);
```

```go
// Go
options := &browser.ScreenshotOptions{FullPage: true}
screenshotData, err := browser.Screenshot(page, options)
```

### Custom Options
```python
# Python - Direct Browser
screenshot_data = await session.browser.screenshot(
    page,
    full_page=False,
    type="jpeg",
    quality=80,
    timeout=30000
)
```

```typescript
// TypeScript
const screenshotData = await browser.screenshot(page, false, {
    type: "jpeg",
    quality: 80,
    timeout: 30000
});
```

```go
// Go
options := &browser.ScreenshotOptions{
    FullPage: false,
    Type: "jpeg",
    Quality: 80,
    Timeout: 30000,
}
screenshotData, err := browser.Screenshot(page, options)
```

## Error Handling

All implementations provide consistent error handling:

1. **Browser Not Initialized** - Error when trying to take screenshot without initializing browser
2. **Page Not Provided** - Error when page parameter is null/undefined
3. **Screenshot Capture Failure** - Errors during actual screenshot capture process
4. **Network Timeout** - Timeout errors during page loading

## Best Practices

1. **Always Initialize Browser** - Ensure browser is initialized before taking screenshots
2. **Handle Errors Gracefully** - Implement proper error handling for network issues
3. **Use Appropriate Timeouts** - Set reasonable timeout values based on page complexity
4. **Consider Image Format** - Use JPEG for smaller file sizes, PNG for transparency support
5. **Verify Page State** - Ensure page is fully loaded before taking screenshots

## Related Documentation

- [Browser Context Management](./browser-context.md)
- [Browser Command Arguments](./browser-command-args.md)
- [Browser Proxies](./browser-proxies.md)
- [Stealth Mode](./browser-fingerprint.md#2-important-notice)



# Call For User

The Call For User feature handles scenarios where browser automation encounters situations that require human intervention. This includes authentication challenges, complex verification processes, or security measures that cannot be automatically resolved by the system.

> **Use Cases:** This feature is triggered when the browser encounters user information requests, authentication challenges, or other scenarios that require manual human interaction to proceed.

## When Call For User is Triggered

The system automatically triggers a "wuying-call-for-user" message when it encounters:

- **Authentication challenges** that cannot be automatically resolved
- **Complex verification processes** that need user input
- **Security measures** that require manual verification
- **User information requests** that need human intervention
- **Situations** where automated solutions are insufficient

## Event Monitoring

Monitor Call For User events through console messages to implement custom handling logic:

```python
def handle_console(msg):
    print(f"üîç Received console message: {msg.text}")
    # Parse JSON message
    try:
        message_data = json.loads(msg.text)
        message_type = message_data.get('type', '')
    except (json.JSONDecodeError, AttributeError):
        # If not JSON, treat as plain text
        message_type = msg.text

    if message_type == "wuying-call-for-user":
        # Open browser for user interaction
        import webbrowser
        webbrowser.open(info.resource_url)
        # Wait for user to complete interaction
        time.sleep(20)

page.on("console", handle_console)
```

## Handling User Intervention

When a Call For User event is triggered, the recommended flow is:

1. **Parse the console message** to identify the message type
2. **Open the session resource URL** in a browser for user interaction
3. **Allow the user to interact** with the browser to complete the required action
4. **Wait for completion** (typically 20-30 seconds)
5. **Continue with automation** flow

## Configuration

The Call For User feature works automatically with any browser session. No special configuration is required:

```python
params = CreateSessionParams(
    image_id="browser_latest",  # Specify the image ID
)
session_result = agent_bay.create(params)

if session_result.success:
    session = session_result.session
    print(f"Session created with ID: {session.session_id}")

    # Get session info to access resource URL
    result = session.info()
    info = result.data
    print(f"session resource url is {info.resource_url}")

    # Call For User is automatically enabled
    if await session.browser.initialize_async(BrowserOption()):
        print("Browser initialized successfully")
```

## Usage Tips

- **Monitor console events** to detect when user intervention is needed
- **Implement proper waiting** mechanisms (20-30 seconds) for user interaction
- **Handle URL escaping** for special characters in resource URLs
- **Provide clear feedback** to users about what action is required
- **Plan for user interaction time** in your automation workflows


## üìö Related Guides

- [CAPTCHA Resolution](captcha.md) - Automatic CAPTCHA handling
- [Session Management](../../common-features/basics/session-management.md) - Session lifecycle and configuration
- [Browser Use Overview](../README.md) - Complete browser automation features

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../../README.md)




# CAPTCHA Resolution

CAPTCHA challenges are common obstacles in web automation that can disrupt your workflow. AIBrowser includes an intelligent CAPTCHA resolution system that automatically handles these verification challenges, ensuring your automation tasks proceed smoothly.

> **Version Information:** CAPTCHA resolution is available starting from version 0.7.0. Currently, the system only supports automatic resolution of slider-type CAPTCHAs. Support for text-based CAPTCHAs will be added in future releases.

## Automatic CAPTCHA Resolution

The system works by:
- Detecting CAPTCHA challenges as they appear on web pages
- Processing the challenge using advanced recognition algorithms
- Completing the verification process transparently
- Resolution typically completes within 30 seconds for most CAPTCHA types
- Feature is opt-in and disabled by default for performance optimization

## Event Monitoring

Track CAPTCHA resolution progress through console events. This allows you to implement custom logic while the system handles the verification:

```python
def handle_console(msg):
    if msg.text == "wuying-captcha-solving-started":
        print("CAPTCHA solving started")
    elif msg.text == "wuying-captcha-solving-finished":
        print("CAPTCHA solving finished")

page.on("console", handle_console)
```

## Configuration

Enable CAPTCHA resolution by setting the appropriate flag during browser initialization:

```python
params = CreateSessionParams(
    image_id="browser_latest",  # Specify the image ID
)
session_result = agent_bay.create(params)

session = session_result.session
browser_option = BrowserOption(
    solve_captchas=True,
)
await session.browser.initialize_async(browser_option)
```

## Usage Tips

- Plan for up to 30 seconds processing time per CAPTCHA
- Implement event listeners to track resolution status
- Disable the feature if manual CAPTCHA handling is preferred for your use case

## üìö Related Guides

- [Browser Fingerprint](browser-fingerprint.md) - Simulate browser fingerprint for web automation
- [Call For User](call-for-user.md) - Human intervention for unsolvable challenges
- [Browser Use Overview](../README.md) - Complete browser automation features
- [Session Management](../../common-features/basics/session-management.md) - Session lifecycle and configuration

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../../README.md)




# Browser Extension Management

Browser Extension Management is a core feature of the AgentBay SDK that enables you to upload, manage, and synchronize browser extensions with your browser sessions. This is particularly useful for automated testing of browser extensions, web scraping with custom extensions, and browser automation workflows.

## Overview

The Extension Management feature allows you to:
- Upload browser extensions to the cloud
- Manage multiple extensions in a context
- Automatically synchronize extensions to browser sessions
- Test extension functionality in controlled environments
- Update and maintain extensions across sessions

## Key Concepts

### ExtensionsService

The `ExtensionsService` is the main class for managing browser extensions. It handles:
- Extension storage in cloud contexts
- Extension upload and management
- Extension synchronization to sessions
- Automatic cleanup of resources

### ExtensionOption

The `ExtensionOption` encapsulates extension configuration for browser sessions, including:
- Context ID where extensions are stored
- List of extension IDs to synchronize
- Automatic generation of context sync configurations

### Extension Synchronization

Extensions are automatically synchronized to browser sessions at:
- Path: `/tmp/extensions/{extension_id}/` in each session
- Each extension gets its own directory with all extension files
- Session isolation ensures each session has its own copy

## Python Implementation

### Basic Extension Usage

```python
from agentbay import AgentBay
from agentbay import ExtensionsService
from agentbay import CreateSessionParams, BrowserContext

# Initialize AgentBay and Extensions Service
agent_bay = AgentBay(api_key="your_api_key")
extensions_service = ExtensionsService(agent_bay)

# Upload your extension
extension = extensions_service.create("/path/to/your-extension.zip")
print(f"Extension uploaded: {extension.name} (ID: {extension.id})")

# Create extension option for browser integration
ext_option = extensions_service.create_extension_option([extension.id])

# Create browser session with extension
session_params = CreateSessionParams(
    labels={"purpose": "extension_testing"},
    browser_context=BrowserContext(
        context_id="extension_test_session",
        extension_option=ext_option
    )
)

# Create session - extension will be automatically synchronized
session_result = agent_bay.create(session_params)
session = session_result.session

# Extensions are now available at /tmp/extensions/ in the session
print("Extension session created successfully!")

# Clean up when done
extensions_service.cleanup()
```

### Working with Multiple Extensions

```python
# Upload multiple extensions
extension_paths = [
    "/path/to/extension1.zip",
    "/path/to/extension2.zip",
    "/path/to/extension3.zip"
]

extension_ids = []
for path in extension_paths:
    ext = extensions_service.create(path)
    extension_ids.append(ext.id)
    print(f"Uploaded: {ext.name}")

# Create session with all extensions
ext_option = extensions_service.create_extension_option(extension_ids)

session_params = CreateSessionParams(
    browser_context=BrowserContext(
        context_id="multi_extension_session",
        extension_option=ext_option
    )
)

session = agent_bay.create(session_params).session

# Extensions are available at /tmp/extensions/{extension_id}/
```

### Extension Development Workflow

```python
class ExtensionDevelopmentWorkflow:
    def __init__(self, api_key: str):
        self.agent_bay = AgentBay(api_key=api_key)
        self.extensions_service = ExtensionsService(self.agent_bay, "dev_extensions")
        self.extension_id = None
    
    def upload_extension(self, extension_path: str) -> str:
        """Upload extension for development testing."""
        extension = self.extensions_service.create(extension_path)
        self.extension_id = extension.id
        print(f"Extension uploaded: {extension.name}")
        return extension.id
    
    def create_test_session(self):
        """Create a browser session for testing."""
        ext_option = self.extensions_service.create_extension_option([self.extension_id])
        
        session_params = CreateSessionParams(
            labels={"purpose": "extension_development"},
            browser_context=BrowserContext(
                context_id="dev_session",
                extension_option=ext_option
            )
        )
        
        return self.agent_bay.create(session_params).session
    
    def update_and_test(self, new_extension_path: str):
        """Update extension and create new test session."""
        # Update existing extension
        updated_ext = self.extensions_service.update(self.extension_id, new_extension_path)
        print(f"Extension updated: {updated_ext.name}")
        
        # Create new test session with updated extension
        return self.create_test_session()
    
    def cleanup(self):
        """Clean up development resources."""
        if self.extension_id:
            self.extensions_service.delete(self.extension_id)
        self.extensions_service.cleanup()

# Usage
workflow = ExtensionDevelopmentWorkflow(api_key="your_api_key")
try:
    # Development cycle
    workflow.upload_extension("/path/to/extension-v1.zip")
    session1 = workflow.create_test_session()
    # Test extension functionality...
    
    # Update and test again
    session2 = workflow.update_and_test("/path/to/extension-v2.zip")
    # Test updated functionality...
    
finally:
    workflow.cleanup()
```

## TypeScript Implementation

### Basic Extension Usage

```typescript
import { AgentBay, ExtensionsService, CreateSessionParams, BrowserContext } from 'wuying-agentbay-sdk';

// Initialize AgentBay and Extensions Service
const agentBay = new AgentBay({ apiKey: "your_api_key" });
const extensionsService = new ExtensionsService(agentBay);

// Upload your extension
const extension = await extensionsService.create("/path/to/your-extension.zip");
console.log(`Extension uploaded: ${extension.name} (ID: ${extension.id})`);

// Create extension option for browser integration
const extOption = extensionsService.createExtensionOption([extension.id]);

// Create browser session with extension
const sessionParams = new CreateSessionParams()
    .withLabels({ purpose: "extension_testing" })
    .withBrowserContext(new BrowserContext(
        "extension_test_session",
        true,
        extOption
    ));

// Create session - extension will be automatically synchronized
const sessionResult = await agentBay.create(sessionParams);
const session = sessionResult.session;

// Extensions are now available at /tmp/extensions/ in the session
console.log("Extension session created successfully!");

// Clean up when done
await extensionsService.cleanup();
```

### Working with Multiple Extensions

```typescript
// Upload multiple extensions
const extensionPaths = [
    "/path/to/extension1.zip",
    "/path/to/extension2.zip",
    "/path/to/extension3.zip"
];

const extensionIds: string[] = [];
for (const path of extensionPaths) {
    const ext = await extensionsService.create(path);
    extensionIds.push(ext.id);
    console.log(`Uploaded: ${ext.name}`);
}

// Create session with all extensions
const extOption = extensionsService.createExtensionOption(extensionIds);

const sessionParams = new CreateSessionParams()
    .withBrowserContext(new BrowserContext(
        "multi_extension_session",
        true,
        extOption
    ));

const session = (await agentBay.create(sessionParams)).session;

// Extensions are available at /tmp/extensions/{extension_id}/
```

## Extension Context Management

The SDK automatically manages extension storage contexts:

### Auto-Generated Contexts

```python
# Auto-generated context (recommended for simple use cases)
extensions_service = ExtensionsService(agent_bay)
# Context name will be automatically generated as "extensions-{timestamp}"
```

### Named Contexts

```python
# Named context (recommended for persistent extension management)
extensions_service = ExtensionsService(agent_bay, "my_project_extensions")
# Context will be created if it doesn't exist
```

## Best Practices

1. **Use Named Contexts**: For persistent extension management, use named contexts instead of auto-generated ones
2. **Clean Up Resources**: Always call `cleanup()` to remove auto-created contexts
3. **Validate Extensions**: Ensure your extensions are properly packaged as ZIP files with manifest.json
4. **Handle Errors**: Implement proper error handling for extension operations
5. **Version Control**: Keep track of extension versions for consistent testing

## Extension Requirements

### File Format
- Extensions must be packaged as ZIP files (.zip)
- Standard browser extension structure with manifest.json
- Manifest V2 or V3 format supported

### File Structure
```
your-extension.zip
‚îú‚îÄ‚îÄ manifest.json
‚îú‚îÄ‚îÄ background.js
‚îú‚îÄ‚îÄ content.js
‚îú‚îÄ‚îÄ popup.html
‚îú‚îÄ‚îÄ icons/
‚îÇ   ‚îú‚îÄ‚îÄ 16.png
‚îÇ   ‚îú‚îÄ‚îÄ 48.png
‚îÇ   ‚îî‚îÄ‚îÄ 128.png
‚îî‚îÄ‚îÄ ...
```

### Size Limits
- Check AgentBay documentation for current size limits
- Large extensions may affect session startup time

## Error Handling

Common errors and how to handle them:

```python
try:
    extension = extensions_service.create("/path/to/extension.zip")
except FileNotFoundError:
    print("Extension file not found")
except ValueError as e:
    print(f"Invalid extension format: {e}")
except Exception as e:
    print(f"Failed to upload extension: {e}")
finally:
    extensions_service.cleanup()
```

## Advanced Features

### Extension Updates

```python
# Update an existing extension
updated_extension = extensions_service.update(
    extension_id="ext_1234567890",
    new_local_path="/path/to/updated-extension.zip"
)
```

### Listing Extensions

```python
# List all extensions in the current context
extensions = extensions_service.list()
for ext in extensions:
    print(f"Extension: {ext.name} (ID: {ext.id})")
```

### Deleting Extensions

```python
# Delete a specific extension
success = extensions_service.delete("ext_1234567890")
if success:
    print("Extension deleted successfully")
```

## Integration with Browser Context

Extensions integrate seamlessly with Browser Context for persistent browser environments:

```python
# Create both browser context and extension service
browser_context_result = agent_bay.context.get("persistent-browser", create=True)
browser_context = browser_context_result.context

extensions_service = ExtensionsService(agent_bay, "project-extensions")
extension = extensions_service.create("/path/to/extension.zip")
ext_option = extensions_service.create_extension_option([extension.id])

# Use both in session
session_params = CreateSessionParams(
    browser_context=BrowserContext(
        context_id=browser_context.id,  # Persistent browser state
        auto_upload=True,
        extension_option=ext_option     # Extension integration
    )
)

session = agent_bay.create(session_params).session
# Session has both persistent browser state AND extensions
```

## üìö Related Guides

- [Browser Context](browser-context.md) - Persistent browser state management
- [Session Management](../../common-features/basics/session-management.md) - Session lifecycle and configuration
- [Browser Use Overview](../README.md) - Complete browser automation features

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../../README.md)



# AIBrowser Core Features

## Context

- [BrowserContext](core-features/browser-context.md) - Create new or reuse existing browser contexts to speed up web page navigation and reduce anti-bot friction

## Extension

- [Extension Management](core-features/extension.md) - Upload, manage, and synchronize browser extensions with your browser sessions for automated testing and web scraping

## Fingerprint

- [Browser Fingerprint](core-features/browser-fingerprint.md) - Using browser fingerprinting to make the browser harder to detect by the anti-bot system

## IPProxy
- [Browser Proxy](core-features/browser-proxies.md) - Configure proxy servers to route browser traffic for IP rotation and geographical distribution

## Captcha Resolving

- [CAPTCHA Resolution](core-features/captcha.md) - Automatically resolve slider-type CAPTCHA challenges to ensure uninterrupted automation workflows

## Call For User

- [Call For User](core-features/call-for-user.md) - Handle scenarios that require human intervention when the browser encounters user information requests or unsolvable problems
## üìö Related Guides

- [Browser Use Overview](README.md) - Complete browser automation features
- [Advanced Features](advance-features.md) - PageUseAgent and advanced capabilities
- [Code Examples](code-example.md) - Code examples for browser automation

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../README.md)




# Integration with community framework/tools/services

## OpenAI CUA

## Crawl4ai
## üìö Related Guides

- [Browser Use Overview](README.md) - Complete browser automation features
- [Session Management](../common-features/basics/session-management.md) - Session lifecycle and configuration

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../README.md)




# CodeSpace Guide

CodeSpace is AgentBay's development environment for code execution and scripting.

> **üí° Async API Support**: This guide uses synchronous API. For async patterns, see:

## Documentation

- [Code Execution](code-execution.md) - Run code in cloud environments

## Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Main Documentation](../../README.md)




# Code Execution Guide (CodeSpace)

This guide covers code execution capabilities in AgentBay SDK's CodeSpace environment. CodeSpace provides a dedicated development environment optimized for running code in Python and JavaScript.

## üìã Table of Contents

- [Overview](#overview)
- [CodeSpace Environment](#codespace-environment)
- [Python Code Execution](#python-code-execution)
- [JavaScript Code Execution](#javascript-code-execution)
- [Code Execution with File I/O](#code-execution-with-file-io)
- [Best Practices](#best-practices)

<a id="overview"></a>
## üéØ Overview

CodeSpace is AgentBay's development-focused environment that provides:

- **Multi-language Support** - Run Python and JavaScript/Node.js code
- **Isolated Execution** - Secure, containerized code execution
- **Development Tools** - Pre-installed interpreters and development utilities
- **File Operations** - Read and write files for script execution

<a id="codespace-environment"></a>
## üîß CodeSpace Environment

### Creating a CodeSpace Session

To use code execution features, create a session with the `code_latest` image:

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams

agent_bay = AgentBay(api_key="your-api-key")

session_params = CreateSessionParams(image_id="code_latest")
result = agent_bay.create(session_params)

if result.success:
    session = result.session
    print(f"CodeSpace session created: {session.session_id}")
else:
    print(f"Failed to create session: {result.error_message}")
```

**Important:** The `run_code()` method requires `image_id="code_latest"` when creating the session.

<a id="python-code-execution"></a>
## üêç Python Code Execution

### Basic Python Execution

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams

agent_bay = AgentBay(api_key="your-api-key")

session_params = CreateSessionParams(image_id="code_latest")
result = agent_bay.create(session_params)

if result.success:
    session = result.session
    
    code = """
import os
import sys
print(f"Python version: {sys.version}")
print(f"Current directory: {os.getcwd()}")
print("Hello from AgentBay!")
"""
    
    result = session.code.run_code(code, "python")
    if result.success:
        print("Output:", result.result)
        # Output: Python version: 3.11.2 (main, Apr 28 2025, 14:11:48) [GCC 12.2.0]
        #         Current directory: /workspace
        #         Hello from AgentBay!
    else:
        print("Execution failed:", result.error_message)
    
    agent_bay.delete(session)
```

### Python with Calculations

```python
session_params = CreateSessionParams(image_id="code_latest")
result = agent_bay.create(session_params)

if result.success:
    session = result.session
    
    code = """
import math

# Calculate factorial
def factorial(n):
    return math.factorial(n)

# Fibonacci sequence
def fibonacci(n):
    if n <= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

print(f"Factorial of 10: {factorial(10)}")
print(f"Fibonacci of 10: {fibonacci(10)}")

# List comprehension
squares = [x**2 for x in range(1, 11)]
print(f"Squares: {squares}")
"""
    
    result = session.code.run_code(code, "python")
    if result.success:
        print("Output:", result.result)
        # Output: Factorial of 10: 3628800
        #         Fibonacci of 10: 55
        #         Squares: [1, 4, 9, 16, 25, 36, 49, 64, 81, 100]
    
    agent_bay.delete(session)
```

<a id="javascript-code-execution"></a>
## üü® JavaScript Code Execution

### Node.js Code Execution

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams

agent_bay = AgentBay(api_key="your-api-key")

session_params = CreateSessionParams(image_id="code_latest")
result = agent_bay.create(session_params)

if result.success:
    session = result.session
    
    js_code = """
const fs = require('fs');
const path = require('path');

console.log('Node.js version:', process.version);
console.log('Current directory:', process.cwd());

// Create a simple file
fs.writeFileSync('/tmp/hello.txt', 'Hello from Node.js!');
console.log('File created successfully');
"""
    
    result = session.code.run_code(js_code, "javascript")
    if result.success:
        print("Output:", result.result)
        # Output: Node.js version: v18.20.5
        #         Current directory: /workspace
        #         File created successfully
    else:
        print("Execution failed:", result.error_message)
    
    agent_bay.delete(session)
```

### JavaScript with Data Processing

```python
session_params = CreateSessionParams(image_id="code_latest")
result = agent_bay.create(session_params)

if result.success:
    session = result.session
    
    js_code = """
// Array operations
const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];

const sum = numbers.reduce((a, b) => a + b, 0);
const avg = sum / numbers.length;
const squares = numbers.map(x => x * x);

console.log('Numbers:', numbers);
console.log('Sum:', sum);
console.log('Average:', avg);
console.log('Squares:', squares);

// Object manipulation
const data = {
    name: 'AgentBay',
    version: '1.0',
    features: ['Python', 'JavaScript', 'File I/O']
};

console.log('\\nData:', JSON.stringify(data, null, 2));
"""
    
    result = session.code.run_code(js_code, "javascript")
    if result.success:
        print("Output:", result.result)
        # Output: Numbers: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
        #         Sum: 55
        #         Average: 5.5
        #         Squares: [1, 4, 9, 16, 25, 36, 49, 64, 81, 100]
        #         
        #         Data: {
        #           "name": "AgentBay",
        #           "version": "1.0",
        #           "features": [
        #             "Python",
        #             "JavaScript",
        #             "File I/O"
        #           ]
        #         }
    
    agent_bay.delete(session)
```

<a id="code-execution-with-file-io"></a>
## üìÅ Code Execution with File I/O

### Writing and Executing Scripts

```python
from agentbay import AgentBay

agent_bay = AgentBay(api_key="your-api-key")
result = agent_bay.create()

if result.success:
    session = result.session
    
    script_content = """
import json
import sys

data = {
    'message': 'Hello from uploaded script',
    'args': sys.argv[1:] if len(sys.argv) > 1 else []
}

with open('/tmp/output.json', 'w') as f:
    json.dump(data, f, indent=2)

print(json.dumps(data, indent=2))
"""
    
    write_result = session.file_system.write_file("/tmp/script.py", script_content)
    if write_result.success:
        print("Script uploaded successfully")
        
        exec_result = session.command.execute_command("python3 /tmp/script.py arg1 arg2")
        if exec_result.success:
            print("Script output:", exec_result.output)
            # Script output: {
            #   "message": "Hello from uploaded script",
            #   "args": [
            #     "arg1",
            #     "arg2"
            #   ]
            # }
            
            output_result = session.file_system.read_file("/tmp/output.json")
            if output_result.success:
                print("Output file content:", output_result.content)
                # Output file content: {
                #   "message": "Hello from uploaded script",
                #   "args": [
                #     "arg1",
                #     "arg2"
                #   ]
                # }
        else:
            print("Execution failed:", exec_result.error_message)
    else:
        print("Failed to write script:", write_result.error_message)
    
    agent_bay.delete(session)
```

### Multi-file Projects

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams

agent_bay = AgentBay(api_key="your-api-key")

session_params = CreateSessionParams(image_id="code_latest")
result = agent_bay.create(session_params)

if result.success:
    session = result.session
    
    session.file_system.create_directory("/workspace/myproject")
    
    main_py = """
from utils import greet

if __name__ == "__main__":
    print(greet("AgentBay"))
"""
    
    utils_py = """
def greet(name):
    return f"Hello, {name}!"
"""
    
    session.file_system.write_file("/workspace/myproject/main.py", main_py)
    session.file_system.write_file("/workspace/myproject/utils.py", utils_py)
    
    result = session.command.execute_command("cd /workspace/myproject && python3 main.py")
    if result.success:
        print("Project output:", result.output)
        # Project output: Hello, AgentBay!
    else:
        print("Execution failed:", result.error_message)
    
    agent_bay.delete(session)
```

<a id="best-practices"></a>
## üí° Best Practices

### 1. Use Timeout for Long-Running Code

The default timeout for `run_code()` is 60 seconds. **Note: Due to gateway limitations, each request cannot exceed 60 seconds.**

```python
# Default timeout is 60 seconds
result = session.code.run_code(code, "python")

# You can specify a custom timeout (max 60 seconds)
result = session.code.run_code(code, "python", timeout_s=60)
```

### 2. Use Standard Library Only

CodeSpace comes with Python and Node.js standard libraries pre-installed. For best performance and reliability, use only built-in modules:

**Python**: `os`, `sys`, `json`, `math`, `datetime`, `re`, etc.  
**JavaScript**: `fs`, `path`, `os`, `crypto`, etc.

## üìö Related Documentation

- [File Operations](../common-features/basics/file-operations.md) - File handling and management
- [Session Management](../common-features/basics/session-management.md) - Session lifecycle and configuration
- [Command Execution](../common-features/basics/command-execution.md) - Shell command execution

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../README.md)

Happy coding with AgentBay CodeSpace! üöÄ




# Common Features

Common features are core capabilities available across all AgentBay environments (Browser Use, Computer Use, Mobile Use, and CodeSpace).

## Basics

Essential features for working with AgentBay SDK:

- [Session Management](basics/session-management.md) - Create and manage cloud sessions
- [Command Execution](basics/command-execution.md) - Execute shell commands
- [File Operations](basics/file-operations.md) - Upload, download, and manipulate files
- [Data Persistence](basics/data-persistence.md) - Persistent data storage across sessions

## Configuration

SDK configuration and settings:

- [SDK Configuration](configuration/sdk-configuration.md) - API keys, gateway regions, endpoints, and timeouts
- [Logging](configuration/logging.md) - Configure log levels, output, and sensitive data protection

## Advanced

Advanced capabilities for complex use cases:

- [Custom Images](advanced/custom-images.md) - Create tailored environments with specific configurations
- [Session Link Access](advanced/session-link-access.md) - Session connectivity and URL generation
- [VPC Sessions](advanced/vpc-sessions.md) - Isolated network environments
- [Agent Modules](advanced/agent-modules.md) - AI-powered task execution
- [OSS Integration](advanced/oss-integration.md) - Object Storage Service integration

## Use Cases

Practical examples and implementation patterns:

- [Use Cases](use-cases/README.md) - Real-world scenarios and code examples for common tasks

## Environment-Specific Guides

- [Browser Use](../browser-use/README.md) - Web automation
- [Computer Use](../computer-use/README.md) - Desktop automation
- [Mobile Use](../mobile-use/README.md) - Mobile device automation
- [CodeSpace](../codespace/README.md) - Development environment

## Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Main Documentation](../../README.md)




# Advanced Features

Advanced capabilities for complex use cases.

## Documentation

- [Custom Images](custom-images.md) - Create tailored environments with specific configurations
- [Session Link Access](session-link-access.md) - Session connectivity and URL generation
- [VPC Sessions](vpc-sessions.md) - Isolated network environments
- [Agent Modules](agent-modules.md) - AI-powered task execution
- [OSS Integration](oss-integration.md) - Object Storage Service integration

## Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Main Documentation](../../../README.md)




# Agent Modules

Agent modules are specialized AI task execution units running in AgentBay windows environment to execute tasks described in natural language.

> **üí° Async API Support**: This guide uses synchronous API. For async patterns, see:

## ü§ñ Agent Module Overview

Agent modules are specialized AI task execution units
runnning in Agentbay windows environment to execute tasks decribed in natural language. 
The task to be executed can be as simple as "Create a word document, input some words and save the document.", in which only one application is involved, or as complex as "Find out the current weather in New York City by Google/Baidu, and write the weather report to a word document, send the word document to a specific email address", in which multiple applications are involved.

The agent is capable of understanding user instructions, planning task execution steps, operating various applications, and managing files and folders on the computer.

## System Image Support

Agent Module functionality is currently only available on specific system images:

| System Image | Agent Module Support | Available APIs |
|-------------|---------------------|----------------|
| `windows_latest` | ‚úÖ Supported | `execute_task`, `get_task_status`, `terminate_task` |
| `linux_latest` | ‚ùå Not Supported | - |
| `browser_latest` | ‚ùå Not Supported | - |
| `code_latest` | ‚ùå Not Supported | - |
| `mobile_latest` | ‚ùå Not Supported | - |

**Important:** When using Agent Module features, you must create sessions with `image_id="windows_latest"` to ensure the required MCP tools are available.

## Creating Agent Sessions

```python
from agentbay import AgentBay, CreateSessionParams

agent_bay = AgentBay()

# Create a session for Agent module usage
agent_params = CreateSessionParams(
    image_id="windows_latest",
    labels={"project": "ai-agent"}
)

result = agent_bay.create(agent_params)
if result.success:
    agent_session = result.session
    print(f"Session created with ID: {agent_session.session_id}")
else:
    print(f"Session creation failed: {result.error_message}")
```

## Agent Capabilities
- Office Automation: Word/Excel/PowerPoint automation
- File Operations:Create/Delete/Move/Copy files and folders
- Infomation Processing: 
    - Gather information from webpages
    - Extract information from a web page
    - Fill forms in a web page
- Text Edition: Using notepad to edit(Read/Write/Edit) text file

### Task Execution
```python
# Execute a task using natural language
task_description = "Calculate the square root of 144"
execution_result = agent_session.agent.execute_task(task_description, max_try_times=5)

if execution_result.success:
    print("Task completed successfully!")
    print(f"Task ID: {execution_result.task_id}")
    print(f"Task status: {execution_result.task_status}")
else:
    print(f"Task failed: {execution_result.error_message}")
```

## üìö Related Resources

- [Session Management Guide](../basics/session-management.md)
- [Data Persistence Guide](../basics/data-persistence.md)
- [VPC Sessions Guide](vpc-sessions.md)

## üÜò Getting Help

If you encounter issues with Agent modules:

1. Check the [Documentation](../../README.md) for detailed information
2. Search [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues) for similar problems
3. Contact support with detailed error information and reproduction steps
4. Please refer to the [Agent Task Excution Example](../../../../python/docs/examples/_async/common-features/advanced/agent_module/main.py) to see how to use the Agent.
5. Please refer to the [Agent API Definition](../../../../python/docs/api/async/async-agent.md) for more details.




# Custom Images

Custom images allow you to create tailored environments with specific operating systems, pre-installed software, and configurations that match your business requirements.

## Overview

### What are Custom Images?

Custom images are user-defined environment templates that extend or customize AgentBay's system images or existing custom images. They are ideal for scenarios where:

1. **Production Deployments**: Lock environment versions for production stability to avoid breaking changes from automatic updates
2. **Specialized Software**: Pre-install specific tools, libraries, or applications not included in system images
3. **Team Standardization**: Create standardized environments to ensure all team members use identical development setups
4. **Compliance Requirements**: Configure custom system settings with specific security configurations or compliance-approved software versions
5. **Performance Optimization**: Pre-installing dependencies reduces session startup time

### System Images vs Custom Images

AgentBay provides official **system images** for different use cases:

| Image Type | Use Case | Example |
|------------|----------|---------|
| `linux_latest` | Computer Use | General computing, server tasks |
| `windows_latest` | Computer Use | Windows applications, .NET development |
| `browser_latest` | Browser Use | Web automation, scraping |
| `code_latest` | CodeSpace | Development environments |
| `mobile_latest` | Mobile Use | Android automation |

**Key differences:**

- **System Images**: Maintained by AgentBay, automatically updated to latest versions
- **Custom Images**: Created and maintained by you, version-controlled and stable

### Image ID

The **Image ID** is a unique identifier for each image (both system and custom images). It serves as:

- A credential for SDK and MCP (Model Context Protocol) API calls
- A reference to specify which environment to use when creating sessions

**Example usage:**
```python
from agentbay import AgentBay
from agentbay import CreateSessionParams

agent_bay = AgentBay()

# Use custom image by Image ID
params = CreateSessionParams(image_id="your_custom_image_id")
session = agent_bay.create(params).session

# Your automation tasks here...

agent_bay.delete(session)
```

## Creating Custom Images

There are two primary methods to create custom images:

### 1. AgentBay Console (UI-Based)

The [AgentBay Console](https://agentbay.console.aliyun.com/) provides a user-friendly interface for creating and managing custom images through visual workflows.

**Key features:**
- Interactive image builder with step-by-step guidance
- Visual selection of base images and configurations
- Real-time preview of image specifications
- Easy management of existing custom images

**Supported image types:**
- Computer Use images (Windows/Linux)
- Mobile Use images (Android)

**Note:** Browser Use images are currently not supported for customization.

**To get started:**
Visit the [AgentBay Console](https://agentbay.console.aliyun.com/) and navigate to the Custom Images section to explore the UI-based creation workflow.

### 2. AgentBay CLI (Command-Line)

The AgentBay CLI provides a programmatic approach to create custom images using Dockerfile-based definitions.

**Key features:**
- Dockerfile-based image definitions
- Command-line automation for CI/CD integration
- Version control for image configurations
- Scriptable and repeatable image builds

**Supported image types:**
- CodeSpace images

**Note:** Computer Use and Mobile Use images should use the AgentBay Console for customization.

**To get started:**
Visit the [AgentBay CLI GitHub repository](https://github.com/aliyun/agentbay-cli) for detailed installation instructions.

**Basic workflow:**
```bash
# 1. Log in to AgentBay
agentbay login

# 2. List available user images
agentbay image list

# 3. Create a custom image
agentbay image create myapp --dockerfile ./Dockerfile --imageId code_latest

# 4. Activate the image
agentbay image activate imgc-xxxxx...xxx

# 5. Deactivate when done
agentbay image deactivate imgc-xxxxx...xxx
```

## Production Environment Best Practices

### Version Stability

**‚ö†Ô∏è Important for Production:**

The `xxxx_latest` system images are automatically updated to newer versions, which may introduce:
- API incompatibilities with older SDK versions
- Unexpected behavior changes
- Breaking changes in pre-installed software

**Recommendation:**
- **Always use custom images with fixed versions in production environments**
- Pin specific versions of dependencies in your custom image definitions
- Test custom images thoroughly before deploying to production
- Maintain separate custom images for development, staging, and production

### Example Production Setup

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams

agent_bay = AgentBay()

# Development: Use latest for new features
dev_params = CreateSessionParams(image_id="browser_latest")

# Production: Use version-locked custom image
prod_params = CreateSessionParams(image_id="my_browser_prod_v1.2.0")

# Create production session with stable environment
session = agent_bay.create(prod_params).session
```

## Availability

**Important Notice**: The Custom Images feature is an exclusive premium feature for paid subscription users (Pro/Ultra). For more details about pricing and subscription plans, please visit the [AgentBay Billing Instructions](https://help.aliyun.com/zh/agentbay/product-overview/agentbay-billing-instructions).

## Next Steps

- Explore the [AgentBay Console](https://agentbay.console.aliyun.com/) to create your first custom image
- Check out the [AgentBay CLI](https://github.com/aliyun/agentbay-cli) for automated image creation
- Review [Session Management](../basics/session-management.md) to learn how to use custom images in your workflows
- See [SDK Configuration](../configuration/sdk-configuration.md) for environment-specific settings





# OSS Integration

Object Storage Service (OSS) integration enables file upload and download operations between AgentBay sessions and Alibaba Cloud OSS buckets.

## Overview

The OSS module provides:
- **Authenticated Operations**: Upload/download files using OSS STS temporary credentials
- **Anonymous Operations**: Upload/download files using presigned URLs
- **Session-scoped**: All OSS operations are executed within a cloud session environment
- **Security-first**: Only STS temporary credentials are supported for authenticated operations

## Prerequisites

Before using OSS operations, you need:
1. An active AgentBay session (preferably `code_latest` image)
2. Alibaba Cloud OSS temporary credentials from STS (Access Key ID, Secret, and Security Token)
   - See [Alibaba Cloud STS documentation](https://help.aliyun.com/zh/oss/developer-reference/use-temporary-access-credentials-provided-by-sts-to-access-oss) for obtaining temporary credentials
   - **Security Note**: For security reasons, only STS temporary credentials are supported. Permanent credentials are not allowed.
3. An OSS bucket (for authenticated operations)

## Basic Workflow

### 1. Initialize OSS Environment

Before performing any OSS operations, you must initialize the OSS environment with your STS temporary credentials:

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams

agent_bay = AgentBay(api_key="your-agentbay-api-key")

params = CreateSessionParams(image_id="code_latest")
result = agent_bay.create(params)
session = result.session

init_result = session.oss.env_init(
    access_key_id="your-oss-access-key-id",
    access_key_secret="your-oss-access-key-secret",
    securityToken="your-security-token",  # Required when using temporary credentials (STS)
    endpoint="https://oss-cn-hangzhou.aliyuncs.com",  # Optional: defaults to OSS endpoint
    region="cn-hangzhou"  # Optional: defaults to OSS region
)

if init_result.success:
    print(f"OSS environment initialized successfully")
    print(f"Request ID: {init_result.request_id}")
else:
    print(f"Failed to initialize OSS: {init_result.error_message}")
```

**Parameters:**
- `access_key_id` (required): Your Alibaba Cloud Access Key ID from STS
- `access_key_secret` (required): Your Alibaba Cloud Access Key Secret from STS
- `securityToken` (required): Security token from [STS temporary credentials](https://help.aliyun.com/zh/oss/developer-reference/use-temporary-access-credentials-provided-by-sts-to-access-oss). **For security reasons, only temporary credentials are supported.**
- `endpoint` (optional): OSS service endpoint (e.g., `https://oss-cn-hangzhou.aliyuncs.com`)
- `region` (optional): OSS region (e.g., `cn-hangzhou`)

**Returns:**
- `OSSClientResult` with fields:
  - `success` (bool): Whether initialization succeeded
  - `request_id` (str): Unique request identifier
  - `client_config` (dict): OSS client configuration details
  - `error_message` (str): Error description if failed

### 2. Upload Files to OSS

After initialization, upload files from the session to your OSS bucket:

```python
upload_result = session.oss.upload(
    bucket="my-bucket-name",
    object="data/report.pdf",  # Object key in OSS
    path="/home/wuying/report.pdf"  # Local path in session
)

if upload_result.success:
    print(f"File uploaded successfully: {upload_result.content}")
    print(f"Request ID: {upload_result.request_id}")
else:
    print(f"Upload failed: {upload_result.error_message}")
```

**Parameters:**
- `bucket` (str): OSS bucket name
- `object` (str): Object key/path in OSS (e.g., `folder/file.txt`)
- `path` (str): Local file path in the session to upload

**Returns:**
- `OSSUploadResult` with fields:
  - `success` (bool): Whether upload succeeded
  - `request_id` (str): Unique request identifier
  - `content` (str): Upload result message
  - `error_message` (str): Error description if failed

### 3. Download Files from OSS

Download files from your OSS bucket to the session:

```python
download_result = session.oss.download(
    bucket="my-bucket-name",
    object="data/report.pdf",  # Object key in OSS
    path="/home/wuying/downloaded_report.pdf"  # Local path to save
)

if download_result.success:
    print(f"File downloaded successfully: {download_result.content}")
    print(f"Request ID: {download_result.request_id}")
    
    file_info = session.file_system.get_file_info("/home/wuying/downloaded_report.pdf")
    if file_info.success:
        print(f"Downloaded file size: {file_info.size} bytes")
else:
    print(f"Download failed: {download_result.error_message}")
```

**Parameters:**
- `bucket` (str): OSS bucket name
- `object` (str): Object key/path in OSS
- `path` (str): Local file path in the session to save the downloaded file

**Returns:**
- `OSSDownloadResult` with fields:
  - `success` (bool): Whether download succeeded
  - `request_id` (str): Unique request identifier
  - `content` (str): Download result message
  - `error_message` (str): Error description if failed

## Anonymous Operations

Anonymous operations allow uploading/downloading files using presigned URLs or public URLs without requiring OSS credential initialization (`env_init()`).

### Upload Anonymously

Upload a file to a presigned upload URL:

```python
upload_result = session.oss.upload_anonymous(
    url="https://example.com/upload/file.txt",  # Presigned upload URL
    path="/home/wuying/file.txt"  # Local file to upload
)

if upload_result.success:
    print(f"Anonymous upload successful: {upload_result.content}")
else:
    print(f"Anonymous upload failed: {upload_result.error_message}")
```

**Parameters:**
- `url` (str): HTTP/HTTPS URL to upload the file to (e.g., presigned OSS upload URL)
- `path` (str): Local file path in the session

**Returns:** Same as `upload()` - `OSSUploadResult`

### Download Anonymously

Download a file from a public URL or presigned download URL:

```python
download_result = session.oss.download_anonymous(
    url="https://example.com/files/document.pdf",  # Public or presigned URL
    path="/home/wuying/document.pdf"  # Local path to save
)

if download_result.success:
    print(f"Anonymous download successful: {download_result.content}")
else:
    print(f"Anonymous download failed: {download_result.error_message}")
```

**Parameters:**
- `url` (str): HTTP/HTTPS URL to download the file from
- `path` (str): Local file path in the session to save the downloaded file

**Returns:** Same as `download()` - `OSSDownloadResult`

## Complete Example

Here's a complete workflow demonstrating OSS integration:

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams

agent_bay = AgentBay(api_key="your-agentbay-api-key")

params = CreateSessionParams(image_id="code_latest")
result = agent_bay.create(params)

if not result.success:
    print(f"Failed to create session: {result.error_message}")
    exit(1)

session = result.session

try:
    # Initialize OSS with STS temporary credentials
    init_result = session.oss.env_init(
        access_key_id="your-sts-access-key-id",
        access_key_secret="your-sts-access-key-secret",
        securityToken="your-sts-security-token",  # Required for STS credentials
        endpoint="https://oss-cn-hangzhou.aliyuncs.com",
        region="cn-hangzhou"
    )
    
    if not init_result.success:
        print(f"Failed to initialize OSS: {init_result.error_message}")
        exit(1)
    
    print("‚úì OSS environment initialized")
    
    session.file_system.write_file(
        path="/home/wuying/data.txt",
        content="Hello from AgentBay!",
        mode="overwrite"
    )
    print("‚úì Created local file")
    
    upload_result = session.oss.upload(
        bucket="my-bucket",
        object="agentbay/data.txt",
        path="/home/wuying/data.txt"
    )
    
    if upload_result.success:
        print(f"‚úì File uploaded to OSS: {upload_result.content}")
    else:
        print(f"‚úó Upload failed: {upload_result.error_message}")
    
    download_result = session.oss.download(
        bucket="my-bucket",
        object="agentbay/data.txt",
        path="/home/wuying/downloaded_data.txt"
    )
    
    if download_result.success:
        print(f"‚úì File downloaded from OSS: {download_result.content}")
        
        content_result = session.file_system.read_file("/home/wuying/downloaded_data.txt")
        if content_result.success:
            print(f"‚úì File content: {content_result.content}")
    else:
        print(f"‚úó Download failed: {download_result.error_message}")

finally:
    agent_bay.delete(session)
    print("‚úì Session deleted")
```

## Error Handling

All OSS operations return result objects with `success` field and `error_message` field. Always check these fields:

```python
result = session.oss.upload(bucket="my-bucket", object="file.txt", path="/tmp/file.txt")

if result.success:
    print(f"Success: {result.content}")
else:
    print(f"Error: {result.error_message}")
```

**Common Error Scenarios:**

1. **Authentication Errors**
   ```
   Error: The OSS Access Key Id you provided does not exist in our records.
   ```
   - Solution: Verify your Access Key ID and Secret

2. **Upload/Download Failures**
   - Check error_message field in result object for specific error details
   - Verify bucket name, object key, and file paths
   - Ensure OSS credentials have appropriate permissions
   - For authenticated operations, verify `env_init()` was called successfully

## Use Cases

### 1. Data Backup

Upload session data to OSS for long-term storage:

```python
import time

session.file_system.create_directory("/home/wuying/backup")

json_data = '{"key": "value"}'
session.file_system.write_file("/home/wuying/backup/data.json", json_data, "overwrite")

timestamp = int(time.time())
upload_result = session.oss.upload(
    bucket="backup-bucket",
    object=f"backups/{timestamp}/data.json",
    path="/home/wuying/backup/data.json"
)
```

### 2. Data Processing

Download data from OSS, process it, and upload results:

```python
session.oss.download(
    bucket="input-bucket",
    object="raw/data.csv",
    path="/home/wuying/input.csv"
)

result = session.code.run_code(
    language="python",
    code="""
with open('/home/wuying/input.csv', 'r') as f:
    lines = f.readlines()
    
processed_lines = [line.upper() for line in lines]

with open('/home/wuying/output.csv', 'w') as f:
    f.writelines(processed_lines)
"""
)

session.oss.upload(
    bucket="output-bucket",
    object="processed/data.csv",
    path="/home/wuying/output.csv"
)
```

### 3. File Distribution

Use anonymous download to access public files:

```python
download_result = session.oss.download_anonymous(
    url="https://public-bucket.oss-cn-hangzhou.aliyuncs.com/dataset.zip",
    path="/home/wuying/dataset.zip"
)

session.command.execute_command("unzip /home/wuying/dataset.zip -d /home/wuying/data/")
```

## Best Practices

1. **Use STS Temporary Credentials**: Always use STS temporary credentials with limited validity and minimal permissions
2. **Always Initialize First**: Call `env_init()` with all three required credentials (`access_key_id`, `access_key_secret`, `securityToken`) before any other OSS operations
3. **Handle Errors**: Check `success` field and handle `error_message` appropriately
4. **Use Absolute Paths**: Use absolute paths for file operations (e.g., `/home/wuying/file.txt`)
5. **Secure Credentials**: Never hardcode credentials; use environment variables or secure vaults
6. **Token Refresh**: Monitor STS token expiration and refresh tokens before they expire
7. **Clean Up**: Delete sessions after completing OSS operations to avoid charges
8. **Request IDs**: Log `request_id` from results for debugging and support

## Security Considerations

- **Mandatory Temporary Credentials**: For security reasons, AgentBay OSS integration **only supports STS temporary credentials**. You must provide a valid `securityToken` when calling `env_init()`.
- **Credential Management**: Store STS credentials securely (environment variables, secrets manager). Never hardcode credentials in source code.
- **Credential Lifecycle**: STS tokens have limited validity. Ensure you obtain fresh temporary credentials before they expire. Refer to [Alibaba Cloud STS documentation](https://help.aliyun.com/zh/oss/developer-reference/use-temporary-access-credentials-provided-by-sts-to-access-oss) for details.
- **Minimal Permissions**: Configure STS policies to grant only the minimum required OSS permissions (e.g., read-only for downloads, write-only for uploads)
- **Bucket Permissions**: Use bucket policies to restrict access to specific resources
- **Network Security**: Always use HTTPS endpoints for OSS operations
- **Session Cleanup**: Delete sessions after completing operations to prevent credential leakage

## Limitations

1. **Session Requirement**: OSS operations require an active session
2. **STS Credentials Only**: Only STS temporary credentials are supported; permanent credentials are not allowed
3. **Initialization Required**: `env_init()` must be called with `securityToken` before upload/download operations
4. **Path Restrictions**: File paths must be within the session filesystem
5. **Image Compatibility**: Works best with `code_latest` image

## Related Documentation

- [Session Management](../basics/session-management.md)
- [File Operations](../basics/file-operations.md)
- [Data Persistence](../basics/data-persistence.md)
- [Command Execution](../basics/command-execution.md)




# Session Link Access

This guide shows you how to use `get_link()` to connect to your AgentBay cloud sessions.

> **‚ö†Ô∏è Important Notice**: The Session Link feature is an exclusive premium feature for paid subscription users (Pro/Ultra). For more details about pricing and subscription plans, please visit the [AgentBay Billing Instructions](https://help.aliyun.com/zh/agentbay/product-overview/agentbay-billing-instructions).

## üìã Table of Contents

- [üéØ What is a Session Link?](#what-is-a-session-link)
- [üöÄ Use Cases and Examples](#use-cases-and-examples)
- [üìñ API Reference](#api-reference)
- [üìñ Advanced Topics](#advanced-topics)

---

<a id="what-is-a-session-link"></a>
## üéØ What is a Session Link?

### Simple Explanation

When you create an AgentBay session, you're starting a virtual computer in the cloud. If you need to **directly connect** external tools (like Playwright, your local browser, or WebSocket clients) to services running inside the session, you'll need a **Session Link**.

Think of it this way:
- üè† **Session** = A house in the cloud running services
- üîó **Session Link** = The direct address to access those services
- üíª **Your local tools** = Need this address to connect to services inside

Session Link provides the **direct network access URL** to services in your cloud session.

### What Can `get_link()` Do?

The `get_link()` method returns a URL that enables **direct connections** to services in your session:

1. ‚úÖ **Control a cloud browser** with Playwright/Puppeteer (browser automation via CDP)
2. ‚úÖ **Access web applications** running in your session (like dev servers on custom ports)
3. ‚úÖ **Connect to custom services** in the cloud (like WebSocket servers, databases)

---

<a id="use-cases-and-examples"></a>
## üöÄ Use Cases and Examples

For practical examples and step-by-step guides, see the **[Session Link Use Cases](../use-cases/session-link-use-cases.md)** document, which covers:

1. **Browser Automation** - Control cloud browsers with Playwright/Puppeteer
2. **Access Web Applications** - Access web services running in cloud sessions
3. **Connect to Custom Services** - Connect to custom ports and services

The use cases document includes:
- Complete working code examples
- Quick selection guide to choose the right approach
- Common mistakes and how to avoid them

---

<a id="api-reference"></a>
## üìñ API Reference

### Method Signature

```python
def get_link(
    protocol_type: Optional[str] = None,
    port: Optional[int] = None
) -> Result[str]
```

### Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `protocol_type` | `str` | No | Protocol type: `"https"` or `"wss"`. If not specified, defaults to WSS for browser CDP endpoint |
| `port` | `int` | No | Port number in range [30100, 30199] for custom services |

### Return Value

Returns a `Result[str]` object containing:
- `success`: Boolean indicating if the operation succeeded
- `data`: The session link URL (wss:// or https://)
- `error_message`: Error description if `success` is False
- `request_id`: Unique identifier for the API request


### Usage Patterns

The `get_link()` method supports three main usage patterns:

| Pattern | Call Syntax | Returns | Use Case |
|---------|-------------|---------|----------|
| Browser CDP | `get_link()` | `wss://...` | Browser automation with Playwright/Puppeteer |
| HTTPS Service | `get_link("https", port)` | `https://...` | Access web applications via HTTPS |
| WebSocket Service | `get_link(port=port)` | `wss://...` | Connect to custom WebSocket services |

> **üìò For detailed examples and complete code**, see the [Session Link Use Cases Guide](../use-cases/session-link-use-cases.md).

### Quick Reference

**Browser Automation**:
```python
# MUST initialize browser first!
await session.browser.initialize_async(BrowserOption())
await asyncio.sleep(10)  # Wait for browser startup

link = session.get_link()  # Returns CDP endpoint
```

**Web Application Access**:
```python
link = session.get_link(protocol_type="https", port=30150)
# Returns: https://gateway.../request_ai/.../path/
```

**Custom Service Connection**:
```python
link = session.get_link(port=30180)
# Returns: wss://gateway.../websocket_ai/...
```

### Parameter Constraints

- **Port Range**: Must be in [30100, 30199]
- **Protocol Types**: Only `"https"` and `"wss"` are supported
- **Browser CDP**: Requires Browser Use image (e.g., `browser_latest`)
- **Protocol + Port**: If `protocol_type` is specified, `port` must also be provided

### Common Errors

| Error | Cause | Solution |
|-------|-------|----------|
| "port is not valid" | `protocol_type` specified without `port` | Always provide `port` when using `protocol_type` |
| "Port must be in [30100, 30199]" | Port outside valid range | Use a port in the valid range |
| "http not supported" | Using `protocol_type="http"` | Use `"https"` instead |
| "only BrowserUse image support cdp" | Non-browser image with no parameters | Use `browser_latest` image or specify port |

---

<a id="advanced-topics"></a>
## üìñ Advanced Topics

### Asynchronous Operations

For async applications, use `get_link_async()`:

```python
import asyncio
import os
from agentbay import AgentBay

async def get_multiple_links():
    api_key = os.environ.get("AGENTBAY_API_KEY")
    agent_bay = AgentBay(api_key=api_key)
    session = agent_bay.create().session
    
    try:
        # Get multiple links in parallel
        tasks = [
            session.get_link_async(),  # Default WebSocket
            session.get_link_async(protocol_type="https", port=30199),  # HTTPS
            session.get_link_async(port=30150)  # WebSocket with port
        ]
        
        results = await asyncio.gather(*tasks, return_exceptions=True)
        
        for i, result in enumerate(results):
            if isinstance(result, Exception):
                print(f"Link {i+1} failed: {result}")
            elif result.success:
                print(f"Link {i+1}: {result.data}")
    finally:
        agent_bay.delete(session)

if __name__ == "__main__":
    asyncio.run(get_multiple_links())
```

### Best Practices

#### 1. Parameter Validation

```python
def safe_get_link(session, protocol_type=None, port=None):
    """Safely get session link with validation"""
    if protocol_type is not None and port is None:
        raise ValueError("protocol_type requires port parameter")
    
    if port is not None and not (30100 <= port <= 30199):
        raise ValueError(f"Port {port} outside valid range [30100, 30199]")
    
    return session.get_link(protocol_type=protocol_type, port=port)
```

#### 2. Error Handling

```python
def robust_get_link(session, protocol_type=None, port=None):
    """Get link with comprehensive error handling"""
    try:
        result = session.get_link(protocol_type=protocol_type, port=port)
        
        if result.success:
            print(f"Link: {result.data}")
            print(f"Request ID: {result.request_id}")
            return result.data
        else:
            print(f"API error: {result.error_message}")
            return None
    
    except Exception as e:
        print(f"Exception: {e}")
        return None
```

#### 3. Link Caching

```python
class SessionLinkManager:
    """Cache links to avoid repeated API calls"""
    
    def __init__(self, session):
        self.session = session
        self.cache = {}
    
    def get_cached_link(self, protocol_type=None, port=None):
        key = f"{protocol_type}:{port}"
        
        if key not in self.cache:
            result = self.session.get_link(
                protocol_type=protocol_type, 
                port=port
            )
            if result.success:
                self.cache[key] = result.data
        
        return self.cache.get(key)
```

### Troubleshooting

#### Link Not Accessible

If the link is generated successfully but you cannot access it:

```python
# Check 1: Verify the service is running on the specified port
result = session.command.execute_command("netstat -tuln | grep 30150")
if result.success:
    print(f"Port status: {result.output}")
else:
    print("Service may not be running on the specified port")

# Check 2: Verify the session is still active
info_result = session.info()
if info_result.success:
    print(f"Session ID: {info_result.data.session_id}")
    print(f"Session status: Active")
else:
    print(f"Session may have been terminated: {info_result.error_message}")
```

#### Connection Timeouts

If connections to the link time out:

```python
# Check 1: Verify network connectivity to the gateway domain
# Extract domain from link for testing
link_result = session.get_link(protocol_type="https", port=30150)
if link_result.success:
    import urllib.parse
    parsed = urllib.parse.urlparse(link_result.data)
    print(f"Gateway domain: {parsed.netloc}")
    # Test connectivity: ping or curl the domain

# Check 2: Confirm the session hasn't been terminated
info_result = session.info()
if not info_result.success:
    print("Session may have been terminated")
    print("Create a new session and try again")

# Check 3: Review VPC and subnet configurations (for VPC sessions)
# If using VPC mode, ensure:
# - Security groups allow traffic on the specified port
# - Network ACLs permit inbound/outbound connections
# - Route tables are correctly configured
```

### Debugging Helper Function

When troubleshooting link issues, use this comprehensive debugging function.

**Note**: This is a helper function example, not a built-in SDK method. Copy the complete function code below into your script to use it.

#### How to Use

1. **Copy the entire function definition** from the code block below
2. **Paste it into your Python script** before calling it
3. **Call the function** with your session object: `debug_session_links(session)`

#### Function Code

```python
def debug_session_links(session):
    """Debug session link generation and accessibility."""
    print(f"Debugging session: {session.session_id}")
    print("=" * 70)
    
    # Step 1: Get session info
    print("\n[Step 1] Checking session status...")
    info_result = session.info()
    if info_result.success:
        info = info_result.data
        print(f"‚úÖ Session ID: {info.session_id}")
        print(f"‚úÖ Resource Type: {info.resource_type}")
        print(f"‚úÖ Resource ID: {info.resource_id}")
        print(f"‚úÖ Resource URL: {info.resource_url[:100]}...")
    else:
        print(f"‚ùå Failed to get session info: {info_result.error_message}")
        return
    
    # Step 2: Test different link types
    print("\n[Step 2] Testing different link configurations...")
    test_cases = [
        ("Default WebSocket", None, None),
        ("WebSocket with port 30150", None, 30150),
        ("HTTPS on port 30199", "https", 30199),
        ("WebSocket Secure on port 30199", "wss", 30199),
    ]
    
    for name, protocol, port in test_cases:
        try:
            if protocol is None and port is None:
                result = session.get_link()
            elif protocol is None:
                result = session.get_link(port=port)
            else:
                result = session.get_link(protocol_type=protocol, port=port)
            
            if result.success:
                url_preview = result.data[:80] + "..." if len(result.data) > 80 else result.data
                print(f"‚úÖ {name}: {url_preview}")
            else:
                print(f"‚ùå {name}: {result.error_message}")
        
        except Exception as e:
            print(f"‚ùå {name}: Exception - {e}")
    
    print("\n" + "=" * 70)
    print("Debugging complete!")
```

#### Usage Example

After copying the function definition above, you can use it like this:

```python
import os
from agentbay import AgentBay

# (Paste the debug_session_links function definition here)

# Now use the function
api_key = os.environ.get("AGENTBAY_API_KEY")
agent_bay = AgentBay(api_key=api_key)
session = agent_bay.create().session

# Call the debugging function
debug_session_links(session)

# Cleanup
agent_bay.delete(session)
```

**Expected Output**:
```
Debugging session: session-abc123
======================================================================

[Step 1] Checking session status...
‚úÖ Session ID: session-abc123
‚úÖ Resource Type: container
‚úÖ Resource ID: res-abc123
‚úÖ Resource URL: wss://gateway.../websocket_ai/...

[Step 2] Testing different link configurations...
‚ùå Default WebSocket: no port specified, cdp default, but only BrowserUse image support cdp
‚úÖ WebSocket with port 30150: wss://gateway.../websocket_ai/...
‚úÖ HTTPS on port 30199: https://gateway.../request_ai/.../path/
‚úÖ WebSocket Secure on port 30199: wss://gateway.../websocket_ai/...

======================================================================
Debugging complete!
```

### Link Format Details

#### WebSocket Secure (wss://)

```
wss://gw-cn-hangzhou-ai-linux.wuyinggw.com:8008/websocket_ai/{token}
 ‚îÇ    ‚îÇ                                        ‚îÇ     ‚îÇ              ‚îÇ
 ‚îÇ    ‚îî‚îÄ Gateway domain                        ‚îÇ     ‚îî‚îÄ Endpoint    ‚îî‚îÄ Auth token
 ‚îÇ                                             ‚îî‚îÄ Gateway port
 ‚îî‚îÄ Protocol (WebSocket Secure)
```

**Use**: Chrome DevTools Protocol (CDP) endpoint for browser automation, or WebSocket services with custom ports

#### HTTPS

```
https://gw-cn-hangzhou-ai-linux.wuyinggw.com:8008/request_ai/{token}/path/
 ‚îÇ     ‚îÇ                                        ‚îÇ     ‚îÇ           ‚îÇ        ‚îÇ
 ‚îÇ     ‚îî‚îÄ Gateway domain                        ‚îÇ     ‚îî‚îÄ Endpoint ‚îî‚îÄ Token ‚îî‚îÄ Path suffix
 ‚îÇ                                             ‚îî‚îÄ Gateway port
 ‚îî‚îÄ Protocol (HTTPS)
```

**Use**: HTTP/HTTPS access to web applications and services running in the session

---

## Related Resources

- [Session Management Guide](../basics/session-management.md)
- [Advanced Features Guide](README.md)

## Getting Help

If you encounter issues:

1. Check this documentation for solutions
2. Search [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
3. Contact support with detailed error information

Remember: Session Link Access is your gateway to cloud session connectivity! üîó




# VPC Sessions

VPC (Virtual Private Cloud) sessions provide a secure communication mechanism where the SDK directly connects to cloud environments within the same VPC after session creation.

> **üí° Async API Support**: This guide uses synchronous API. For async patterns, see:

## Overview

VPC (Virtual Private Cloud) sessions provide a secure communication mechanism where the SDK directly connects to cloud environments within the same VPC after session creation. This ensures that all business data bypasses AgentBay's control plane services, delivering enhanced security for customers.

### Key Security Benefits

- **Direct Communication**: After session creation, the SDK establishes direct connections to cloud environments within the same VPC
- **Data Privacy**: All business data and operations are transmitted directly between SDK and cloud environment, without passing through AgentBay control services
- **Network Isolation**: Complete network isolation through VPC boundaries ensures secure execution of sensitive workloads
- **Compliance Ready**: Meets enterprise security requirements for data sovereignty and regulatory compliance

## How It Works

1. **Session Creation**: When creating a session with `is_vpc=True`, AgentBay provisions a cloud environment within your VPC
2. **Direct Communication**: All operations (file operations, command execution, browser automation, etc.) communicate directly with the VPC environment
3. **Control Plane Bypass**: Business data never traverses AgentBay's control plane, ensuring maximum data privacy

## Creating VPC Sessions

```python
from agentbay import AgentBay, CreateSessionParams

agent_bay = AgentBay(api_key=api_key)

# Create VPC session
vpc_params = CreateSessionParams(is_vpc=True)

result = agent_bay.create(vpc_params)
if result.success:
    vpc_session = result.session
    print(f"VPC session created successfully: {vpc_session.session_id}")
else:
    print(f"VPC session creation failed: {result.error_message}")
agent_bay.delete(vpc_session)
```

## VPC Session Configuration

VPC sessions are created by setting the `is_vpc` parameter to `True` in the `CreateSessionParams`. The actual VPC configuration (VPC ID, subnet ID, security groups, etc.) is managed by the AgentBay platform and does not need to be specified in the SDK.

## Related Resources

- [Session Management Guide](../basics/session-management.md)
- [SDK Configuration](../configuration/sdk-configuration.md)

## üìö Related Guides

- [Session Management](../basics/session-management.md) - Session lifecycle and configuration
- [Session Link Access](session-link-access.md) - Session connectivity and URL generation
- [Data Persistence](../basics/data-persistence.md) - Persistent data storage

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../../README.md)




# Basic Features

Fundamental capabilities for working with AgentBay SDK.

## Documentation

- [Session Management](session-management.md) - Create and manage cloud sessions
- [Command Execution](command-execution.md) - Execute shell commands and scripts
- [File Operations](file-operations.md) - Upload, download, and manipulate files
- [Data Persistence](data-persistence.md) - Persistent data storage across sessions

## Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Main Documentation](../../../README.md)




# Command Execution Guide

This guide covers command execution capabilities in AgentBay SDK. The command module allows you to execute shell commands and system operations in cloud sessions.

> **üí° Async API Support**: This guide uses synchronous API by default. For async/await syntax and concurrent execution patterns, see:
> - [Async-Specific Patterns](#async-specific-patterns) - Concurrent command execution

## üìã Table of Contents

- [Overview](#overview)
- [Basic Command Execution](#basic-command-execution)
- [Command with Timeout](#command-with-timeout)
- [Working with Command Output](#working-with-command-output)
- [Advanced Patterns](#advanced-patterns)
- [Async-Specific Patterns](#async-specific-patterns)
- [Choosing Sync vs Async](#choosing-sync-vs-async)

<a id="overview"></a>
## üéØ Overview

The `session.command` module provides programmatic access to execute shell commands in cloud sessions. This is useful for:

- **System Operations** - Run shell commands, manage processes
- **Environment Setup** - Install packages, configure environments
- **File Processing** - Use command-line tools for file operations
- **Automation** - Automate complex workflows

### Command Module Features

- ‚úÖ Synchronous and asynchronous command execution
- ‚úÖ Timeout support
- ‚úÖ Output and error capture
- ‚úÖ Exit code handling

<a id="basic-command-execution"></a>
## üíª Basic Command Execution

### Simple Commands

```python
from agentbay import AgentBay

agent_bay = AgentBay(api_key="your-api-key")
result = agent_bay.create()

if result.success:
    session = result.session

    cmd_result = session.command.execute_command("ls -la /tmp")
    if cmd_result.success:
        print("Output:", cmd_result.output)
    else:
        print("Command failed:", cmd_result.error_message)

    agent_bay.delete(session)
else:
    print("Failed to create session:", result.error_message)

# Output example:
# Output: total 140
# drwxrwxrwt 21 root   root    4096 Oct  2 14:57 .
# drwxr-xr-x 19 root   root    4096 Oct  2 14:20 ..
# -rw-------  1 root   root       0 Oct  2 14:20 example.lock
# srwxr-xr-x  1 root   root       0 Oct  2 14:20 service.sock
# ...
```

### Sequential Command Execution

Execute multiple commands one after another:

```python
from agentbay import AgentBay

agent_bay = AgentBay()
session = agent_bay.create().session

commands = [
    "echo 'Hello from cloud'",
    "pwd",
    "whoami",
    "uname -a"
]

for cmd in commands:
    result = session.command.execute_command(cmd)
    if result.success:
        print(f"{cmd} -> {result.output.strip()}")
    else:
        print(f"{cmd} failed: {result.error_message}")

agent_bay.delete(session)

# Output example:
# echo 'Hello from cloud' -> Hello from cloud
# pwd -> /home/user
# whoami -> user
# uname -a -> Linux hostname 5.15.0-125-generic #135-Ubuntu SMP x86_64 x86_64 x86_64 GNU/Linux
```

<a id="command-with-timeout"></a>
## ‚è±Ô∏è Command with Timeout

### Setting Execution Timeout

Control how long a command can run before timing out:

```python
from agentbay import AgentBay

agent_bay = AgentBay()
session = agent_bay.create().session

# Command completes within timeout
result = session.command.execute_command("sleep 3", timeout_ms=5000)
if result.success:
    print("Command completed within timeout")
else:
    print("Command timed out or failed:", result.error_message)

# Command exceeds timeout
result = session.command.execute_command("sleep 10", timeout_ms=2000)
if result.success:
    print("Command completed")
else:
    print("Command timed out:", result.error_message)

agent_bay.delete(session)

# Output example:
# Command completed within timeout
# Command timed out: Error in response: Execution failed. Error code:-1 Error message: [timeout]
```

<a id="working-with-command-output"></a>
## üì§ Working with Command Output

### Capturing and Processing Output

```python
from agentbay import AgentBay

agent_bay = AgentBay()
session = agent_bay.create().session

result = session.command.execute_command("df -h")
if result.success:
    print("Full output:")
    print(result.output)

    lines = result.output.strip().split('\n')
    print(f"Found {len(lines)} filesystems")
else:
    print("Command failed:", result.error_message)

agent_bay.delete(session)

# Output example:
# Full output:
# Filesystem      Size  Used Avail Use% Mounted on
# tmpfs           756M  2.9M  753M   1% /run
# /dev/vda3        99G   23G   72G  24% /
# tmpfs           3.7G     0  3.7G   0% /dev/shm
# tmpfs           5.0M     0  5.0M   0% /run/lock
# ...
# Found 8 filesystems
```

<a id="advanced-patterns"></a>
## üîß Advanced Patterns

### Command Chaining

Execute multiple commands in a single shell invocation:

```python
from agentbay import AgentBay

agent_bay = AgentBay()
session = agent_bay.create().session

result = session.command.execute_command(
    "mkdir -p /tmp/test && cd /tmp/test && echo 'Hello' > file.txt && cat file.txt"
)
if result.success:
    print("Output:", result.output)

agent_bay.delete(session)

# Output example:
# Output: Hello
```

<a id="async-specific-patterns"></a>
## ‚ö° Async-Specific Patterns

The async API provides powerful patterns for concurrent command execution, delivering **4-6x performance improvements** when running multiple independent commands.

> **Note**: These patterns require the asynchronous API (`from agentbay import AsyncAgentBay`)

### Concurrent Command Execution

Execute multiple commands simultaneously for dramatic performance gains:

```python
import asyncio
from agentbay import AsyncAgentBay

async def main():
    agent_bay = AsyncAgentBay()
    session = (await agent_bay.create()).session

    # Execute multiple commands concurrently
    commands = [
        "sleep 2 && echo 'Command 1 done'",
        "sleep 2 && echo 'Command 2 done'",
        "sleep 2 && echo 'Command 3 done'"
    ]

    # This takes ~2 seconds instead of ~6 seconds (3x faster!)
    results = await asyncio.gather(*[
        session.command.execute_command(cmd)
        for cmd in commands
    ])

    for i, result in enumerate(results, 1):
        if result.success:
            print(f"Command {i}: {result.output.strip()}")

    await agent_bay.delete(session)

asyncio.run(main())

# Output (all commands complete in ~2 seconds):
# Command 1: Command 1 done
# Command 2: Command 2 done
# Command 3: Command 3 done
```

**Performance**: Sequential execution would take 6 seconds, concurrent execution takes only 2 seconds.

### Async Timeout with asyncio.wait_for

Use asyncio's native timeout functionality for fine-grained control:

```python
import asyncio
from agentbay import AsyncAgentBay

async def main():
    agent_bay = AsyncAgentBay()
    session = (await agent_bay.create()).session

    try:
        # Use asyncio.wait_for for timeout
        result = await asyncio.wait_for(
            session.command.execute_command("sleep 10"),
            timeout=5.0  # 5 seconds
        )
        print("Command completed:", result.output)
    except asyncio.TimeoutError:
        print("Command timed out after 5 seconds")
    finally:
        await agent_bay.delete(session)

asyncio.run(main())
```

### Parallel Processing Pattern

Process multiple files or tasks concurrently:

```python
import asyncio
from agentbay import AsyncAgentBay

async def process_file(session, filename):
    """Process a single file"""
    cmd = f"wc -l /tmp/{filename}"
    result = await session.command.execute_command(cmd)
    if result.success:
        return f"{filename}: {result.output.strip()}"
    return f"{filename}: failed"

async def main():
    agent_bay = AsyncAgentBay()
    session = (await agent_bay.create()).session

    # Create test files
    for i in range(5):
        await session.command.execute_command(
            f"seq 1 {(i+1)*10} > /tmp/file{i}.txt"
        )

    # Process all files concurrently
    files = [f"file{i}.txt" for i in range(5)]
    results = await asyncio.gather(*[
        process_file(session, f)
        for f in files
    ])

    for result in results:
        print(result)

    await agent_bay.delete(session)

asyncio.run(main())

# Output:
# file0.txt: 10 /tmp/file0.txt
# file1.txt: 20 /tmp/file1.txt
# file2.txt: 30 /tmp/file2.txt
# file3.txt: 40 /tmp/file3.txt
# file4.txt: 50 /tmp/file4.txt
```

<a id="choosing-sync-vs-async"></a>
## üîÑ Choosing Sync vs Async

### Use Sync API When:

- ‚úÖ Writing simple scripts or CLI tools
- ‚úÖ Commands must execute sequentially
- ‚úÖ Learning AgentBay for the first time
- ‚úÖ Code simplicity is more important than performance

### Use Async API When:

- ‚úÖ Building web applications (FastAPI, Django async)
- ‚úÖ Need to execute multiple commands concurrently
- ‚úÖ Working with I/O-bound operations
- ‚úÖ Performance and scalability are critical

### Performance Comparison

**Sequential Execution (5 commands, 1 second each)**:
- Sync API: ~5 seconds
- Async API (sequential with for loop): ~5 seconds
- Async API (concurrent with asyncio.gather): ~1 second ‚ö° **5x faster!**

**Recommendation**: For command execution, async API shines when you need to run multiple commands concurrently. For single commands or sequential workflows, both APIs perform similarly - use sync for simplicity.

## üìö Related Documentation

- [Code Execution (CodeSpace)](../../codespace/code-execution.md) - Python, JavaScript code execution
- [File Operations](file-operations.md) - File handling and management
- [Session Management](session-management.md) - Session lifecycle

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../README.md)

Happy automating with AgentBay! üöÄ




# Complete Data Persistence Guide

This guide covers AgentBay SDK's data persistence features, including context concepts, context management, and data synchronization strategies for maintaining state across sessions. Both synchronous and asynchronous APIs are supported.


## üìã Table of Contents

- [Core Concepts](#core-concepts)
- [Context Management](#context-management)
- [Data Synchronization Strategies](#data-synchronization-strategies)

<a id="core-concepts"></a>
## üéØ Core Concepts

### Understanding Context - A Simple Example

Before diving into complex features, let's understand what Context and ContextId represent with the simplest possible example:

```python
from agentbay import AgentBay

# Initialize client
agent_bay = AgentBay()

# Create a context - think of it as a "named storage box"
context_result = agent_bay.context.get("my-storage-box", create=True)
context = context_result.context

print(f"Context Name: {context.name}")        # Output: "my-storage-box"
print(f"Context ID: {context.id}")           # Output: "SdkCtx-123abc456def" (unique identifier)
```

**What is a Context?**
- A **Context** is like a persistent storage container that survives beyond individual sessions
- The **Context Name** (like "my-storage-box") is what you use to reference it
- The **Context ID** (like "SdkCtx-123abc456def") is the system's unique identifier for that storage container

**What is a ContextId?**
- Every Context has a unique ID assigned by the system
- You use this ID to mount the context's data into sessions
- Think of it as the "address" where your persistent data lives

### The Persistence Problem

In AgentBay, **sessions are temporary** - when a session ends, all its data disappears:

```python
# Without Context: Data is LOST when session ends
session1 = agent_bay.create().session
session1.file_system.write_file("/tmp/data.txt", "Important data")
agent_bay.delete(session1)
# Session ends -> data.txt is GONE forever!

# With Context: Data is SAVED permanently
from agentbay import ContextSync, CreateSessionParams

context = agent_bay.context.get("my-storage", create=True).context
context_sync = ContextSync.new(context.id, "/tmp/persistent")  # Mount context at /tmp/persistent

session2 = agent_bay.create(CreateSessionParams(context_syncs=[context_sync])).session
session2.file_system.write_file("/tmp/persistent/data.txt", "Important data")
agent_bay.delete(session2, sync_context=True)  # Ensure data syncs before continuing

# Later, in a new session, you can access the same data:
session3 = agent_bay.create(CreateSessionParams(context_syncs=[context_sync])).session
content = session3.file_system.read_file("/tmp/persistent/data.txt")
print(content.content)  # Output: "Important data"
agent_bay.delete(session3)
```

### Implementation Principle - How Context Works Under the Hood

Understanding the technical implementation helps you better use the Context system:

**Context Storage Architecture:**
```
ContextId (e.g., "SdkCtx-123abc456def")
    ‚Üì
OSS Directory (/contexts/SdkCtx-123abc456def/)
    ‚îú‚îÄ‚îÄ file1.txt
    ‚îú‚îÄ‚îÄ data/
    ‚îÇ   ‚îî‚îÄ‚îÄ config.json
    ‚îî‚îÄ‚îÄ logs/
        ‚îî‚îÄ‚îÄ app.log
```

**What happens when you create a Context:**
1. **OSS Directory Creation**: AgentBay creates a dedicated OSS (Object Storage Service) directory
2. **Unique Mapping**: Each ContextId maps to a specific OSS path like `/contexts/{SdkCtx-123abc456def}/`
3. **Persistent Storage**: All files in this OSS directory persist beyond session lifecycles

**What happens when you bind Context to Session:**
```python
# This line tells the session: "Download OSS files to /tmp/persistent"
context_sync = ContextSync.new(context.id, "/tmp/persistent")
session = agent_bay.create(CreateSessionParams(context_syncs=[context_sync])).session
```

**Session Lifecycle with Context:**
1. **Session Start**: Downloads all files from OSS directory to `/tmp/persistent`
2. **Session Runtime**: You work with files in `/tmp/persistent` as normal local files  
3. **Session End**: Uploads all changes from `/tmp/persistent` back to OSS directory

**Visual Flow:**
```
OSS Storage          Session Environment          OSS Storage After Upload
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ             ‚îÇ ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ /tmp/persistent/ ‚îÇ ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ                  ‚îÇ
‚îÇ SdkCtx-123/ ‚îÇ      ‚îÇ   ‚îú‚îÄ‚îÄ file1      ‚îÇ      ‚îÇ SdkCtx-123/      ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ file1   ‚îÇ      ‚îÇ   ‚îú‚îÄ‚îÄ data       ‚îÇ      ‚îÇ ‚îú‚îÄ‚îÄ file1        ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ data    ‚îÇ      ‚îÇ   ‚îî‚îÄ‚îÄ output.log ‚îÇ      ‚îÇ ‚îú‚îÄ‚îÄ data         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ   (new file)     ‚îÇ      ‚îÇ ‚îî‚îÄ‚îÄ output.log   ‚îÇ
   Download          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
   on Start                                       Upload on End
```

**What this diagram shows:**
- **Left**: Initial OSS directory with existing files (`file1`, `data`) 
- **Middle**: Session workspace with downloaded files + new files you create (`output.log`)
- **Right**: Final OSS directory with ALL changes uploaded back (modified/original files + new files)

**Key Benefits of this Architecture:**
- **Scalability**: OSS handles large files and directories efficiently
- **Reliability**: Cloud storage ensures data durability and availability
- **Performance**: Local file operations during session for fast I/O
- **Sharing**: Multiple sessions can mount the same OSS directory

### Context vs Session

| Feature | Session | Context |
|---------|---------|---------|
| Lifecycle | Temporary, destroyed when session ends | Persistent, destroyed only when manually deleted |
| Data Storage | Not saved | Permanently saved in OSS |
| Sharing | Independent, not shared | Can be shared across multiple sessions |
| Use Case | Execute temporary tasks | Store project data, configurations, etc. |
| Implementation | Local filesystem only | OSS directory + local filesystem sync |

<a id="context-management"></a>
## üì¶ Context Management

### Creating and Getting Contexts

```python
from agentbay import AgentBay

# Initialize AgentBay client (requires valid API key)
#api_key from your os env
agent_bay = AgentBay(api_key=api_key)

 # Initialize AgentBay client (requires valid API key)
agent_bay = AgentBay()

# Get or create context
context_result = agent_bay.context.get("my-project", create=True)
if context_result.success:
    context = context_result.context
    print(f"Context ID: {context.id}")
    print(f"Context Name: {context.name}")
    print(f"Created At: {context.created_at}")
else:
    print(f"Context operation failed: {context_result.success}")

# Get existing context only
existing_context_result = agent_bay.context.get("my-project", create=False)
if not existing_context_result.success:
    print("Context does not exist")
else:
context = existing_context_result.context
print(f"Found context: {context.name}")
```


### Listing and Deleting Contexts

```python
# List all contexts (default pagination)
contexts_result = agent_bay.context.list()
if contexts_result.success:
    print(f"Total contexts: {contexts_result.total_count}")
    for context in contexts_result.contexts:
        print(f"Context: {context.name} (ID: {context.id})")
else:
    print(f"Failed to list contexts: {contexts_result.error_message}")

# List contexts with pagination
from agentbay import ContextListParams

params = ContextListParams(max_results=20)
result = agent_bay.context.list(params)

if result.success:
    print(f"Total contexts: {result.total_count}")
    print(f"Current page: {len(result.contexts)} contexts")
    
    # Iterate through all pages
    while result.next_token:
        params = ContextListParams(max_results=20, next_token=result.next_token)
        result = agent_bay.context.list(params)
        if result.success:
            print(f"Next page: {len(result.contexts)} contexts")
        else:
            print(f"Failed to fetch next page: {result.error_message}")
            break

# Get context by name
context_result = agent_bay.context.get(name="my-project", create=False)
if context_result.success:
    print(f"Found context: {context_result.context.name}")
else:
    print(f"Context not found: {context_result.error_message}")

# Get context by ID
context_result = agent_bay.context.get(context_id="SdkCtx-123abc456def")
if context_result.success:
    print(f"Found context: {context_result.context.name} (ID: {context_result.context.id})")
else:
    print(f"Context not found: {context_result.error_message}")

# Update context name
context_result = agent_bay.context.get(name="old-name", create=False)
if context_result.success:
    context = context_result.context
    context.name = "new-name"
    update_result = agent_bay.context.update(context)
    if update_result.success:
        print("Context name updated successfully")
    else:
        print(f"Failed to update context: {update_result.error_message}")

# Delete context
context_to_delete = agent_bay.context.get("my-project", create=False).context
if context_to_delete:
    delete_result = agent_bay.context.delete(context_to_delete)
    if delete_result.success:
        print("Context deleted successfully")
    else:
        print(f"Failed to delete context: {delete_result.error_message}")
```

## üìÅ Context File Operations

Context file operations provide direct access to files stored in a context's OSS directory. These operations are useful when you need to manage files without creating a session, or when you want to integrate context data with external systems.

### When to Use Direct File Operations

**Use direct file operations when:**
- You need to access files without creating a session
- You want to integrate with external systems (webhooks, APIs)
- You need to download/upload large files directly
- You want to inspect context contents programmatically

**Use session sync when:**
- You need to work with files during session execution
- You want automatic bidirectional synchronization
- You're running code that expects local filesystem access

### Getting Presigned URLs

Presigned URLs allow you to upload or download files directly to/from the context's OSS storage without going through a session.

```python
from agentbay import AgentBay
import requests

agent_bay = AgentBay()

# Create or get context
context = agent_bay.context.get("my-project", create=True).context

# Get upload URL
upload_result = agent_bay.context.get_file_upload_url(
    context_id=context.id,
    file_path="/data/report.txt"
)

if upload_result.success:
    print(f"Upload URL: {upload_result.url}")
    print(f"URL expires at: {upload_result.expire_time}")
    
    # Upload file using requests library
    file_content = "This is my report content"
    response = requests.put(upload_result.url, data=file_content.encode('utf-8'))
    
    if response.status_code == 200:
        print("File uploaded successfully")
    else:
        print(f"Upload failed: {response.status_code}")
else:
    print(f"Failed to get upload URL: {upload_result.error_message}")

# Get download URL
download_result = agent_bay.context.get_file_download_url(
    context_id=context.id,
    file_path="/data/report.txt"
)

if download_result.success:
    print(f"Download URL: {download_result.url}")
    
    # Download file using requests library
    response = requests.get(download_result.url)
    
    if response.status_code == 200:
        content = response.text
        print(f"File content: {content}")
    else:
        print(f"Download failed: {response.status_code}")
else:
    print(f"Failed to get download URL: {download_result.error_message}")
```

### Listing Files

List files in a context with pagination support:

```python
from agentbay import AgentBay

agent_bay = AgentBay()

# Get context
context = agent_bay.context.get("my-project", create=True).context

# List files in root directory
list_result = agent_bay.context.list_files(
    context_id=context.id,
    parent_folder_path="/",
    page_number=1,
    page_size=50
)

if list_result.success:
    print(f"Found {len(list_result.entries)} files")
    
    for entry in list_result.entries:
        print(f"File: {entry.file_name}")
        print(f"  Path: {entry.file_path}")
        print(f"  Size: {entry.size} bytes")
        print(f"  Type: {entry.file_type}")
        print(f"  Created: {entry.gmt_create}")
        print(f"  Modified: {entry.gmt_modified}")
else:
    print(f"Failed to list files: {list_result.error_message}")

# List files with pagination
page_number = 1
page_size = 10

while True:
    list_result = agent_bay.context.list_files(
        context_id=context.id,
        parent_folder_path="/data",
        page_number=page_number,
        page_size=page_size
    )
    
    if not list_result.success:
        print(f"Failed to list files: {list_result.error_message}")
        break
    
    if not list_result.entries:
        print("No more files")
        break
    
    print(f"Page {page_number}: {len(list_result.entries)} files")
    for entry in list_result.entries:
        print(f"  - {entry.file_name} ({entry.size} bytes)")
    
    page_number += 1
```

### Deleting Files

Delete specific files from a context:

```python
from agentbay import AgentBay

agent_bay = AgentBay()

# Get context
context = agent_bay.context.get("my-project", create=True).context

# Delete a single file
delete_result = agent_bay.context.delete_file(
    context_id=context.id,
    file_path="/data/old_report.txt"
)

if delete_result.success:
    print("File deleted successfully")
else:
    print(f"Failed to delete file: {delete_result.error_message}")

# Delete multiple files
files_to_delete = ["/logs/debug.log", "/temp/cache.dat", "/old/data.json"]

for file_path in files_to_delete:
    delete_result = agent_bay.context.delete_file(
        context_id=context.id,
        file_path=file_path
    )
    
    if delete_result.success:
        print(f"Deleted: {file_path}")
    else:
        print(f"Failed to delete {file_path}: {delete_result.error_message}")
```

## üóëÔ∏è Context Data Clearing

Context clearing removes all files from a context while keeping the context itself intact. This is useful when you want to reset a context's data without deleting and recreating it.

### Clear vs Delete

| Operation | Context | Context ID | Files | Use Case |
|-----------|---------|------------|-------|----------|
| **Clear** | Preserved | Unchanged | Deleted | Reset data, keep configuration |
| **Delete** | Removed | Lost | Deleted | Complete cleanup, remove context |

**When to use Clear:**
- Reset a context for a new workflow run
- Clean up temporary data periodically
- Prepare a context for fresh data
- Keep context references in your code valid

**When to use Delete:**
- Remove a context completely
- Clean up unused contexts
- Context is no longer needed

### Synchronous Clear (Recommended)

The simplest way to clear a context is using the synchronous `clear()` method, which waits for the operation to complete:

```python
from agentbay import AgentBay
from agentbay import ClearanceTimeoutError

agent_bay = AgentBay()

# Get context
context = agent_bay.context.get("my-project", create=True).context

# Clear context data (synchronous - waits for completion)
try:
    clear_result = agent_bay.context.clear(
        context_id=context.id,
        timeout=60,  # Wait up to 60 seconds
        poll_interval=2.0  # Check status every 2 seconds
    )
    
    if clear_result.success:
        print(f"Context cleared successfully")
        print(f"Final status: {clear_result.status}")  # Should be "available"
    else:
        print(f"Failed to clear context: {clear_result.error_message}")
        
except ClearanceTimeoutError as e:
    print(f"Clearing timed out: {e}")
    # Context may still be clearing in the background
    # You can check status later using get_clear_status()
```

### Asynchronous Clear with Manual Polling

For more control over the clearing process, you can use the asynchronous approach:

```python
from agentbay import AgentBay
import time

agent_bay = AgentBay()

# Get context
context = agent_bay.context.get("my-project", create=True).context

# Start clearing asynchronously
clear_result = agent_bay.context.clear_async(context_id=context.id)

if clear_result.success:
    print(f"Clearing started, status: {clear_result.status}")  # Should be "clearing"
    
    # Poll for completion
    max_attempts = 30
    attempt = 0
    
    while attempt < max_attempts:
        time.sleep(2)  # Wait 2 seconds between checks
        attempt += 1
        
        # Check status
        status_result = agent_bay.context.get_clear_status(context_id=context.id)
        
        if not status_result.success:
            print(f"Failed to get status: {status_result.error_message}")
            break
        
        print(f"Status: {status_result.status} (attempt {attempt}/{max_attempts})")
        
        if status_result.status == "available":
            print("Context cleared successfully!")
            break
        elif status_result.status == "clearing":
            print("Still clearing...")
        else:
            print(f"Unexpected status: {status_result.status}")
    else:
        print("Clearing timed out")
else:
    print(f"Failed to start clearing: {clear_result.error_message}")
```

### Clear Status States

The clearing operation follows this state machine:

| Status | Description | Next State |
|--------|-------------|------------|
| `clearing` | Data is being deleted | `available` |
| `available` | Clearing completed successfully | - (final state) |

### Error Handling

```python
from agentbay import AgentBay
from agentbay import ClearanceTimeoutError, AgentBayError

agent_bay = AgentBay()

context = agent_bay.context.get("my-project", create=True).context

try:
    # Try to clear with a short timeout
    clear_result = agent_bay.context.clear(
        context_id=context.id,
        timeout=30,
        poll_interval=1.0
    )
    
    if clear_result.success:
        print("Context cleared successfully")
    else:
        print(f"Clear failed: {clear_result.error_message}")
        
except ClearanceTimeoutError as e:
    print(f"Timeout: {e}")
    print("The context may still be clearing in the background")
    
    # Check current status
    status_result = agent_bay.context.get_clear_status(context.id)
    if status_result.success:
        print(f"Current status: {status_result.status}")
        
except AgentBayError as e:
    print(f"API error: {e}")
```

### Context with Sessions

```python
from agentbay import ContextSync, CreateSessionParams

# Create context
context_result = agent_bay.context.get("my-project", create=True)
if context_result.success:
    context = context_result.context
    print(f"Context ID: {context.id}")

    # Create context sync configuration
    context_sync = ContextSync.new(
        context_id=context.id,
        path="/tmp/data"  # Mount path in session
    )

    # === Session 1: Write data ===
    print("\n--- Session 1: Writing data ---")
    params = CreateSessionParams(context_syncs=[context_sync])
    session1_result = agent_bay.create(params)
    
    if session1_result.success:
        session1 = session1_result.session
        print(f"Session 1 ID: {session1.session_id}")

        # Write files to persistent storage
        session1.file_system.write_file("/tmp/data/config.json", '{"version": "1.0", "app": "demo"}')
        session1.file_system.write_file("/tmp/data/user_data.txt", "User preferences and settings")
        print("Data written to /tmp/data/")
        
        # End session1 and ensure data is fully synced to Context
        agent_bay.delete(session1, sync_context=True)
        print("Session 1 ended - data fully synced to Context")
    else:
        print(f"Failed to create session 1: {session1_result.error_message}")

    # === Session 2: Read persisted data ===
    print("\n--- Session 2: Reading persisted data ---")
    session2_result = agent_bay.create(params)
    
    if session2_result.success:
        session2 = session2_result.session
        print(f"Session 2 ID: {session2.session_id}")

        # Read data that was persisted from session1
        config_result = session2.file_system.read_file("/tmp/data/config.json")
        user_data_result = session2.file_system.read_file("/tmp/data/user_data.txt")
        
        if config_result.success and user_data_result.success:
            print(f"‚úÖ Config data: {config_result.content}")
            print(f"‚úÖ User data: {user_data_result.content}")
            print("üéâ Data successfully persisted across sessions!")
        else:
            print("‚ùå Failed to read persisted data")
            
        # Clean up
        agent_bay.delete(session2)
        print("Session 2 ended")
    else:
        print(f"Failed to create session 2: {session2_result.error_message}")
else:
    print(f"Failed to create context: {context_result.error_message}")
```

### üîç Important: Session Deletion and Sync Timing

**The `sync_context` parameter is crucial for reliable persistence:**

```python
# ‚ùå Potential race condition - may return before upload completes
agent_bay.delete(session)

# ‚úÖ Guaranteed sync - waits for upload completion  
agent_bay.delete(session, sync_context=True)
```

**Why this matters:**

1. **Asynchronous Upload**: When a session ends, file upload to OSS happens asynchronously
2. **Race Condition**: `delete()` returns immediately, but upload may still be in progress
3. **Data Consistency**: Creating a new session too quickly might not see the latest data

**When to use `sync_context=True`:**
- When you need to immediately create another session to access the data
- In automated workflows where timing is critical
- When data consistency across sessions is essential

**Technical Details:**
- `sync_context=True` triggers upload and polls until completion
- The SDK waits for OSS upload confirmation before returning
- This ensures the next session will definitely see all persisted data

**‚ö†Ô∏è Auto-upload Timeout Limitation:**

Even with auto-upload enabled in the sync policy, the backend enforces a **1-minute timeout** for automatic uploads when a session ends. This can cause issues with:

- **Large file counts**: Many files may not finish uploading within 60 seconds
- **Large file sizes**: Big files may not complete upload before timeout
- **Network latency**: Slow connections may trigger timeout

**Best Practice to Prevent Data Loss:**

```python
# Option 1: Manual sync before session ends (recommended for large datasets)
session.file_system.write_file("/tmp/data/large_file.bin", large_content)
sync_result = session.context.sync()  # Explicit sync with no timeout limit
if sync_result.success:
    print("‚úÖ Data fully synced")
agent_bay.delete(session)  # Safe to delete now

# Option 2: Use sync_context=True on delete (recommended for standard workflows)
session.file_system.write_file("/tmp/data/config.json", config_data)
agent_bay.delete(session, sync_context=True)  # Ensures complete sync before deletion
```

**Key Differences:**

| Method | Timeout Limit | Best For | Notes |
|--------|---------------|----------|-------|
| Auto-upload only | 1 minute | Small files, quick operations | May fail silently for large datasets |
| `session.context.sync()` | None | Large files, many files | Full control, no timeout constraint |
| `delete(sync_context=True)` | None | Standard workflows | Convenient, guaranteed completion |

**Recommendation:** Always use either manual `sync()` or `delete(sync_context=True)` to ensure data persistence, especially when working with large files or multiple files.

<a id="data-synchronization-strategies"></a>

## üîÑ Data Synchronization Strategies

### Sync Policies

#### Default Synchronization Behavior

By default, AgentBay uses **automatic synchronization** when you don't specify a custom policy:

```python
from agentbay import ContextSync, CreateSessionParams

# Default behavior - no policy specified
context_sync = ContextSync.new(context.id, "/tmp/data")  # Uses default policy
session = agent_bay.create(CreateSessionParams(context_syncs=[context_sync])).session

# Equivalent to:
default_policy = SyncPolicy.default()
context_sync = ContextSync.new(context.id, "/tmp/data", default_policy)
```

**Default policy characteristics:**
- **Auto-download**: Context data is automatically downloaded when session starts
- **Auto-upload**: Local changes are automatically uploaded when session ends
- **Service-controlled intervals**: The sync timing is managed by the AgentBay service

#### When to Use Custom Sync Policies

You should consider custom sync policies in these scenarios:

1. **Manual control**: When you need precise control over when data is synced (use manual sync policy)
2. **Unidirectional sync**: When you only need upload or download (use upload-only or download-only policies)
3. **Large datasets**: When working with large files that don't need immediate sync
4. **Large file synchronization**: When you need to sync large quantities of files, compression mode can significantly reduce sync time and storage costs (use Archive upload mode)


**Note:** Selective file synchronization based on patterns is currently not supported. Use the default policy to sync all files, or organize files into separate contexts.

#### Available Sync Policy Options

```python
from agentbay import SyncPolicy, UploadPolicy, DownloadPolicy, BWList, WhiteList

# 1. Default policy - syncs all files
default_policy = SyncPolicy(
    upload_policy=UploadPolicy(auto_upload=True),
    download_policy=DownloadPolicy(auto_download=True)
)

# 2. Manual sync - sync only when explicitly requested
manual_policy = SyncPolicy(
    upload_policy=UploadPolicy(auto_upload=False),
    download_policy=DownloadPolicy(auto_download=False)
)

# 3. Upload-only policy (for write-heavy workflows)
upload_only_policy = SyncPolicy(
    upload_policy=UploadPolicy(auto_upload=True),
    download_policy=DownloadPolicy(auto_download=False)
)

# 4. Download-only policy (for read-heavy workflows)
download_only_policy = SyncPolicy(
    upload_policy=UploadPolicy(auto_upload=False),
    download_policy=DownloadPolicy(auto_download=True)
)
```


#### Compression Mode Configuration

AgentBay SDK provides file compression capabilities to optimize storage space and transfer performance during context synchronization. This is particularly beneficial when working with large text files, source code, or other compressible content.

**Upload Mode Options:**

| Mode | Description | Best For | Compression |
|------|-------------|----------|-------------|
| `UploadMode.FILE` | Default mode - files uploaded as-is | Small files | None |
| `UploadMode.ARCHIVE` | Files compressed before upload | Large text files, source code, logs | Yes |

**When to Use Archive Mode:**

1. **Large text-based files**: Source code, configuration files, logs, documentation
2. **Multiple small files**: Many small files benefit from compression and bundling
3. **Bandwidth optimization**: Slow network connections or limited bandwidth
4. **Storage cost reduction**: Minimize OSS storage usage for compressible content

**Basic Usage:**

```python
from agentbay import AgentBay, CreateSessionParams
from agentbay import ContextSync, SyncPolicy, UploadPolicy, UploadMode

# Initialize AgentBay client
agent_bay = AgentBay(api_key="your-api-key")

# Create context
context_result = agent_bay.context.get("my-project", create=True)
context = context_result.context

# Configure sync policy with Archive upload mode
upload_policy = UploadPolicy(upload_mode=UploadMode.ARCHIVE)  # Enable compression
sync_policy = SyncPolicy(upload_policy=upload_policy)

# Create context sync with compression enabled
context_sync = ContextSync(
    context_id=context.id,
    path="/tmp/data",
    policy=sync_policy
)

# Create session with Archive mode
session_params = CreateSessionParams(
    labels={
        "example": "archive-mode-demo",
        "type": "compression-test",
    },
    context_syncs=[context_sync]
)

session_result = agent_bay.create(session_params)
session = session_result.session

# Files written to /tmp/data will be compressed before upload
session.file_system.write_file("/tmp/data/large-file.txt", large_content, mode="overwrite")
session.file_system.write_file("/tmp/data/config.json", config_data, mode="overwrite")

# Perform context sync before getting info (synchronous operation)
sync_result = session.context.sync()
if sync_result.success:
    print("Context sync successful!")
    
    # Get context status information after sync
    info_result = session.context.info()
    if info_result.success:
        print(f"Context status data count: {len(info_result.context_status_data)}")
        for status in info_result.context_status_data:
            print(f"Context ID: {status.context_id}, Path: {status.path}, Status: {status.status}")

    # List files in context sync directory
    list_result = agent_bay.context.list_files(context.id, "/tmp/data", page_number=1, page_size=10)
    if list_result.success:
        print(f"Total files found: {len(list_result.entries)}")
        for entry in list_result.entries:
            print(f"File: {entry.file_name}, Size: {entry.size} bytes, Type: {entry.file_type}")

# Clean up with sync to ensure compressed upload completes
agent_bay.delete(session, sync_context=True)
```

####  Data Lifecycle Management (RecyclePolicy)

`RecyclePolicy` controls how long your context data is retained in the cloud before automatic cleanup. This is useful for managing storage costs and automatically removing temporary data.

**Key Concepts:**
- **Default Behavior**: Data is kept **FOREVER** (permanently) if no RecyclePolicy is specified
- **Automatic Cleanup**: Data is automatically deleted after the specified duration
- **Path-Specific**: Apply different lifecycles to different directories
- **No Wildcards**: Paths must be exact - wildcard patterns are not supported for safety

**Available Lifecycle Options:**

| Lifecycle | Duration | Use Case |
|-----------|----------|----------|
| `LIFECYCLE_1DAY` | 1 day | Temporary cache, test data |
| `LIFECYCLE_3DAYS` | 3 days | Short-term work files |
| `LIFECYCLE_5DAYS` | 5 days | Weekly data |
| `LIFECYCLE_10DAYS` | 10 days | Sprint data |
| `LIFECYCLE_15DAYS` | 15 days | Bi-weekly data |
| `LIFECYCLE_30DAYS` | 30 days | Monthly archives |
| `LIFECYCLE_90DAYS` | 90 days | Quarterly data |
| `LIFECYCLE_180DAYS` | 180 days | Semi-annual data |
| `LIFECYCLE_360DAYS` | 360 days | Annual archives |
| `LIFECYCLE_FOREVER` | Permanent | Important data (default) |

**Basic Usage:**

```python
from agentbay import RecyclePolicy, Lifecycle, SyncPolicy, ContextSync

# Example 1: Keep data for 1 day
recycle_policy = RecyclePolicy(
    lifecycle=Lifecycle.LIFECYCLE_1DAY,
    paths=[""]  # "" means apply to all paths
)

sync_policy = SyncPolicy(recycle_policy=recycle_policy)
context_sync = ContextSync.new(context.id, "/tmp/cache", sync_policy)

# This creates a RecyclePolicy with:
# - lifecycle: Lifecycle_1Day
# - paths: ['']
```

**Path-Specific Cleanup:**

```python
# Example 2: Different lifespans for different directories
recycle_policy = RecyclePolicy(
    lifecycle=Lifecycle.LIFECYCLE_3DAYS,
    paths=["/tmp/cache", "/tmp/logs"]  # Only these paths
)

# Important: Use exact paths, NOT wildcards like "/tmp/*"
sync_policy = SyncPolicy(recycle_policy=recycle_policy)

# This applies the 3-day lifecycle only to /tmp/cache and /tmp/logs
```

**Important Restrictions:**

```python
# ‚ùå WRONG: Wildcard patterns are NOT supported
recycle_policy = RecyclePolicy(
    lifecycle=Lifecycle.LIFECYCLE_1DAY,
    paths=["/tmp/*", "/var/*.log"]  # Will raise ValueError
)
# Raises: ValueError: Wildcard patterns are not supported in recycle policy paths.
#         Got: /tmp/*. Please use exact directory paths instead.

# ‚úÖ CORRECT: Use exact directory paths
recycle_policy = RecyclePolicy(
    lifecycle=Lifecycle.LIFECYCLE_1DAY,
    paths=["/tmp/cache", "/var/logs"]  # Exact paths only
)
# Successfully creates RecyclePolicy with exact paths
```

**When to Use RecyclePolicy:**

1. **Temporary Data**: Set short lifecycles (1-3 days) for cache, temp files, or test data
2. **Project Data**: Use medium lifecycles (30-90 days) for project files
3. **Archives**: Use long lifecycles (180-360 days) for important archives
4. **Permanent Data**: Use `LIFECYCLE_FOREVER` (default) for critical data

**Complete Example:**

```python
from agentbay import AgentBay, CreateSessionParams
from agentbay import (
    ContextSync, SyncPolicy, RecyclePolicy, Lifecycle,
    UploadPolicy, DownloadPolicy, BWList, WhiteList
)

# Create context
context = agent_bay.context.get("my-project", create=True).context

# Create RecyclePolicy with 5 days lifecycle
recycle_policy = RecyclePolicy(
    lifecycle=Lifecycle.LIFECYCLE_5DAYS,  # Note: No LIFECYCLE_7DAYS, use 5 or 10
    paths=[""]  # Apply to all paths
)

# Create comprehensive SyncPolicy
sync_policy = SyncPolicy(
    upload_policy=UploadPolicy.default(),
    download_policy=DownloadPolicy.default(),
    recycle_policy=recycle_policy  # Add lifecycle management
)

# Create session with lifecycle-managed context
context_sync = ContextSync.new(context.id, "/tmp/data", sync_policy)
session = agent_bay.create(CreateSessionParams(context_syncs=[context_sync])).session

# The session is now configured with RecyclePolicy
# Data uploaded to this context will be automatically deleted after 5 days
```

> **Note**: RecyclePolicy applies from the time data is uploaded to the cloud. The timer starts after the session ends and data is synchronized, not when files are created in the session.

#### Selective Directory Sync

Use `bw_list` (blacklist/whitelist) to control which subdirectories within the context mount point are synced:

```python
from agentbay import BWList, WhiteList

# Example: Sync only /src and /config, exclude /src/node_modules
policy = SyncPolicy(
    upload_policy=UploadPolicy(auto_upload=True),
    download_policy=DownloadPolicy(auto_download=True),
    bw_list=BWList(
        white_lists=[
            WhiteList(
                path="/src",  # No wildcards like *.json or /src/*
                exclude_paths=["/node_modules"]  # Exact path, not patterns like *.log
            ),
            WhiteList(path="/config")
        ]
    )
)

# Mount point: use any directory with write permissions
# In linux_latest image, /home/wuying is recommended
# Whitelisted paths are relative to mount point:
# - "/src" ‚Üí /home/wuying/src  
# - "/config" ‚Üí /home/wuying/config
# - "/node_modules" in exclude ‚Üí /home/wuying/src/node_modules
context_sync = ContextSync.new(context.id, "/home/wuying", policy)
```

**Mount Point Selection:**
- Use any directory where you have write permissions
- In `linux_latest` image: `/home/wuying`, `/tmp`, `/var/tmp` are available
- System directories like `/workspace`, `/opt`, `/usr` typically require elevated privileges

**Path Specifications:**
- `path` in WhiteList is **relative to the context mount point**
- `exclude_paths` are **relative to the whitelist path**
- Example: If mounted at `/home/wuying`, then `path="/src"` refers to `/home/wuying/src`
- Wildcard patterns (e.g., `*.json`, `/data/*`) are not supported



### Manual Synchronization

When using manual sync policies, you need to explicitly call `session.context.sync()` to trigger data synchronization:

```python
from agentbay import SyncPolicy, UploadPolicy, DownloadPolicy

agent_bay = AgentBay()
# Create session with manual sync policy
manual_policy = SyncPolicy(
    upload_policy=UploadPolicy(auto_upload=False),
    download_policy=DownloadPolicy(auto_download=False)
)
context = agent_bay.context.get("my-project", create=True).context

context_sync = ContextSync.new(context.id, "/tmp/data", manual_policy)
session_result = agent_bay.create(CreateSessionParams(context_syncs=[context_sync]))

if session_result.success:
    session = session_result.session

    # Write some data
    session.file_system.write_file("/tmp/data/temp.txt", "Temporary data")

    # Manually trigger sync to save data (synchronous call - returns when sync is complete)
    sync_result = session.context.sync()
    if sync_result.success:
        print("Data synchronized successfully")
    else:
        print(f"Sync failed: {sync_result.success}")

    # Data is now persisted even if session ends
else:
    print(f"Failed to create session: {session_result.error_message}")
```


### Bidirectional Sync

By default, `session.context.sync()` triggers file **upload** (mode="upload"). You can explicitly specify the sync direction:

```python
# Default behavior - upload local changes to OSS (mode="upload" is default)
upload_result = session.context.sync()  # Same as sync(mode="upload")
if upload_result.success:
    print("Local changes uploaded to context")
else:
    print(f"Upload failed: {upload_result.error_message}")

# Explicitly download latest data from OSS to session
download_result = session.context.sync(mode="download")
if download_result.success:
    print("Latest data downloaded from context")
else:
    print(f"Download failed: {download_result.error_message}")

# Explicitly upload local changes to OSS
upload_result = session.context.sync(mode="upload")
if upload_result.success:
    print("Local changes uploaded to context")
else:
    print(f"Upload failed: {upload_result.error_message}")
```

<a id="troubleshooting"></a>
## üîß Troubleshooting

### Issue 1: Permission Denied When Creating Files

**Error Message:**
```
Permission denied
Failed to create directory: /workspace, error: Permission denied
```

**Cause:** Mount point directory lacks write permissions for the current user.

**Solution:**
```python
# ‚ùå Wrong: Using directory without write permission
context_sync = ContextSync.new(context.id, "/workspace", policy)
context_sync = ContextSync.new(context.id, "/opt/myapp", policy)

# ‚úÖ Correct: Use directory with write permission
context_sync = ContextSync.new(context.id, "/home/wuying", policy)
context_sync = ContextSync.new(context.id, "/tmp/myapp", policy)
```

**Available directories in `linux_latest` image:** `/home/wuying`, `/tmp`, `/var/tmp`

### Issue 2: Files Not Persisted (WhiteList Path Error)

**Symptom:** Files created in session are not found in the next session, even though sync completed.

**Cause:** WhiteList paths are treated as absolute instead of relative to mount point.

**Example of the error:**
```python
# ‚ùå Wrong: This looks for /home/wuying/home/wuying/src (doesn't exist)
policy = SyncPolicy(
    bw_list=BWList(
        white_lists=[WhiteList(path="/home/wuying/src")]
    )
)
context_sync = ContextSync.new(context.id, "/home/wuying", policy)
```

**Solution:**
```python
# ‚úÖ Correct: Paths are relative to mount point
policy = SyncPolicy(
    bw_list=BWList(
        white_lists=[WhiteList(path="/src")]  # ‚Üí /home/wuying/src
    )
)
context_sync = ContextSync.new(context.id, "/home/wuying", policy)
```

### Issue 3: Wildcard Patterns Not Supported

**Symptom:** Files are not persisted even though sync completes successfully. No error is reported.

**Cause:** Using wildcard patterns (`*`, `**`) in WhiteList paths or exclude_paths.

**Example of the error:**
```python
# ‚ùå Wrong: Wildcards silently fail
policy = SyncPolicy(
    bw_list=BWList(
        white_lists=[
            WhiteList(path="*.json"),           # No files synced
            WhiteList(path="/data/*"),          # No files synced
            WhiteList(path="/logs/**/*.txt"),   # No files synced
            WhiteList(path="/src", exclude_paths=["*.log"])  # No files synced
        ]
    )
)
```

**Solution:**
```python
# ‚úÖ Correct: Use exact directory paths
policy = SyncPolicy(
    bw_list=BWList(
        white_lists=[
            WhiteList(path="/data"),  # Syncs all files in /data
            WhiteList(path="/src", exclude_paths=["/temp"])  # Syncs /src except /src/temp
        ]
    )
)
```

### Issue 4: Data Loss After Session Deletion

**Symptom:** Files written in session are not available in the next session.

**Cause:** Session deleted before sync upload completes.

**Solution:**
```python
# ‚ùå Wrong: May delete before upload finishes
session.file_system.write_file("/home/wuying/data.txt", "content")
agent_bay.delete(session)

# ‚úÖ Correct: Wait for sync to complete
session.file_system.write_file("/home/wuying/data.txt", "content")
agent_bay.delete(session, sync_context=True)
```

### Issue 5: Understanding RecyclePolicy and Data Retention

**Question:** When will my context data be deleted?

**Answer:**
- **Default**: Data is kept **FOREVER** unless you specify a RecyclePolicy
- **With RecyclePolicy**: Data is automatically deleted after the specified period from upload time
- **Timer Start**: The lifecycle countdown begins when data is uploaded to the cloud (after session ends and sync completes)

**Example:**
```python
# Scenario: Set 1 day lifecycle
recycle_policy = RecyclePolicy(
    lifecycle=Lifecycle.LIFECYCLE_1DAY,
    paths=[""]
)

# Timeline:
# Day 0, 10:00 AM - Session created, files written
# Day 0, 11:00 AM - Session deleted, sync uploads data to cloud
# Day 0, 11:00 AM - Lifecycle timer starts
# Day 1, 11:00 AM - Data automatically deleted (24 hours after upload)
```

**Common Mistakes:**

```python
# ‚ùå Wrong: Using wildcards in paths
recycle_policy = RecyclePolicy(
    lifecycle=Lifecycle.LIFECYCLE_1DAY,
    paths=["/tmp/*", "/var/*.log"]  # ValueError: wildcards not supported
)

# ‚úÖ Correct: Use exact directory paths
recycle_policy = RecyclePolicy(
    lifecycle=Lifecycle.LIFECYCLE_1DAY,
    paths=["/tmp/cache", "/var/logs"]  # Exact paths only
)
```

**Choosing the Right Lifecycle:**
- **Temporary cache/test data**: `LIFECYCLE_1DAY` or `LIFECYCLE_3DAYS`
- **Development work**: `LIFECYCLE_5DAYS` to `LIFECYCLE_15DAYS`
- **Project archives**: `LIFECYCLE_30DAYS` to `LIFECYCLE_90DAYS`
- **Important data**: `LIFECYCLE_FOREVER` (default)

### Verifying Sync Status

```python
context_info = session.context.info()

if context_info.context_status_data:
    for status in context_info.context_status_data:
        print(f"Context: {status.context_id}")
        print(f"Path: {status.path}")
        print(f"Status: {status.status}")
        if status.error_message:
            print(f"Error: {status.error_message}")
else:
    print("No sync tasks found")
```



## üìö Related Guides

- [Session Management](session-management.md) - Session lifecycle and configuration
- [File Operations](file-operations.md) - File handling and management
- [OSS Integration](../advanced/oss-integration.md) - Object storage service integration

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../README.md)




# Complete Guide to File Operations

This guide provides a complete introduction to file operations in the AgentBay SDK, including basic file operations, directory management, batch operations, permission management, and performance optimization. Both synchronous and asynchronous APIs are supported.


## üìã Table of Contents

- [Basic Concepts](#basic-concepts)
- [API Quick Reference](#api-quick-reference)
- [Basic File Operations](#basic-file-operations)
- [Directory Management](#directory-management)
- [Batch Operations](#batch-operations)
- [File Editing Operations](#file-editing-operations)  
- [File Permissions and Attributes](#file-permissions-and-attributes)
- [File Transfer Operations](#file-transfer-operations)
- [Error Handling](#error-handling)

<a id="basic-concepts"></a>
## üéØ Basic Concepts

### File System Structure

AgentBay sessions provide complete file system access, supporting different operating systems. Each system image provides a fully functional environment with standard directory structures:

#### Linux Environment (`linux_latest`)
```
/
‚îú‚îÄ‚îÄ bin -> usr/bin          # Essential command binaries (symlink)
‚îú‚îÄ‚îÄ boot/                   # Boot loader files
‚îú‚îÄ‚îÄ dev/                    # Device files
‚îú‚îÄ‚îÄ etc/                    # System configuration files
‚îú‚îÄ‚îÄ home/                   # User home directories
‚îÇ   ‚îî‚îÄ‚îÄ wuying/            # Default user directory
‚îú‚îÄ‚îÄ lib -> usr/lib         # Essential libraries (symlink)
‚îú‚îÄ‚îÄ media/                  # Removable media mount points
‚îú‚îÄ‚îÄ mnt/                    # Mount points (for context synchronization)
‚îú‚îÄ‚îÄ opt/                    # Optional application packages
‚îú‚îÄ‚îÄ proc/                   # Process information filesystem
‚îú‚îÄ‚îÄ root/                   # Root user home directory
‚îú‚îÄ‚îÄ run/                    # Runtime variable data
‚îú‚îÄ‚îÄ snap/                   # Snap packages
‚îú‚îÄ‚îÄ srv/                    # Service data
‚îú‚îÄ‚îÄ sys/                    # System information filesystem
‚îú‚îÄ‚îÄ tmp/                    # Temporary files (recommended for testing)
‚îú‚îÄ‚îÄ usr/                    # User programs and libraries
‚îî‚îÄ‚îÄ var/                    # Variable data files

Working Directory: /home/wuying
User: wuying
```

#### Windows Environment (`windows_latest`)
```
C:\
‚îú‚îÄ‚îÄ LogtailData\           # Logging service data
‚îú‚îÄ‚îÄ PerfLogs\              # Performance monitoring logs
‚îú‚îÄ‚îÄ Program Files\         # 64-bit application programs
‚îú‚îÄ‚îÄ Program Files (x86)\   # 32-bit application programs
‚îú‚îÄ‚îÄ temp\                  # Temporary files (for AgentBay operations)
‚îú‚îÄ‚îÄ Users\                 # User profile directories
‚îÇ   ‚îî‚îÄ‚îÄ Administrator\     # Default administrator account
‚îî‚îÄ‚îÄ Windows\               # Windows system files

Working Directory: C:\Users\Administrator
User: Administrator
```

#### Mobile/Android Environment (`mobile_latest`)
```
/
‚îú‚îÄ‚îÄ acct/                  # Process accounting
‚îú‚îÄ‚îÄ apex/                  # Android package extensions
‚îú‚îÄ‚îÄ bin -> /system/bin     # Binary executables (symlink)
‚îú‚îÄ‚îÄ cache/                 # System cache
‚îú‚îÄ‚îÄ config/                # Configuration files
‚îú‚îÄ‚îÄ data/                  # Application and user data
‚îú‚îÄ‚îÄ dev/                   # Device files
‚îú‚îÄ‚îÄ etc -> /system/etc     # System configuration (symlink)
‚îú‚îÄ‚îÄ metadata/              # Filesystem metadata
‚îú‚îÄ‚îÄ mnt/                   # Mount points
‚îú‚îÄ‚îÄ proc/                  # Process information
‚îú‚îÄ‚îÄ storage/               # External storage access
‚îú‚îÄ‚îÄ sys/                   # System information
‚îú‚îÄ‚îÄ system/                # Core Android system
‚îî‚îÄ‚îÄ vendor/                # Vendor-specific files

Working Directory: /
User: root
```

### Path Conventions

- **Linux/Android**: Use forward slash `/tmp/file.txt`
- **Windows**: Use backslash `C:\temp\file.txt` or forward slash `C:/temp/file.txt`
- **Recommendation**: Prefer absolute paths to avoid ambiguity

<a id="api-quick-reference"></a>
## üöÄ API Quick Reference

<details open>
<summary>üìò <strong>Synchronous API</strong> (Recommended for beginners)</summary>

```python
from agentbay import AgentBay

# Create session
agent_bay = AgentBay()
session = agent_bay.create().session
 #Create Directory
session.file_system.create_directory("/path/to")
print("‚úÖ Directory created successfully")


# Write text file (UTF-8 text only)
result = session.file_system.write_file("/path/to/file.txt", "Hello, World!")
if result.success:
    print("Text file written successfully")

# Read text file (UTF-8 text only)
result = session.file_system.read_file("/path/to/file.txt")
if result.success:
    content = result.content  # String content
    print(f"File content: {content}")

# List directory
result = session.file_system.list_directory("/path/to")
if result.success:
    entries = result.entries
    for entry in entries:
        print(f"Name: {entry['name']}")

# Get file info
result = session.file_system.get_file_info("/path/to/file.txt")

if result.success:
    info = result.file_info
    print(f"File info: {info}")
agent_bay.delete(session)
```

**Best for**: Simple scripts, sequential operations

</details>

<details>
<summary>‚ö° <strong>Asynchronous API</strong> (Click to expand)</summary>

```python
import asyncio
from agentbay import AsyncAgentBay

async def main():
    # Create session
    agent_bay = AsyncAgentBay()
    session = (await agent_bay.create()).session

    # Create Directory
    session.file_system.create_directory("/path/to")
    print("‚úÖ Directory created successfully")

    # Write text file (Note: write_file is currently synchronous in async sessions)
    result = session.file_system.write_file("/path/to/file.txt", "Hello, World!")
    if result.success:
        print("Text file written successfully")

    # Read text file (Note: read_file is currently synchronous in async sessions)
    result = session.file_system.read_file("/path/to/file.txt")
    if result.success:
        content = result.content
        print(f"File content: {content}")

    # List directory
    result = session.file_system.list_directory("/path/to")
    if result.success:
        entries = result.entries
        for entry in entries:
            print(f"Name: {entry['name']}")

    # Get file info
    result = session.file_system.get_file_info("/path/to/file.txt")
    if result.success:
        info = result.file_info
        print(f"File info: {info}")

    await agent_bay.delete(session)

asyncio.run(main())
```

**Best for**: High concurrency, async projects, web applications


</details>

<a id="basic-file-operations"></a>
## üìù Basic File Operations

**‚ö†Ô∏è Important: Text Files Only**: The `read_file()` and `write_file()` methods are designed specifically for **text files** (UTF-8 encoded). They cannot handle binary files such as images, executables, archives, or other non-text formats. For binary file operations, use command-line tools through the `session.command` interface or context synchronization features.

**File Size Support**: Both `read_file()` and `write_file()` methods support text files of any size through automatic chunked transfer. You don't need to worry about file size limitations - the SDK handles large text files transparently.

**Supported File Types**:
- ‚úÖ Text files: `.txt`, `.json`, `.py`, `.html`, etc.
- ‚ùå Binary files: `.jpg`, `.pdf`, `.exe`, `.zip`, etc.

### Reading Files

```python
from agentbay import AgentBay

agent_bay = AgentBay()
session = agent_bay.create().session

# Read text file
result = session.file_system.read_file("/tmp/sample.txt")
if result.success:
    content = result.content
    print(f"File content: {content}")
else:
    print(f"Failed to read file: {result.error_message}")
    
agent_bay.delete(session)
```


### Writing Files

```python
from agentbay import AgentBay

agent_bay = AgentBay()
session = agent_bay.create().session

# Write plain text file
content = "Hello, AgentBay!\nThis is a multi-line text file."
result = session.file_system.write_file("/tmp/hello.txt", content)
if result.success:
    print("Text file written successfully")
else:
    print(f"Failed to write file: {result.error_message}")

# Append to file
result = session.file_system.write_file("/tmp/hello.txt", "\nNew log entry", mode="append")
if result.success:
    print("File appended successfully")
    
agent_bay.delete(session)
```

### Handling Binary Files

Since `read_file()` and `write_file()` only support text files, **use `upload_file()` and `download_file()` APIs for binary file operations**.

For detailed examples and usage, see [File Transfer Operations](#file-transfer-operations) section.


<a id="directory-management"></a>
## üìÅ Directory Management

### Creating and moving Directories

```python
from agentbay import AgentBay

agent_bay = AgentBay()
session = agent_bay.create().session

# Create directory
result = session.file_system.create_directory("/tmp/data/my_project")
if result.success:
    print("Directory created successfully")
else:
    print(f"Failed to create directory: {result.error_message}")

# Remove directory with parent directories
result = session.file_system.move_file("/tmp/data", "/tmp/test/")
if result.success:
    print("Directory moved successfully")
#List direction
result = session.file_system.list_directory("/tmp/")
if result.success:
    entries = result.entries
    for entry in entries:
        print(f"Name: {entry['name']}")
agent_bay.delete(session)
```

### Listing Directory Contents

```python
from agentbay import AgentBay

agent_bay = AgentBay()
session = agent_bay.create().session

# List directory contents
result = session.file_system.list_directory("/tmp")
if result.success:
    entries = result.entries
    for entry in entries:
        print(f"Name: {entry['name']}")
        print(f"Is Directory: {entry['isDirectory']}")
        print("---")
else:
    print(f"Failed to list directory: {result.error_message}")
```

### Directory Monitoring

Monitor directories for file changes in real-time:

```python
import os
import time
import threading
from agentbay import AgentBay
from agentbay import CreateSessionParams

# Initialize AgentBay
api_key = os.getenv("AGENTBAY_API_KEY")
agentbay = AgentBay(api_key=api_key)

# Create session
session_params = CreateSessionParams(image_id="linux_latest")
session_result = agentbay.create(session_params)
session = session_result.session

# Define callback function
def on_file_change(events):
    for event in events:
        print(f"{event.event_type}: {event.path} ({event.path_type})")

# Start monitoring
monitor_thread = session.file_system.watch_directory(
    path="/tmp/my_directory",
    callback=on_file_change,
    interval=1.0  # Check every second
)
monitor_thread.start()

# Do your work...
time.sleep(10)

# Stop monitoring
monitor_thread.stop_event.set()
monitor_thread.join()

# Clean up
agentbay.delete(session)
```

#### Event Filtering

```python
def on_file_change(events):
    # Only process file modifications
    for event in events:
        if event.event_type == "modify" and event.path_type == "file":
            print(f"File modified: {event.path}")
        elif event.event_type == "create":
            print(f"File created: {event.path}")
        elif event.event_type == "delete":
            print(f"File deleted: {event.path}")
```

<a id="batch-operations"></a>
## üì¶ Batch Operations

### Batch File Operations

```python
from agentbay import AgentBay

agent_bay = AgentBay()
session = agent_bay.create().session

# Batch write files
files_to_write = [
    ("/tmp/file1.txt", "Content of file 1"),
    ("/tmp/file2.txt", "Content of file 2"),
    ("/tmp/file3.txt", "Content of file 3")
]

results = []
for file_path, content in files_to_write:
    result = session.file_system.write_file(file_path, content)
    results.append((file_path, result))

# Check results
for file_path, result in results:
    if result.success:
        print(f"‚úÖ {file_path} written successfully")
    else:
        print(f"‚ùå {file_path} failed: {result.error_message}")

# Batch read files using read_multiple_files
files_to_read = ["/tmp/file1.txt", "/tmp/file2.txt", "/tmp/file3.txt"]
result = session.file_system.read_multiple_files(files_to_read)

if result.success:
    for file_path, content in result.contents.items():
        print(f"‚úÖ {file_path}: {content[:50]}...")  # First 50 chars
else:
    print(f"‚ùå Failed to read multiple files: {result.error_message}")
```

### File Search Operations

```python
from agentbay import AgentBay

session = agent_bay.create().session

# Search for files with wildcard pattern
result = session.file_system.search_files("/tmp", "*systemd*")
if result.success:
    print(f"Found {len(result.matches)} files matching pattern:")
    for match in result.matches:
        print(f"  - {match}")
else:
    print(f"Search failed: {result.error_message}")

# Search with exclusion patterns
result = session.file_system.search_files(
    "/tmp",
    "*config*",
    exclude_patterns=["*backup*", "*temp*"]
)
if result.success:
    print(f"Found {len(result.matches)} files matching '*config*' (excluding '*backup*' and '*temp*'):")
    for match in result.matches:
        print(f"  - {match}")
```

#### ‚ö†Ô∏è Important: Search Rules and Limitations

**Pattern Matching Rules:**
- **Wildcard-based**: Supports `*` (any characters) and `?` (single character)
- **Recursive search**: Searches through all subdirectories from the starting path
- **Case sensitivity**:
  - **Windows**: Case-insensitive matching
  - **Linux/Unix**: Case-sensitive matching

**Examples of Pattern Matching:**

```python
# ‚úÖ CORRECT: Wildcard patterns
session.file_system.search_files("/tmp", "*.txt")
# Matches: test.txt, file.txt, etc.

session.file_system.search_files("/tmp", "test_*")
# Matches: test_file.py, test_data.json, etc.

session.file_system.search_files("/tmp", "*config*")
# Matches: config.json, app_config.xml, my_configuration.ini, etc.

session.file_system.search_files("/tmp", "?.log")
# Matches: a.log, 1.log, etc. (single character before .log)
```

**Platform-Specific Behavior:**

```python
# On Windows (case-insensitive)
result = session.file_system.search_files("/tmp", "*TEST*")
# Matches: TEST.txt, test.log, MyTest.py, etc.

# On Linux/Unix (case-sensitive)
result = session.file_system.search_files("/tmp", "*TEST*")
# Matches only: TEST.txt, MyTEST.py (exact case match)
result = session.file_system.search_files("/tmp", "*test*")
# Matches only: test.txt, my_test.py (exact case match)
```



<a id="file-editing-operations"></a>
## ‚úèÔ∏è File Editing Operations

### Text Find and Replace

```python
from agentbay import AgentBay

agent_bay = AgentBay()
session = agent_bay.create().session

# Create a test file
initial_content = "This is old1 text with old2 content.\nAnother line with old1 data."
result = session.file_system.write_file("/tmp/edit_test.txt", initial_content)

# Edit file with multiple find-replace operations
edits = [
    {"oldText": "old1", "newText": "new1"},
    {"oldText": "old2", "newText": "new2"}
]

result = session.file_system.edit_file("/tmp/edit_test.txt", edits, dry_run=False)
if result.success:
    print("File edited successfully")

    # Verify changes
    read_result = session.file_system.read_file("/tmp/edit_test.txt")
    if read_result.success:
        print(f"Updated content: {read_result.content}")
else:
    print(f"Edit failed: {result.error_message}")
```
### Global Character Replacement
**Note**: Each call to the `edit_file` method will only modify the first matched instance. If you need to globally replace the same string, there are two methods:
```python

from agentbay import AgentBay

agent_bay = AgentBay()
session = agent_bay.create().session

# Create a test file
initial_content = "This is old1 text with old2 content.\nAnother line with old1 data."
result = session.file_system.write_file("/tmp/edit_test.txt", initial_content)

# Method One: Single Call to `edit_file` for Global Replacement
edits = [
    {"oldText": "old1", "newText": "new1"},
    {"oldText": "old1", "newText": "new1"}
]

result = session.file_system.edit_file("/tmp/edit_test.txt", edits, dry_run=False)
if result.success:
    print("File edited successfully")

    # Verify changes
    read_result = session.file_system.read_file("/tmp/edit_test.txt")
    if read_result.success:
        print(f"Updated content: {read_result.content}")
else:
    print(f"Edit failed: {result.error_message}")
# Method Two:Multiple Calls to edit_file for Global Replacement
# Create a test file
result = session.file_system.write_file("/tmp/edit_test.txt", initial_content)

# Edit file with multiple find-replace operations
edits = [
    {"oldText": "old1", "newText": "new1"},
]

result1 = session.file_system.edit_file("/tmp/edit_test.txt", edits, dry_run=False)
result2 = session.file_system.edit_file("/tmp/edit_test.txt", edits, dry_run=False)
if result.success and result2.success:
    print("File edited successfully")

    # Verify changes
    read_result = session.file_system.read_file("/tmp/edit_test.txt")
    if read_result.success:
        print(f"Updated content: {read_result.content}")
else:
    print(f"Edit failed: {result.error_message}")

```

### Dry Run Mode

```python
from agentbay import AgentBay

agent_bay = AgentBay()
session = agent_bay.create().session
    # Create a test file
initial_content = "This is oldText text with newText content.\nAnother line with newText data."
result = session.file_system.write_file("/tmp/test.txt", initial_content)

# Preview changes without applying them
edits = [
    {"oldText": "newText", "newText": "modified"}
]

# Use dry_run=True to preview changes
result = session.file_system.edit_file("/tmp/test.txt", edits, dry_run=True)
if result.success:
    print("Dry run completed - changes would be applied")
    result = session.file_system.read_file("/tmp/test.txt")
    if result.success:
        print(f"Preview content: {result.content}")

    # Apply changes if preview looks good
    actual_result = session.file_system.edit_file("/tmp/test.txt", edits, dry_run=False)
    if actual_result.success:
        print("Changes applied successfully")
        result = session.file_system.read_file("/tmp/test.txt")
        if result.success:
            print(f"updated content: {result.content}")
else:
    print(f"Dry run failed: {result.error_message}")
```

<a id="file-permissions-and-attributes"></a>
## üîê File Permissions and Attributes

### Getting File Permissions Info

```python
from agentbay import AgentBay

agent_bay = AgentBay()
session = agent_bay.create().session

# Get file info
result = session.file_system.get_file_info("/tmp/example.txt")
if result.success:
    info = result.file_info
    print(f"Size: {info.get('size', 'N/A')} bytes")
    print(f"Created: {info.get('created', 'N/A')}")
    print(f"Modified: {info.get('modified', 'N/A')}")
    print(f"Is Directory: {info.get('isDirectory', 'N/A')}")
```

<a id="file-transfer-operations"></a>
## üì§üì• File Transfer Operations

AgentBay provides dedicated `upload_file()` and `download_file()` methods for transferring files between your local machine and the cloud environment. These methods support both text and binary files, making them ideal for handling any file type.

### Key Features
- **Universal file support**: Works with both text and binary files
- **Automatic synchronization**: Handles cloud storage synchronization automatically  
- **Progress tracking**: Optional progress callbacks for monitoring large transfers
- **Robust error handling**: Comprehensive error reporting and retry capabilities
- **Flexible timeouts**: Configurable wait times for different use cases

### File Upload

Upload files from your local machine to the cloud environment:

```python
from agentbay import AgentBay

agent_bay = AgentBay()
session = agent_bay.create().session

# Basic file upload
upload_result = session.file_system.upload_file(
    local_path="/path/to/local/file.txt",
    remote_path="/tmp/uploaded_file.txt"
)

if upload_result.success:
    print(f"‚úÖ Upload successful!")
    print(f"   Bytes sent: {upload_result.bytes_sent}")
    print(f"   HTTP status: {upload_result.http_status}")
    print(f"   Remote path: {upload_result.path}")
else:
    print(f"‚ùå Upload failed: {upload_result.error}")

agent_bay.delete(session)
```

### File Download

Download files from the cloud environment to your local machine:

```python
from agentbay import AgentBay

agent_bay = AgentBay()
session = agent_bay.create().session

# Basic file download
download_result = session.file_system.download_file(
    remote_path="/tmp/cloud_file.txt",
    local_path="/path/to/local/downloaded_file.txt"
)

if download_result.success:
    print(f"‚úÖ Download successful!")
    print(f"   Bytes received: {download_result.bytes_received}")
    print(f"   HTTP status: {download_result.http_status}")
    print(f"   Local path: {download_result.local_path}")
else:
    print(f"‚ùå Download failed: {download_result.error}")

agent_bay.delete(session)
```

### Binary File Transfer

Unlike `read_file()` and `write_file()`, the transfer methods work seamlessly with binary files:

```python
from agentbay import AgentBay
import os

agent_bay = AgentBay()
session = agent_bay.create().session

# Upload binary files (images, archives, executables, etc.)
binary_files = [
    ("/path/to/image.jpg", "/tmp/uploaded_image.jpg"),
    ("/path/to/data.zip", "/tmp/uploaded_archive.zip")
]

for local_path, remote_path in binary_files:
    if os.path.exists(local_path):
        upload_result = session.file_system.upload_file(
            local_path=local_path,
            remote_path=remote_path
        )
        
        if upload_result.success:
            print(f"‚úÖ {os.path.basename(local_path)}: {upload_result.bytes_sent} bytes")
        else:
            print(f"‚ùå {os.path.basename(local_path)}: {upload_result.error}")

agent_bay.delete(session)
```

### File Transfer vs. Read/Write Methods

| Feature | `upload_file()` / `download_file()` | `read_file()` / `write_file()` |
|---------|-----------------------------------|------------------------------|
| **File Types** | ‚úÖ Text and Binary | ‚ùå Text only (UTF-8) |
| **Use Case** | Local ‚Üî Cloud transfer | Cloud-side text processing |
| **Size Limit** | ‚úÖ No practical limit | ‚úÖ No limit (chunked) |
| **Progress Tracking** | ‚úÖ Available | ‚ùå Not available |
| **Binary Support** | ‚úÖ Full support | ‚ùå Not supported |

### When to Use Each Method

**Use `upload_file()` / `download_file()` for:**
- Transferring files between local machine and cloud
- Working with binary files (images, archives, executables)
- Large file transfers with progress monitoring
- Moving files into/out of the cloud environment

**Use `read_file()` / `write_file()` for:**
- Processing text content within the cloud environment
- Reading configuration files for analysis
- Generating reports and logs
- Text manipulation and editing tasks




<a id="error-handling"></a>
## ‚ùå Error Handling

### Binary File Error Handling

When attempting to read or write binary files with text methods, you'll encounter specific errors. Here are the actual error messages and how to handle them:

```python
from agentbay import AgentBay
import base64

agent_bay = AgentBay()
session = agent_bay.create().session

# ‚ùå Binary data write will fail with JSON serialization error
try:
    binary_data = b'\x89PNG\r\n\x1a\n'  # PNG header example
    result = session.file_system.write_file("/tmp/image.png", binary_data)
    if not result.success:
        # Actual error: "Failed to call MCP tool write_file: Object of type bytes is not JSON serializable"
        print(f"Binary data write error: {result.error_message}")
        
        # ‚úÖ Use alternative method: base64 encoding
        base64_content = base64.b64encode(binary_data).decode('utf-8')
        session.file_system.write_file("/tmp/binary_b64.txt", base64_content)
        result = session.command.execute_command("base64 -d /tmp/binary_b64.txt > /tmp/image.png")
        if result.success:
            print("‚úÖ Binary file created successfully using base64")
            
except Exception as e:
    print(f"Exception during binary write: {e}")

# ‚ö†Ô∏è Note: Binary file reads may unexpectedly succeed
# Some binary files might be read as text, but the content will be corrupted
try:
    result = session.file_system.read_file("/bin/ls")  # Binary executable
    if result.success:
        print("‚ö†Ô∏è Binary file read succeeded, but content may be corrupted")
        print(f"Content preview: {repr(result.content[:50])}...")
        
        # ‚úÖ Use command-line tools for proper binary handling
        cmd_result = session.command.execute_command("file /bin/ls")
        if cmd_result.success:
            print(f"File type: {cmd_result.output}")
            
except Exception as e:
    print(f"Exception reading binary file: {e}")

# üìÅ File not found errors
try:
    result = session.file_system.read_file("/tmp/nonexistent_file.txt")
    if not result.success:
        # Actual error: "Error in response: Execution failed. Error code:-32602 Error message: Failed to get file status: /tmp/nonexistent_file.txt, error: No such file or directory"
        print(f"File not found error: {result.error_message}")
        
except Exception as e:
    print(f"Exception reading non-existent file: {e}")

agent_bay.delete(session)
```

## üìã API Method Selection Guide

| Use Case | Recommended Method | Notes |
|----------|-------------------|-------|
| Read text file | `read_file()` | **Text files only**, supports any size via chunked transfer |
| Read multiple text files | `read_multiple_files()` | **Text files only**, more efficient than individual reads |
| Write text content | `write_file()` | **Text files only**, supports any size via chunked transfer |
| Upload file (local ‚Üí cloud) | `upload_file()` | Supports all file types, with progress tracking |
| Download file (cloud ‚Üí local) | `download_file()` | Supports all file types, with progress tracking |
| Find and replace text | `edit_file()` | **Text files only**, better than read-modify-write |
| Search for files | `search_files()` | Supports wildcard patterns (* and ?) |
| Move/rename files | `move_file()` | Works for both text and binary files |
| Get file metadata | `get_file_info()` | File size, type, timestamps |
| List directory | `list_directory()` | Directory contents |
| Create directories | `create_directory()` | Supports nested creation |
| Monitor directory changes | `watch_directory()` | Real-time file change monitoring with callbacks |

## üìö Related Resources

- [Session Management Guide](session-management.md)
- [Command Execution Guide](command-execution.md)
- [Data Persistence Guide](data-persistence.md)

## üÜò Getting Help

If you encounter issues with file operations:

1. Check file paths and permissions
2. Verify available disk space
3. Review error messages for specific details
4. Consult the [Documentation](../README.md) for detailed information
5. Search [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues) for similar problems

Remember: File operations are fundamental to most cloud workflows. Master these concepts to build robust and efficient applications! üöÄ




# Session Management Documentation

This document provides comprehensive guidance on using the session management capabilities of the AgentBay SDK. Both synchronous and asynchronous APIs are fully supported.


## Overview

Sessions are the fundamental unit of interaction with the AgentBay cloud environment. Each session represents an isolated cloud environment where you can execute commands, manipulate files, run applications, and perform automation tasks.

The session management system provides:
1. **Session Creation**: Create isolated cloud environments with customizable image types and parameters
2. **Session Information**: Access session details including direct browser URLs and connection credentials
3. **Label Management**: Organize and categorize sessions using descriptive labels
4. **Session Recovery**: Restore session objects using session IDs for continued operations
5. **Session Deletion**: Clean up sessions to free cloud resources

## Getting Started

### Prerequisites

Before running the example programs in this guide, please ensure you have completed the following setup:

**Required Setup (2 minutes):**
1. **SDK Installation & API Key Configuration**: Follow the [Installation and API Key Setup Guide](../../../quickstart/installation.md) to install the AgentBay SDK and configure your API key
2. **SDK Configuration**: Review the [SDK Configuration Guide](../configuration/sdk-configuration.md) for detailed configuration options including environment variables and API gateway selection
3. **Core Concepts**: Review [Core Concepts Guide](../../../quickstart/basic-concepts.md) to understand AgentBay fundamentals including sessions, images, and data persistence

**Quick Verification:**

<details open>
<summary>üìò <strong>Synchronous API</strong> (Recommended for beginners)</summary>

```python
import os
from agentbay import AgentBay

api_key = os.getenv("AGENTBAY_API_KEY")
agent_bay = AgentBay(api_key=api_key)
result = agent_bay.create()
if result.success:
    print("‚úÖ Setup successful - ready to use session management!")
    agent_bay.delete(result.session)
else:
    print(f"‚ùå Setup issue: {result.error_message}")
```

**Best for**: Simple scripts, sequential operations

</details>

<details>
<summary>‚ö° <strong>Asynchronous API</strong> (Click to expand)</summary>

```python
import os
import asyncio
from agentbay import AsyncAgentBay

async def main():
    api_key = os.getenv("AGENTBAY_API_KEY")
    agent_bay = AsyncAgentBay(api_key=api_key)
    result = await agent_bay.create()
    if result.success:
        print("‚úÖ Setup successful - ready to use session management!")
        await agent_bay.delete(result.session)
    else:
        print(f"‚ùå Setup issue: {result.error_message}")

asyncio.run(main())
```

**Best for**: High concurrency, async projects, web applications

</details>

### Creating a Session

Creating a session is the first step in using the AgentBay SDK.

<details open>
<summary>üìò <strong>Synchronous API</strong> (Recommended for beginners)</summary>

```python
from agentbay import AgentBay

# Initialize the SDK
agent_bay = AgentBay(api_key=api_key)

# Create a session with default parameters
session_result = agent_bay.create()
if session_result.success:
    session = session_result.session
    print(f"Session created with ID: {session.session_id}")
```

**Best for**: Simple scripts, sequential operations

</details>

<details>
<summary>‚ö° <strong>Asynchronous API</strong> (Click to expand)</summary>

```python
import asyncio
from agentbay import AsyncAgentBay

async def main():
    # Initialize the SDK
    agent_bay = AsyncAgentBay(api_key=api_key)

    # Create a session with default parameters
    session_result = await agent_bay.create()
    if session_result.success:
        session = session_result.session
        print(f"Session created with ID: {session.session_id}")

asyncio.run(main())
```

**Best for**: High concurrency, async projects, web applications


</details>

## Creating Sessions with Custom Parameters

You can customize sessions by specifying parameters such as [image ID](../../../quickstart/basic-concepts.md#image-types) and [labels](#session-label-management). For production environments, consider using [custom images](../advanced/custom-images.md) with fixed versions:

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams

# Initialize the SDK
agent_bay = AgentBay(api_key="your_api_key")

# Create a session with custom parameters
params = CreateSessionParams(
    image_id="linux_latest",
    labels={"project": "demo", "environment": "testing"}
)
session_result = agent_bay.create(params)
session = session_result.session

if session_result.success:
    session = session_result.session
    print(f"Session created with ID: {session.session_id}")
```



## Session Label Management

Labels help organize and categorize sessions for easier management:

### Setting Session Labels

```python
from agentbay import AgentBay

# Initialize the SDK and create a session
agent_bay = AgentBay(api_key=api_key)
session_result = agent_bay.create()
session = session_result.session

# Set labels
labels = {"project": "demo", "environment": "testing"}
result = session.set_labels(labels)

if result.success:
    print("Labels set successfully")
else:
    print(f"Failed to set labels: {result.error_message}")
```

### Getting Session Labels

```python
from agentbay import AgentBay

# Initialize the SDK and create a session
agent_bay = AgentBay(api_key=api_key)
session_result = agent_bay.create()
session = session_result.session

# Get labels
result = session.get_labels()

if result.success:
    print("Session labels:")
    for key, value in result.data.items():
        print(f"  {key}: {value}")
else:
    print(f"Failed to get labels: {result.error_message}")
```

## Listing Sessions

The `list()` method allows you to query and retrieve session IDs from your AgentBay account. This is useful for managing multiple sessions, monitoring active environments, and organizing your cloud resources.

### Basic Usage

```python
from agentbay import AgentBay

# Initialize the SDK
agent_bay = AgentBay(api_key=api_key)

# List all active sessions
result = agent_bay.list()

if result.success:
    print(f"Found {result.total_count} total sessions")
    print(f"Showing {len(result.session_ids)} session IDs on this page")
    print(f"Request ID: {result.request_id}")

    for session_id in result.session_ids:
        print(f"Session ID: {session_id}")
else:
    print(f"Failed to list sessions: {result.error_message}")

# Output:
# Found 0 total sessions
# Showing 0 session IDs on this page
# Request ID: 6620****-****-****-****-********C2C1
```

### Filtering by Labels

You can filter sessions by labels to find specific environments:

```python
from agentbay import AgentBay

# Initialize the SDK
agent_bay = AgentBay(api_key=api_key)

# List sessions with specific labels
result = agent_bay.list(labels={"project": "demo", "environment": "testing"})

if result.success:
    print(f"Found {len(result.session_ids)} sessions matching the labels")
    for session_id in result.session_ids:
        print(f"Session ID: {session_id}")

# Output (after creating a session with matching labels):
# Found 1 sessions matching the labels
# Session ID: session-**********************sic
```

### Pagination

For accounts with many sessions, use pagination to retrieve results in manageable chunks:

```python
from agentbay import AgentBay

# Initialize the SDK
agent_bay = AgentBay(api_key=api_key)

# Get page 2 with 10 items per page
result = agent_bay.list(labels={"project": "demo"}, page=2, limit=10)

if result.success:
    print(f"Page 2 of results (showing {len(result.session_ids)} sessions)")
    print(f"Total sessions: {result.total_count}")
    print(f"Next page token: {result.next_token}")

# Output (when there are no sessions on page 2):
# Page 2 of results (showing 0 sessions)
# Total sessions: 0
# Next page token: None
```

### Important Notes

**Active Sessions Only:**
- The `list()` method **only returns currently active sessions**
- Sessions that have been deleted or released (either manually via `delete()` or automatically due to timeout) will **not** be included in the results
- To check if a specific session is still active, use the `get()` method or `session.info()` method

**Return Value:**
- The method returns session IDs (strings) rather than full Session objects
- Use `agent_bay.get(session_id)` to retrieve a full Session object if needed

**Key Features:**
- **Flexible Filtering**: List all sessions or filter by any combination of labels
- **Pagination Support**: Use `page` and `limit` parameters for easy pagination
- **Request ID**: All responses include a `request_id` for tracking and debugging
- **Efficient**: Returns only session IDs for better performance

## Getting Session Information

The `info()` method provides detailed information about a session, including direct browser access URLs and SDK integration credentials. This API serves two primary purposes:

1. **Cloud Environment Access**: Get the `resource_url` to directly access the cloud environment in a web browser with real-time video streaming and full mouse/keyboard control
2. **Session Status Validation**: Check if a session is still active and hasn't been released
3. **SDK Integration**: Extract authentication credentials for Web SDK (desktop) and Android SDK (mobile) integration

### Session Information Retrieval

```python
from agentbay import AgentBay

# Initialize the SDK and create a session
agent_bay = AgentBay(api_key=api_key)
session_result = agent_bay.create()
session = session_result.session

# Get session information
info_result = session.info()

if info_result.success:
    info = info_result.data
    print(f"Session ID: {info.session_id}")
    print(f"Resource ID: {info.resource_id}")
    print(f"Resource URL: {info.resource_url}")
    print(f"App ID: {info.app_id}")
    print(f"Resource Type: {info.resource_type}")
    print(f"Request ID: {info_result.request_id}")

    # Authentication info (displayed safely)
    print(f"Auth Code: {info.auth_code[:8]}***{info.auth_code[-8:]}")
    print(f"Connection Properties: {len(info.connection_properties)} chars")
    print(f"Ticket: {info.ticket[:50]}...")

    # The resource_url can be opened in a browser for direct access
    print("\nüåê Open the resource_url in your browser to access the cloud environment!")
else:
    print(f"Failed to get session info: {info_result.error_message}")
```

### Session Information Field Details

- **session_id**: Unique identifier for the session
- **resource_id**: Cloud resource identifier (e.g., "p-xxxxxxxxx")
- **resource_url**: **Direct browser access URL** - Open this URL in any web browser to access the cloud environment with real-time video stream and full mouse/keyboard control
- **app_id**: Application type identifier
- **resource_type**: Resource classification (typically "AIAgent")
- **auth_code**: Authentication token required for Web SDK and Android SDK integration
- **connection_properties**: JSON configuration for SDK connection settings
- **ticket**: Gateway access ticket containing connection endpoints and tokens for SDK integration

### Session Information Use Cases

For detailed practical examples and use cases of session information, including browser access, Android SDK integration, and session health monitoring, see the [Session Information Use Cases Guide](../use-cases/session-info-use-cases.md).



## Session Pause and Resume

Sessions can be temporarily paused to suspend resource usage and resumed later to continue work. This feature is useful for reducing costs during inactive periods and preserving session state for later continuation.

### Pausing a Session

To pause a session, use the `pause()` method:

```python
from agentbay import AgentBay

# Initialize the SDK and create a session
agent_bay = AgentBay(api_key=api_key)
session_result = agent_bay.create()
session = session_result.session

# Perform your tasks...

# Pause the session to suspend resource usage
pause_result = session.pause()
if pause_result.success:
    print("Session paused successfully")
    print(f"Request ID: {pause_result.request_id}")
else:
    print(f"Failed to pause session: {pause_result.error_message}")
```

### Resuming a Session

To resume a paused session, use the `resume()` method:

```python
from agentbay import AgentBay

# Initialize the SDK and get a paused session
agent_bay = AgentBay(api_key=api_key)
# Assuming you have a paused session with session_id
get_result = agent_bay.get("your_paused_session_id")
if get_result.success:
    session = get_result.session
    
    # Resume the session to continue work
    resume_result = session.resume()
    if resume_result.success:
        print("Session resumed successfully")
        print(f"Request ID: {resume_result.request_id}")
        
        # Continue with your tasks...
        result = session.command.execute_command("echo 'Hello after resume!'")
        print(f"Command output: {result.output}")
    else:
        print(f"Failed to resume session: {resume_result.error_message}")
else:
    print(f"Failed to get session: {get_result.error_message}")
```

### Important Notes

- **Resource Usage and Costs**: During pause, both resource usage and costs are lower
- **Session State**: All session state is preserved during pause and resume operations
- **Optional Operations**: Pause and resume are optional - you can also directly delete a session
- **Paused Session Restrictions**: When a session is in a paused state, it cannot perform operations such as deletion, task execution, or other actions. You must resume the session first before performing these operations

## Session Release

Sessions consume cloud resources while active. Understanding how sessions are released is crucial for resource management.

### Two Ways to Release Sessions

**1. Manual Release (Recommended)**

Explicitly delete sessions when you're done:

```python
from agentbay import AgentBay

# Initialize the SDK and create a session
agent_bay = AgentBay(api_key=api_key)
session_result = agent_bay.create()
session = session_result.session

# Perform your tasks...

# Release resources immediately
delete_result = agent_bay.delete(session)
if delete_result.success:
    print("Session deleted successfully")
else:
    print(f"Failed to delete session: {delete_result.error_message}")
```

**2. Automatic Timeout Release**

If you don't manually delete a session, it will be automatically released after a configured timeout period:

- **Configuration**: Timeout duration is set in the [AgentBay Console](https://agentbay.console.aliyun.com/)
- **Behavior**: Once the timeout is reached, the session is automatically released
- **Recovery**: After release (manual or automatic), the session cannot be recovered - the session ID becomes invalid

### Important Notes

- Released sessions (either manually or by timeout) will **not** appear in `agent_bay.list()` results
- Once released, all non-persistent data in the session is permanently lost
- Use [Data Persistence](data-persistence.md) to preserve important data across sessions


## Session Recovery

In certain scenarios, you may need to recover a Session object using its session ID. The SDK provides the `get` method to retrieve an existing session.

### Using the get Method

The `get` method is the recommended way to recover a session. It retrieves session information from the cloud and returns a ready-to-use Session object with the API request ID.

```python
from agentbay import AgentBay

# Initialize the SDK
agent_bay = AgentBay(api_key="your_api_key")

# Retrieve session using its ID
session_id = "your_existing_session_id"
get_result = agent_bay.get(session_id)

if get_result.success:
    session = get_result.session
    print(f"Retrieved session: {session.session_id}")
    print(f"Request ID: {get_result.request_id}")
    
    # You can now perform any session operations
    result = session.command.execute_command("echo 'Hello, World!'")
    print(result.output)
else:
    print(f"Failed to get session: {get_result.error_message}")

# Output (when session exists):
# Retrieved session: session-**********************uhi
# Request ID: B27C****-****-****-****-********0366
# Command output: Hello, World!

# Output (when session is deleted or not found):
# Failed to get session: Failed to get session session-**********************uhi: Failed to get session session-**********************uhi: Error: InvalidMcpSession.NotFound code: 400,   Resource [McpSession] is not found. request id: 1C3C****-****-****-****-********AD3F ...
```


### Important Considerations

**Session Recovery Limitations:**

1. **Released Sessions Cannot Be Recovered**: If the session ID corresponds to a cloud environment that has been actually released (either through active deletion via `Session.delete()` or automatic timeout release), it cannot be recovered using the session ID. In such cases, you must:
   - Create a new session
   - Use data persistence (see [Data Persistence Guide](data-persistence.md)) to restore your data

2. **Session Status Validation**: Use the `Session.info()` method to determine if a session has been released. Only active (non-released) sessions can return information through the info interface.

3. **Automatic Release Timeout**: Session automatic release timeout can be configured in the [console page](https://agentbay.console.aliyun.com/).

## Advanced Session Patterns

### Error-Safe Session Creation

Create sessions with comprehensive error handling:

```python
import os
from agentbay import AgentBay
from agentbay import CreateSessionParams

def create_session_safely(image_id="linux_latest"):
    agent_bay = AgentBay(api_key=os.getenv("AGENTBAY_API_KEY"))
    
    params = CreateSessionParams(image_id=image_id) if image_id != "linux_latest" else None
    result = agent_bay.create(params)
    
    if result.success:
        print(f"‚úÖ Session created: {result.session.session_id}")
        return result.session, agent_bay
    else:
        print(f"‚ùå Failed: {result.error_message}")
        return None, None

session, client = create_session_safely("browser_latest")
if session:
    client.delete(session)
```

### Context Manager Pattern

Implement automatic cleanup using Python's context manager protocol:

```python
import os
from agentbay import AgentBay
from agentbay import CreateSessionParams

class SessionManager:
    def __init__(self, image_id="linux_latest"):
        self.agent_bay = AgentBay(api_key=os.getenv("AGENTBAY_API_KEY"))
        self.image_id = image_id
        self.session = None
    
    def __enter__(self):
        params = CreateSessionParams(image_id=self.image_id) if self.image_id != "linux_latest" else None
        result = self.agent_bay.create(params)
        if result.success:
            self.session = result.session
            return self.session
        else:
            raise Exception(f"Session creation failed: {result.error_message}")
    
    def __exit__(self, exc_type, exc_val, exc_tb):
        if self.session:
            self.agent_bay.delete(self.session)
            print("üßπ Session automatically cleaned up")

try:
    with SessionManager("code_latest") as session:
        result = session.command.execute_command("echo 'Automatic cleanup!'")
        print(f"Output: {result.output}")
except Exception as e:
    print(f"Error: {e}")
```

## API Reference

For detailed API documentation, see:
- [Python Session API](../../../../python/docs/api/sync/session.md)
- [TypeScript Session API](../../../../typescript/docs/api/common-features/basics/session.md)
- [Golang Session API](../../../../golang/docs/api/common-features/basics/session.md)
- [Python AgentBay API](../../../../python/docs/api/sync/agentbay.md)
- [TypeScript AgentBay API](../../../../typescript/docs/api/common-features/basics/agentbay.md)
- [Golang AgentBay API](../../../../golang/docs/api/common-features/basics/agentbay.md)

## üìö Related Guides

- [Data Persistence](data-persistence.md) - Persistent data storage across sessions
- [File Operations](file-operations.md) - File handling and management
- [Command Execution](command-execution.md) - Execute shell commands
- [VPC Sessions](../advanced/vpc-sessions.md) - Isolated network environments

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../README.md)




# Configuration

SDK configuration options and settings.

## Documentation

- [SDK Configuration](sdk-configuration.md) - API keys, gateway regions, and endpoints
- [Logging](logging.md) - Configure log levels, output, and data masking

## Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Main Documentation](../../../README.md)




# Logging Configuration Guide

This guide shows how to configure logging in AgentBay SDK. Each language has its own documentation with specific details.

## Quick Links

- **[Python Logging Guide](../../../../python/docs/api/common/logging.md)** - Setup, configuration, and file logging
- **[Go Logging Guide](../../../../golang/docs/api/common-features/basics/logging.md)** - Environment variables and code-level configuration
- **[TypeScript Logging Guide](../../../../typescript/docs/api/common-features/basics/logging.md)** - Import-time setup and RequestID tracking

---

## Overview

All AgentBay SDKs provide:
- Multiple log levels (DEBUG, INFO, WARNING/WARN, ERROR)
- **.env file support** - Automatically loaded from project directory
- Environment variable configuration (AGENTBAY_LOG_LEVEL or LOG_LEVEL)
- Code-level setup
- Automatic sensitive data masking
- Color output detection

### Quick Start: Using .env File (Recommended)

Create a `.env` file in your project root:

```
# .env file
AGENTBAY_LOG_LEVEL=DEBUG

# Other configuration
AGENTBAY_API_KEY=your_api_key_here
```

All SDKs automatically load this file - no additional code needed!

### Priority System (All Languages)

Log levels are applied in this order (highest to lowest):

1. **setup() method** - Explicitly calling setup() always takes effect (code-level configuration)
2. **Environment variables** - AGENTBAY_LOG_LEVEL or LOG_LEVEL
3. **.env file** - Automatically loaded from current directory or parent directories
4. **Default values** - INFO level if nothing else is configured

---

## Python Example

### Set Log Level via .env File (Recommended)

Create a `.env` file in your project root:

```
# .env file
AGENTBAY_LOG_LEVEL=DEBUG
```

The SDK automatically loads this file.

### Set Log Level via Environment Variable

```bash
export AGENTBAY_LOG_LEVEL=DEBUG
python your_script.py
```

### Set Log Level in Code

```python
from agentbay import AgentBayLogger, get_logger

# Configure logging level with setup()
AgentBayLogger.setup(level="DEBUG")

logger = get_logger("my_app")
logger.debug("Debug message")
logger.info("Info message")
```

### Available Log Levels

| Level | Use Case |
|-------|----------|
| **DEBUG** | Development - see everything |
| **INFO** | Default - important events |
| **WARNING** | Issues but not failures |
| **ERROR** | Only failures |

### File Logging

> **Note**: File logging is currently only available in the Python SDK. TypeScript and Golang SDKs log to stdout/stderr.

The Python SDK supports file logging with automatic log rotation and retention. By default, logs are written to `python/agentbay.log`.

```python
from agentbay import AgentBayLogger

# Configure file logging with rotation
AgentBayLogger.setup(
    level="DEBUG",
    log_file="/var/log/myapp.log",  # Custom log file path
    rotation="100 MB",               # Rotate when file reaches 100 MB
    retention="30 days"              # Keep logs for 30 days
)
```

---

## Sensitive Data Masking

All SDKs automatically mask sensitive information:

- API keys, tokens, passwords
- Authorization headers
- Private keys

No configuration needed - it works automatically.





# SDK Configuration Guide

This guide explains how to configure the AgentBay SDK for different environments and requirements.

> **üí° Async API Support**: Configuration works identically for both sync and async APIs. For async patterns, see:

> **Important:** The `endpoint` configuration specifies the **API Gateway location** used for SDK-backend communication. This determines which regional gateway your SDK connects to. You can use the `region_id` configuration to specify where your cloud sessions will be created.

## Configuration Parameters

| Parameter | Environment Variable | Description | Default Value |
|-----------|---------------------|-------------|---------------|
| API Key | `AGENTBAY_API_KEY` | Authentication key for API access | Required |
| Endpoint | `AGENTBAY_ENDPOINT` | API Gateway endpoint URL (determines gateway location for SDK communication) | `wuyingai.cn-shanghai.aliyuncs.com` |
| Region ID | `AGENTBAY_REGION_ID` | Cloud resource region for sessions and contexts (e.g., `cn-hangzhou`, `ap-southeast-1`) | `None` |

## Supported API Gateway Regions

The following API gateway locations are available. Choose the gateway closest to your users for optimal network performance:

| Gateway Location | Endpoint |
|-----------------|----------|
| Shanghai | `wuyingai.cn-shanghai.aliyuncs.com` |
| Singapore | `wuyingai.ap-southeast-1.aliyuncs.com` |

## Default Configuration

If no configuration is provided, the SDK uses the following default values:

```json
{
    "endpoint": "wuyingai.cn-shanghai.aliyuncs.com"
}
```

## Configuration Priority

Configuration values are resolved in the following order (highest to lowest priority):

1. **Hard-coded configuration** (passed directly to SDK)
2. **Environment variables**
3. **`.env` configuration file** (searched upward from current directory)
4. **Default configuration**

## Configuration Methods

### Method 1: Environment Variables

Set configuration using shell commands:

**Linux/macOS:**
```bash
export AGENTBAY_API_KEY=your-api-key-here
export AGENTBAY_ENDPOINT=wuyingai.ap-southeast-1.aliyuncs.com
export AGENTBAY_REGION_ID=ap-southeast-1
```

**Windows:**
```cmd
set AGENTBAY_API_KEY=your-api-key-here
set AGENTBAY_ENDPOINT=wuyingai.ap-southeast-1.aliyuncs.com
set AGENTBAY_REGION_ID=ap-southeast-1
```

### Method 2: .env File

The SDK automatically searches for `.env` files using the following strategy:

1. **Current directory** - starts from where your program runs
2. **Parent directories** - searches upward until it finds a `.env` file or reaches the root
3. **First match wins** - stops searching when the first `.env` file is found

**Basic usage:**
```env
# .env file (can be placed in project root or any parent directory)
AGENTBAY_API_KEY=your-api-key-here
AGENTBAY_ENDPOINT=wuyingai.ap-southeast-1.aliyuncs.com
AGENTBAY_REGION_ID=ap-southeast-1
```

**File locations examples:**
```
my-project/
‚îú‚îÄ‚îÄ .env                    # ‚úÖ Found from any subdirectory
‚îî‚îÄ‚îÄ src/
    ‚îî‚îÄ‚îÄ app/
        ‚îî‚îÄ‚îÄ main.py         # Searches upward: app/ ‚Üí src/ ‚Üí my-project/ ‚úÖ
```

**Custom .env file path (Sync):**

```python
from agentbay import AgentBay
client = AgentBay(env_file="/path/to/custom.env")
```

**Custom .env file path (Async):**

```python
import asyncio
from agentbay import AsyncAgentBay

async def main():
    client = AsyncAgentBay(env_file="/path/to/custom.env")
    # Use client...

asyncio.run(main())
```

### Method 3: Hard-coded Configuration (Debug Only)

For debugging purposes, you can pass configuration directly in code.

**Sync API:**

```python
from agentbay import AgentBay, Config

# Hard-coded configuration (not recommended for production)
config = Config(
    endpoint="wuyingai.ap-southeast-1.aliyuncs.com",
    region_id="ap-southeast-1"
)
agent_bay = AgentBay(api_key="your-api-key-here", cfg=config)
```

**Async API:**

```python
import asyncio
from agentbay import AsyncAgentBay, Config

async def main():
    # Hard-coded configuration (not recommended for production)
    config = Config(
        endpoint="wuyingai.ap-southeast-1.aliyuncs.com",
        region_id="ap-southeast-1"
    )
    agent_bay = AsyncAgentBay(api_key="your-api-key-here", cfg=config)
    # Use agent_bay...

asyncio.run(main())
```

> **Warning:** Hard-coding API keys and configuration is not recommended for production environments due to security risks.

### SDK Initialization

After setting configuration, initialize the SDK:

```python
from agentbay import AgentBay
agent_bay = AgentBay()  # Automatically searches for .env files
```

## Common Scenarios

### Switch to Singapore Gateway

To use the Singapore API gateway for better network performance in Asia-Pacific regions:

```bash
export AGENTBAY_ENDPOINT=wuyingai.ap-southeast-1.aliyuncs.com
```

### Configure Cloud Resource Region

To specify the region where your AgentBay sessions and contexts will be created:

```bash
export AGENTBAY_REGION_ID=ap-southeast-1  # For Singapore region
# or
export AGENTBAY_REGION_ID=cn-hangzhou  # For Hangzhou region
```

**Important Notes:**
- `region_id` is optional - if not specified, AgentBay will use the default region
- This setting determines where your actual cloud sessions run, which can affect performance and data locality
- Choose a region close to your users or data sources for optimal performance
- Available region IDs can be found in the [AgentBay Console](https://agentbay.console.aliyun.com/)
- The `region_id` is automatically passed to session and context creation APIs when configured


### Development vs Production

**Development:** 
- Use `.env` file in project root for local configuration
- SDK automatically finds configuration regardless of execution directory
- For different environments, use custom paths: `AgentBay(env_file=".env.development")`

**Production:** 
- Use environment variables for secure deployment
- Environment variables always take precedence over `.env` files

## Troubleshooting

### Check Configuration

```bash
env | grep AGENTBAY  # Verify environment variables
```

**Debug .env file discovery:**
```bash
# Check if .env file exists in current directory or parent directories
find . -name ".env" -o -name ".git" -type d 2>/dev/null | head -10
```

### Common Error Messages

#### 1. Missing API Key
**Error:** `ValueError: API key is required. Provide it as a parameter or set the AGENTBAY_API_KEY environment variable`

**Solution:** 
- Set the `AGENTBAY_API_KEY` environment variable
- Or pass `api_key` parameter when creating AgentBay instance

#### 2. Invalid API Key
**Error:** `NOT_LOGIN code: 400, You are not logged in or your login token has expired`

**Solution:**
- Verify your API key is correct and not expired
- Check if your API key has proper permissions
- Contact support if the key should be valid

#### 3. API Key and Gateway Mismatch
**Error:** `NOT_LOGIN code: 400` with unexpected `HostId` in error response

**Example:** Error shows `'HostId': 'wuyingai.ap-southeast-1.aliyuncs.com'` but you expected to connect to Shanghai gateway.

**Solution:**
- Check if your API key matches the gateway region you're trying to use
- Ensure `AGENTBAY_ENDPOINT` matches your API key's region
- Domestic (China) API keys typically work with China mainland gateway endpoints (e.g., `wuyingai.cn-shanghai.aliyuncs.com`)
- International API keys typically work with international gateway endpoints (e.g., `wuyingai.ap-southeast-1.aliyuncs.com`)
- API keys are region-specific and cannot be used across different gateway regions

#### 4. Wrong Endpoint/Network Issues
**Error:** `Failed to resolve 'invalid-endpoint.com'` or `NameResolutionError`

**Solution:**
- Verify the gateway endpoint URL is correct
- Ensure your network can reach the gateway endpoint
- Check if you're behind a corporate firewall
- Confirm gateway location and endpoint match (see supported gateway regions table above)

#### 5. .env File Not Found
**Symptom:** SDK uses default configuration despite having a `.env` file

**Solution:**
- Ensure `.env` file is in your project root or a parent directory
- Check file permissions (must be readable)
- Verify file format (no spaces around `=`, proper line endings)
- Use absolute path if needed: `AgentBay(env_file="/full/path/to/.env")`
- Debug with: `find . -name ".env" -type f` to locate your `.env` files

### Quick Diagnosis

```python
from agentbay import AgentBay

try:
    agent_bay = AgentBay()  # Test basic initialization
    result = agent_bay.create()  # Test API connectivity
    print("Configuration is working correctly")
except ValueError as e:
    print(f"Configuration issue: {e}")
except Exception as e:
    print(f"Network/API issue: {e}")
```

## Best Practices

- **Gateway Selection:** Choose the API gateway closest to your users for optimal network performance
- **Security:** Use environment variables in production (not hardcoded values)
- **Validation:** Test configuration during application startup
- **Future Planning:** Be aware that future versions may support specifying cloud environment regions separately during session creation

## Related Documentation

- [Getting Started](../../../quickstart/installation.md)
- [Session Management](../basics/session-management.md)

## üìö Related Guides

- [Session Management](../basics/session-management.md) - Session lifecycle and configuration
- [VPC Sessions](../advanced/vpc-sessions.md) - Isolated network environments

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../../README.md)




# Use Cases

This directory contains practical use cases and examples for the AgentBay SDK. Each use case provides detailed implementation examples, integration patterns, and best practices for specific scenarios.

## Available Use Cases

### Session Management

- **[Session Information Use Cases](session-info-use-cases.md)** - Practical examples for using session information, including browser access, Android SDK integration, and session health monitoring
- **[Session Link Use Cases](session-link-use-cases.md)** - Practical examples for connecting external tools to cloud sessions, including browser automation, web application access, and custom service connections

### Data Persistence

- **[Cross-Platform Data Persistence](cross-platform-persistence.md)** - Enable context data created on one OS to be accessible on another using MappingPolicy

## How to Use This Directory

Each use case document follows a consistent structure:

1. **Overview** - Brief description of the use case and its applications
2. **Prerequisites** - Required setup and dependencies
3. **Implementation Examples** - Step-by-step code examples with explanations
4. **Best Practices** - Recommended approaches and common patterns
5. **Troubleshooting** - Common issues and solutions
6. **Related Resources** - Links to relevant guides and API documentation

## Contributing Use Cases

When adding new use cases to this directory:

1. Follow the established naming convention: `{feature}-use-cases.md`
2. Include practical, real-world examples
3. Provide comprehensive code samples with explanations
4. Add troubleshooting sections for common issues
5. Update this README.md to include the new use case
6. Cross-reference with related guides and API documentation

## Getting Help

If you need assistance with any of these use cases:

1. Visit the [Quick Start guide](../../../quickstart/README.md) for basic setup
2. Consult the specific guide documents in the [guides directory](../../README.md)
3. Check the troubleshooting sections in individual guide documents

For additional support, please refer to the main [AgentBay SDK documentation](../../README.md).



# Cross-Platform Data Persistence

This guide explains how to use the MappingPolicy feature to enable cross-platform data persistence, allowing context data created on one operating system to be accessible on another.

## Overview

By default, context data persistence is tied to the operating system where it was created. For example, data created in a Windows session (at `c:\Users\Administrator\Downloads`) can only be reused in other Windows sessions at the same path.

The **MappingPolicy** feature solves this limitation by allowing you to map paths from one operating system to another, enabling true cross-platform data persistence.

## Use Case

Consider this scenario:

1. You create a session on Windows and save files to `c:\Users\Administrator\Downloads`
2. The files are persisted to a context
3. Later, you create a Linux session and want to access those same files at `/home/wuying/‰∏ãËΩΩ`

Without MappingPolicy, this wouldn't work because the paths are OS-specific. With MappingPolicy, you can map the Windows path to the Linux path, making the data accessible across platforms.

## How It Works

When you create a context sync configuration with a MappingPolicy:

1. The `path` in MappingPolicy specifies the original OS path where data was stored
2. The `path` in ContextSync specifies where you want to access that data in the current session
3. The system automatically maps between these paths, making cross-platform access seamless

## Implementation

### Golang

```go
package main

import (
    "github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay"
)

func main() {
    // Initialize AgentBay client
    ab, err := agentbay.NewAgentBay("your-api-key")
    if err != nil {
        panic(err)
    }

    // Get or create a context
    contextResult, err := ab.Context.Get("my-cross-platform-context", true)
    if err != nil {
        panic(err)
    }
    context := contextResult.Context

    // Define the original Windows path and target Linux path
    windowsPath := "c:\\Users\\Administrator\\Downloads"
    linuxPath := "/home/wuying/‰∏ãËΩΩ"

    // Create mapping policy with the original Windows path
    mappingPolicy := &agentbay.MappingPolicy{
        Path: windowsPath,
    }

    // Create sync policy with mapping policy
    syncPolicy := &agentbay.SyncPolicy{
        UploadPolicy:   agentbay.NewUploadPolicy(),
        DownloadPolicy: agentbay.NewDownloadPolicy(),
        DeletePolicy:   agentbay.NewDeletePolicy(),
        ExtractPolicy:  agentbay.NewExtractPolicy(),
        MappingPolicy:  mappingPolicy,
    }

    // Create session with context sync
    sessionParams := agentbay.NewCreateSessionParams()
    sessionParams.AddContextSync(context.ID, linuxPath, syncPolicy)
    sessionParams.WithImageId("linux_latest")

    // Create session
    sessionResult, err := ab.Create(sessionParams)
    if err != nil {
        panic(err)
    }

    session := sessionResult.Session
    // Now you can access Windows files at /home/wuying/‰∏ãËΩΩ in Linux
}
```

### Python

```python
from agentbay import AgentBay
from agentbay import (
    MappingPolicy,
    SyncPolicy,
    UploadPolicy,
    DownloadPolicy,
    DeletePolicy,
    ExtractPolicy
)
from agentbay import CreateSessionParams

# Initialize AgentBay client
ab = AgentBay("your-api-key")

# Get or create a context
context_result = ab.context.get("my-cross-platform-context", create_if_not_exists=True)
context = context_result.context

# Define the original Windows path and target Linux path
windows_path = "c:\\Users\\Administrator\\Downloads"
linux_path = "/home/wuying/‰∏ãËΩΩ"

# Create mapping policy with the original Windows path
mapping_policy = MappingPolicy(path=windows_path)

# Create sync policy with mapping policy
sync_policy = SyncPolicy(
    upload_policy=UploadPolicy(),
    download_policy=DownloadPolicy(),
    delete_policy=DeletePolicy(),
    extract_policy=ExtractPolicy(),
    mapping_policy=mapping_policy
)

# Create session with context sync
session_params = CreateSessionParams()
session_params.add_context_sync(context.id, linux_path, sync_policy)
session_params.with_image_id("linux_latest")

# Create session
session_result = ab.create(session_params)
session = session_result.session
# Now you can access Windows files at /home/wuying/‰∏ãËΩΩ in Linux
```

### TypeScript

```typescript
import { AgentBay, CreateSessionParams } from "wuying-agentbay-sdk";
import {
  MappingPolicy,
  SyncPolicy,
  newUploadPolicy,
  newDownloadPolicy,
  newDeletePolicy,
  newExtractPolicy,
} from "wuying-agentbay-sdk";

// Initialize AgentBay client
const ab = new AgentBay({ apiKey: "your-api-key" });

// Get or create a context
const contextResult = await ab.context.get("my-cross-platform-context", true);
const context = contextResult.context!;

// Define the original Windows path and target Linux path
const windowsPath = "c:\\Users\\Administrator\\Downloads";
const linuxPath = "/home/wuying/‰∏ãËΩΩ";

// Create mapping policy with the original Windows path
const mappingPolicy: MappingPolicy = {
  path: windowsPath,
};

// Create sync policy with mapping policy
const syncPolicy: SyncPolicy = {
  uploadPolicy: newUploadPolicy(),
  downloadPolicy: newDownloadPolicy(),
  deletePolicy: newDeletePolicy(),
  extractPolicy: newExtractPolicy(),
  mappingPolicy: mappingPolicy,
};

// Create session with context sync
const sessionParams = new CreateSessionParams();
sessionParams.addContextSync(context.id, linuxPath, syncPolicy);
sessionParams.withImageId("linux_latest");

// Create session
const sessionResult = await ab.create(sessionParams);
const session = sessionResult.session!;
// Now you can access Windows files at /home/wuying/‰∏ãËΩΩ in Linux
```

## Common Scenarios

### Windows to Linux

```
Original: c:\Users\Administrator\Downloads
Target:   /home/wuying/‰∏ãËΩΩ
```

### Linux to Windows

```
Original: /home/wuying/‰∏ãËΩΩ
Target:   c:\Users\Administrator\Downloads
```

### macOS to Linux

```
Original: /Users/username/Downloads
Target:   /home/wuying/‰∏ãËΩΩ
```

## Best Practices

1. **Consistent Context IDs**: Use the same context ID across sessions to ensure data continuity
2. **Path Validation**: Ensure target paths exist or can be created in the new environment
3. **Character Encoding**: Be aware of path character encoding differences between operating systems
4. **Testing**: Test cross-platform scenarios in your development environment before production use

## Important Notes

- The MappingPolicy `path` should contain the original OS path where data was first stored
- The ContextSync `path` should contain where you want to access the data in the current session
- Path mapping is handled automatically by the system
- All other sync policies (upload, download, delete, extract) work the same way with MappingPolicy

## Related Resources

- [Data Persistence Guide](../basics/data-persistence.md)
- [Session Management](../basics/session-management.md)





# Session Information Use Cases

This document provides practical examples and use cases for using session information obtained from the `session.info()` API. These examples demonstrate common scenarios for integrating AgentBay sessions with different platforms and systems.

## Overview

The `session.info()` method provides detailed information about a session, including direct browser access URLs and SDK integration credentials. This API serves multiple purposes:

1. **Cloud Environment Access**: Get the `resource_url` to directly access the cloud environment in a web browser with real-time video streaming and full mouse/keyboard control
2. **Session Status Validation**: Check if a session is still active and hasn't been released  
3. **SDK Integration**: Extract authentication credentials for Web SDK (desktop) and Android SDK (mobile) integration

## Use Case 1: Cloud Environment Access via Browser

The most common use case is accessing the cloud environment directly through a web browser using the `resource_url`:

```python
def access_cloud_environment_browser(session):
    """Get cloud environment access URL for browser-based remote control."""
    info_result = session.info()

    if info_result.success:
        info = info_result.data
        resource_url = info.resource_url

        print(f"Cloud environment ready for session: {info.session_id}")
        print(f"Resource URL: {resource_url}")
        print("\nüåê Copy and paste the Resource URL into any web browser to access the cloud environment")
        print("   Features available:")
        print("   - Real-time video stream of the desktop")
        print("   - Mouse and keyboard interaction capabilities")
        print("   - Full remote desktop experience")

        return {
            "session_id": info.session_id,
            "resource_url": resource_url,
            "access_method": "browser_direct"
        }
    else:
        print(f"Failed to get session info: {info_result.error_message}")
        return None

# Usage
access_info = access_cloud_environment_browser(session)
if access_info:
    print("Cloud environment URL is ready - open it in your browser to start using the remote desktop")
```

## Use Case 2: Android SDK Configuration for Cloud Environment Access

The session information obtained from `session.info()` can be used as configuration parameters for the Alibaba Cloud Android SDK, enabling users to connect to the session's cloud environment through the Android SDK:

```python
def prepare_android_sdk_config(session):
    """Prepare Android SDK configuration for cloud environment connection."""
    info_result = session.info()
    
    if info_result.success:
        info = info_result.data
        
        # Android SDK Config parameters based on Alibaba Cloud Android SDK documentation
        # Reference: https://help.aliyun.com/zh/ecp/android-sdk-of-cloud-phone section 4.1 Config
        # info.resource_id maps to CONFIG_DESKTOP_ID
        # info.ticket maps to CONFIG_CONNECTION_TICKET
        android_config = {
            "CONFIG_DESKTOP_ID": info.resource_id,      # Desktop ID for connection
            "CONFIG_CONNECTION_TICKET": info.ticket,    # Connection ticket for authentication
            "CONFIG_USE_VPC": False,                     # VPC configuration (set based on your network setup)
            "OS_TYPE": "android",                        # OS type for the connection
            "CONFIG_USER": "",                           # User identifier (optional)
            "CONFIG_UUID": ""                            # UUID identifier (optional)
        }
        
        print("Android SDK Configuration:")
        print(f"CONFIG_DESKTOP_ID: {info.resource_id}")
        print(f"CONFIG_CONNECTION_TICKET: {info.ticket[:50]}...")  # Truncated for security
        print(f"CONFIG_USE_VPC: {android_config['CONFIG_USE_VPC']}")
        print(f"OS_TYPE: {android_config['OS_TYPE']}")
        
        return android_config
    else:
        print(f"Failed to prepare Android SDK config: {info_result.error_message}")
        return None

# Usage example for Android SDK integration
android_config = prepare_android_sdk_config(session)
if android_config:
    print("Android SDK configuration ready for StreamView connection")
    
    # Method 1: Using StreamView.start() with mConfigs (reference section 2.2)
    # Map<String, Object> mConfigs = new HashMap<>();
    # mConfigs.put("CONFIG_DESKTOP_ID", android_config.get("CONFIG_DESKTOP_ID"));
    # mConfigs.put("CONFIG_CONNECTION_TICKET", android_config.get("CONFIG_CONNECTION_TICKET"));
    # mConfigs.put("CONFIG_USE_VPC", android_config.get("CONFIG_USE_VPC"));
    # mConfigs.put("OS_TYPE", android_config.get("OS_TYPE"));
    # mConfigs.put("CONFIG_USER", android_config.get("CONFIG_USER"));
    # mConfigs.put("CONFIG_UUID", android_config.get("CONFIG_UUID"));
    # mStreamView.start(mConfigs);
    
    # Method 2: Using IAspEngine with ConnectionConfig (reference section 2.5)
    # ConnectionConfig cc = new ConnectionConfig();
    # cc.id = android_config.get("CONFIG_DESKTOP_ID");
    # cc.connectionTicket = android_config.get("CONFIG_CONNECTION_TICKET");
    # cc.useVPC = android_config.get("CONFIG_USE_VPC");
    # cc.type = android_config.get("OS_TYPE");
    # cc.user = android_config.get("CONFIG_USER");
    # cc.uuid = android_config.get("CONFIG_UUID");
    # engine.start(cc);
```

### Android SDK Integration Notes

- **`info.resource_id`** maps to **`CONFIG_DESKTOP_ID`** - This is the unique identifier for the cloud desktop/resource that the Android client will connect to
- **`info.ticket`** maps to **`CONFIG_CONNECTION_TICKET`** - This is the authentication ticket required to establish a secure connection to the cloud environment
- **`CONFIG_USE_VPC`** - Set to `true` if your cloud environment uses VPC networking, `false` for standard networking
- **`OS_TYPE`** - Specifies the OS type, typically set to "android" for mobile connections
- **`CONFIG_USER`** and **`CONFIG_UUID`** - Optional parameters that can be set based on your specific requirements
- The Android SDK supports two connection methods:
  1. **StreamView.start(mConfigs)** - Direct connection using configuration map (section 2.2)
  2. **IAspEngine with ConnectionConfig** - Multi-StreamView mode for advanced scenarios (section 2.5)
- For detailed Android SDK integration steps, refer to the [Alibaba Cloud Android SDK documentation](https://help.aliyun.com/zh/ecp/android-sdk-of-cloud-phone)

## Use Case 3: Session Status Validation and Health Check

Use `info()` to check if a session is still active and hasn't been released:

```python
def check_session_status(session):
    """Check if session is still active and hasn't been released."""
    try:
        info_result = session.info()

        if info_result.success:
            info = info_result.data
            print(f"‚úÖ Session {info.session_id} is ACTIVE")
            print(f"   Resource ID: {info.resource_id}")
            print(f"   App ID: {info.app_id}")
            print(f"   Resource Type: {info.resource_type}")
            return True
        else:
            print(f"‚ùå Session status check failed: {info_result.error_message}")
            return False

    except Exception as e:
        print(f"‚ùå Session has been RELEASED or is inaccessible: {e}")
        return False

def monitor_session_health(session, check_interval=30):
    """Continuously monitor session health."""
    import time

    print(f"Starting health monitoring for session: {session.session_id}")

    while True:
        is_active = check_session_status(session)

        if not is_active:
            print("üö® Session is no longer active - stopping monitoring")
            break

        print(f"üíö Session health check passed - next check in {check_interval}s")
        time.sleep(check_interval)

# Usage examples
print("=== Session Status Check ===")
if check_session_status(session):
    print("Session is ready for use")
else:
    print("Session needs to be recreated")

# For continuous monitoring (run in background thread)
# import threading
# monitor_thread = threading.Thread(target=monitor_session_health, args=(session, 60))
# monitor_thread.daemon = True
# monitor_thread.start()
```

## Additional Integration Scenarios

### Web SDK Integration

For web-based applications that need to embed cloud environment access:

```python
def prepare_web_sdk_config(session):
    """Prepare configuration for Web SDK integration."""
    info_result = session.info()
    
    if info_result.success:
        info = info_result.data
        
        web_config = {
            "session_id": info.session_id,
            "resource_url": info.resource_url,
            "auth_code": info.auth_code,
            "connection_properties": info.connection_properties
        }
        
        return web_config
    else:
        return None
```

### API Gateway Integration

For scenarios where session access needs to be proxied through an API gateway:

```python
def create_session_proxy_endpoint(session):
    """Create API endpoint configuration for session proxy."""
    info_result = session.info()
    
    if info_result.success:
        info = info_result.data
        
        proxy_config = {
            "endpoint": f"/api/sessions/{info.session_id}/proxy",
            "target_url": info.resource_url,
            "auth_token": info.auth_code,
            "session_metadata": {
                "resource_id": info.resource_id,
                "app_id": info.app_id,
                "resource_type": info.resource_type
            }
        }
        
        return proxy_config
    else:
        return None
```

## Best Practices

1. **Always validate session info results** - Check the `success` field before using session information
2. **Handle authentication securely** - Never log or expose auth codes and tickets in plain text
3. **Implement proper error handling** - Session info calls can fail if sessions are released
4. **Cache session information appropriately** - Avoid excessive info() calls, but refresh when needed
5. **Monitor session lifecycle** - Use periodic health checks for long-running applications
6. **Secure credential transmission** - Use HTTPS/TLS when transmitting session credentials to other systems

## Troubleshooting

### Common Issues

1. **Session info returns null/empty**: Session may have been released or expired
2. **Authentication failures**: Verify auth codes and tickets are correctly transmitted
3. **Connection timeouts**: Check network connectivity and firewall settings
4. **Invalid resource URLs**: Ensure the session is still active before using URLs

### Error Handling

```python
def robust_session_info_handler(session):
    """Robust session info handling with comprehensive error handling."""
    try:
        info_result = session.info()
        
        if info_result.success:
            return info_result.data
        else:
            print(f"Session info failed: {info_result.error_message}")
            # Consider session recreation or fallback logic
            return None
            
    except Exception as e:
        print(f"Session info exception: {e}")
        # Session likely released - implement recovery logic
        return None
```

For more information about session management, see the [Session Management Guide](../basics/session-management.md).
## üìö Related Guides

- [Session Management](../basics/session-management.md) - Session lifecycle and configuration
- [Session Link Access](../advanced/session-link-access.md) - Session connectivity

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../../README.md)




# Session Link Use Cases

This document provides practical use cases for Session Link Access, showing you how to connect external tools to services running in your AgentBay cloud sessions.

> **‚ö†Ô∏è Important Notice**: The Session Link feature is currently in whitelist-only access. To request access to this feature, please send your application to agentbay_dev@alibabacloud.com. For product feedback or suggestions, please submit through the [Alibaba Cloud ticket system](https://smartservice.console.aliyun.com/service/list).

## üìã Table of Contents

- [Overview](#overview)
- [Use Case 1: Browser Automation](#use-case-1-browser-automation)
- [Use Case 2: Access Web Applications](#use-case-2-access-web-applications)
- [Use Case 3: Connect to Custom Services](#use-case-3-connect-to-custom-services)
- [Quick Selection Guide](#quick-selection-guide)
- [Complete Code Examples](#complete-code-examples)

---

## Overview

Session Link provides **direct network access URLs** to services in your cloud session. The `get_link()` method enables three main scenarios:

1. ‚úÖ **Control a cloud browser** with Playwright/Puppeteer (browser automation via CDP)
2. ‚úÖ **Access web applications** running in your session (like dev servers on custom ports)
3. ‚úÖ **Connect to custom services** in the cloud (like WebSocket servers, databases)

---

<a id="use-case-1-browser-automation"></a>
## Use Case 1: Browser Automation ü§ñ

### Your Need
I want to control a cloud browser with Playwright/Puppeteer for automation tasks.

### Solution
Call `get_link()` **with no parameters**. It returns a browser control address (CDP endpoint).

### Minimal Code

```python
import asyncio
from agentbay import AgentBay, CreateSessionParams
from agentbay import BrowserOption
from playwright.async_api import async_playwright

async def main():
    # 1. Create session (MUST use Browser Use image)
    agent_bay = AgentBay(api_key="your_api_key")
    session = agent_bay.create(
        CreateSessionParams(image_id="browser_latest")  # or other Browser Use images
    ).session

    # 2. Initialize browser and wait for it to be ready
    await session.browser.initialize_async(BrowserOption())
    await asyncio.sleep(10)  # Wait for browser to be fully ready

    # 3. Get browser control address
    link = session.get_link()
    print(f"Browser address: {link.data}")
    # Output: wss://gateway.../websocket_ai/...

    # 4. Connect with Playwright
    async with async_playwright() as p:
        browser = await p.chromium.connect_over_cdp(link.data)
        context = browser.contexts[0]
        page = await context.new_page()
        await page.goto("https://example.com")
        # Now you can control the cloud browser!
        await browser.close()
    
    # 5. Cleanup
    agent_bay.delete(session)

asyncio.run(main())
```

### Key Points
- ‚úÖ MUST use Browser Use image (e.g., `browser_latest` or custom Browser Use images)
- ‚úÖ No parameters needed (or use `protocol_type="wss"`)
- ‚úÖ Returns a WebSocket URL starting with `wss://`

### Who Is This For?
- Browser automation testing
- Web scraping with headless browsers
- RPA automation workflows

---

<a id="use-case-2-access-web-applications"></a>
## Use Case 2: Access Web Applications üåê

### Your Need
I'm running a web service in the cloud session (like `npm run dev`) and want to access it from my local browser.

### Solution
Call `get_link(protocol_type="https", port=port_number)` to get an HTTPS URL.

### Minimal Code

```python
from agentbay import AgentBay

# 1. Create session (any image works)
agent_bay = AgentBay(api_key="your_api_key")
session = agent_bay.create().session

# 2. Start a web server in the cloud (port 30150)
session.file_system.write_file(
    "/tmp/index.html", 
    "<h1>Hello from Cloud!</h1>"
)
session.command.execute_command(
    "cd /tmp && python3 -m http.server 30150 &"
)

# 3. Get access URL
link = session.get_link(protocol_type="https", port=30150)
print(f"Web app URL: {link.data}")
# Output: https://gateway.../request_ai/.../path/

# 4. Open this URL in your browser to access the cloud web service!
```

### Key Points
- ‚úÖ MUST specify both `protocol_type="https"` and `port`
- ‚úÖ Port number MUST be in **30100-30199** range
- ‚úÖ Returns an HTTPS URL you can open in a browser

### Who Is This For?
- Debugging frontend projects in the cloud (React/Vue dev servers)
- Viewing web apps running in the cloud

---

<a id="use-case-3-connect-to-custom-services"></a>
## Use Case 3: Connect to Custom Services üîå

### Your Need
I'm running a custom service in the cloud and want to connect to it from my local machine.

### Solution
Call `get_link(port=port_number)` to get a WebSocket URL.

### Minimal Code

```python
from agentbay import AgentBay

# 1. Create session
agent_bay = AgentBay(api_key="your_api_key")
session = agent_bay.create().session

# 2. Start a service in the cloud (port 30180)
session.command.execute_command(
    "python3 -m http.server 30180 &"
)

# 3. Get connection URL
link = session.get_link(port=30180)
print(f"Service URL: {link.data}")
# Output: wss://gateway.../websocket_ai/...

# 4. Connect from your local code
# (Use appropriate client based on your service type)
```

### Key Points
- ‚úÖ Only pass `port`, don't pass `protocol_type`
- ‚úÖ Port number MUST be in **30100-30199** range
- ‚úÖ Returns a WebSocket URL (wss://)

### Who Is This For?
- Connecting to custom WebSocket services
- Accessing database services (via port forwarding)
- Debugging network services

---

## Quick Selection Guide

### Decision Tree

```
Question: What do you want to do?
    ‚Üì
‚îú‚îÄ A. Control a browser ‚Üí [Use Case 1] No parameters
‚îú‚îÄ B. Access a web page ‚Üí [Continue to Question 2]
‚îî‚îÄ C. Connect to other services ‚Üí [Continue to Question 3]

Question 2: This web page is...
‚îú‚îÄ Running in the cloud session ‚Üí [Use Case 2] HTTPS + port
‚îî‚îÄ External website ‚Üí ‚ö†Ô∏è  No need for get_link, access directly

Question 3: This service is...
‚îú‚îÄ HTTP/HTTPS service ‚Üí [Use Case 2] HTTPS + port
‚îú‚îÄ WebSocket or other ‚Üí [Use Case 3] Port only
‚îî‚îÄ Other protocols ‚Üí ‚ö†Ô∏è  Only HTTPS and WSS are supported
```

### Quick Reference Table

| Your Need | How to Call | protocol_type | port | Image Required |
|-----------|------------|---------------|------|----------------|
| Browser automation (CDP) | `get_link()` | Don't pass | Don't pass | Browser Use image |
| Access web app | `get_link("https", 30150)` | `"https"` | 30100-30199 | Any |
| WebSocket service | `get_link(port=30150)` | Don't pass | 30100-30199 | Any |
| Custom HTTPS service | `get_link("https", 30150)` | `"https"` | 30100-30199 | Any |

### Common Mistakes

| You Write | What Happens | Correct Way |
|-----------|--------------|-------------|
| `get_link("https")` | ‚ùå Error: "port is not valid" | `get_link("https", 30150)` |
| `get_link(port=8080)` | ‚ùå Error: "Port must be in 30100-30199" | `get_link(port=30150)` |
| `get_link("http", 30150)` | ‚ùå Error: "http not supported" | `get_link("https", 30150)` |
| Non-Browser Use image + `get_link()` | ‚ùå Error: "only BrowserUse image support cdp" | Use Browser Use image (e.g., `browser_latest`) |

---

## Complete Code Examples

These are complete, tested examples you can copy and run directly.

### Example 1: Browser Automation Complete Flow

**Goal**: Control a cloud browser with Playwright and visit a website

```python
import asyncio
import os
from agentbay import AgentBay, CreateSessionParams
from playwright.async_api import async_playwright

async def browser_automation_example():
    """Complete browser automation example"""
    
    # 1. Initialize (get API key from environment variable)
    api_key = os.environ.get("AGENTBAY_API_KEY")
    if not api_key:
        print("‚ùå Error: AGENTBAY_API_KEY environment variable is not set")
        print("Please set it using: export AGENTBAY_API_KEY=your_api_key")
        return
    
    agent_bay = AgentBay(api_key=api_key)
    session = None
    
    try:
        # 2. Create Browser Use session
        print("Creating cloud browser session...")
        session_result = agent_bay.create(
            CreateSessionParams(image_id="browser_latest")
        )
        
        if not session_result.success:
            print(f"‚ùå Failed: {session_result.error_message}")
            return
        
        session = session_result.session
        print(f"‚úÖ Session created: {session.session_id}")
        
        # 3. Initialize browser
        print("\nInitializing browser...")
        from agentbay import BrowserOption
        init_ok = await session.browser.initialize_async(BrowserOption())
        if not init_ok:
            print("‚ùå Browser initialization failed")
            return
        print("‚úÖ Browser initialized")
        
        # Wait for browser to be ready
        print("Waiting for browser to be ready...")
        await asyncio.sleep(10)
        
        # 4. Get browser CDP address
        print("\nGetting browser control address...")
        link_result = session.get_link()
        
        if not link_result.success:
            print(f"‚ùå Failed: {link_result.error_message}")
            return
        
        cdp_url = link_result.data
        print(f"‚úÖ CDP URL: {cdp_url[:60]}...")
        
        # 5. Connect with Playwright and control browser
        print("\nConnecting to browser...")
        async with async_playwright() as p:
            browser = await p.chromium.connect_over_cdp(cdp_url)
            print("‚úÖ Connected to browser!")
            
            # Create new page
            context = browser.contexts[0]
            page = await context.new_page()
            
            # Visit Alibaba Cloud website
            print("\nVisiting https://www.aliyun.com ...")
            await page.goto("https://www.aliyun.com")
            title = await page.title()
            print(f"‚úÖ Page title: {title}")
            
            # Close browser
            await browser.close()
            print("‚úÖ Browser closed")
        
        print("\nüéâ SUCCESS: Browser automation completed!")
        
    except Exception as e:
        print(f"‚ùå Error: {e}")
        import traceback
        traceback.print_exc()
    
    finally:
        # 6. Cleanup
        if session:
            print("\nCleaning up...")
            agent_bay.delete(session)
            print("‚úÖ Session deleted")

if __name__ == "__main__":
    asyncio.run(browser_automation_example())
```

**Before Running**:
1. Install dependencies: `pip install wuying-agentbay-sdk playwright`
2. Install browser: `playwright install chromium`
3. Set your API key: `export AGENTBAY_API_KEY=your_api_key`

**Expected Output**:
```
Creating cloud browser session...
‚úÖ Session created: session-abc123

Getting browser control address...
‚úÖ CDP URL: wss://gateway.../websocket_ai/...

Connecting to browser...
‚úÖ Connected to browser!

Visiting https://www.aliyun.com ...
‚úÖ Page title: ÈòøÈáå‰∫ë-ËÆ°ÁÆóÔºå‰∏∫‰∫ÜÊó†Ê≥ïËÆ°ÁÆóÁöÑ‰ª∑ÂÄº
‚úÖ Browser closed

üéâ SUCCESS: Browser automation completed!

Cleaning up...
‚úÖ Session deleted
```

---

### Example 2: Access Cloud Web Application

**Goal**: Start an HTTP server in the cloud and access it from local browser

```python
import time
import os
from agentbay import AgentBay

def web_app_access_example():
    """Complete web application access example"""
    
    # 1. Initialize (get API key from environment variable)
    api_key = os.environ.get("AGENTBAY_API_KEY")
    if not api_key:
        print("‚ùå Error: AGENTBAY_API_KEY environment variable is not set")
        print("Please set it using: export AGENTBAY_API_KEY=your_api_key")
        return
    
    agent_bay = AgentBay(api_key=api_key)
    session = None
    
    try:
        # 2. Create session (any image works)
        print("Creating session...")
        session = agent_bay.create().session
        print(f"‚úÖ Session ID: {session.session_id}")
        
        # 3. Create a simple HTML file in the cloud
        print("\nCreating HTML file in cloud...")
        session.file_system.write_file(
            "/tmp/index.html",
            "<h1>Hello from AgentBay Cloud!</h1><p>Running on port 30150</p>"
        )
        print("‚úÖ HTML file created")
        
        # 4. Start HTTP server on port 30150
        print("\nStarting HTTP server...")
        port = 30150
        session.command.execute_command(
            f"cd /tmp && nohup python3 -m http.server {port} > /dev/null 2>&1 &"
        )
        time.sleep(3)  # Wait for server to start
        print(f"‚úÖ HTTP server started on port {port}")
        
        # 5. Get access URL
        print("\nGetting access URL...")
        link_result = session.get_link(protocol_type="https", port=port)
        
        if not link_result.success:
            print(f"‚ùå Failed: {link_result.error_message}")
            return
        
        web_url = link_result.data
        print(f"‚úÖ Web URL: {web_url}")
        
        print("\n" + "=" * 70)
        print("üéâ SUCCESS: Web application is accessible!")
        print("=" * 70)
        print(f"\nüëâ Open this URL in your browser:")
        print(f"   {web_url}")
        print(f"\nSession will stay alive for 30 seconds...")
        
        time.sleep(30)
        
    except Exception as e:
        print(f"‚ùå Error: {e}")
        import traceback
        traceback.print_exc()
    
    finally:
        # 6. Cleanup
        if session:
            print("\nCleaning up...")
            agent_bay.delete(session)
            print("‚úÖ Session deleted")

if __name__ == "__main__":
    web_app_access_example()
```

**Key Points**:
- Port must be in 30100-30199 range
- Must pass both `protocol_type` and `port`
- Returned URL can be opened directly in browser

---

### Example 3: Custom Port Access

**Goal**: Demonstrate port parameter usage for custom services

```python
import time
import os
from agentbay import AgentBay

def custom_port_example():
    """Custom port access example"""
    
    # 1. Initialize (get API key from environment variable)
    api_key = os.environ.get("AGENTBAY_API_KEY")
    if not api_key:
        print("‚ùå Error: AGENTBAY_API_KEY environment variable is not set")
        print("Please set it using: export AGENTBAY_API_KEY=your_api_key")
        return
    
    agent_bay = AgentBay(api_key=api_key)
    session = None
    
    try:
        # 2. Create session
        print("Creating session...")
        session = agent_bay.create().session
        print(f"‚úÖ Session ID: {session.session_id}")
        
        # 3. Start a service on custom port 30180
        print("\nStarting service on port 30180...")
        port = 30180
        session.command.execute_command(
            f"cd /tmp && nohup python3 -m http.server {port} > /dev/null 2>&1 &"
        )
        time.sleep(3)
        print(f"‚úÖ Service started on port {port}")
        
        # 4. Get link with custom port
        print("\nGetting link with custom port...")
        link_result = session.get_link(port=port)
        
        if not link_result.success:
            print(f"‚ùå Failed: {link_result.error_message}")
            return
        
        service_url = link_result.data
        print(f"‚úÖ Service URL: {service_url[:80]}...")
        print(f"‚úÖ Protocol: {service_url.split('://')[0]}://")
        
        # Verify protocol
        if service_url.startswith("wss://"):
            print("‚úÖ Confirmed: WebSocket Secure (wss://) URL")
        
        print("\nüéâ SUCCESS: Custom port link obtained!")
        print(f"\nKey findings:")
        print(f"  - Port: {port}")
        print(f"  - Protocol: wss://")
        print(f"  - Port range: 30100-30199")
        
    except Exception as e:
        print(f"‚ùå Error: {e}")
        import traceback
        traceback.print_exc()
    
    finally:
        # 5. Cleanup
        if session:
            print("\nCleaning up...")
            agent_bay.delete(session)
            print("‚úÖ Session deleted")

if __name__ == "__main__":
    custom_port_example()
```

**Note**: These examples have been tested and verified with real AgentBay API calls.

---

## Related Resources

- [Session Link Access Guide](../advanced/session-link-access.md) - Complete API documentation and advanced topics
- [Session Management Guide](../basics/session-management.md) - Session lifecycle management
- [Session Information Use Cases](session-info-use-cases.md) - Other session-related use cases

## Getting Help

If you encounter issues:

1. Check the [Session Link Access Guide](../advanced/session-link-access.md) for detailed documentation
2. Search [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
3. Contact support with detailed error information

Remember: Session Link Access is your gateway to cloud session connectivity! üîó

## üìö Related Guides

- [Session Link Access](../advanced/session-link-access.md) - Session connectivity and URL generation
- [Session Management](../basics/session-management.md) - Session lifecycle and configuration
- [Browser Use Overview](../../browser-use/README.md) - Browser automation features

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../../README.md)




# Computer Use Guide

Computer Use is AgentBay's desktop automation environment for Windows and Linux systems.

> **üí° Async API Support**: This guide uses synchronous API. For async patterns, see:

## Documentation

- [Application Management](computer-application-management.md) - Desktop application lifecycle management
- [Window Management](window-management.md) - Window control and positioning
- [UI Automation](computer-ui-automation.md) - Mouse and keyboard automation

## Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Main Documentation](../../README.md)




# Browser Capabilities by Image Type

Different image types provide different levels of browser automation capabilities. Understanding these differences is crucial for choosing the right image for your use case.

## Feature Comparison Table

| Feature | Browser Use Image | Computer Use Image (Linux) | Computer Use Image (Windows) |
|---------|-------------------|---------------------------|------------------------------|
| **Image ID** | `browser_latest` | `linux_latest` | `windows_latest` |
| **Browser Initialization** | ‚úÖ Full Support | ‚úÖ Full Support | ‚ùå Not Available |
| **CDP Endpoint Access** | ‚úÖ Available | ‚úÖ Available | ‚ùå Not Available |
| **Playwright/Puppeteer Integration** | ‚úÖ Supported | ‚úÖ Supported | ‚ùå Not Supported |
| **Browser Options** (viewport, user agent, fingerprint) | ‚úÖ All Options | ‚úÖ All Options | ‚ùå Not Available |
| **Browser Type Selection** (Chrome/Chromium) | ‚ùå Chromium Only | ‚úÖ Chrome or Chromium | ‚ùå Not Available |
| **Browser Proxies** | ‚úÖ Supported | ‚úÖ Supported | ‚ùå Not Supported |
| **Browser Context** | ‚úÖ Supported | ‚úÖ Supported | ‚ùå Not Supported |
| **Browser Random Fingerprint** | ‚úÖ Supported | ‚úÖ Supported | ‚úÖ Supported |
| **Browser Fingerprint Local Sync** | ‚úÖ Supported | ‚ùå Not Supported | ‚ùå Not Supported |
| **Browser Fingerprint Construct** | ‚úÖ Supported | ‚ùå Not Supported | ‚ùå Not Supported |
| **Browser Fingerprint Persistence** | ‚úÖ Supported | ‚ùå Not Supported | ‚ùå Not Supported |
| **Browser Command-line Args** | ‚úÖ Supported | ‚úÖ Supported | ‚ùå Not Supported |
| **Browser Default Navigate** | ‚úÖ Supported | ‚úÖ Supported | ‚ùå Not Supported |
| **CAPTCHA Solving** | ‚úÖ Supported | ‚úÖ Supported | ‚ùå Not Supported |
| **Page Use Agent** (AI-powered automation) | ‚úÖ Supported | ‚ùå Not Available | ‚ùå Not Available |
| **Desktop UI Automation** | ‚ùå Not Available | ‚úÖ Supported | ‚úÖ Supported |
| **Window Management** | ‚ùå Not Available | ‚úÖ Supported | ‚úÖ Supported |
| **Best For** | Pure web automation (best performance) | Web + Desktop automation (Linux apps) | Desktop automation only (Windows apps) |

## When to Use Each Image Type

### 1. Browser Use Image (`browser_latest`)

**Use when you only need web browser automation**

- ‚úÖ Provides full browser capabilities including AI-powered Page Use Agent
- ‚úÖ **Best performance and lowest resource cost** for browser automation
- ‚úÖ Optimized specifically for web automation with minimal overhead
- ‚úÖ Best for web scraping, testing, form filling, and web-based workflows
- ‚ùå Cannot control desktop applications or windows
- ‚ÑπÔ∏è Browser type is fixed to Chromium

**Ideal Use Cases:**
- Web scraping and data extraction
- Automated web testing
- Form filling and submission
- Web-based workflow automation
- AI-powered web interactions (Page Use Agent)

### 2. Computer Use Image - Linux (`linux_latest`)

**Use when you need both browser automation AND Linux desktop application control**

- ‚úÖ Provides most browser features except Page Use Agent
- ‚úÖ Can control Linux desktop applications and windows
- ‚úÖ Supports browser type selection between Chrome and Chromium
- ‚úÖ Best for hybrid workflows (web + desktop automation on Linux)
- ‚ÑπÔ∏è Slightly higher resource usage than Browser Use Image

**Ideal Use Cases:**
- Hybrid workflows combining web and desktop automation
- Testing Linux desktop applications
- Browser automation with desktop application integration
- Scenarios requiring both web and window management

### 3. Computer Use Image - Windows (`windows_latest`)

**Use when you only need Windows desktop application automation**

- ‚úÖ Full Windows application and window management
- ‚úÖ Complete desktop UI automation capabilities
- ‚ùå No browser automation capabilities available
- ‚ùå Cannot initialize or control browsers via SDK

**Ideal Use Cases:**
- Windows desktop application automation
- Window management and UI testing
- Office automation (Word, Excel, PowerPoint)
- Legacy Windows application testing

## Code Examples

### Python

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams

api_key = "your_api_key"
agent_bay = AgentBay(api_key=api_key)

# For pure web automation with AI capabilities
params = CreateSessionParams(image_id="browser_latest")
result = agent_bay.create(params)

# For Linux desktop + browser automation (no Page Use Agent)
params = CreateSessionParams(image_id="linux_latest")
result = agent_bay.create(params)

# For Windows desktop automation only (no browser)
params = CreateSessionParams(image_id="windows_latest")
result = agent_bay.create(params)
```

### TypeScript

```typescript
import { AgentBay, CreateSessionParams } from '@wuying-org/agentbay-sdk';

const apiKey = process.env.AGENTBAY_API_KEY;
const agentBay = new AgentBay(apiKey);

// For pure web automation with AI capabilities
const params = new CreateSessionParams({ imageId: 'browser_latest' });
const result = await agentBay.create(params);

// For Linux desktop + browser automation (no Page Use Agent)
const params = new CreateSessionParams({ imageId: 'linux_latest' });
const result = await agentBay.create(params);

// For Windows desktop automation only (no browser)
const params = new CreateSessionParams({ imageId: 'windows_latest' });
const result = await agentBay.create(params);
```

### Golang

```go
import (
	"github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay"
)

apiKey := os.Getenv("AGENTBAY_API_KEY")
agentBay := agentbay.NewAgentBay(apiKey)

// For pure web automation with AI capabilities
params := &agentbay.CreateSessionParams{
	ImageId: "browser_latest",
}
result, err := agentBay.Create(params)

// For Linux desktop + browser automation (no Page Use Agent)
params := &agentbay.CreateSessionParams{
	ImageId: "linux_latest",
}
result, err := agentBay.Create(params)

// For Windows desktop automation only (no browser)
params := &agentbay.CreateSessionParams{
	ImageId: "windows_latest",
}
result, err := agentBay.Create(params)
```

## Decision Guide

### Choose Browser Use Image if:
- ‚úì You only need web browser automation
- ‚úì You want the best performance and lowest cost
- ‚úì You need AI-powered Page Use Agent
- ‚úì You don't need desktop application control

### Choose Computer Use Image (Linux) if:
- ‚úì You need both web AND desktop automation
- ‚úì You need to control Linux applications
- ‚úì You want to switch between Chrome and Chromium
- ‚úì You need window management alongside browser automation

### Choose Computer Use Image (Windows) if:
- ‚úì You only need Windows desktop automation
- ‚úì You need to control Windows applications
- ‚úì You don't need any browser automation
- ‚úì You need full Windows UI automation capabilities

## Important Notes

> **Performance Consideration**: Browser Use Image offers the best performance and lowest resource cost for browser automation, and includes Page Use Agent for AI-powered natural language automation. If you only need manual browser control with Playwright/Puppeteer without desktop features, Browser Use Image is the optimal choice. Use Computer Use Image (Linux) only when you need both browser AND desktop automation capabilities.

> **Page Use Agent Availability**: The AI-powered Page Use Agent is only available in Browser Use Image. If you need natural language browser automation, you must use `browser_latest`.

> **Browser Type Selection**: Only Computer Use Image (Linux) supports choosing between Chrome and Chromium. Browser Use Image is fixed to Chromium, and Computer Use Image (Windows) has no browser support.

## Related Documentation

- [Browser Use Guide](../browser-use/README.md) - Complete browser automation guide
- [Computer Use Guide](README.md) - Desktop automation guide
- [Browser Core Features](../browser-use/core-features.md) - Essential browser features
- [Browser Advanced Features](../browser-use/advance-features.md) - Advanced capabilities
- [Page Use Agent](../browser-use/advance-features/page-use-agent.md) - AI-powered automation





# Application Management for Computer Use

This guide covers application management capabilities for desktop environments (Windows/Linux) using the AgentBay SDK. Learn how to discover, launch, monitor, and control desktop applications in cloud environments.

## üìã Table of Contents

- [Overview](#overview)
- [Prerequisites](#prerequisites)
- [Getting Installed Applications](#getting-installed-applications)
- [Starting Applications](#starting-applications)
- [Stopping Applications](#stopping-applications)
- [Listing Running Applications](#listing-running-applications)
- [Complete Workflow Example](#complete-workflow-example)
- [API Reference](#api-reference)

<a id="overview"></a>
## üéØ Overview

The Computer Use module provides comprehensive application management capabilities for desktop environments:

1. **Application Discovery** - Find installed applications in the system
2. **Application Lifecycle** - Start and stop desktop applications
3. **Process Monitoring** - Track running applications and their processes
4. **Desktop Automation** - Automate complex desktop workflows

These features have been tested and verified on `windows_latest` and `linux_latest` system images.

<a id="prerequisites"></a>
## üì¶ Prerequisites

First, create a session with a desktop environment:

```python
import os
from agentbay import AgentBay
from agentbay import CreateSessionParams

api_key = os.getenv("AGENTBAY_API_KEY")
if not api_key:
    raise ValueError("AGENTBAY_API_KEY environment variable is required")

agent_bay = AgentBay(api_key=api_key)

params = CreateSessionParams(image_id="linux_latest")
result = agent_bay.create(params)

if result.success:
    session = result.session
    print(f"Session created: {session.session_id}")
    # Output: Session created: session-xxxxxxxxxxxxxxxxx
else:
    print(f"Failed to create session: {result.error_message}")
    exit(1)
```

<a id="getting-installed-applications"></a>
## üîç Getting Installed Applications

Discover all applications available in the desktop environment:

```python
result = session.computer.get_installed_apps(
    start_menu=True,
    desktop=False,
    ignore_system_apps=True
)

# Verification: Result type is InstalledAppListResult
# Verification: Success = True
# Verification: Found 76 installed applications on test system

if result.success:
    apps = result.data
    print(f"Found {len(apps)} installed applications")
    # Output: Found 76 installed applications
    
    for app in apps[:5]:
        print(f"Name: {app.name}")
        print(f"Start Command: {app.start_cmd}")
        print(f"Stop Command: {app.stop_cmd if app.stop_cmd else 'N/A'}")
        print(f"Work Directory: {app.work_directory if app.work_directory else 'N/A'}")
        print("---")
    # Output example:
    # Name: AptURL
    # Start Command: apturl %u
    # Stop Command: N/A
    # Work Directory: N/A
    # ---
    # Name: Bluetooth Transfer
    # Start Command: bluetooth-sendto
    # Stop Command: N/A
    # Work Directory: N/A
    # ---
else:
    print(f"Error: {result.error_message}")
```

**Parameters:**
- `start_menu` (bool): Whether to include start menu applications
- `desktop` (bool): Whether to include desktop applications
- `ignore_system_apps` (bool): Whether to filter out system applications

**Returns:**
- `InstalledAppListResult` containing a list of `InstalledApp` objects

<a id="starting-applications"></a>
## üöÄ Starting Applications

Launch desktop applications using their start commands:

### Method 1: Start by Command

```python
start_cmd = "/usr/bin/google-chrome-stable"

result = session.computer.start_app(start_cmd)

# Verification: Result type is ProcessListResult
# Verification: Success = True
# Verification: Started 6 processes (chrome main process + helper processes)

if result.success:
    processes = result.data
    print(f"Application started with {len(processes)} processes")
    # Output: Application started with 6 processes
    
    for process in processes:
        print(f"Process: {process.pname} (PID: {process.pid})")
    # Output example:
    # Process: chrome (PID: 4443)
    # Process: cat (PID: 4448)
    # Process: cat (PID: 4449)
    # Process: chrome (PID: 4459)
    # Process: chrome (PID: 4460)
    # Process: chrome (PID: 4462)
else:
    print(f"Failed to start application: {result.error_message}")
```

### Method 2: Start with Working Directory

```python
start_cmd = "/usr/bin/google-chrome-stable"
work_directory = "/tmp"

result = session.computer.start_app(
    start_cmd=start_cmd,
    work_directory=work_directory
)

# Verification: Result type is ProcessListResult
# Verification: Success = True
# Verification: Application starts in the specified working directory

if result.success:
    processes = result.data
    print(f"Application started with {len(processes)} processes")
    # Output: Application started with 6 processes
else:
    print(f"Failed to start application: {result.error_message}")
```

### Method 3: Start from Installed Apps List

```python
result = session.computer.get_installed_apps(
    start_menu=True,
    desktop=False,
    ignore_system_apps=True
)

# Verification: Successfully retrieves installed apps list

if result.success:
    apps = result.data
    
    target_app = None
    for app in apps:
        if "chrome" in app.name.lower():
            target_app = app
            break
    
    # Verification: Found "Google Chrome" in the apps list
    
    if target_app:
        print(f"Starting {target_app.name}...")
        # Output: Starting Google Chrome...
        
        start_result = session.computer.start_app(target_app.start_cmd)
        
        # Verification: Successfully started the application
        
        if start_result.success:
            print("Application started successfully!")
            # Output: Application started successfully!
        else:
            print(f"Failed to start: {start_result.error_message}")
    else:
        print("Target application not found")
```

<a id="stopping-applications"></a>
## üõë Stopping Applications

Stop running applications using process ID, process name, or stop command:

### Method 1: Stop by Process ID (PID)

```python
start_result = session.computer.start_app("/usr/bin/google-chrome-stable")

# Verification: Application started successfully with multiple processes

if start_result.success:
    target_pid = None
    for process in start_result.data:
        print(f"Process: {process.pname} (PID: {process.pid})")
        # Output example:
        # Process: chrome (PID: 6378)
        # Process: cat (PID: 6383)
        # Process: cat (PID: 6384)
        
        if 'chrome' in process.pname.lower():
            target_pid = process.pid
            break
    
    if target_pid:
        result = session.computer.stop_app_by_pid(target_pid)
        
        # Verification: Result type is AppOperationResult
        # Verification: Success = True
        
        if result.success:
            print(f"Successfully stopped process {target_pid}")
            # Output: Successfully stopped process 6378
        else:
            print(f"Failed to stop process: {result.error_message}")
```

### Method 2: Stop by Process Name

```python
start_result = session.computer.start_app("/usr/bin/google-chrome-stable")

# Verification: Application started successfully

if start_result.success:
    target_pname = None
    for process in start_result.data:
        print(f"Process: {process.pname} (PID: {process.pid})")
        target_pname = process.pname
        break
    
    # Verification: Retrieved process name "chrome"
    
    if target_pname:
        result = session.computer.stop_app_by_pname(target_pname)
        
        # Verification: Result type is AppOperationResult
        # Verification: Success = True
        
        if result.success:
            print(f"Successfully stopped process {target_pname}")
            # Output: Successfully stopped process chrome
        else:
            print(f"Failed to stop process: {result.error_message}")
```

### Method 3: Stop by Stop Command

```python
result = session.computer.get_installed_apps(
    start_menu=True,
    desktop=False,
    ignore_system_apps=True
)

# Verification: Successfully retrieved installed apps

if result.success:
    apps = result.data
    
    target_app = None
    for app in apps:
        if app.stop_cmd:
            target_app = app
            break
    
    # Note: Most desktop apps on Linux don't have stop_cmd defined
    # This is normal - use stop_app_by_pid or stop_app_by_pname instead
    
    if target_app:
        start_result = session.computer.start_app(target_app.start_cmd)
        
        if start_result.success:
            print("Application started successfully!")
            
            result = session.computer.stop_app_by_cmd(target_app.stop_cmd)
            
            # Verification: Result type is AppOperationResult
            
            if result.success:
                print("Successfully stopped application using command")
            else:
                print(f"Failed to stop application: {result.error_message}")
```

<a id="listing-running-applications"></a>
## üìä Listing Running Applications

Monitor currently running applications with visible windows:

```python
result = session.computer.list_visible_apps()

# Verification: Result type is ProcessListResult
# Verification: Success = True
# Verification: Found 1 visible application (chrome with visible window)

if result.success:
    visible_apps = result.data
    print(f"Found {len(visible_apps)} running applications")
    # Output: Found 1 running applications
    
    for app in visible_apps:
        print(f"Process: {app.pname}")
        print(f"PID: {app.pid}")
        print(f"Command: {app.cmdline}")
        print("---")
    # Output example:
    # Process: chrome
    # PID: 6378
    # Command: /opt/google/chrome/chrome
    # ---
else:
    print(f"Error: {result.error_message}")
```

**Process Object Properties:**
- `pname` (str): Process name
- `pid` (int): Process ID
- `cmdline` (str): Full command line used to start the process

<a id="complete-workflow-example"></a>
## üîÑ Complete Workflow Example

Complete example showing how to find, launch, and control a desktop application:

```python
import os
import time
from agentbay import AgentBay
from agentbay import CreateSessionParams

api_key = os.getenv("AGENTBAY_API_KEY")
if not api_key:
    raise ValueError("AGENTBAY_API_KEY environment variable is required")

agent_bay = AgentBay(api_key=api_key)

params = CreateSessionParams(image_id="linux_latest")
result = agent_bay.create(params)

if not result.success:
    print(f"Failed to create session: {result.error_message}")
    exit(1)

session = result.session
print(f"Session created: {session.session_id}")
# Output: Session created: session-xxxxxxxxxxxxxxxxx

print("Step 1: Finding installed applications...")
apps_result = session.computer.get_installed_apps(
    start_menu=True,
    desktop=False,
    ignore_system_apps=True
)

# Verification: Successfully retrieved 76 applications

if not apps_result.success:
    print(f"Failed to get apps: {apps_result.error_message}")
    agent_bay.delete(session)
    exit(1)

target_app = None
for app in apps_result.data:
    if "chrome" in app.name.lower():
        target_app = app
        break

# Verification: Found "Google Chrome" application

if not target_app:
    print("Google Chrome not found")
    agent_bay.delete(session)
    exit(1)

print(f"Found application: {target_app.name}")
# Output: Found application: Google Chrome

print("Step 2: Launching application...")
start_result = session.computer.start_app(target_app.start_cmd)

# Verification: Successfully started with 6 processes

if not start_result.success:
    print(f"Failed to start app: {start_result.error_message}")
    agent_bay.delete(session)
    exit(1)

print(f"Application started with {len(start_result.data)} processes")
# Output: Application started with 6 processes

for process in start_result.data:
    print(f"  - {process.pname} (PID: {process.pid})")
# Output example:
#   - chrome (PID: 6420)
#   - cat (PID: 6425)
#   - cat (PID: 6426)
#   - chrome (PID: 6436)
#   - chrome (PID: 6437)
#   - chrome (PID: 6439)

print("Step 3: Waiting for application to load...")
time.sleep(5)

print("Step 4: Checking running applications...")
visible_result = session.computer.list_visible_apps()

# Verification: Found 1 visible application

if visible_result.success:
    print(f"Found {len(visible_result.data)} visible applications")
    # Output: Found 1 visible applications

print("Step 5: Stopping application...")
if start_result.data:
    stop_result = session.computer.stop_app_by_pid(start_result.data[0].pid)
    
    # Verification: Successfully stopped the application
    
    if stop_result.success:
        print("Application stopped successfully")
        # Output: Application stopped successfully
    else:
        print(f"Failed to stop application: {stop_result.error_message}")

print("Cleaning up session...")
agent_bay.delete(session)
print("Workflow completed!")
# Output: Workflow completed!

# === Complete Workflow Verification Results ===
# ‚úì Session creation: Success
# ‚úì Get installed apps: 76 applications found
# ‚úì Find target app: Google Chrome found
# ‚úì Start application: 6 processes started
# ‚úì List visible apps: 1 visible application
# ‚úì Stop application: Successfully stopped
# ‚úì Session cleanup: Success
```

<a id="api-reference"></a>
## üìö API Reference

### Computer Application Management Methods

All application management methods are accessed through `session.computer.*`:

| Method | Parameters | Returns | Description |
|--------|------------|---------|-------------|
| `get_installed_apps()` | `start_menu: bool = True`<br/>`desktop: bool = False`<br/>`ignore_system_apps: bool = True` | `InstalledAppListResult` | Get list of installed applications |
| `start_app()` | `start_cmd: str`<br/>`work_directory: str = ""`<br/>`activity: str = ""` | `ProcessListResult` | Start an application |
| `stop_app_by_pid()` | `pid: int` | `AppOperationResult` | Stop application by process ID |
| `stop_app_by_pname()` | `pname: str` | `AppOperationResult` | Stop application by process name |
| `stop_app_by_cmd()` | `stop_cmd: str` | `AppOperationResult` | Stop application by stop command |
| `list_visible_apps()` | None | `ProcessListResult` | List currently visible applications |

### Return Types

**InstalledAppListResult**
- `success` (bool): Whether the operation succeeded
- `data` (List[InstalledApp]): List of installed applications
- `error_message` (str): Error message if operation failed
- `request_id` (str): Unique request identifier

**InstalledApp**
- `name` (str): Application name
- `start_cmd` (str): Command to start the application
- `stop_cmd` (Optional[str]): Command to stop the application
- `work_directory` (Optional[str]): Working directory for the application

**ProcessListResult**
- `success` (bool): Whether the operation succeeded
- `data` (List[Process]): List of process objects
- `error_message` (str): Error message if operation failed
- `request_id` (str): Unique request identifier

**Process**
- `pname` (str): Process name
- `pid` (int): Process ID
- `cmdline` (Optional[str]): Full command line

**AppOperationResult**
- `success` (bool): Whether the operation succeeded
- `error_message` (str): Error message if operation failed
- `request_id` (str): Unique request identifier

## üéØ Summary

This guide covered desktop application management capabilities:

- **Application Discovery**: Find installed desktop applications
- **Application Lifecycle**: Start and stop applications reliably
- **Process Monitoring**: Track running processes
- **Desktop Automation**: Build automated desktop workflows

These features enable you to build sophisticated desktop automation solutions for testing, workflow automation, and remote desktop management scenarios using AgentBay SDK's Computer Use capabilities.

## üìö Related Guides

- [Computer UI Automation](computer-ui-automation.md) - Mouse and keyboard automation
- [Window Management](window-management.md) - Window control and positioning
- [Session Management](../common-features/basics/session-management.md) - Session lifecycle and configuration
- [Command Execution](../common-features/basics/command-execution.md) - Execute shell commands

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../README.md)




# Computer UI Automation Guide

This guide covers computer UI automation capabilities in AgentBay SDK for desktop environments, including mouse operations, keyboard operations, and screen operations.

**Verified System Images:** These features have been verified to work with `windows_latest` and `linux_latest` system images.

## üìã Table of Contents

- [Overview](#overview)
- [Prerequisites](#prerequisites)
- [Mouse Operations](#mouse-operations)
- [Keyboard Operations](#keyboard-operations)
- [Screen Operations](#screen-operations)
- [Troubleshooting](#troubleshooting)

<a id="overview"></a>
## üéØ Overview

AgentBay provides powerful computer UI automation capabilities for interacting with Windows desktop environments in the cloud. You can:

1. **Mouse Operations** - Click, move, drag, and scroll with precise control
2. **Keyboard Operations** - Type text and send key combinations
3. **Screen Operations** - Capture screenshots and get screen information

All operations are performed through the `session.computer` module, which provides a comprehensive API for desktop automation tasks.

<a id="prerequisites"></a>
## ‚öôÔ∏è Prerequisites

Computer UI automation requires creating a session with a computer use system image:

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams

agent_bay = AgentBay()
# Use windows_latest or linux_latest
session_params = CreateSessionParams(image_id="windows_latest")
session = agent_bay.create(session_params).session
```

<a id="mouse-operations"></a>
## üñ±Ô∏è Mouse Operations

### Click Operations

The `click_mouse()` method supports multiple click types. You can use the `MouseButton` enum for type safety:

```python
from agentbay import MouseButton

session_params = CreateSessionParams(image_id="windows_latest")
session = agent_bay.create(session_params).session

# Left click
result = session.computer.click_mouse(x=500, y=300, button=MouseButton.LEFT)
if result.success:
    print("Left click successful")
# Output: Left click successful

# Right click
result = session.computer.click_mouse(x=500, y=300, button=MouseButton.RIGHT)
if result.success:
    print("Right click successful")
# Output: Right click successful

# Middle click
result = session.computer.click_mouse(x=500, y=300, button=MouseButton.MIDDLE)
if result.success:
    print("Middle click successful")
# Output: Middle click successful

# Double left click
result = session.computer.click_mouse(x=500, y=300, button=MouseButton.DOUBLE_LEFT)
if result.success:
    print("Double click successful")
# Output: Double click successful

agent_bay.delete(session)
```

**Supported button types:** `MouseButton.LEFT`, `MouseButton.RIGHT`, `MouseButton.MIDDLE`, `MouseButton.DOUBLE_LEFT`

### Move Mouse

Move the mouse cursor to specific coordinates:

```python
session_params = CreateSessionParams(image_id="windows_latest")
session = agent_bay.create(session_params).session

result = session.computer.move_mouse(x=600, y=400)
if result.success:
    print("Mouse moved successfully")
# Output: Mouse moved successfully

agent_bay.delete(session)
```

### Drag Operations

Drag the mouse from one point to another using the `MouseButton` enum:

```python
from agentbay import MouseButton

session_params = CreateSessionParams(image_id="windows_latest")
session = agent_bay.create(session_params).session

# Drag with left button
result = session.computer.drag_mouse(
    from_x=100, 
    from_y=100, 
    to_x=200, 
    to_y=200, 
    button=MouseButton.LEFT
)
if result.success:
    print("Drag operation successful")
# Output: Drag operation successful

agent_bay.delete(session)
```

**Supported button types for drag:** `MouseButton.LEFT`, `MouseButton.RIGHT`, `MouseButton.MIDDLE`

### Scroll Operations

Scroll the mouse wheel at specific coordinates using the `ScrollDirection` enum:

```python
from agentbay import ScrollDirection

session_params = CreateSessionParams(image_id="windows_latest")
session = agent_bay.create(session_params).session

# Scroll up
result = session.computer.scroll(x=500, y=500, direction=ScrollDirection.UP, amount=3)
if result.success:
    print("Scrolled up successfully")
# Output: Scrolled up successfully

# Scroll down
result = session.computer.scroll(x=500, y=500, direction=ScrollDirection.DOWN, amount=5)
if result.success:
    print("Scrolled down successfully")
# Output: Scrolled down successfully

agent_bay.delete(session)
```

**Supported directions:** `ScrollDirection.UP`, `ScrollDirection.DOWN`, `ScrollDirection.LEFT`, `ScrollDirection.RIGHT`

### Get Cursor Position

Retrieve the current mouse cursor position:

```python
import json

session_params = CreateSessionParams(image_id="windows_latest")
session = agent_bay.create(session_params).session

result = session.computer.get_cursor_position()
if result.success:
    cursor_data = json.loads(result.data)
    print(f"Cursor at x={cursor_data['x']}, y={cursor_data['y']}")
# Output: Cursor at x=512, y=384

agent_bay.delete(session)
```

<a id="keyboard-operations"></a>
## ‚å®Ô∏è Keyboard Operations

### Text Input

Type text into the active window or field:

```python
session_params = CreateSessionParams(image_id="windows_latest")
session = agent_bay.create(session_params).session

result = session.computer.input_text("Hello AgentBay!")
if result.success:
    print("Text input successful")
# Output: Text input successful

agent_bay.delete(session)
```

### Press Keys

Press key combinations (supports modifier keys):

```python
session_params = CreateSessionParams(image_id="windows_latest")
session = agent_bay.create(session_params).session

# Press Ctrl+A to select all
result = session.computer.press_keys(keys=["Ctrl", "a"])
if result.success:
    print("Keys pressed successfully")
# Output: Keys pressed successfully

# Press Ctrl+C to copy
result = session.computer.press_keys(keys=["Ctrl", "c"])
if result.success:
    print("Copy command sent")
# Output: Copy command sent

agent_bay.delete(session)
```

### Release Keys

Release specific keys (useful when keys are held):

```python
session_params = CreateSessionParams(image_id="windows_latest")
session = agent_bay.create(session_params).session

# Hold Ctrl key
session.computer.press_keys(keys=["Ctrl"], hold=True)

# ... perform other operations ...

# Release Ctrl key
result = session.computer.release_keys(keys=["Ctrl"])
if result.success:
    print("Keys released successfully")
# Output: Keys released successfully

agent_bay.delete(session)
```

<a id="screen-operations"></a>
## üì∏ Screen Operations

### Take Screenshot

Capture a screenshot of the current screen. The screenshot is saved to cloud storage and a download URL is returned:

```python
session_params = CreateSessionParams(image_id="windows_latest")
session = agent_bay.create(session_params).session

result = session.computer.screenshot()
if result.success:
    screenshot_url = result.data
    print(f"Screenshot URL: {screenshot_url}")
# Output: Screenshot URL: https://***.***.aliyuncs.com/***/screenshot_1234567890.png?***

agent_bay.delete(session)
```

### Get Screen Size

Retrieve screen dimensions and DPI scaling factor:

```python
import json

session_params = CreateSessionParams(image_id="windows_latest")
session = agent_bay.create(session_params).session

result = session.computer.get_screen_size()
if result.success:
    screen_data = json.loads(result.data)
    print(f"Screen width: {screen_data['width']}")
    print(f"Screen height: {screen_data['height']}")
    print(f"DPI scaling factor: {screen_data['dpiScalingFactor']}")
# Output: Screen width: 1024
# Output: Screen height: 768
# Output: DPI scaling factor: 1.0

agent_bay.delete(session)
```

<a id="troubleshooting"></a>
## üÜò Troubleshooting

### Common Issues

1. **"Tool not found" errors**
   - Ensure you're using a computer use image (`windows_latest` or `linux_latest`)

3. **Screenshot URL handling**
   - The screenshot is saved to cloud storage (OSS)
   - `result.data` contains a download URL, not the image data
   - Use the URL to download the screenshot if needed

### Getting Help

For more assistance:
- Review [Session Management Guide](../common-features/basics/session-management.md)

## üìö Related Guides

- [Session Management Guide](../common-features/basics/session-management.md) - Learn about session lifecycle
- [Computer Application Management](computer-application-management.md) - Manage applications
- [Window Management](window-management.md) - Manage windows
- [Command Execution](../common-features/basics/command-execution.md) - Execute shell commands
- [Mobile UI Automation](../mobile-use/mobile-ui-automation.md) - Mobile device automation




# Window Management for Computer Use

This guide covers window management capabilities for desktop environments (Windows/Linux) using the AgentBay SDK. Learn how to control window states, positions, focus, and interact with desktop windows in cloud environments.

## üìã Table of Contents

- [Overview](#overview)
- [Prerequisites](#prerequisites)
- [Listing Windows](#listing-windows)
- [Window Control Operations](#window-control-operations)
- [Focus Management](#focus-management)
- [Getting Active Window](#getting-active-window)
- [Complete Workflow Example](#complete-workflow-example)
- [API Reference](#api-reference)

<a id="overview"></a>
## üéØ Overview

The Computer Use module provides comprehensive window management capabilities for desktop environments:

1. **Window Discovery** - List and find windows in the system
2. **Window State Control** - Maximize, minimize, restore, and close windows
3. **Window Positioning** - Resize and reposition windows
4. **Focus Management** - Control window focus and activation
5. **Desktop Automation** - Build complex desktop automation workflows

These features have been verified with `windows_latest` and `linux_latest` system images.

<a id="prerequisites"></a>
## üì¶ Prerequisites

First, create a session with a desktop environment:

```python
import os
from agentbay import AgentBay
from agentbay import CreateSessionParams

api_key = os.getenv("AGENTBAY_API_KEY")
if not api_key:
    raise ValueError("AGENTBAY_API_KEY environment variable is required")

agent_bay = AgentBay(api_key=api_key)

params = CreateSessionParams(image_id="linux_latest")
result = agent_bay.create(params)

if result.success:
    session = result.session
    print(f"Session created: {session.session_id}")
else:
    print(f"Failed to create session: {result.error_message}")
    exit(1)
```

<a id="listing-windows"></a>
## üîç Listing Windows

Get information about all available windows in the desktop environment:

```python
result = session.computer.list_root_windows(timeout_ms=5000)

if result.success:
    windows = result.windows
    print(f"Found {len(windows)} windows")
    # Execution result: Found 0 windows (when no windows are open)
    # or: Found 5 windows (when applications are running)
    
    for window in windows:
        print(f"Title: {window.title}")
        # Execution result: Title: Google Chrome
        print(f"Window ID: {window.window_id}")
        # Execution result: Window ID: 12345678
        print(f"Process: {window.pname if window.pname else 'N/A'}")
        # Execution result: Process: chrome
        print(f"PID: {window.pid if window.pid else 'N/A'}")
        # Execution result: PID: 9876
        print(f"Position: ({window.absolute_upper_left_x}, {window.absolute_upper_left_y})")
        # Execution result: Position: (100, 50)
        print(f"Size: {window.width}x{window.height}")
        # Execution result: Size: 1280x720
        print(f"Child Windows: {len(window.child_windows)}")
        # Execution result: Child Windows: 0
        print("---")
else:
    print(f"Error listing windows: {result.error_message}")
```

**Parameters:**
- `timeout_ms` (int, optional): Timeout in milliseconds. Defaults to 3000.

**Window Object Properties:**
- `window_id` (int): Unique identifier for the window
- `title` (str): Window title/caption
- `absolute_upper_left_x` (Optional[int]): X-coordinate of window's upper-left corner
- `absolute_upper_left_y` (Optional[int]): Y-coordinate of window's upper-left corner
- `width` (Optional[int]): Window width in pixels
- `height` (Optional[int]): Window height in pixels
- `pid` (Optional[int]): Process ID that owns the window
- `pname` (Optional[str]): Process name that owns the window
- `child_windows` (List[Window]): List of child windows

<a id="window-control-operations"></a>
## üéõÔ∏è Window Control Operations

Control window states and positions:

### Activate Window

```python
result = session.computer.list_root_windows()

if result.success and result.windows:
    window_id = result.windows[0].window_id
    
    activate_result = session.computer.activate_window(window_id)
    # Execution result: Window activated successfully
    
    if activate_result.success:
        print("Window activated successfully")
    else:
        print(f"Failed to activate window: {activate_result.error_message}")
```

### Maximize Window

```python
result = session.computer.list_root_windows()

if result.success and result.windows:
    window_id = result.windows[0].window_id
    
    maximize_result = session.computer.maximize_window(window_id)
    # Execution result: Window maximized successfully
    
    if maximize_result.success:
        print("Window maximized successfully")
    else:
        print(f"Failed to maximize window: {maximize_result.error_message}")
```

### Minimize Window

```python
result = session.computer.list_root_windows()

if result.success and result.windows:
    window_id = result.windows[0].window_id
    
    minimize_result = session.computer.minimize_window(window_id)
    # Execution result: Window minimized successfully
    
    if minimize_result.success:
        print("Window minimized successfully")
    else:
        print(f"Failed to minimize window: {minimize_result.error_message}")
```

### Restore Window

```python
result = session.computer.list_root_windows()

if result.success and result.windows:
    window_id = result.windows[0].window_id
    
    restore_result = session.computer.restore_window(window_id)
    # Execution result: Window restored successfully
    
    if restore_result.success:
        print("Window restored successfully")
    else:
        print(f"Failed to restore window: {restore_result.error_message}")
```

### Resize Window

```python
result = session.computer.list_root_windows()

if result.success and result.windows:
    window_id = result.windows[0].window_id
    
    resize_result = session.computer.resize_window(window_id, 800, 600)
    # Execution result: Window resized to 800x600
    
    if resize_result.success:
        print("Window resized to 800x600")
    else:
        print(f"Failed to resize window: {resize_result.error_message}")
```

### Fullscreen Window

```python
result = session.computer.list_root_windows()

if result.success and result.windows:
    window_id = result.windows[0].window_id
    
    fullscreen_result = session.computer.fullscreen_window(window_id)
    # Execution result: Window set to fullscreen
    
    if fullscreen_result.success:
        print("Window set to fullscreen")
    else:
        print(f"Failed to set fullscreen: {fullscreen_result.error_message}")
```

### Close Window

```python
# Note: Use with caution as it permanently closes windows
result = session.computer.list_root_windows()

if result.success and result.windows:
    window_id = result.windows[0].window_id
    
    close_result = session.computer.close_window(window_id)
    
    if close_result.success:
        print("Window closed successfully")
    else:
        print(f"Failed to close window: {close_result.error_message}")
```

### Complete Window Control Function

```python
import time

def control_window(session, window_id):
    print(f"Controlling window ID: {window_id}")
    
    try:
        session.computer.activate_window(window_id)
        print("Window activated")
    except Exception as e:
        print(f"Failed to activate: {e}")
    
    time.sleep(1)
    
    try:
        session.computer.maximize_window(window_id)
        print("Window maximized")
    except Exception as e:
        print(f"Failed to maximize: {e}")
    
    time.sleep(1)
    
    try:
        session.computer.minimize_window(window_id)
        print("Window minimized")
    except Exception as e:
        print(f"Failed to minimize: {e}")
    
    time.sleep(1)
    
    try:
        session.computer.restore_window(window_id)
        print("Window restored")
    except Exception as e:
        print(f"Failed to restore: {e}")
    
    try:
        session.computer.resize_window(window_id, 800, 600)
        print("Window resized to 800x600")
    except Exception as e:
        print(f"Failed to resize: {e}")

windows = session.computer.list_root_windows()
if windows.success and windows.windows:
    control_window(session, windows.windows[0].window_id)
```

<a id="focus-management"></a>
## üéØ Focus Management

Control system focus behavior to prevent focus stealing:

```python
try:
    session.computer.focus_mode(True)
    # Execution result: Focus mode enabled - windows won't steal focus
    print("Focus mode enabled - windows won't steal focus")
except Exception as e:
    print(f"Failed to enable focus mode: {e}")

try:
    session.computer.focus_mode(False)
    # Execution result: Focus mode disabled
    print("Focus mode disabled")
except Exception as e:
    print(f"Failed to disable focus mode: {e}")
```

**Parameters:**
- `on` (bool): True to enable focus mode, False to disable it

<a id="getting-active-window"></a>
## üñ•Ô∏è Getting Active Window

Get information about the currently active window:

```python
# Note: May fail if no window is currently active
result = session.computer.get_active_window(timeout_ms=5000)

if result.success:
    active_window = result.window
    # Execution result when window is active:
    # Active Window:
    #   Title: Google Chrome
    #   Window ID: 87654321
    #   Process: chrome
    #   PID: 4321
    #   Position: (0, 0)
    #   Size: 1920x1080
    print(f"Active Window:")
    print(f"  Title: {active_window.title}")
    print(f"  Window ID: {active_window.window_id}")
    print(f"  Process: {active_window.pname}")
    print(f"  PID: {active_window.pid}")
    print(f"  Position: ({active_window.absolute_upper_left_x}, {active_window.absolute_upper_left_y})")
    print(f"  Size: {active_window.width}x{active_window.height}")
else:
    # Execution result when no window is active:
    # Failed to get active window: Error in response (expected if no window is active)
    print(f"Failed to get active window: {result.error_message}")
```

**Parameters:**
- `timeout_ms` (int, optional): Timeout in milliseconds. Defaults to 3000.

<a id="complete-workflow-example"></a>
## üîÑ Complete Workflow Example

Complete example showing how to launch an application and control its window:

```python
import os
import time
from agentbay import AgentBay
from agentbay import CreateSessionParams

api_key = os.getenv("AGENTBAY_API_KEY")
if not api_key:
    raise ValueError("AGENTBAY_API_KEY environment variable is required")

agent_bay = AgentBay(api_key=api_key)

params = CreateSessionParams(image_id="linux_latest")
result = agent_bay.create(params)

if not result.success:
    print(f"Failed to create session: {result.error_message}")
    exit(1)

session = result.session
print(f"Session created: {session.session_id}")
# Execution result: Session created: session-04bdwfj7u688ec96t

print("Step 1: Finding installed applications...")
apps_result = session.computer.get_installed_apps(
    start_menu=True,
    desktop=False,
    ignore_system_apps=True
)
# Execution result: Found 76 applications

if not apps_result.success:
    print(f"Failed to get apps: {apps_result.error_message}")
    agent_bay.delete(session)
    exit(1)

target_app = None
for app in apps_result.data:
    if "chrome" in app.name.lower():
        target_app = app
        break

if not target_app:
    print("Google Chrome not found")
    agent_bay.delete(session)
    exit(1)

print(f"Found application: {target_app.name}")
# Execution result: Found application: Google Chrome

print("Step 2: Launching application...")
start_result = session.computer.start_app(target_app.start_cmd)

if not start_result.success:
    print(f"Failed to start app: {start_result.error_message}")
    agent_bay.delete(session)
    exit(1)

print(f"Application started with {len(start_result.data)} processes")
# Execution result: Application started with 6 processes

print("Step 3: Waiting for application window to load...")
time.sleep(5)

print("Step 4: Finding application window...")
windows_result = session.computer.list_root_windows()

if not windows_result.success:
    print(f"Failed to list windows: {windows_result.error_message}")
    agent_bay.delete(session)
    exit(1)

app_window = None
for window in windows_result.windows:
    if target_app.name.lower() in window.title.lower():
        app_window = window
        break

if not app_window and windows_result.windows:
    app_window = windows_result.windows[0]
    print("Using first available window")

if app_window:
    print(f"Found window: {app_window.title}")
    # Execution result: Found window: Welcome to Google Chrome
    
    print("Step 5: Controlling the window...")
    try:
        session.computer.activate_window(app_window.window_id)
        print("Window activated")
        # Execution result: Window activated
        
        time.sleep(1)
        session.computer.maximize_window(app_window.window_id)
        print("Window maximized")
        # Execution result: Window maximized
        
        time.sleep(1)
        session.computer.resize_window(app_window.window_id, 1024, 768)
        print("Window resized to 1024x768")
        # Execution result: Window resized to 1024x768
        
    except Exception as e:
        print(f"Window control failed: {e}")

print("Cleaning up session...")
agent_bay.delete(session)
print("Workflow completed!")
# Execution result: Session deleted successfully
```

<a id="api-reference"></a>
## üìö API Reference

### Window Manager Methods

| Method | Parameters | Returns | Description |
|--------|------------|---------|-------------|
| `list_root_windows()` | `timeout_ms: int = 3000` | `WindowListResult` | List all root windows |
| `get_active_window()` | `timeout_ms: int = 3000` | `WindowInfoResult` | Get currently active window |
| `activate_window()` | `window_id: int` | `BoolResult` | Activate a window |
| `maximize_window()` | `window_id: int` | `BoolResult` | Maximize a window |
| `minimize_window()` | `window_id: int` | `BoolResult` | Minimize a window |
| `restore_window()` | `window_id: int` | `BoolResult` | Restore a window |
| `close_window()` | `window_id: int` | `BoolResult` | Close a window |
| `fullscreen_window()` | `window_id: int` | `BoolResult` | Make window fullscreen |
| `resize_window()` | `window_id: int`<br/>`width: int`<br/>`height: int` | `BoolResult` | Resize a window |
| `focus_mode()` | `on: bool` | `BoolResult` | Toggle focus mode |

### Return Types

**WindowListResult**
- `success` (bool): Whether the operation succeeded
- `windows` (List[Window]): List of window objects
- `error_message` (str): Error message if operation failed
- `request_id` (str): Unique request identifier

**Window**
- `window_id` (int): Unique identifier for the window
- `title` (str): Window title/caption
- `absolute_upper_left_x` (Optional[int]): X-coordinate of upper-left corner
- `absolute_upper_left_y` (Optional[int]): Y-coordinate of upper-left corner
- `width` (Optional[int]): Window width in pixels
- `height` (Optional[int]): Window height in pixels
- `pid` (Optional[int]): Process ID that owns the window
- `pname` (Optional[str]): Process name that owns the window
- `child_windows` (List[Window]): List of child windows

**WindowInfoResult**
- `success` (bool): Whether the operation succeeded
- `window` (Window): Window object
- `error_message` (str): Error message if operation failed
- `request_id` (str): Unique request identifier

**BoolResult**
- `success` (bool): Whether the operation succeeded
- `data` (bool): Operation result data
- `error_message` (str): Error message if operation failed
- `request_id` (str): Unique request identifier

## üéØ Summary

This guide covered desktop window management capabilities:

- **Window Discovery**: List and find windows in the system
- **Window Control**: Manage window states (maximize, minimize, restore, close)
- **Window Positioning**: Resize and reposition windows
- **Focus Management**: Control window focus and activation

These features enable you to build sophisticated desktop automation solutions that can interact with any application window in cloud environments, making AgentBay SDK's Computer Use module a powerful tool for automated testing, workflow automation, and remote desktop management.

## üìö Related Guides

- [Computer UI Automation](computer-ui-automation.md) - Mouse and keyboard automation
- [Computer Application Management](computer-application-management.md) - Manage applications
- [Session Management](../common-features/basics/session-management.md) - Session lifecycle and configuration
- [Command Execution](../common-features/basics/command-execution.md) - Execute shell commands

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../README.md)




# Mobile Use Guide

Mobile Use is AgentBay's mobile device automation environment for Android devices.

> **üí° Async API Support**: This guide uses synchronous API. For async patterns, see:

## Documentation

- [Application Management](mobile-application-management.md) - Mobile app lifecycle management
- [UI Automation](mobile-ui-automation.md) - Touch gestures and UI interaction
- [Mobile Device Simulation](mobile-simulate.md) - Simulate different mobile devices with specific characteristics
- [ADB Connection](adb-connection.md) - Connect and control devices via Android Debug Bridge

## Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Main Documentation](../../README.md)




# ADB Connection Guide

This guide explains how to use the `getAdbUrl` method to connect to mobile sessions in AgentBay cloud environment via ADB (Android Debug Bridge).

## Overview

The `getAdbUrl` method provides an ADB connection URL that allows you to use standard ADB commands to interact with mobile sessions running in AgentBay cloud. This enables you to use ADB tools from your local machine to control and debug cloud-based mobile devices.

## Prerequisites

1. **Mobile Session**: A session created with a mobile environment image (e.g., `mobile_latest`)
2. **ADB Tool**: ADB installed on your local machine
3. **API Key**: Valid AgentBay API key

> **Note**: For ADB installation instructions, please refer to the [official Android documentation](https://developer.android.com/studio/command-line/adb).

## Usage Restrictions

‚ö†Ô∏è **Important**: The `getAdbUrl` method is **only available in mobile environments**.

- ‚úÖ **Supported**: Sessions created with mobile environment images (e.g., `mobile_latest`)
- ‚ùå **Not Supported**: Browser, Linux, or other non-mobile environment images

If you attempt to use this method with a non-mobile session, you will receive an error indicating that the operation is only supported in mobile environments.

## Step-by-Step Guide

### Step 1: Obtain Your ADB Public Key

The `getAdbUrl` method requires your ADB public key for device authentication. You need to provide your actual ADB public key to establish an authorized connection.

**Locate your ADB public key:**

```bash
# ADB public key is typically located at:
# - Linux/macOS: ~/.android/adbkey.pub
# - Windows: %USERPROFILE%\.android\adbkey.pub

# View your ADB public key
cat ~/.android/adbkey.pub
```

Example output:
```
QAAAAI/NTd6RTmNt3enWSGR8iqLQF1/TkNWcMSxmy9vAqQkn6xha/lCkxtiQV4LYJ8nRbCiWIyCaslUCG2dFBcd9nPhhUTHvdMzYjf6DNJH3J0mPmErWrB0tg2BVPZ2eFNG7HnKmi+bztVLBJYx6NS/54Ki5rbWgqNPjRw5riOPtXJsu3KwVS1VMTI8VuBX+Xg401NW3tjrOfybf6fWnqKFpPX+B6dFASm3eIIye5tkhbuG4cNYURLpf10tyv9bssYi0Vdr0GcmTH9yQ0rDVn4L/n2HPa6eLuuX0WYQyj8uD2fKUryunOCbi95k1ZCQMt+ZTZRK+MvaZfly5QA2mNeQ7LURyMDi3g3C6J8Tu+8uzgrwBUPvdSwiTnht4ZyDjGr8JB+lDiDf5LfB52+Npl4wKBiMV2J/aa3FyBgzFEMRKtnRa+r1u2zB6e2LNG8xkDHVF3L7ODeI5QHDkTwz1X9betVss5mV5sALv45nfzOLo4IbAR94eH9jj3j+E8mclHKDqhpkR8KRoh/K4mHQCg+a3Qz3JTaO6ddLqqFN+wCn/7YnHfPfH3HF8m9CXEoPIhFAsWI7H3LH4lZ9AZZqVm3IZJ4UrSbR2pX7a1D4R+Cd7JcantfxmyXrc8K7Ui1/2W9qZkz9cczqnnQTNciqa0i7xITVNFtLGFWfCeEe/wFAds2qn+GKcSwEAAQA= user@hostname
```

**Read the key in Python:**

```python
import os

# Read your ADB public key
adbkey_path = os.path.expanduser('~/.android/adbkey.pub')
with open(adbkey_path, 'r') as f:
    adbkey_pub = f.read().strip()

print(f"ADB key loaded (first 50 chars): {adbkey_pub[:50]}...")
```

> **Important**: You must use your actual ADB public key. Using a test string will result in an "unauthorized" device status, and ADB commands will fail.

### Step 2: Create a Mobile Session

```python
from agentbay import AgentBay

# Initialize AgentBay client
client = AgentBay(api_key="your_api_key")

# Create a mobile session
result = client.create(image_id="mobile_latest")
session = result.session

print(f"Session created: {session.session_id}")
```

### Step 3: Get ADB Connection URL

```python
# Get ADB connection URL using your real ADB public key
adb_result = session.mobile.get_adb_url(adbkey_pub=adbkey_pub)

if adb_result.success:
    print(f"ADB URL: {adb_result.data}")
    print(f"Request ID: {adb_result.request_id}")
else:
    print(f"Error: {adb_result.error_message}")
```

Expected output:
```
ADB URL: adb connect 47.99.76.99:54321
Request ID: 1234567890ABCDEF
```

The returned URL format is: `adb connect <IP>:<Port>`

### Step 4: Connect to the Device via ADB

The returned URL is a complete ADB connect command. Simply copy and execute it:

```python
# The returned URL is already a complete command
# URL format: "adb connect 47.99.76.99:54321"
adb_url = adb_result.data
print(f"Run this command: {adb_url}")
```

Execute the command in your terminal:

```bash
# Copy and run the command from the output
adb connect 47.99.76.99:54321
```

Expected output:
```
connected to 47.99.76.99:54321
```

### Step 5: Verify the Connection

```bash
# List connected devices
adb devices
```

Expected output:
```
List of devices attached
47.99.76.99:54321    device
```

The device status should be `device` (not `offline` or `unauthorized`).

If the device shows as `unauthorized`, you need to use your actual ADB public key (see Step 1).

### Step 6: Use ADB Commands

Once connected, you can use any standard ADB command:

```bash
# Get device information
adb shell getprop ro.product.model
# Output: wuying android14

# List installed packages
adb shell pm list packages
# Output: package:com.android.providers.media.module
#         package:com.android.modulemetadata
#         ...

# Take a screenshot
adb shell screencap -p /sdcard/screenshot.png
adb pull /sdcard/screenshot.png
# Output: /sdcard/screenshot.png: 1 file pulled...

# View real-time logs (press Ctrl+C to stop)
adb logcat

# Install an application
adb install app.apk

# Access device shell
adb shell
# You'll get an interactive shell prompt
```

### Step 7: Disconnect and Cleanup

```bash
# Disconnect from the device
adb disconnect 47.99.76.99:54321
```

```python
# Delete the session when done
session.delete()
print("Session deleted")
```

## Complete Example

Here's a complete Python example that demonstrates the full workflow:

```python
from agentbay import AgentBay
import subprocess
import time

def main():
    # Step 1: Read ADB public key
    import os
    adbkey_path = os.path.expanduser('~/.android/adbkey.pub')
    with open(adbkey_path, 'r') as f:
        adbkey_pub = f.read().strip()
    print(f"ADB key loaded (first 50 chars): {adbkey_pub[:50]}...")
    
    # Initialize client
    client = AgentBay(api_key="your_api_key")
    
    try:
        # Step 2: Create mobile session
        print("\nCreating mobile session...")
        result = client.create(image_id="mobile_latest")
        session = result.session
        print(f"‚úÖ Session created: {session.session_id}")
        
        # Step 3: Get ADB connection URL
        print("\nGetting ADB connection URL...")
        adb_result = session.mobile.get_adb_url(adbkey_pub=adbkey_pub)
        
        if not adb_result.success:
            print(f"‚ùå Failed: {adb_result.error_message}")
            return
        
        print(f"‚úÖ ADB URL: {adb_result.data}")
        print(f"‚úÖ Request ID: {adb_result.request_id}")
        
        # Step 3: Parse the ADB connect command
        adb_url = adb_result.data  # "adb connect 47.99.76.99:54321"
        # Extract just the address part for later use
        address = adb_url.replace("adb connect ", "")
        
        # Step 4: Connect via ADB
        print(f"\nConnecting to device...")
        print(f"Command: {adb_url}")
        result = subprocess.run(
            ["adb", "connect", address],
            capture_output=True,
            text=True
        )
        print(result.stdout.strip())
        
        # Wait for connection to establish
        time.sleep(2)
        
        # Step 5: Verify connection
        print("\nVerifying connection...")
        print("Command: adb devices")
        result = subprocess.run(
            ["adb", "devices"],
            capture_output=True,
            text=True
        )
        print(result.stdout)
        
        # Check if device is connected
        if "unauthorized" in result.stdout:
            print("‚ùå Device is unauthorized - check your ADB public key")
            return
        elif address not in result.stdout or "device" not in result.stdout:
            print("‚ùå Device not connected properly")
            return
        
        print("‚úÖ Device connected successfully!")
        
        # Step 6: Now you can use ADB commands
        print("\nYou can now use ADB commands:")
        print(f"  adb -s {address} shell getprop ro.product.model")
        print(f"  adb -s {address} shell pm list packages")
        print(f"  adb -s {address} shell screencap -p /sdcard/screenshot.png")
        
        # Example: Get device model
        print("\nExample - Getting device model...")
        result = subprocess.run(
            ["adb", "-s", address, "shell", "getprop", "ro.product.model"],
            capture_output=True,
            text=True
        )
        print(f"Device model: {result.stdout.strip()}")
        
        # Step 7: Disconnect
        print(f"\nDisconnecting from {address}...")
        subprocess.run(["adb", "disconnect", address])
        print("‚úÖ Disconnected")
        
    except Exception as e:
        print(f"‚ùå Error: {e}")
    
    finally:
        # Cleanup
        print("\nCleaning up session...")
        session.delete()
        print("‚úÖ Session deleted")

if __name__ == "__main__":
    main()
```

## Error Handling

### Check ADB Key File

```python
import os

adbkey_path = os.path.expanduser('~/.android/adbkey.pub')
if not os.path.exists(adbkey_path):
    print(f"Error: ADB public key not found at {adbkey_path}")
    exit(1)
```

### Check getAdbUrl Result

```python
result = session.mobile.get_adb_url(adbkey_pub)

if not result.success:
    print(f"Error: {result.error_message}")
    exit(1)
```

### Verify ADB Connection

After connecting, verify the device status:

```bash
adb devices
```

Check the output:
- ‚úÖ `device` - Connected and authorized
- ‚ùå `unauthorized` - ADB public key is incorrect
- ‚ùå `offline` - Connection issue

## Troubleshooting

### Device Shows as Unauthorized

If the device shows as "unauthorized" when running `adb devices`:

```
List of devices attached
47.99.76.99:54321	unauthorized
```

**Cause**: You are not using your actual ADB public key.

**Solution**: 
1. Locate your ADB public key: `~/.android/adbkey.pub` (Linux/macOS) or `%USERPROFILE%\.android\adbkey.pub` (Windows)
2. Read the entire content of the file
3. Pass the complete key string to `get_adb_url()`

```python
import os
adbkey_path = os.path.expanduser('~/.android/adbkey.pub')
with open(adbkey_path, 'r') as f:
    adbkey_pub = f.read().strip()  # Read the entire key

result = session.mobile.get_adb_url(adbkey_pub=adbkey_pub)
```

### Connection Refused

If you get "connection refused" errors:

```bash
# Restart ADB server
adb kill-server
adb start-server

# Try connecting again
adb connect <IP>:<Port>
```

### Device Shows as Offline

If the device appears as "offline":

```bash
# Disconnect and reconnect
adb disconnect <IP>:<Port>
adb connect <IP>:<Port>
```

### Multiple Devices Connected

If you have multiple devices, specify the device for each command:

```bash
# Use -s flag to specify device
adb -s <IP>:<Port> shell getprop
adb -s <IP>:<Port> install app.apk
```

### Cannot Find ADB Command

If `adb` command is not found:

```bash
# Check if ADB is installed
which adb

# If not installed, refer to Android documentation for installation
```

## API Documentation

For detailed API documentation in other languages:

- **Python**: [Mobile API Documentation](../../../python/docs/api/sync/mobile.md#getadburl)
- **Golang**: [Mobile API Documentation](../../../golang/docs/api/mobile-use/mobile.md#getadburl)
- **TypeScript**: [Mobile API Documentation](../../../typescript/docs/api/mobile-use/mobile.md)

## Example Code

Complete working examples for all languages:

- **Python**: [mobile_get_adb_url_example.py](../../../python/docs/examples/_async/mobile-use/mobile_get_adb_url_example.py)
- **Golang**: [mobile_get_adb_url Example](../../../golang/docs/examples/mobile-use/mobile_get_adb_url/README.md)
- **TypeScript**: [mobile-get-adb-url Example](../../../typescript/docs/examples/mobile-use/mobile-get-adb-url/README.md)

## Related Guides

- [Mobile UI Automation](./mobile-ui-automation.md) - Touch gestures and UI interaction
- [Mobile Application Management](./mobile-application-management.md) - App lifecycle management
- [Session Management](../common-features/basics/session-management.md) - Session creation and management

## Summary

The ADB connection feature enables you to:

1. ‚úÖ Connect to cloud-based mobile sessions from your local machine
2. ‚úÖ Use standard ADB commands to control the device
3. ‚úÖ Integrate with existing ADB-based tools and workflows
4. ‚úÖ Debug and test mobile applications remotely

**Key Points:**
- Only works with `mobile_latest` sessions
- The `adbkey_pub` parameter is not validated (can use any string)
- Returns URL in format: `adb connect <IP>:<Port>`
- Always verify connection with `adb devices` before running commands
- Remember to disconnect and delete the session when done




# Application Management for Mobile Use

This guide covers application management capabilities for mobile devices (Android) using the AgentBay SDK. Learn how to launch, monitor, and control mobile applications in cloud environments.

## üìã Table of Contents

- [Overview](#overview)
- [Prerequisites](#prerequisites)
- [Getting Installed Applications](#getting-installed-applications)
- [Starting Applications](#starting-applications)
- [Stopping Applications](#stopping-applications)
- [Complete Workflow Example](#complete-workflow-example)
- [API Reference](#api-reference)

<a id="overview"></a>
## üéØ Overview

The Mobile Use module provides application management capabilities for Android mobile devices:

1. **Application Discovery** - Query installed applications on the device
2. **Application Lifecycle** - Start and stop mobile applications using package names
3. **Activity Management** - Launch specific Android activities
4. **Process Monitoring** - Track running applications and their processes

**Note:** This guide has been verified with the `mobile_latest` system image. These features should also work with other mobile system images.

<a id="prerequisites"></a>
## üì¶ Prerequisites

First, create a session with a mobile environment:

```python
import os
from agentbay import AgentBay
from agentbay import CreateSessionParams

api_key = os.getenv("AGENTBAY_API_KEY")
if not api_key:
    raise ValueError("AGENTBAY_API_KEY environment variable is required")

agent_bay = AgentBay(api_key=api_key)

params = CreateSessionParams(image_id="mobile_latest")
result = agent_bay.create(params)

if result.success:
    session = result.session
    print(f"Session created: {session.session_id}")
else:
    print(f"Failed to create session: {result.error_message}")
    exit(1)

# Actual output:
# Session created: session-04bdw8o39c9uiwet4
```

<a id="getting-installed-applications"></a>
## üîç Getting Installed Applications

Query the list of installed applications on the mobile device:

```python
result = session.mobile.get_installed_apps(
    start_menu=True,
    desktop=False,
    ignore_system_apps=True
)

if result.success:
    apps = result.data
    print(f"Found {len(apps)} installed applications")
    
    for app in apps[:5]:
        print(f"Name: {app.name}")
        print(f"Start Command: {app.start_cmd}")
        print(f"Stop Command: {app.stop_cmd if app.stop_cmd else 'N/A'}")
        print(f"Work Directory: {app.work_directory if app.work_directory else 'N/A'}")
        print("---")
else:
    print(f"Error: {result.error_message}")

# Actual output (with current mobile_latest image):
# Found 0 installed applications
```

**Parameters:**
- `start_menu` (bool): Whether to include start menu applications
- `desktop` (bool): Whether to include desktop applications
- `ignore_system_apps` (bool): Whether to filter out system applications

**Returns:**
- `InstalledAppListResult` containing a list of `InstalledApp` objects

**Note:** The current `mobile_latest` image does not include pre-installed applications in the listing, so this method returns an empty list. However, you can still launch applications using their package names (see below).

<a id="starting-applications"></a>
## üöÄ Starting Applications

Launch mobile applications using the "monkey -p" command format with package names:

### Start by Package Name

```python
# Use "monkey -p" format for Android package names
start_cmd = "monkey -p com.android.settings"

result = session.mobile.start_app(start_cmd)

if result.success:
    processes = result.data
    print(f"Application started with {len(processes)} processes")
    
    for process in processes:
        print(f"Process: {process.pname} (PID: {process.pid})")
else:
    print(f"Failed to start application: {result.error_message}")

# Actual output:
# Application started with 1 processes
# Process: com.android.settings (PID: 2805)
```

**Important Notes:**
- **Command Format**: Always use `"monkey -p <package_name>"` format for starting apps
- **Package Names**: Common Android package names:
  - Settings: `com.android.settings`
  - Chrome: `com.android.chrome`
  - Calculator: `com.android.calculator2`
  - Contacts: `com.android.contacts`

### Start with Specific Activity (Android)

```python
start_cmd = "monkey -p com.android.settings"
activity = ".Settings"

result = session.mobile.start_app(
    start_cmd=start_cmd,
    activity=activity
)

if result.success:
    processes = result.data
    print(f"Application started with activity {activity}")
    print(f"Found {len(processes)} processes")
    
    for process in processes:
        print(f"Process: {process.pname} (PID: {process.pid})")
else:
    print(f"Failed to start application: {result.error_message}")

# Actual output:
# Application started with activity .Settings
# Found 1 processes
# Process: com.android.settings (PID: 2921)
```

**Note:** The `activity` parameter allows you to launch a specific activity within an app. Activities can be specified as:
- Relative name: `".SettingsActivity"`
- Full name: `"com.package/.Activity"`

Common activity examples:
- Settings: `com.android.settings` with activity `.Settings`
- Browser: `com.android.chrome` with activity `com.google.android.apps.chrome.Main`
- Calculator: `com.android.calculator2` with activity `.Calculator`

<a id="stopping-applications"></a>
## üõë Stopping Applications

Stop running mobile applications using the stop command:

```python
# Start an application
start_result = session.mobile.start_app("monkey -p com.android.settings")

if start_result.success:
    print("Application started successfully")
    for process in start_result.data:
        print(f"  Process: {process.pname} (PID: {process.pid})")
    
    # Stop the application using package name
    result = session.mobile.stop_app_by_cmd("com.android.settings")
    
    if result.success:
        print("Successfully stopped application")
    else:
        print(f"Failed to stop application: {result.error_message}")

# Actual output:
# Application started successfully
#   Process: com.android.settings (PID: 3042)
# Successfully stopped application
```

**Note:** The `stop_cmd` parameter should be the package name (e.g., `"com.android.settings"`).

<a id="complete-workflow-example"></a>
## üîÑ Complete Workflow Example

Complete example showing how to launch and control a mobile application:

```python
import os
import time
from agentbay import AgentBay
from agentbay import CreateSessionParams

api_key = os.getenv("AGENTBAY_API_KEY")
if not api_key:
    raise ValueError("AGENTBAY_API_KEY environment variable is required")

agent_bay = AgentBay(api_key=api_key)

# Create mobile session
params = CreateSessionParams(image_id="mobile_latest")
result = agent_bay.create(params)

if not result.success:
    print(f"Failed to create session: {result.error_message}")
    exit(1)

session = result.session
print(f"Session created: {session.session_id}")

# Step 1: Launching application
print("Step 1: Launching Settings application...")
start_result = session.mobile.start_app("monkey -p com.android.settings")

if not start_result.success:
    print(f"Failed to start app: {start_result.error_message}")
    agent_bay.delete(session)
    exit(1)

print(f"Application started with {len(start_result.data)} processes")
for process in start_result.data:
    print(f"  - {process.pname} (PID: {process.pid})")

# Step 2: Waiting for application to load
print("Step 2: Waiting for application to load...")
time.sleep(3)

# Step 3: Stopping application
print("Step 3: Stopping application...")
stop_result = session.mobile.stop_app_by_cmd("com.android.settings")
if stop_result.success:
    print("Application stopped successfully")
else:
    print(f"Failed to stop application: {stop_result.error_message}")

# Cleanup
print("Cleaning up session...")
agent_bay.delete(session)
print("Workflow completed!")

# Actual output:
# Session created: session-04bdwfj7tnhfnzibx
# Step 1: Launching Settings application...
# Application started with 1 processes
#   - com.android.settings (PID: 3268)
# Step 2: Waiting for application to load...
# Step 3: Stopping application...
# Application stopped successfully
# Cleaning up session...
# Workflow completed!
```

<a id="api-reference"></a>
## üìö API Reference

### Mobile Manager Methods

| Method | Parameters | Returns | Description |
|--------|------------|---------|-------------|
| `get_installed_apps()` | `start_menu: bool`<br/>`desktop: bool`<br/>`ignore_system_apps: bool` | `InstalledAppListResult` | Get list of installed applications |
| `start_app()` | `start_cmd: str`<br/>`work_directory: str = ""`<br/>`activity: str = ""` | `ProcessListResult` | Start a mobile application |
| `stop_app_by_cmd()` | `stop_cmd: str` | `AppOperationResult` | Stop application by package name |

### Return Types

**InstalledAppListResult**
- `success` (bool): Whether the operation succeeded
- `data` (List[InstalledApp]): List of installed applications
- `error_message` (str): Error message if operation failed
- `request_id` (str): Unique request identifier

**InstalledApp**
- `name` (str): Application name
- `start_cmd` (str): Command/package name to start the application
- `stop_cmd` (Optional[str]): Command to stop the application
- `work_directory` (Optional[str]): Working directory for the application

**ProcessListResult**
- `success` (bool): Whether the operation succeeded
- `data` (List[Process]): List of process objects
- `error_message` (str): Error message if operation failed
- `request_id` (str): Unique request identifier

**Process**
- `pname` (str): Process name
- `pid` (int): Process ID
- `cmdline` (Optional[str]): Full command line

**AppOperationResult**
- `success` (bool): Whether the operation succeeded
- `error_message` (str): Error message if operation failed
- `request_id` (str): Unique request identifier

### Mobile-Specific Parameters

**Start Command Format**

The `start_cmd` parameter must use the "monkey -p" format:

```python
session.mobile.start_app("monkey -p com.android.settings")
```

**Stop Command Format**

The `stop_cmd` parameter should be the package name:

```python
session.mobile.stop_app_by_cmd("com.android.settings")
```

**Activity Parameter (Android)**

The `activity` parameter allows launching a specific activity:

```python
session.mobile.start_app(
    start_cmd="monkey -p com.android.settings",
    activity=".Settings"
)
```

Activity names can be specified as:
- **Relative name**: `.SettingsActivity` (package prefix will be added automatically)
- **Full name**: `com.package/.Activity` (complete activity identifier)

## üéØ Summary

This guide covered mobile application management capabilities:

- **Application Discovery**: Query installed applications on the device
- **Application Lifecycle**: Start and stop Android apps using monkey command format
- **Activity Management**: Launch specific Android activities
- **Process Monitoring**: Track running mobile processes

These features enable you to build automated mobile workflows for testing, automation, and remote mobile device management scenarios using AgentBay SDK's Mobile Use capabilities.

## üìù Platform Differences

**Mobile vs. Desktop:**
- **Mobile** (this guide): Uses "monkey -p" command format (e.g., `"monkey -p com.android.chrome"`) and supports Android activities
- **Desktop**: Uses executable paths (e.g., `/usr/bin/google-chrome-stable`) and supports working directories
- **Window Management**: Only available for desktop environments; mobile apps use full-screen activities instead
- **Application Discovery**: The current `mobile_latest` image returns an empty list from `get_installed_apps()`, but the API is available for future image versions
- **Stop Methods**: Mobile only supports `stop_app_by_cmd()` using package names; desktop supports additional methods like `stop_app_by_pid()` and `stop_app_by_pname()`

For desktop application management, see the [Computer Use Application Management Guide](../computer-use/computer-application-management.md).

## üìö Related Guides

- [Mobile UI Automation](mobile-ui-automation.md) - Touch gestures and UI interaction
- [Computer Application Management](../computer-use/computer-application-management.md) - Desktop application management
- [Session Management](../common-features/basics/session-management.md) - Session lifecycle and configuration
- [Command Execution](../common-features/basics/command-execution.md) - Execute shell commands

## üÜò Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../README.md)




# Mobile Session Configuration

This guide demonstrates how to create mobile sessions with advanced configuration options using the AgentBay SDK. The mobile configuration allows you to control application access and screen resolution settings for mobile environments.

## Table of Contents
- [Overview](#overview)
- [Configuration Options](#configuration-options)
- [Navigation Bar Control](#navigation-bar-control)
- [Uninstall Protection](#uninstall-protection)
- [Whitelist Configuration](#whitelist-configuration)
- [Blacklist Configuration](#blacklist-configuration)
- [Advanced Configuration Examples](#advanced-configuration-examples)

## Overview

When creating mobile sessions, you can configure advanced settings using the `extra_configs` parameter in `CreateSessionParams`. This allows you to:

- Control application access through whitelist or blacklist rules
- Lock or unlock screen resolution
- Hide or show the system navigation bar
- Protect critical applications from uninstallation
- Enhance security and testing flexibility

## Configuration Options

The mobile configuration supports the following options:

### Resolution Settings

- **`lock_resolution`** (bool): Controls whether the screen resolution is locked
  - `True`: Locks the resolution to prevent changes
  - `False`: Allows resolution changes for flexible display adaptation

### Navigation Bar Control

- **`hide_navigation_bar`** (bool): Controls the visibility of the system navigation bar
  - `True`: Hides the navigation bar for immersive full-screen experience
  - `False`: Shows the navigation bar (default system behavior)

### Uninstall Protection

- **`uninstall_blacklist`** (list): A list of package names protected from uninstallation
  - Prevents accidental or malicious removal of critical applications
  - Commonly used to protect system apps, security tools, and essential services

### App Manager Rule

- **`app_manager_rule`** (AppManagerRule): Controls application access
  - **`rule_type`**: Either "White" (whitelist) or "Black" (blacklist)
  - **`app_package_name_list`**: List of package names to allow or block

## Navigation Bar Control

The navigation bar control feature allows you to create immersive mobile experiences by hiding the system navigation bar. This is particularly useful for:

- **Kiosk Applications**: Creating dedicated-purpose applications without system navigation
- **Immersive Gaming**: Full-screen gaming experiences without distractions
- **UI Testing**: Testing applications in full-screen mode
- **Digital Signage**: Creating clean, distraction-free displays

### Example: Hiding Navigation Bar

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams
from agentbay import ExtraConfigs, MobileExtraConfig

# Initialize the SDK
agent_bay = AgentBay(api_key="your_api_key")

# Configure mobile settings with hidden navigation bar
mobile_config = MobileExtraConfig(
    lock_resolution=True,
    hide_navigation_bar=True  # Hide navigation bar for immersive experience
)

# Create extra configs
extra_configs = ExtraConfigs(mobile=mobile_config)

# Create session with immersive configuration
params = CreateSessionParams(
    image_id="mobile_latest",
    labels={"project": "immersive-ui", "mode": "kiosk"},
    extra_configs=extra_configs
)

session_result = agent_bay.create(params)
if session_result.success:
    session = session_result.session
    print(f"Immersive mobile session created with ID: {session.session_id}")
    print("Navigation bar hidden for full-screen experience")
```

## Uninstall Protection

The uninstall protection feature prevents critical applications from being accidentally or maliciously uninstalled. This is essential for:

- **System Stability**: Protecting essential system applications
- **Security**: Preventing removal of security and management tools
- **Compliance**: Ensuring required applications remain installed
- **Kiosk Mode**: Maintaining application integrity in public devices

### Example: Protecting Critical Applications

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams
from agentbay import ExtraConfigs, MobileExtraConfig

# Initialize the SDK
agent_bay = AgentBay(api_key="your_api_key")

# Configure uninstall protection for critical apps
mobile_config = MobileExtraConfig(
    lock_resolution=True,
    uninstall_blacklist=[
        "com.android.systemui",        # System UI
        "com.android.settings",        # Settings app
        "com.google.android.gms",      # Google Play Services
        "com.company.security.app",    # Company security app
        "com.company.management.tool"  # Device management tool
    ]
)

# Create extra configs
extra_configs = ExtraConfigs(mobile=mobile_config)

# Create session with uninstall protection
params = CreateSessionParams(
    image_id="mobile_latest",
    labels={"project": "secure-deployment", "protection": "enabled"},
    extra_configs=extra_configs
)

session_result = agent_bay.create(params)
if session_result.success:
    session = session_result.session
    print(f"Protected mobile session created with ID: {session.session_id}")
    print("Critical applications protected from uninstallation")
```

## Whitelist Configuration

Use whitelists in production environments to ensure only approved applications can be installed and accessed. This provides the highest level of security by explicitly allowing only trusted applications.

### Example: Creating a Session with App Whitelist

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams
from agentbay import ExtraConfigs, MobileExtraConfig, AppManagerRule

# Initialize the SDK
agent_bay = AgentBay(api_key="your_api_key")

# Configure mobile app management with whitelist
app_whitelist_rule = AppManagerRule(
    rule_type="White",
    app_package_name_list=[
        "com.example.allowed.app",
        "com.company.trusted.app",
        "com.system.essential.service"
    ]
)

# Configure mobile settings with comprehensive options
mobile_config = MobileExtraConfig(
    lock_resolution=True,
    hide_navigation_bar=True,  # Hide navigation bar for clean UI
    uninstall_blacklist=[      # Protect critical system apps
        "com.android.systemui",
        "com.android.settings",
        "com.google.android.gms"
    ],
    app_manager_rule=app_whitelist_rule
)

# Create extra configs
extra_configs = ExtraConfigs(mobile=mobile_config)

# Create session with mobile configuration
params = CreateSessionParams(
    image_id="mobile_latest",
    labels={"project": "mobile-testing", "environment": "development"},
    extra_configs=extra_configs
)

session_result = agent_bay.create(params)
if session_result.success:
    session = session_result.session
    print(f"Mobile session created with ID: {session.session_id}")
    print("Mobile configuration applied:")
    print("- Resolution locked")
    print("- App whitelist enabled with allowed packages")
else:
    print(f"Failed to create mobile session: {session_result.error_message}")
```

## Blacklist Configuration

Use blacklists in development and testing to block known problematic applications while allowing flexibility for other apps. This approach is useful when you want to prevent access to specific applications without restricting the entire environment.

### Example: Creating a Session with App Blacklist

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams
from agentbay import ExtraConfigs, MobileExtraConfig, AppManagerRule

# Initialize the SDK
agent_bay = AgentBay(api_key="your_api_key")

# Configure mobile app management with blacklist
app_blacklist_rule = AppManagerRule(
    rule_type="Black",
    app_package_name_list=[
        "com.malware.suspicious.app",
        "com.unwanted.adware",
        "com.blocked.social.media"
    ]
)

# Configure mobile settings with resolution flexibility and security
mobile_config = MobileExtraConfig(
    lock_resolution=False,
    hide_navigation_bar=False,  # Keep navigation bar visible
    uninstall_blacklist=[       # Protect essential apps even in blacklist mode
        "com.android.systemui",
        "com.android.settings"
    ],
    app_manager_rule=app_blacklist_rule
)

# Create extra configs
extra_configs = ExtraConfigs(mobile=mobile_config)

# Create session with mobile blacklist configuration
params = CreateSessionParams(
    image_id="mobile_latest",
    labels={"project": "security-testing"},
    extra_configs=extra_configs
)

session_result = agent_bay.create(params)
if session_result.success:
    session = session_result.session
    print(f"Secure mobile session created with ID: {session.session_id}")
    print("Security configuration applied:")
    print("- Resolution unlocked for flexibility")
    print("- App blacklist enabled to block malicious packages")
else:
    print(f"Failed to create mobile session: {session_result.error_message}")
```

## Advanced Configuration Examples

### Comprehensive Mobile Configuration

This example demonstrates all available mobile configuration options working together:

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams
from agentbay import ExtraConfigs, MobileExtraConfig, AppManagerRule

# Initialize the SDK
agent_bay = AgentBay(api_key="your_api_key")

# Create comprehensive app management rule
app_rule = AppManagerRule(
    rule_type="White",
    app_package_name_list=[
        "com.android.settings",
        "com.company.business.app",
        "com.trusted.productivity.suite"
    ]
)

# Configure all mobile options
mobile_config = MobileExtraConfig(
    lock_resolution=True,           # Lock resolution for consistent testing
    hide_navigation_bar=True,       # Hide navigation bar for immersive experience
    uninstall_blacklist=[           # Protect critical applications
        "com.android.systemui",     # System UI components
        "com.android.settings",     # Device settings
        "com.google.android.gms",   # Google Play Services
        "com.company.security.app", # Company security application
        "com.company.mdm.agent"     # Mobile device management agent
    ],
    app_manager_rule=app_rule       # Application access control
)

# Create extra configs
extra_configs = ExtraConfigs(mobile=mobile_config)

# Create session with comprehensive configuration
params = CreateSessionParams(
    image_id="mobile_latest",
    labels={
        "project": "enterprise-mobile",
        "config_type": "comprehensive",
        "security_level": "high",
        "ui_mode": "immersive"
    },
    extra_configs=extra_configs
)

session_result = agent_bay.create(params)
if session_result.success:
    session = session_result.session
    print(f"Comprehensive mobile session created with ID: {session.session_id}")
    print("Configuration applied:")
    print("‚úì Resolution locked for consistent testing")
    print("‚úì Navigation bar hidden for immersive experience")
    print("‚úì Critical system apps protected from uninstallation")
    print("‚úì App whitelist enforced for security")
else:
    print(f"Failed to create comprehensive session: {session_result.error_message}")
```

## Related Documentation

- [Mobile Application Management](./mobile-application-management.md)
- [Mobile UI Automation](./mobile-ui-automation.md)
- [Session Creation Basics](../common-features/basics/session-management.md)




# Mobile Device Simulation

This guide demonstrates how to use the mobile device simulation feature in AgentBay SDK to simulate different mobile devices with specific hardware characteristics and properties across sessions.

## Table of Contents
- [Overview](#overview)
- [What is Mobile Simulate](#what-is-mobile-simulate)
- [Simulation Modes](#simulation-modes)
- [Device Info Format](#device-info-format)
- [Basic Usage](#basic-usage)
- [Using with User Context](#using-with-user-context)
- [Best Practices](#best-practices)

## Overview

Mobile device simulation allows you to:

- **Simulate Real Devices**: Mimic the properties and characteristics of real mobile devices
- **Cross-Session Persistence**: Maintain device identity across multiple sessions
- **Flexible Configuration**: Choose different level simulate mode for device simulation

**Note:** Due to stability reasons, we recommend using mobile simulate feature in Android 12 image but not Android 14 image.

## What is Mobile Simulate

Mobile Simulate is a feature that allows you to configure a mobile session to mimic a specific mobile device. This includes:

- **Device Properties**: Model name, manufacturer, Android version, build information
- **Hardware Characteristics**: Screen resolution, CPU architecture, memory configuration
- **Installed Packages**: Application packages installed on the device
- **System Services**: System-level services running on the device

The mobile device information is stored in a JSON file that can be obtained from:
- Real devices info by using DumpSDK tools
- User maintained mobile info database
**Note:** For more information, please contact AgentBay support team for assistance

## Simulation Modes

AgentBay supports five simulation modes, allowing you to choose the level of device simulation based on your needs:

### Properties Only Mode

Simulates device properties without modifying hardware characteristics. This mode is most recommended.

```python
MobileSimulateMode.PROPERTIES_ONLY
```

### Sensors Only Mode

Simulates only the device sensors information (accelerometer, gyroscope, etc.).

```python
MobileSimulateMode.SENSORS_ONLY
```

### Packages Only Mode

Simulates only the installed packages on the device.

```python
MobileSimulateMode.PACKAGES_ONLY
```

### Services Only Mode

Simulates only the system services running on the device.

```python
MobileSimulateMode.SERVICES_ONLY
```

### All Mode

Provides comprehensive device simulation including all aspects: properties, sensors, packages, and services. This mode offers the most realistic device emulation.

```python
MobileSimulateMode.ALL
```

## Device Info Format

Mobile device information files contain detailed device characteristics in JSON format.

Example device info file structure:
```json
{
    "version": 1,
    "properties": {
        "ro.product.model": "V2429A",
        "ro.xxx": "xxx"
    },
    "packages": []
}
```

## Basic Usage
We can use a persistent mobile simulate context id to simulate mobile devices across sessions. Users only need to store the context id persistently.

- Use `upload_mobile_info` interface to upload a user device info and a context id will be returned.
- Configure `MobileSimulateConfig` for `CreateSessionParams` when creating a session, and the device will be simulated automatically.
- The same context id can be reused across multiple sessions using `set_simulate_context_id()`.

### Python Example

```python
import asyncio
from agentbay import AsyncAgentBay, AsyncMobileSimulateService
from agentbay import CreateSessionParams, ExtraConfigs
from agentbay import MobileExtraConfig, MobileSimulateMode

async def main():
    # Initialize AgentBay client
    agent_bay = AsyncAgentBay(api_key="your_api_key")

    # Step 1: Create MobileSimulateService and configure
    simulate_service = AsyncMobileSimulateService(agent_bay)
    simulate_service.set_simulate_enable(True)
    simulate_service.set_simulate_mode(MobileSimulateMode.PROPERTIES_ONLY)

    # Step 2: Upload mobile device info file
    with open("mobile_info_model_a.json", "r") as f:
        mobile_info_content = f.read()

    upload_result = await simulate_service.upload_mobile_info(mobile_info_content)
    if not upload_result.success:
        print(f"Failed to upload: {upload_result.error_message}")
        return

    mobile_sim_context_id = upload_result.mobile_simulate_context_id
    print(f"Mobile simulate context ID: {mobile_sim_context_id}")

    # Step 3: Create first session with mobile simulate configuration
    params = CreateSessionParams(
        image_id="mobile_latest",
        extra_configs=ExtraConfigs(
            mobile=MobileExtraConfig(
                simulate_config=simulate_service.get_simulate_config()
            )
        )
    )

    session_result = await agent_bay.create(params)
    if not session_result.success or not session_result.session:
        print(f"Failed to create session: {session_result.error_message}")
        return

    session1 = session_result.session
    print(f"Session created with ID: {session1.session_id}")

    # Step 4: Wait for mobile simulate to complete
    await asyncio.sleep(5)

    # Step 5: Verify device simulation
    result = await session1.command.execute_command("getprop ro.product.model")
    if result.success:
        print(f"First session device model: {result.output.strip()}")

    # Step 6: Cleanup first session
    delete_result = await agent_bay.delete(session1, sync_context=True)
    if not delete_result.success:
        print(f"Failed to delete first session: {delete_result.error_message}")
        return
    print(f"First session deleted successfully (RequestID: {delete_result.request_id})")

    # Step 7: Create second session with the same mobile simulate context
    simulate_service2 = AsyncMobileSimulateService(agent_bay)
    simulate_service2.set_simulate_enable(True)
    simulate_service2.set_simulate_mode(MobileSimulateMode.PROPERTIES_ONLY)
    simulate_service2.set_simulate_context_id(mobile_sim_context_id)

    params2 = CreateSessionParams(
        image_id="mobile_latest",
        extra_configs=ExtraConfigs(
            mobile=MobileExtraConfig(
                simulate_config=simulate_service2.get_simulate_config()
            )
        )
    )

    session_result2 = await agent_bay.create(params2)
    if not session_result2.success or not session_result2.session:
        print(f"Failed to create session: {session_result2.error_message}")
        return

    session2 = session_result2.session
    print(f"Second session created with ID: {session2.session_id}")

    # Step 8: Wait for mobile simulate to complete
    await asyncio.sleep(5)

    # Step 9: Verify device simulation
    result = await session2.command.execute_command("getprop ro.product.model")
    if result.success:
        print(f"Second session device model: {result.output.strip()}")

    # Step 10: Cleanup second session
    delete_result = await agent_bay.delete(session2, sync_context=True)
    if not delete_result.success:
        print(f"Failed to delete second session: {delete_result.error_message}")
        return
    print(f"Second session deleted successfully (RequestID: {delete_result.request_id})")

if __name__ == "__main__":
    asyncio.run(main())
```

### TypeScript Example

```typescript
import { AgentBay, MobileSimulateService, MobileSimulateMode } from 'wuying-agentbay-sdk';
import { readFileSync } from 'fs';

// Initialize AgentBay client
const client = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY! });

// Step 1: Create MobileSimulateService and configure
const simulateService = new MobileSimulateService(client);
simulateService.setSimulateEnable(true);
simulateService.setSimulateMode(MobileSimulateMode.PropertiesOnly);

// Step 2: Upload mobile device info file
const mobileInfoContent = readFileSync('mobile_info_model_a.json', 'utf-8');

const uploadResult = await simulateService.uploadMobileInfo(mobileInfoContent);
if (!uploadResult.success) {
  throw new Error(`Failed to upload: ${uploadResult.errorMessage}`);
}

const mobileSimContextId = uploadResult.mobileSimulateContextId!;
console.log(`Mobile simulate context ID: ${mobileSimContextId}`);

// Step 3: Create first session with mobile simulate configuration
const sessionResult = await client.create({
  imageId: 'mobile_latest',
  extraConfigs: {
    mobile: {
      simulateConfig: simulateService.getSimulateConfig(),
    },
  },
});

if (!sessionResult.success || !sessionResult.session) {
  throw new Error(`Failed to create session: ${sessionResult.errorMessage}`);
}

const session1 = sessionResult.session;
console.log(`Session created with ID: ${session1.sessionId}`);

// Step 4: Wait for mobile simulate to complete
await new Promise(resolve => setTimeout(resolve, 5000));

// Step 5: Verify device simulation
const result = await session1.command.executeCommand('getprop ro.product.model');
if (result.success) {
  console.log(`Device model: ${result.output.trim()}`);
}

// Step 6: Cleanup first session
await session1.delete();

// Step 7: Create second session with the same mobile simulate context
const simulateService2 = new MobileSimulateService(client);
simulateService2.setSimulateEnable(true);
simulateService2.setSimulateMode(MobileSimulateMode.PropertiesOnly);
simulateService2.setSimulateContextId(mobileSimContextId);

const sessionResult2 = await client.create({
  imageId: 'mobile_latest',
  extraConfigs: {
    mobile: {
      simulateConfig: simulateService2.getSimulateConfig(),
    },
  },
});

const session2 = sessionResult2.session!;
console.log(`Second session created with ID: ${session2.sessionId}`);

// Step 8: Cleanup second session
await session2.delete();
```

### Go Example

```go
package main

import (
	"fmt"
	"os"
	"time"

	"github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay"
	"github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay/models"
)

func main() {
	// Initialize AgentBay client
	client, err := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"))
	if err != nil {
		panic(err)
	}

	// Step 1: Create MobileSimulateService and configure
	simulateService, err := agentbay.NewMobileSimulateService(client)
	if err != nil {
		panic(err)
	}
	simulateService.SetSimulateEnable(true)
	simulateService.SetSimulateMode(models.MobileSimulateModePropertiesOnly)

	// Step 2: Upload mobile device info file
	mobileInfoContent, err := os.ReadFile("mobile_info_model_a.json")
	if err != nil {
		panic(err)
	}

	uploadResult := simulateService.UploadMobileInfo(string(mobileInfoContent), nil)
	if !uploadResult.Success {
		panic(uploadResult.ErrorMessage)
	}

	mobileSimContextID := uploadResult.MobileSimulateContextID
	fmt.Printf("Mobile simulate context ID: %s\n", mobileSimContextID)

	// Step 3: Create first session with mobile simulate configuration
	params := &agentbay.CreateSessionParams{
		ImageId: "mobile_latest",
		ExtraConfigs: &models.ExtraConfigs{
			Mobile: &models.MobileExtraConfig{
				SimulateConfig: simulateService.GetSimulateConfig(),
			},
		},
	}

	sessionResult, err := client.Create(params)
	if err != nil || !sessionResult.Success {
		panic("Failed to create session")
	}

	session1 := sessionResult.Session
	fmt.Printf("Session created with ID: %s\n", session1.SessionID)

	// Step 4: Wait for mobile simulate to complete
	time.Sleep(5 * time.Second)

	// Step 5: Verify device simulation
	result, err := session1.Command.ExecuteCommand("getprop ro.product.model")
	if err == nil && result.Success {
		fmt.Printf("Device model: %s\n", result.Output)
	}

	// Step 6: Cleanup first session
	session1.Delete()

	// Step 7: Create second session with the same mobile simulate context
	simulateService2, _ := agentbay.NewMobileSimulateService(client)
	simulateService2.SetSimulateEnable(true)
	simulateService2.SetSimulateMode(models.MobileSimulateModePropertiesOnly)
	simulateService2.SetSimulateContextID(mobileSimContextID)

	params2 := &agentbay.CreateSessionParams{
		ImageId: "mobile_latest",
		ExtraConfigs: &models.ExtraConfigs{
			Mobile: &models.MobileExtraConfig{
				SimulateConfig: simulateService2.GetSimulateConfig(),
			},
		},
	}

	sessionResult2, _ := client.Create(params2)
	session2 := sessionResult2.Session
	fmt.Printf("Second session created with ID: %s\n", session2.SessionID)

	// Step 8: Cleanup second session
	session2.Delete()
}
```

## Using with User Context

For persistent device simulation across multiple sessions, use user-specific contexts. This approach allows you to:

- Store device information in a user's context
- Reuse device configuration across sessions

### Python Example with Context

```python
import asyncio
from agentbay import AsyncAgentBay, AsyncMobileSimulateService
from agentbay import ContextSync, SyncPolicy, BWList, WhiteList
from agentbay import CreateSessionParams, ExtraConfigs
from agentbay import MobileExtraConfig, MobileSimulateMode

async def main():
    # Initialize AgentBay client
    agent_bay = AsyncAgentBay(api_key="your_api_key")

    # Step 1: Get or create user-specific context
    print("Getting a user specific context...")
    context_result = await agent_bay.context.get("user_phone_number", create=True)
    if not context_result.success or not context_result.context:
        print(f"Failed to get context: {context_result.error_message}")
        return

    context = context_result.context
    print(f"context.id = {context.id}, context.name = {context.name}")

    # Step 2: Create context sync configuration
    sync_policy = SyncPolicy(
        bw_list=BWList(
            white_lists=[
                WhiteList(path="/com.wuying.devinfo", exclude_paths=[])
            ]
        )
    )

    context_sync = ContextSync(
        context_id=context.id,
        path="/data/data",
        policy=sync_policy,
    )

    # Step 3: Create MobileSimulateService and configure
    simulate_service = AsyncMobileSimulateService(agent_bay)
    simulate_service.set_simulate_enable(True)
    simulate_service.set_simulate_mode(MobileSimulateMode.PROPERTIES_ONLY)

    # Step 4: Check and upload mobile info if needed
    print("Checking or uploading mobile dev info file...")
    has_mobile_info = await simulate_service.has_mobile_info(context_sync)
    if not has_mobile_info:
        with open("mobile_info_model_a.json", "r") as f:
            mobile_info_content = f.read()
        
        upload_result = await simulate_service.upload_mobile_info(
            mobile_info_content, 
            context_sync
        )
        if not upload_result.success:
            print(f"Failed to upload: {upload_result.error_message}")
            return
        print("Mobile dev info uploaded successfully")
    else:
        print(f"Mobile dev info already exists: {has_mobile_info}")

    # Step 5: Create session with context sync
    params = CreateSessionParams(
        image_id="mobile_latest",
        context_syncs=[context_sync],
        extra_configs=ExtraConfigs(
            mobile=MobileExtraConfig(
                simulate_config=simulate_service.get_simulate_config()
            )
        )
    )

    print("Creating session...")
    session_result = await agent_bay.create(params)
    if not session_result.success or not session_result.session:
        print(f"Failed to create session: {session_result.error_message}")
        return

    session = session_result.session
    print(f"Session created with ID: {session.session_id}")

    # Step 6: Wait for mobile simulate to complete
    await asyncio.sleep(5)

    # Step 7: Use the session
    # Device info is automatically loaded from context
    print("Getting device model after mobile simulate...")
    result = await session.command.execute_command("getprop ro.product.model")
    if result.success:
        print(f"Session device model: {result.output.strip()}")

    # Step 8: Delete session with context sync
    print("Deleting session...")
    delete_result = await agent_bay.delete(session, sync_context=True)
    if not delete_result.success:
        print(f"Failed to delete session: {delete_result.error_message}")
        return
    print(f"Session deleted successfully (RequestID: {delete_result.request_id})")

if __name__ == "__main__":
    asyncio.run(main())
```

### TypeScript Example with Context

```typescript
import { AgentBay, MobileSimulateService, MobileSimulateMode, ContextSync, SyncPolicy } from 'wuying-agentbay-sdk';
import { readFileSync } from 'fs';

const client = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY! });

// Step 1: Get or create user-specific context
const contextResult = await client.context.get('user_phone_number', true);
if (!contextResult.success || !contextResult.context) {
  throw new Error(`Failed to get context: ${contextResult.errorMessage}`);
}

const context = contextResult.context;
console.log(`context.id = ${context.id}, context.name = ${context.name}`);

// Step 2: Create context sync configuration
const syncPolicy: SyncPolicy = {
  bwList: {
    whiteLists: [
      { path: '/com.wuying.devinfo', excludePaths: [] }
    ]
  }
};

const contextSync: ContextSync = {
  contextId: context.id,
  path: '/data/data',
  policy: syncPolicy
};

// Step 3: Create MobileSimulateService and configure
const simulateService = new MobileSimulateService(client);
simulateService.setSimulateEnable(true);
simulateService.setSimulateMode(MobileSimulateMode.PropertiesOnly);

// Step 4: Check and upload mobile info if needed
console.log('Checking or uploading mobile dev info file...');
const hasMobileInfo = await simulateService.hasMobileInfo(contextSync);
if (!hasMobileInfo) {
  const mobileInfoContent = readFileSync('mobile_info_model_a.json', 'utf-8');
  
  const uploadResult = await simulateService.uploadMobileInfo(
    mobileInfoContent,
    contextSync
  );
  if (!uploadResult.success) {
    throw new Error(`Failed to upload: ${uploadResult.errorMessage}`);
  }
  console.log('Mobile dev info uploaded successfully');
} else {
  console.log(`Mobile dev info already exists: ${hasMobileInfo}`);
}

// Step 5: Create session with context sync
const sessionResult = await client.create({
  imageId: 'mobile_latest',
  contextSync: [contextSync],
  extraConfigs: {
    mobile: {
      simulateConfig: simulateService.getSimulateConfig(),
    },
  },
});

if (!sessionResult.success || !sessionResult.session) {
  throw new Error(`Failed to create session: ${sessionResult.errorMessage}`);
}

const session = sessionResult.session;
console.log(`Session created with ID: ${session.sessionId}`);

// Step 6: Wait for mobile simulate to complete
await new Promise(resolve => setTimeout(resolve, 5000));

// Step 7: Use the session
const result = await session.command.executeCommand('getprop ro.product.model');
if (result.success) {
  console.log(`Device model: ${result.output.trim()}`);
}

// Step 8: Delete session with context sync
const deleteResult = await session.delete({ syncContext: true });
if (!deleteResult.success) {
  throw new Error(`Failed to delete session: ${deleteResult.errorMessage}`);
}
console.log(`Session deleted successfully (RequestID: ${deleteResult.requestId})`);
```

### Go Example with Context

```go
package main

import (
	"fmt"
	"os"
	"time"

	"github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay"
	"github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay/models"
)

func main() {
	client, err := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"))
	if err != nil {
		panic(err)
	}

	// Step 1: Get or create user-specific context
	fmt.Println("Getting a user specific context...")
	contextResult, err := client.Context.Get("user_phone_number", true)
	if err != nil {
		panic(err)
	}
	if !contextResult.Success || contextResult.Context == nil {
		panic(fmt.Sprintf("Failed to get context: %s", contextResult.ErrorMessage))
	}

	context := contextResult.Context
	fmt.Printf("context.id = %s, context.name = %s\n", context.ID, context.Name)

	// Step 2: Create context sync configuration
	syncPolicy := &agentbay.SyncPolicy{
		BWList: &agentbay.BWList{
			WhiteLists: []*agentbay.WhiteList{
				{
					Path:         "/com.wuying.devinfo",
					ExcludePaths: []string{},
				},
			},
		},
	}

	contextSync := &agentbay.ContextSync{
		ContextID: context.ID,
		Path:      "/data/data",
		Policy:    syncPolicy,
	}

	// Step 3: Create MobileSimulateService and configure
	fmt.Println("Creating mobile simulate service and set simulate params...")
	simulateService, err := agentbay.NewMobileSimulateService(client)
	if err != nil {
		panic(err)
	}
	simulateService.SetSimulateEnable(true)
	simulateService.SetSimulateMode(models.MobileSimulateModePropertiesOnly)

	// Step 4: Check and upload mobile info if needed
	fmt.Println("Checking or uploading mobile dev info file...")
	hasMobileInfo, err := simulateService.HasMobileInfo(contextSync)
	if err != nil {
		panic(err)
	}
	if !hasMobileInfo {
		mobileInfoContent, err := os.ReadFile("mobile_info_model_a.json")
		if err != nil {
			panic(err)
		}
		uploadResult := simulateService.UploadMobileInfo(
			string(mobileInfoContent),
			contextSync,
		)
		if !uploadResult.Success {
			panic(uploadResult.ErrorMessage)
		}
		fmt.Println("Mobile dev info uploaded successfully")
	} else {
		fmt.Printf("Mobile dev info already exists: %v\n", hasMobileInfo)
	}

	// Step 5: Create session with context sync
	params := &agentbay.CreateSessionParams{
		ImageId:     "mobile_latest",
		ContextSync: []*agentbay.ContextSync{contextSync},
		ExtraConfigs: &models.ExtraConfigs{
			Mobile: &models.MobileExtraConfig{
				SimulateConfig: simulateService.GetSimulateConfig(),
			},
		},
	}

	fmt.Println("Creating session...")
	sessionResult, err := client.Create(params)
	if err != nil {
		panic(err)
	}
	if !sessionResult.Success || sessionResult.Session == nil {
		panic(fmt.Sprintf("Failed to create session: %s", sessionResult.ErrorMessage))
	}

	session := sessionResult.Session
	fmt.Printf("Session created with ID: %s\n", session.SessionID)

	// Step 6: Wait for mobile simulate to complete
	fmt.Println("Waiting 5 seconds for mobile simulate to complete...")
	time.Sleep(5 * time.Second)

	// Step 7: Use the session
	fmt.Println("Getting device model after mobile simulate...")
	result, err := session.Command.ExecuteCommand("getprop ro.product.model")
	if err != nil {
		panic(err)
	}
	fmt.Printf("Device model: %s\n", result.Output)

	// Step 8: Delete session with context sync
	fmt.Println("Deleting session...")
	deleteResult, err := client.Delete(session, true)
	if err != nil {
		panic(err)
	}
	if !deleteResult.Success {
		panic(fmt.Sprintf("Failed to delete session: %s", deleteResult.ErrorMessage))
	}
	fmt.Printf("Session deleted successfully (RequestID: %s)\n", deleteResult.RequestID)
}
```


## Best Practices

### 1. Simulation Mode Selection

- **Development**: Use `PROPERTIES_ONLY` mode for faster iteration
- **Production**: Use `FULL` mode for comprehensive simulation

### 2. Verification

- **Always verify**: Check device properties after session creation
- **Wait time**: Allow 5-10 seconds for simulation to complete
- **Multiple checks**: Verify multiple properties to ensure complete simulation

```python
# Verify multiple device properties
properties_to_check = [
    "ro.product.model",
    "ro.product.manufacturer",
    "ro.build.version.release",
    "ro.product.brand"
]

for prop in properties_to_check:
    result = await session.command.execute_command(f"getprop {prop}")
    if result.success:
        print(f"{prop}: {result.output.strip()}")
```

### 5. Error Handling

Always implement proper error handling:

```python
import asyncio

async def main():
    session = None

    try:
        # Create and configure simulate service
        simulate_service = AsyncMobileSimulateService(agent_bay)
        simulate_service.set_simulate_enable(True)
        simulate_service.set_simulate_mode(MobileSimulateMode.PROPERTIES_ONLY)
        
        # Upload mobile info
        upload_result = await simulate_service.upload_mobile_info(mobile_info_content)
        if not upload_result.success:
            raise Exception(f"Upload failed: {upload_result.error_message}")
        
        # Create session
        session_result = await agent_bay.create(params)
        if not session_result.success or not session_result.session:
            raise Exception(f"Session creation failed: {session_result.error_message}")
        
        session = session_result.session
        # Use session
        # ...
        
    except Exception as e:
        print(f"Error: {e}")
    finally:
        if session:
            try:
                delete_result = await agent_bay.delete(session, sync_context=True)
                if not delete_result.success:
                    print(f"Failed to delete session: {delete_result.error_message}")
            except Exception as e:
                print(f"Cleanup error: {e}")

if __name__ == "__main__":
    asyncio.run(main())
```

### 6. Resource Cleanup

Always clean up resources properly:

```python
# Clean up sessions
try:
    delete_result = await agent_bay.delete(session, sync_context=True)
    if not delete_result.success:
        print(f"Failed to delete session: {delete_result.error_message}")
except Exception as e:
    print(f"Cleanup error: {e}")
```

## Related Documentation

- [Mobile Session Configuration](./mobile-session-configuration.md) - Additional mobile configuration options
- [Mobile Application Management](./mobile-application-management.md) - Managing mobile applications
- [Mobile UI Automation](./mobile-ui-automation.md) - Automating mobile UI interactions

## Example Code

Complete working examples are available in the SDK repository:

- **Python (Async)**: `python/docs/examples/_async/mobile-use/mobile_simulate_basic_usage.py`
- **Python with Context (Async)**: `python/docs/examples/_async/mobile-use/mobile_simulate_with_ctx.py`
- **Python (Sync)**: `python/docs/examples/_sync/mobile-use/mobile_simulate_basic_usage.py`
- **Python with Context (Sync)**: `python/docs/examples/_sync/mobile-use/mobile_simulate_with_ctx.py`
- **TypeScript**: `typescript/docs/examples/mobile-use/mobile-simulate-basic-usage.ts`
- **TypeScript with Context**: `typescript/docs/examples/mobile-use/mobile-simulate-with-ctx.ts`
- **Go**: `golang/docs/examples/mobile-use/mobile_simulate_basic_usage/main.go`
- **Go with Context**: `golang/docs/examples/mobile-use/mobile_simulate_with_ctx/main.go`





# Mobile UI Automation Guide

This guide covers mobile UI automation capabilities in AgentBay SDK for Android mobile environments, including touch operations, text input, UI element detection, and screen operations.

## üìã Table of Contents

- [Overview](#overview)
- [Prerequisites](#prerequisites)
- [Touch Operations](#touch-operations)
- [Text Input Operations](#text-input-operations)
- [UI Element Detection](#ui-element-detection)
- [Screen Operations](#screen-operations)
- [Best Practices](#best-practices)
- [Common Use Cases](#common-use-cases)
- [Troubleshooting](#troubleshooting)

<a id="overview"></a>
## üéØ Overview

AgentBay provides powerful mobile UI automation capabilities for interacting with Android mobile environments in the cloud. You can:

1. **Touch Operations** - Tap and swipe gestures for mobile interaction
2. **Text Input** - Input text and send hardware key events
3. **UI Element Detection** - Discover and interact with UI elements
4. **Screen Operations** - Capture screenshots for visual verification

All operations are performed through the `session.mobile` module, which provides a comprehensive API for mobile automation tasks.

<a id="prerequisites"></a>
## ‚öôÔ∏è Prerequisites

Mobile UI automation requires creating a session with a mobile system image (this example uses `mobile_latest` for verification):

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams

agent_bay = AgentBay()
session_params = CreateSessionParams(image_id="mobile_latest")
session = agent_bay.create(session_params).session
# Session created successfully for mobile automation
```

<a id="touch-operations"></a>
## üëÜ Touch Operations

### Tap Gesture

Tap on the screen at specific coordinates:

```python
session_params = CreateSessionParams(image_id="mobile_latest")
session = agent_bay.create(session_params).session

# Tap at coordinates
result = session.mobile.tap(x=500, y=300)
if result.success:
    print("Tap successful")  # Output: Tap successful
else:
    print(f"Tap failed: {result.error_message}")

agent_bay.delete(session)
```

### Swipe Gesture

Perform swipe gestures from one point to another:

```python
session_params = CreateSessionParams(image_id="mobile_latest")
session = agent_bay.create(session_params).session

# Swipe up (from bottom to top)
result = session.mobile.swipe(
    start_x=100,
    start_y=500,
    end_x=100,
    end_y=200,
    duration_ms=300
)
if result.success:
    print("Swipe up successful")  # Output: Swipe up successful

# Swipe left (from right to left)
result = session.mobile.swipe(
    start_x=500,
    start_y=300,
    end_x=100,
    end_y=300,
    duration_ms=300
)
if result.success:
    print("Swipe left successful")  # Output: Swipe left successful

agent_bay.delete(session)
```

**Parameters:**
- `start_x`, `start_y`: Starting coordinates
- `end_x`, `end_y`: Ending coordinates
- `duration_ms`: Duration of the swipe in milliseconds (default: 300)

<a id="text-input-operations"></a>
## ‚å®Ô∏è Text Input Operations

### Input Text

Type text into the active field:

```python
session_params = CreateSessionParams(image_id="mobile_latest")
session = agent_bay.create(session_params).session

result = session.mobile.input_text("Hello AgentBay!")
if result.success:
    print("Text input successful")  # Output: Text input successful

agent_bay.delete(session)
```

### Send Hardware Key Events

Send Android hardware key events using KeyCode constants:

```python
from agentbay import KeyCode

session_params = CreateSessionParams(image_id="mobile_latest")
session = agent_bay.create(session_params).session

# Press HOME key
result = session.mobile.send_key(KeyCode.HOME)
if result.success:
    print("HOME key pressed")  # Output: HOME key pressed

# KeyCode values are: HOME=3, BACK=4, VOLUME_UP=24, VOLUME_DOWN=25, POWER=26, MENU=82
print(f"HOME keycode value: {KeyCode.HOME}")  # Output: HOME keycode value: 3

agent_bay.delete(session)
```

**Available KeyCode Constants:**

| KeyCode | Value | Description |
|---------|-------|-------------|
| `KeyCode.HOME` | 3 | Home button |
| `KeyCode.BACK` | 4 | Back button |
| `KeyCode.VOLUME_UP` | 24 | Volume up button |
| `KeyCode.VOLUME_DOWN` | 25 | Volume down button |
| `KeyCode.POWER` | 26 | Power button |
| `KeyCode.MENU` | 82 | Menu button |

**Note:** All hardware keys can be used for mobile device automation. The key press events are sent to the Android system and executed accordingly.

<a id="ui-element-detection"></a>
## üîç UI Element Detection

### Get All UI Elements

Retrieve all UI elements in the current screen hierarchy:

```python
session_params = CreateSessionParams(image_id="mobile_latest")
session = agent_bay.create(session_params).session

result = session.mobile.get_all_ui_elements(timeout_ms=2000)
if result.success:
    print(f"Found {len(result.elements)} UI elements")  # Output: Found 2172 UI elements
    for element in result.elements:
        # Element structure varies, inspect element data
        print(f"Element: {element}")
        # Output example: Element data contains UI hierarchy information
else:
    print(f"Failed: {result.error_message}")

agent_bay.delete(session)
```

**Parameters:**
- `timeout_ms`: Timeout in milliseconds to wait for UI elements (default: 2000)

### Get Clickable UI Elements

Retrieve only clickable/interactable UI elements:

```python
session_params = CreateSessionParams(image_id="mobile_latest")
session = agent_bay.create(session_params).session

result = session.mobile.get_clickable_ui_elements(timeout_ms=2000)
if result.success:
    print(f"Found {len(result.elements)} clickable elements")  # Output: Found 3 clickable elements
    for element in result.elements:
        # Process clickable elements
        print(f"Clickable element: {element}")
        # Output example: Clickable element data with interaction capabilities
else:
    print(f"Failed: {result.error_message}")

agent_bay.delete(session)
```

**Parameters:**
- `timeout_ms`: Timeout in milliseconds to wait for UI elements (default: 2000)

<a id="screen-operations"></a>
## üì∏ Screen Operations

### Take Screenshot

Capture a screenshot of the current mobile screen:

```python
session_params = CreateSessionParams(image_id="mobile_latest")
session = agent_bay.create(session_params).session

result = session.mobile.screenshot()
if result.success:
    screenshot_url = result.data
    print(f"Screenshot URL: {screenshot_url}")
    # Output: Screenshot URL: https://***.***.aliyuncs.com/***/screenshot_1234567890.png?***
else:
    print(f"Screenshot failed: {result.error_message}")

agent_bay.delete(session)
```

<a id="best-practices"></a>
## üí° Best Practices

### 1. Always Use Mobile System Images

Mobile UI automation requires a mobile system image (examples below use `mobile_latest`):

```python
# Correct - using mobile system image
session_params = CreateSessionParams(image_id="mobile_latest")
session = agent_bay.create(session_params).session

# Incorrect - will not work for mobile operations
session_params = CreateSessionParams(image_id="windows_latest")
session = agent_bay.create(session_params).session
```

### 4. Handle Screenshot URLs Properly

Screenshots return OSS URLs, not image data:

```python
result = session.mobile.screenshot()
if result.success:
    screenshot_url = result.data
    print(f"Screenshot available at: {screenshot_url}")
    # Output: Screenshot available at: https://***.***.aliyuncs.com/***/screenshot_1234567890.png?***
    # Use the URL to download or display the screenshot as needed
else:
    print(f"Screenshot failed: {result.error_message}")
```

<a id="common-use-cases"></a>
## üé® Common Use Cases

### Example 1: App Navigation

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams

agent_bay = AgentBay()
session_params = CreateSessionParams(image_id="mobile_latest")
session = agent_bay.create(session_params).session

try:
    # Tap on app icon
    tap_result = session.mobile.tap(x=200, y=400)
    print(f"App tap result: {tap_result.success}")  # Output: App tap result: True
    
    # Wait a moment for app to load
    import time
    time.sleep(2)
    
    # Swipe to navigate
    swipe_result = session.mobile.swipe(
        start_x=400,
        start_y=600,
        end_x=100,
        end_y=600,
        duration_ms=300
    )
    print(f"Navigation swipe result: {swipe_result.success}")  # Output: Navigation swipe result: True
    
    # Tap on a button
    button_result = session.mobile.tap(x=300, y=800)
    print(f"Button tap result: {button_result.success}")  # Output: Button tap result: True
    
finally:
    agent_bay.delete(session)
```

### Example 2: Form Input on Mobile

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams

agent_bay = AgentBay()
session_params = CreateSessionParams(image_id="mobile_latest")
session = agent_bay.create(session_params).session

try:
    # Tap on username field
    username_tap = session.mobile.tap(x=300, y=400)
    print(f"Username field focused: {username_tap.success}")  # Output: Username field focused: True
    
    # Enter username
    username_input = session.mobile.input_text("john_doe")
    print(f"Username entered: {username_input.success}")  # Output: Username entered: True
    
    # Tap on password field
    password_tap = session.mobile.tap(x=300, y=500)
    print(f"Password field focused: {password_tap.success}")  # Output: Password field focused: True
    
    # Enter password
    password_input = session.mobile.input_text("secure_password")
    print(f"Password entered: {password_input.success}")  # Output: Password entered: True
    
    # Tap login button
    login_tap = session.mobile.tap(x=300, y=650)
    print(f"Login button pressed: {login_tap.success}")  # Output: Login button pressed: True
    
finally:
    agent_bay.delete(session)
```

### Example 3: UI Element Discovery and Interaction

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams

agent_bay = AgentBay()
session_params = CreateSessionParams(image_id="mobile_latest")
session = agent_bay.create(session_params).session

try:
    # Get all clickable elements
    result = session.mobile.get_clickable_ui_elements(timeout_ms=3000)
    
    if result.success:
        print(f"Found {len(result.elements)} clickable elements")  # Output: Found 3 clickable elements
        
        # Analyze elements to find target
        for i, element in enumerate(result.elements):
            print(f"Element {i+1}: {element}")  
            # Output example:
            # Element 1: UI element with interaction capabilities
            # Element 2: UI element with interaction capabilities  
            # Element 3: UI element with interaction capabilities
    
    # Take screenshot for verification
    screenshot = session.mobile.screenshot()
    if screenshot.success:
        screenshot_url = screenshot.data
        print(f"Screenshot URL: {screenshot_url}")
        # Output: Screenshot URL: https://***.***.aliyuncs.com/***/screenshot_1234567890.png?***
    
finally:
    agent_bay.delete(session)
```

### Example 4: Scroll Through Content

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams

agent_bay = AgentBay()
session_params = CreateSessionParams(image_id="mobile_latest")
session = agent_bay.create(session_params).session

try:
    # Scroll down multiple times
    for i in range(3):
        scroll_result = session.mobile.swipe(
            start_x=300,
            start_y=800,
            end_x=300,
            end_y=200,
            duration_ms=400
        )
        print(f"Scroll down {i+1}: {scroll_result.success}")  # Output: Scroll down 1: True, etc.
        
        # Brief pause between scrolls
        import time
        time.sleep(1)
    
    # Scroll back up
    up_result = session.mobile.swipe(
        start_x=300,
        start_y=200,
        end_x=300,
        end_y=800,
        duration_ms=400
    )
    print(f"Scroll up result: {up_result.success}")  # Output: Scroll up result: True
    
finally:
    agent_bay.delete(session)
```

<a id="troubleshooting"></a>
## üÜò Troubleshooting

### Common Issues

1. **"Tool not found" errors**
   - Ensure you're using a mobile system image (e.g., `image_id="mobile_latest"`)
   - Verify the session was created successfully
   - Check that API key and endpoint are configured correctly

2. **Hardware key operations**
   - Hardware key operations send key events to the Android system
   - Check the `result.success` status to verify if the key was sent successfully
   - Example error handling:
     ```python
     result = session.mobile.send_key(KeyCode.HOME)
     if not result.success:
         print(f"Key press failed: {result.error_message}")
     ```

3. **UI element detection returns empty results**
   - Increase the `timeout_ms` parameter
   - Take a screenshot to verify the current UI state
   - Ensure the target screen has fully loaded

4. **Screenshot URL handling**
   - Screenshots return OSS URLs, not image data
   - `result.data` contains a download URL, not the image itself
   - Use the URL to download the screenshot if needed

5. **Swipe gestures not working as expected**
   - Verify coordinates are within screen bounds
   - Adjust `duration_ms` for different gesture speeds
   - Ensure start and end coordinates create meaningful swipe direction

### Getting Help

For more assistance:
- Review [Session Management Guide](../common-features/basics/session-management.md)

## üìö Related Guides

- [Session Management Guide](../common-features/basics/session-management.md) - Learn about session lifecycle
- [Computer UI Automation](../computer-use/computer-ui-automation.md) - Windows desktop automation
- [Command Execution](../common-features/basics/command-execution.md) - Execute shell commands
- [File Operations](../common-features/basics/file-operations.md) - Upload and download files




# Quick Start Guide for Beginners

Welcome to AgentBay SDK! This guide provides a step-by-step learning path for users new to cloud development.

## üéØ Learning Objectives

After completing this quick start guide, you will be able to:
- Understand AgentBay's core concepts
- Create your first cloud session (both sync and async)
- Perform basic file and command operations in the cloud
- Choose between synchronous and asynchronous APIs
- Learn how to save and reuse your work

## üìö Learning Path (Estimated 30 minutes)

### Step 1: Environment Setup (5 minutes)
- [Installation and Configuration](installation.md)
- Get API key
- Verify installation

### Step 2: Core Concepts (10 minutes)
- [Understanding Basic Concepts](basic-concepts.md)
- What is a cloud session?
- Differences between sessions and local environments
- Data persistence concepts

### Step 3: First Program (10 minutes)
- [Create Your First Session](first-session.md)
- Quick verification (30 seconds) - Sync & Async
- Cloud data processing example - Sync & Async
- Understanding the differences

### Step 4: Choosing Your API Style (5 minutes)
- When to use synchronous API
- When to use asynchronous API
- Performance considerations

## üîÑ Synchronous vs Asynchronous APIs

AgentBay provides both synchronous and asynchronous APIs. Here's a quick comparison to help you choose:

### Synchronous API (Recommended for Beginners)

**Best for:**
- Learning AgentBay
- Scripts and automation
- CLI tools
- Simple, sequential tasks

**Example:**
```python
from agentbay import AgentBay

agent_bay = AgentBay()
session = agent_bay.create().session
result = session.command.execute_command("echo 'Hello'")
print(result.output)
agent_bay.delete(session)
```

### Asynchronous API

**Best for:**
- Web applications (FastAPI, Django async views)
- High-concurrency scenarios
- Real-time systems
- Processing multiple tasks simultaneously

**Example:**
```python
import asyncio
from agentbay import AsyncAgentBay

async def main():
    agent_bay = AsyncAgentBay()
    session = (await agent_bay.create()).session
    result = await session.command.execute_command("echo 'Hello'")
    print(result.output)
    await agent_bay.delete(session)

asyncio.run(main())
```

### Quick Decision Guide

| Your Situation | Recommended API |
|----------------|-----------------|
| Just learning AgentBay | **Sync** |
| Building a script or CLI tool | **Sync** |
| Building a web application | **Async** |
| Need to handle 100+ concurrent operations | **Async** |
| Simple automation tasks | **Sync** |
| Real-time data processing | **Async** |


## üöÄ Next Steps After Completion

### Core Features
- **[Session Management](../guides/common-features/basics/session-management.md)** - Advanced session patterns
- **[File Operations](../guides/common-features/basics/file-operations.md)** - Upload, download, and manage files
- **[Command Execution](../guides/codespace/code-execution.md)** - Run shell commands and code
- **[Data Persistence](../guides/common-features/basics/data-persistence.md)** - Save and reuse your work

### Advanced Topics
- **[Browser Automation](../guides/computer-use/computer-ui-automation.md)** - Web scraping and testing
- **[Mobile Testing](../guides/mobile-use/mobile-ui-automation.md)** - Android app automation

### Explore More
- Check out the [Feature Guides](../guides/README.md) to learn about complete functionality
- Explore [Use Cases](../guides/common-features/use-cases/README.md) for practical application examples
- Join community discussions

## ‚ùì Having Issues?

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation](../README.md)

## üí° Tips

- **Start with Sync API** - It's simpler and easier to understand for beginners
- **Each step includes complete code examples** - Both sync and async versions where applicable
- **Don't worry if you don't understand everything at first** - Learning takes time
- **The community is here to help!** - Don't hesitate to ask questions
- **Try the examples yourself** - Hands-on practice is the best way to learn

## üìä Learning Progress Checklist

- [ ] Completed environment setup
- [ ] Understood basic concepts
- [ ] Created first session (sync)
- [ ] Tried async version (optional for beginners)
- [ ] Understand when to use sync vs async
- [ ] Ready to explore advanced features

**Congratulations!** Once you've completed these steps, you're ready to build amazing applications with AgentBay! üéâ




# Core Concepts

Before we start programming, let's understand the essential concepts you need to know to use AgentBay effectively.

## üåê What is AgentBay?

AgentBay is a cloud computing platform that provides on-demand virtual environments. You can think of it as:
- Cloud-based remote computers that support different operating systems (Windows, Linux, Android)
- Virtual machines that can be created and destroyed instantly
- Designed specifically for automation, testing, and development tasks

### üì¶ AgentBay Class - Your Cloud Gateway

In the SDK, the `AgentBay` class is your main interface for interacting with the cloud service:

```python
from agentbay import AgentBay

# Create AgentBay client instance
agent_bay = AgentBay()
```

**Core functions of the AgentBay class:**
- **Session Manager**: Create, delete, and manage cloud sessions
- **API Client**: Handle all communication with AgentBay cloud service
- **Authentication Handler**: Automatically manage API keys and security

**Basic usage pattern:**
```python
# 1. Initialize client
agent_bay = AgentBay()

# 2. Create session (uses linux_latest by default)
session = agent_bay.create().session

# 3. Use session for your tasks
# ... your automation tasks ...

# 4. Clean up resources
agent_bay.delete(session)
```

**Learn more**: [SDK Configuration Guide](../guides/common-features/configuration/sdk-configuration.md)

## üîó Session

A **session** is your connection to a cloud environment. It's like renting a computer in the cloud for a specific period of time.

### Key Characteristics:
- **Temporary**: Sessions are created when you need them and destroyed when you're done
- **Isolated**: Each session is completely separate from others
- **Billable**: You pay for the time your session is active

### Basic Usage:
```python
# Create a session
session = agent_bay.create().session

# Use the session for your tasks
session.command.execute_command("echo 'Hello World'")

# Always clean up when done
agent_bay.delete(session)
```

### Session Lifecycle:
```
Create Session ‚Üí Use Session ‚Üí (Pause Session) ‚Üí (Resume Session) ‚Üí Delete Session
      ‚Üì             ‚Üì              ‚Üì                ‚Üì              ‚Üì
  Allocate      Execute      Suspend Resources  Restore Resources Release
  Resources     Operations                    Operations         Resources
```

### Session Pause and Resume

Sessions can be temporarily paused to suspend resource usage and resumed later to continue work. This is useful for:
- Reducing costs during inactive periods
- Preserving session state for later continuation

**Pausing a Session:**
```python
# Pause the session to suspend resource usage
result = session.pause()
if result.success:
    print(f"Session paused successfully. Request ID: {result.request_id}")
else:
    print(f"Failed to pause session: {result.error_message}")
```

**Resuming a Session:**
```python
# Resume the session to continue work
result = session.resume()
if result.success:
    print(f"Session resumed successfully. Request ID: {result.request_id}")
else:
    print(f"Failed to resume session: {result.error_message}")
```

**Note:** Pause and resume operations are optional. You can also directly delete a session without pausing it. During pause, resource usage and costs will be lower.

### Session Release

Sessions must be released when you're done to free cloud resources. There are **two ways** to release a session:

**1. Manual Release (Recommended)**
```python
# Explicitly delete when done
agent_bay.delete(session)
```

**2. Automatic Timeout Release**
- If not manually deleted, sessions are automatically released after a timeout period
- Timeout duration is configured in the [AgentBay Console](https://agentbay.console.aliyun.com/)
- After timeout, the session is released and cannot be recovered

**Important**: Always manually delete sessions when finished. This is a best practice for resource management.

**Learn more**: [Session Management Guide](../guides/common-features/basics/session-management.md)

## üñ•Ô∏è Image Types

When creating a session, you must choose an **image type** - this determines what kind of environment you get and what you can do with it.

### Official System Images:

The following table shows the latest official system images provided by AgentBay:

| Image ID | Environment | Best For |
|----------|-------------|----------|
| `linux_latest` | Computer Use | General computing, server tasks (default if not specified) |
| `windows_latest` | Computer Use | General Windows tasks, .NET development, Windows apps |
| `browser_latest` | Browser Use | Web scraping, browser automation, testing websites |
| `code_latest` | CodeSpace  | Coding, development tools, programming tasks |
| `mobile_latest` | Mobile Use | Mobile app testing, Android automation |

**Note**:
- If you don't specify an `image_id`, AgentBay will automatically use `linux_latest` as the default environment.
- These are the current latest versions of official system images. You can also create and use **custom images** through the AgentBay console to meet your specific requirements.

**‚ö†Ô∏è Production Environment Recommendation**:
- The `xxxx_latest` images are automatically updated to newer versions, which may introduce API incompatibilities with older SDK versions.
- **For production environments**, it is strongly recommended to use **custom images** with fixed versions to ensure stability and avoid unexpected breaking changes.
- Learn more about custom images and how to create them: [Custom Images Guide](../guides/common-features/advanced/custom-images.md)

### Choosing the Right Image:

**Windows Environment Example:**
```python
from agentbay import CreateSessionParams

# Create Windows environment and automate notepad
params = CreateSessionParams(image_id="windows_latest")
session = agent_bay.create(params).session

# Start Notepad application
session.computer.start_app("notepad.exe")
# Returns: ProcessListResult with started process info

# Input text into notepad
session.computer.input_text("Hello from Windows!")
# Returns: BoolResult with success status

agent_bay.delete(session)
```

**Browser Environment Example:**
```python
# Create browser environment
params = CreateSessionParams(image_id="browser_latest")
session = agent_bay.create(params).session

# Initialize and navigate
from agentbay import BrowserOption
session.browser.initialize(BrowserOption())
session.browser.agent.navigate("https://www.baidu.com")
print("Web navigation successful")

agent_bay.delete(session)
```

**CodeSpace Environment Example:**
```python
# Create development environment and execute code
params = CreateSessionParams(image_id="code_latest")
session = agent_bay.create(params).session

# Execute code
result = session.code.run_code("print('Hello from CodeSpace!')", "python")
# Returns: CodeExecutionResult with output
# Example: result.result = "Hello from CodeSpace!"

agent_bay.delete(session)
```

**Mobile Environment Example:**
```python
# Create Android environment and send HOME key
params = CreateSessionParams(image_id="mobile_latest")
session = agent_bay.create(params).session

# Press HOME key to return to home screen
from agentbay import KeyCode
session.mobile.send_key(KeyCode.HOME)
# Returns: BoolResult with success status
# Example: result.success = True (returns to Android home screen)

agent_bay.delete(session)
```

**Important**: Different images support different features. Choose the image that matches your specific use case.

**Learn more about each environment:**
- [Computer Use Guide](../guides/computer-use/README.md) - Windows/Linux automation
- [Browser Use Guide](../guides/browser-use/README.md) - Web automation and scraping
- [CodeSpace Guide](../guides/codespace/README.md) - Code execution environments
- [Mobile Use Guide](../guides/mobile-use/README.md) - Android automation

## üíæ Data Permanence - Temporary vs Persistent

Understanding data permanence is crucial when using cloud environments:

### Temporary Data (Default Behavior)
- **All data in a session is temporary by default**
- **Everything is lost when the session ends**
- Suitable for: processing tasks, temporary files, cache

```python
# This data will be LOST when session ends
session.file_system.write_file("/tmp/temp_data.txt", "This will disappear")
```

### Persistent Data (Context)
- **Data that survives across sessions**
- **Must be explicitly configured**
- Suitable for: project files, configurations, important results

```python
from agentbay import ContextSync

# Create persistent storage
context = agent_bay.context.get("my-project", create=True).context
context_sync = ContextSync.new(context.id, "/persistent")

# Create session with persistent data
params = CreateSessionParams(context_syncs=[context_sync])
session = agent_bay.create(params).session

# This data will be SAVED across sessions
session.file_system.write_file("/persistent/important.txt", "This will persist")
```

**Critical Rule**: If you need to keep data, you MUST use Context. Otherwise, it will be lost forever when the session ends.

**Learn more**: 
- [Data Persistence Guide](../guides/common-features/basics/data-persistence.md)
- [File Operations Guide](../guides/common-features/basics/file-operations.md)

## üîç Understanding API Results and Request IDs

When you call AgentBay APIs, the results are wrapped in result objects that contain more than just your data:

```python
# Example API call
screenshot = session.computer.screenshot()

# The result object contains:
print(screenshot.success)     # True/False - whether the operation succeeded
print(screenshot.data)        # Your actual data (screenshot URL)
print(screenshot.request_id)  # Request ID for troubleshooting
```

### What is a Request ID?
Every API call to AgentBay gets a unique **Request ID** - a special identifier like `"ABC12345-XXXX-YYYY-ZZZZ-123456789ABC"`.

**Why Request IDs matter:**
- **Troubleshooting**: If something goes wrong, you can provide this ID to support for faster problem resolution
- **Tracking**: Helps track individual operations in logs
- **Debugging**: Makes it easier to identify which specific API call had issues

**When you might need it:**
- API calls fail unexpectedly
- Performance issues with specific operations
- When contacting support about problems

**Example troubleshooting:**
```python
result = session.code.run_code("print('hello')", "python")
if not result.success:
    print(f"Code execution failed! Request ID: {result.request_id}")
    # Share this Request ID with support for faster help
```

Don't worry about Request IDs for normal usage - they're just there when you need them for debugging!

**Learn more**: [Common Features Guide](../guides/common-features/README.md)

## üöÄ Quick Start

Now you understand the essentials:

1. **AgentBay** = Cloud computing platform
2. **Session** = Your temporary connection to a cloud computer
3. **Image** = The type of environment (Linux/Windows/Browser/Code/Mobile)
4. **Data** = Temporary by default, use Context for persistence

Ready to create your first session? Check out the [First Session Guide](first-session.md) - a 5-minute hands-on tutorial!




# Create Your First Session

Now let's experience the core features of AgentBay through actual code.

## üöÄ Before You Start (2-minute setup)

If you haven't completed the setup yet, please complete the quick setup steps:

üëâ **[Installation and API Key Setup Guide](installation.md)** - Complete SDK installation and API key configuration in 2 minutes

Already done? Great! Let's verify everything works with a quick test.

## üí° 30-Second Quick Verification

Let's first verify everything works with the simplest possible example:

```python
import os
from agentbay import AgentBay

api_key = os.getenv("AGENTBAY_API_KEY")
agent_bay = AgentBay(api_key=api_key)

result = agent_bay.create()
if result.success:
    session = result.session
    cmd_result = session.command.execute_command("echo 'Hello from the cloud!'")
    print(f"‚úÖ Cloud says: {cmd_result.output.strip()}")
    agent_bay.delete(session)
else:
    print(f"‚ùå Failed: {result.error_message}")

# Expected output:
# ‚úÖ Cloud says: Hello from the cloud!
```

If this works, you're ready to explore more! üéâ

## üåü A Practical Example: Cloud Data Processing

Let's do something more useful - process a data file in the cloud:

```python
import os
from agentbay import AgentBay

agent_bay = AgentBay(api_key=os.getenv("AGENTBAY_API_KEY"))
result = agent_bay.create()
session = result.session

try:
    # 1. Create a Python script for data processing
    script_content = '''
import json
import sys

data = {
    "students": [
        {"name": "Alice", "scores": [85, 92, 88]},
        {"name": "Bob", "scores": [78, 85, 80]},
        {"name": "Charlie", "scores": [92, 95, 98]}
    ]
}

results = []
for student in data["students"]:
    avg = sum(student["scores"]) / len(student["scores"])
    results.append({
        "name": student["name"],
        "average": round(avg, 2),
        "grade": "A" if avg >= 90 else "B" if avg >= 80 else "C"
    })

print(json.dumps(results, indent=2))
'''

    # 2. Upload script to cloud
    session.file_system.write_file("/tmp/process_data.py", script_content)
    print("‚úÖ Script uploaded to cloud")

    # 3. Execute the script in cloud environment
    result = session.command.execute_command("python3 /tmp/process_data.py")
    print(f"\nüìä Processing results:\n{result.output}")

    # Expected output:
    # [
    #   {"name": "Alice", "average": 88.33, "grade": "B"},
    #   {"name": "Bob", "average": 81.0, "grade": "B"},
    #   {"name": "Charlie", "average": 95.0, "grade": "A"}
    # ]

    print("\nüí° What happened:")
    print("  1. Uploaded Python script to cloud environment")
    print("  2. Executed script with pre-installed Python")
    print("  3. Got results back - all without local setup!")

finally:
    agent_bay.delete(session)
    print("\n‚úÖ Session cleaned up")

# Expected output includes JSON formatted student grades
```

## üí° What You Learned

**The AgentBay Workflow:**
1. **Create** - Get a fresh cloud environment (`agent_bay.create()`)
2. **Use** - Execute commands, upload/download files
3. **Cleanup** - Delete session to free resources (`agent_bay.delete()`)

**Key Operations:**
- `agent_bay.create()` - Create a new cloud session
- `session.command.execute_command()` - Run shell commands
- `session.file_system.write_file()` - Upload files
- `agent_bay.delete(session)` - Clean up resources

---

## üí° Need Async API?

This quickstart uses synchronous API for simplicity. If you're building a web app or need high concurrency, check out:

---

## üöÄ Next Steps

Now that you've created your first session, explore more capabilities:

**Learn Core Features:**
- üìù **[Command Execution](../guides/codespace/code-execution.md)** - Run shell commands and code
- üìÅ **[File Operations](../guides/common-features/basics/file-operations.md)** - Upload, download, and manage files
- üîß **[Session Management](../guides/common-features/basics/session-management.md)** - Advanced session patterns and best practices

**Explore Use Cases:**
- üåê **[Browser Automation](../guides/computer-use/computer-ui-automation.md)** - Web scraping and testing
- üì± **[Mobile Testing](../guides/mobile-use/mobile-ui-automation.md)** - Android app automation
- üíª **[Code Development](../guides/codespace/code-execution.md)** - Cloud development environment

**Ready to build something amazing?** Check out the [Feature Guides](../guides/README.md) to explore all capabilities! üöÄ




# Installation and Configuration

## üìã System Requirements

### Python
- Python 3.10+
- pip or poetry

### TypeScript/JavaScript
- Node.js 14+
- npm or yarn

### Golang
- Go 1.24.4+

## üöÄ Quick Installation

### Python

**‚úÖ Recommended: Using Virtual Environment**
```bash
# Create and activate virtual environment
python3 -m venv agentbay-env
source agentbay-env/bin/activate  # Linux/macOS
# agentbay-env\Scripts\activate   # Windows

# Install the package
pip install wuying-agentbay-sdk

# Verify installation
python -c "import agentbay; print('‚úÖ Installation successful')"
```

**Alternative: Using System Python (if allowed)**
```bash
# Install with user flag (if system allows)
pip install --user wuying-agentbay-sdk

# Verify installation  
python -c "import agentbay; print('‚úÖ Installation successful')"
```

### TypeScript/JavaScript

```bash
# Initialize project (if new project)
mkdir my-agentbay-project && cd my-agentbay-project
npm init -y

# Install the package
npm install wuying-agentbay-sdk

# Verify installation
node -e "const {AgentBay} = require('wuying-agentbay-sdk'); console.log('‚úÖ Installation successful')"
```

### Golang

```bash
# Initialize module (if new project)
mkdir my-agentbay-project && cd my-agentbay-project  
go mod init my-agentbay-project

# Install the package
GOPROXY=direct go get github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay

# Verify installation
go list -m github.com/aliyun/wuying-agentbay-sdk/golang && echo "‚úÖ Installation successful"
```

## üîë API Key Setup

### Step 1: Get API Key
1. Register at [https://aliyun.com](https://aliyun.com)
2. Visit [AgentBay Console](https://agentbay.console.aliyun.com/service-management)  
3. Create and copy your API key

### Step 2: Set Environment Variable

**Linux/macOS:**
```bash
export AGENTBAY_API_KEY=your_api_key_here
```

**Windows:**
```cmd
setx AGENTBAY_API_KEY your_api_key_here
```

## ‚úÖ Installation Verification

Create a simple test to verify everything works with your API key:

### Python Test
```python
import os
from agentbay import AgentBay

# Get API key from environment
api_key = os.getenv("AGENTBAY_API_KEY")
if not api_key:
    print("‚ö†Ô∏è  Please set AGENTBAY_API_KEY environment variable")
    exit(1)

try:
    # Initialize SDK
    agent_bay = AgentBay(api_key=api_key)
    print("‚úÖ SDK initialized successfully")
    
    # Create a session (requires valid API key and network)
    session_result = agent_bay.create()
    if session_result.success:
        session = session_result.session
        print(f"‚úÖ Session created: {session.session_id}")
        
        # Clean up
        agent_bay.delete(session)
        print("‚úÖ Test completed successfully")
    else:
        print(f"‚ö†Ô∏è  Session creation failed: {session_result.error_message}")
        
except Exception as e:
    print(f"‚ùå Error: {e}")
```

### TypeScript Test
```typescript
import { AgentBay } from 'wuying-agentbay-sdk';

const apiKey = process.env.AGENTBAY_API_KEY;
if (!apiKey) {
    console.log("‚ö†Ô∏è  Please set AGENTBAY_API_KEY environment variable");
    process.exit(1);
}

async function test() {
    try {
        // Initialize SDK
        const agentBay = new AgentBay({ apiKey });
        console.log("‚úÖ SDK initialized successfully");
        
        // Create a session (requires valid API key and network)
        const sessionResult = await agentBay.create();
        if (sessionResult.success) {
            const session = sessionResult.session;
            console.log(`‚úÖ Session created: ${session.sessionId}`);
            
            // Clean up
            await agentBay.delete(session);
            console.log("‚úÖ Test completed successfully");
        } else {
            console.log(`‚ö†Ô∏è  Session creation failed: ${sessionResult.errorMessage}`);
        }
    } catch (error) {
        console.log(`‚ùå Error: ${error}`);
    }
}

test();
```

### Golang Test
```go
package main

import (
    "fmt"
    "os"
    "github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay"
)

func main() {
    // Get API key from environment
    apiKey := os.Getenv("AGENTBAY_API_KEY")
    if apiKey == "" {
        fmt.Println("‚ö†Ô∏è  Please set AGENTBAY_API_KEY environment variable")
        return
    }

    // Initialize SDK
    client, err := agentbay.NewAgentBay(apiKey, nil)
    if err != nil {
        fmt.Printf("‚ùå Failed to initialize SDK: %v\n", err)
        return
    }
    fmt.Println("‚úÖ SDK initialized successfully")

    // Create a session (requires valid API key and network)
    sessionResult, err := client.Create(nil)
    if err != nil {
        fmt.Printf("‚ö†Ô∏è  Session creation failed: %v\n", err)
        return
    }
    
    if sessionResult.Session != nil {
        fmt.Printf("‚úÖ Session created: %s\n", sessionResult.Session.SessionID)
        
        // Clean up
        _, err = client.Delete(sessionResult.Session, false)
        if err != nil {
            fmt.Printf("‚ö†Ô∏è  Session cleanup failed: %v\n", err)
        } else {
            fmt.Println("‚úÖ Test completed successfully")
        }
    }
}
```

## üîß Advanced Configuration (Optional)

> **Note:** The SDK uses the Shanghai API gateway by default. You only need to configure a different gateway if you want to connect through other regions, such as Singapore, for better network performance.

### Supported API Gateway Regions

The SDK configuration specifies which **API Gateway** to connect to. Choose the gateway closest to your users for optimal network performance:

| Gateway Location | Endpoint |
|-----------------|----------|
| Shanghai (Default) | `wuyingai.cn-shanghai.aliyuncs.com` |
| Singapore | `wuyingai.ap-southeast-1.aliyuncs.com` |

### Switching to Singapore Gateway

**Linux/macOS:**
```bash
export AGENTBAY_ENDPOINT=wuyingai.ap-southeast-1.aliyuncs.com
```

**Windows:**
```cmd
set AGENTBAY_ENDPOINT=wuyingai.ap-southeast-1.aliyuncs.com
```

For more configuration options, see the [SDK Configuration Guide](../guides/common-features/configuration/sdk-configuration.md).

## üÜò Troubleshooting

### Python Issues

**`externally-managed-environment` error:**
```bash
# Solution: Use virtual environment
python3 -m venv agentbay-env
source agentbay-env/bin/activate
pip install wuying-agentbay-sdk
```

**`ModuleNotFoundError: No module named 'agentbay'`:**
```bash
# Check if virtual environment is activated
which python  # Should show venv path
# Re-install if needed
pip install --force-reinstall wuying-agentbay-sdk
```

**Permission denied errors:**
```bash
# Use user installation
pip install --user wuying-agentbay-sdk
```

### TypeScript Issues

**`Cannot find module 'wuying-agentbay-sdk'`:**
```bash
# Ensure you're in the project directory with package.json
pwd
ls package.json  # Should exist
# Re-install if needed
npm install wuying-agentbay-sdk
```

**`require() is not defined`:**
```bash
# Check Node.js version (requires 14+)
node --version
# Ensure you're using CommonJS (default) or update to ES modules
```

### Golang Issues

**`checksum mismatch` error (Most Common):**
```bash
# Always use direct proxy for this package
GOPROXY=direct go get github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay
```

**Import path errors:**
```bash
# Check Go version (requires 1.24.4+)
go version
# Ensure module is initialized
go mod init your-project-name
```

**Build failures:**
```bash
# Clean module cache and retry
go clean -modcache
go mod tidy
go get github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay
```

### Network and API Issues

**Connection timeouts:**
- Check your network connection
- Verify the API gateway endpoint is appropriate for your location
- Try different gateway endpoints if available for better connectivity

**API key errors:**
- Verify API key is correct and active
- Check API key permissions in console
- Ensure environment variable is properly set

**Session creation failures:**
- Verify account has sufficient quota
- Check service status at console
- Try again after a few minutes

## üéâ Installation Complete!

If all the above tests pass, congratulations! You have successfully installed and configured the AgentBay SDK.

**Next Steps:**
- [Understanding Basic Concepts](basic-concepts.md)
- [Creating Your First Session](first-session.md) - 5-minute hands-on tutorial





# Python SDK Documentation


# AgentBay SDK for Python

> Execute commands, operate files, and run code in cloud environments

## üì¶ Installation

```bash
pip install wuying-agentbay-sdk
```

## üöÄ Prerequisites

Before using the SDK, you need to:

1. Register an Alibaba Cloud account: [https://aliyun.com](https://aliyun.com)
2. Get API credentials: [AgentBay Console](https://agentbay.console.aliyun.com/service-management)
3. Set environment variable: `export AGENTBAY_API_KEY=your_api_key`

## üöÄ Quick Start

### Synchronous API (Default)

```python
from agentbay import AgentBay

# Create session
agent_bay = AgentBay()
result = agent_bay.create()

if result.success:
    session = result.session

    # Execute command
    cmd_result = session.command.execute_command("ls -la")
    print(cmd_result.output)

    # File operations
    session.file_system.write_file("/tmp/test.txt", "Hello World")
    content = session.file_system.read_file("/tmp/test.txt")
    print(content.content)  # Hello World

    # Clean up
    agent_bay.delete(session)
```

### Asynchronous API

```python
import asyncio
from agentbay import AsyncAgentBay

async def main():
    # Create session
    agent_bay = AsyncAgentBay()
    result = await agent_bay.create()

    if result.success:
        session = result.session

        # Execute command
        cmd_result = await session.command.execute_command("ls -la")
        print(cmd_result.output)

        # File operations
        await session.file_system.write_file("/tmp/test.txt", "Hello World")
        content = await session.file_system.read_file("/tmp/test.txt")
        print(content.content)  # Hello World

        # Clean up
        await agent_bay.delete(session)

if __name__ == "__main__":
    asyncio.run(main())
```

## üîÑ Sync vs Async: Which to Choose?

AgentBay Python SDK provides both synchronous and asynchronous APIs. Choose based on your application needs:

| Feature | Sync API (`AgentBay`) | Async API (`AsyncAgentBay`) |
|---------|----------------------|----------------------------|
| **Import** | `from agentbay import AgentBay` | `from agentbay import AsyncAgentBay` |
| **Best for** | Scripts, simple tools, CLI apps | Web servers (FastAPI/Django), high-concurrency apps |
| **Blocking** | Yes, blocks thread until complete | No, allows other tasks to run |
| **Usage** | `client.create(...)` | `await client.create(...)` |
| **Concurrency** | Sequential execution | Concurrent execution with asyncio |
| **Learning Curve** | Simpler, easier to start | Requires understanding of async/await |

### When to Use Sync API

Use the synchronous API (`AgentBay`) when:

- **Simple scripts**: One-off automation tasks or data processing scripts
- **CLI tools**: Command-line applications with sequential operations
- **Learning**: Getting started with AgentBay SDK
- **Debugging**: Easier to debug with sequential execution flow

**Example Use Case**: A script that processes files sequentially

```python
from agentbay import AgentBay, CreateSessionParams

agent_bay = AgentBay()
session = agent_bay.create(CreateSessionParams(image_id="code_latest")).session

# Process files one by one
for file_path in ["/tmp/file1.txt", "/tmp/file2.txt", "/tmp/file3.txt"]:
    content = session.file_system.read_file(file_path)
    processed = content.content.upper()
    session.file_system.write_file(file_path + ".processed", processed)

agent_bay.delete(session)
```

### When to Use Async API

Use the asynchronous API (`AsyncAgentBay`) when:

- **Web applications**: FastAPI, Django, or other async web frameworks
- **High concurrency**: Managing multiple sessions or operations simultaneously
- **Performance critical**: Need to maximize throughput with I/O-bound operations
- **Real-time systems**: Applications requiring non-blocking operations

**Example Use Case**: A web server handling multiple concurrent requests

```python
import asyncio
from agentbay import AsyncAgentBay, CreateSessionParams

async def process_request(task_id: str, code: str):
    agent_bay = AsyncAgentBay()
    session = (await agent_bay.create(CreateSessionParams(image_id="code_latest"))).session

    result = await session.code.run_code(code, "python")

    await agent_bay.delete(session)
    return result

async def main():
    # Process multiple requests concurrently
    tasks = [
        process_request("task1", "print('Hello from task 1')"),
        process_request("task2", "print('Hello from task 2')"),
        process_request("task3", "print('Hello from task 3')"),
    ]

    results = await asyncio.gather(*tasks)
    for result in results:
        print(result.result)

if __name__ == "__main__":
    asyncio.run(main())
```

## üìñ Complete Documentation

### üÜï New Users
- [üìö Quick Start Tutorial](https://github.com/aliyun/wuying-agentbay-sdk/tree/main/docs/quickstart/README.md) - Get started in 5 minutes
- [üéØ Core Concepts](https://github.com/aliyun/wuying-agentbay-sdk/tree/main/docs/quickstart/basic-concepts.md) - Understand cloud environments and sessions
- [üîÑ Sync vs Async Guide](docs/guides/async-programming/sync-vs-async.md) - Detailed guide on choosing between sync and async APIs

### üöÄ Experienced Users
**Choose Your Cloud Environment:**
- üåê [Browser Use](https://github.com/aliyun/wuying-agentbay-sdk/tree/main/docs/guides/browser-use/README.md) - Web scraping, browser testing, form automation
- üñ•Ô∏è [Computer Use](https://github.com/aliyun/wuying-agentbay-sdk/tree/main/docs/guides/computer-use/README.md) - Windows desktop automation, UI testing
- üì± [Mobile Use](https://github.com/aliyun/wuying-agentbay-sdk/tree/main/docs/guides/mobile-use/README.md) - Android UI testing, mobile app automation
- üíª [CodeSpace](https://github.com/aliyun/wuying-agentbay-sdk/tree/main/docs/guides/codespace/README.md) - Code execution, development environments

**Additional Resources:**
- [üìñ Feature Guides](https://github.com/aliyun/wuying-agentbay-sdk/tree/main/docs/guides/README.md) - Complete feature introduction
- [üîß Python API Reference](docs/api/README.md) - Detailed API documentation
- [üíª Python Examples](docs/examples/README.md) - Complete example code
- [üìã Logging Configuration](https://github.com/aliyun/wuying-agentbay-sdk/tree/main/docs/guides/common-features/configuration/logging.md) - Configure logging levels and output

## üîß Core Features Quick Reference

### Session Management

#### Synchronous
```python
from agentbay import AgentBay

agent_bay = AgentBay()

# Create session
result = agent_bay.create()
if result.success:
    session = result.session

# List sessions by labels with pagination
result = agent_bay.list(labels={"environment": "production"}, limit=10)
if result.success:
    session_ids = result.session_ids

# Delete session
delete_result = agent_bay.delete(session)
```

#### Asynchronous
```python
import asyncio
from agentbay import AsyncAgentBay

async def main():
    agent_bay = AsyncAgentBay()

    # Create session
    result = await agent_bay.create()
    if result.success:
        session = result.session

    # List sessions by labels with pagination
    result = await agent_bay.list(labels={"environment": "production"}, limit=10)
    if result.success:
        session_ids = result.session_ids

    # Delete session
    delete_result = await agent_bay.delete(session)

asyncio.run(main())
```

### File Operations

#### Synchronous
```python
# Read/write files
session.file_system.write_file("/path/file.txt", "content")
content = session.file_system.read_file("/path/file.txt")
print(content.content)

# List directory
files = session.file_system.list_directory("/path")
```

#### Asynchronous
```python
# Read/write files
await session.file_system.write_file("/path/file.txt", "content")
content = await session.file_system.read_file("/path/file.txt")
print(content.content)

# List directory
files = await session.file_system.list_directory("/path")
```

### Command Execution

#### Synchronous
```python
# Execute command
result = session.command.execute_command("python script.py")
print(result.output)
```

#### Asynchronous
```python
# Execute command
result = await session.command.execute_command("python script.py")
print(result.output)
```

### Code Execution

#### Synchronous
```python
from agentbay import AgentBay, CreateSessionParams

agent_bay = AgentBay()
session = agent_bay.create(CreateSessionParams(image_id="code_latest")).session

# Run Python code
result = session.code.run_code("print('Hello World')", "python")
if result.success:
    print(result.result)  # Hello World

agent_bay.delete(session)
```

#### Asynchronous
```python
import asyncio
from agentbay import AsyncAgentBay, CreateSessionParams

async def main():
    agent_bay = AsyncAgentBay()
    session = (await agent_bay.create(CreateSessionParams(image_id="code_latest"))).session

    # Run Python code
    result = await session.code.run_code("print('Hello World')", "python")
    if result.success:
        print(result.result)  # Hello World

    await agent_bay.delete(session)

asyncio.run(main())
```

### Data Persistence

#### Synchronous
```python
from agentbay import AgentBay, CreateSessionParams
from agentbay import ContextSync, SyncPolicy

agent_bay = AgentBay()

# Create context
context = agent_bay.context.get("my-project", create=True).context

# Create session with context
context_sync = ContextSync.new(context.id, "/tmp/data", SyncPolicy.default())
session = agent_bay.create(CreateSessionParams(context_syncs=[context_sync])).session

# Data in /tmp/data will be synchronized to the context
session.file_system.write_file("/tmp/data/config.json", '{"key": "value"}')

agent_bay.delete(session)
```

#### Asynchronous
```python
import asyncio
from agentbay import AsyncAgentBay, CreateSessionParams
from agentbay import ContextSync, SyncPolicy

async def main():
    agent_bay = AsyncAgentBay()

    # Create context
    context = (await agent_bay.context.get("my-project", create=True)).context

    # Create session with context
    context_sync = ContextSync.new(context.id, "/tmp/data", SyncPolicy.default())
    session = (await agent_bay.create(CreateSessionParams(context_syncs=[context_sync]))).session

    # Data in /tmp/data will be synchronized to the context
    await session.file_system.write_file("/tmp/data/config.json", '{"key": "value"}')

    await agent_bay.delete(session)

asyncio.run(main())
```

## üÜò Get Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation](https://github.com/aliyun/wuying-agentbay-sdk/tree/main/docs/README.md)

## üìÑ License

This project is licensed under the Apache License 2.0 - see the [LICENSE](../LICENSE) file for details.




# AgentBay Python SDK API Reference

This directory contains auto-generated API reference documentation.

## Quick Links

- [üìÅ Synchronous API (`sync/`)](#synchronous-api)
- [‚ö° Asynchronous API (`async/`)](#asynchronous-api)
- [üì¶ Common Classes (`common/`)](#common-classes)

## Synchronous vs Asynchronous

AgentBay provides both synchronous and asynchronous APIs with identical interfaces:

| Feature | Sync API | Async API |
|-|-|-|
| **Use Case** | Simple scripts, linear workflows | Concurrent operations, high performance |
| **Performance** | Sequential execution | 4-6x faster for parallel tasks |
| **Syntax** | `result = agent.create()` | `result = await agent.create()` |
| **Import** | `from agentbay import AgentBay` | `from agentbay import AsyncAgentBay` |

See [Synchronous vs Asynchronous Guide](../guides/async-programming/sync-vs-async.md) for detailed comparison.

---

## Synchronous API

All synchronous API classes are in the `sync/` directory:

- [AgentBay](sync/agentbay.md) - `agentbay.agentbay`
- [Session](sync/session.md) - `agentbay.session`
- [Command](sync/command.md) - `agentbay.command`
- [Context](sync/context.md) - `agentbay.context`
- [Context Manager](sync/context-manager.md) - `agentbay.context_manager`
- [File System](sync/filesystem.md) - `agentbay.filesystem`
- [Agent](sync/agent.md) - `agentbay.agent`
- [OSS](sync/oss.md) - `agentbay.oss`
- [Browser](sync/browser.md) - `agentbay.browser`
- [Extension](sync/extension.md) - `agentbay.extension`
- [Code](sync/code.md) - `agentbay.code`
- [Computer](sync/computer.md) - `agentbay.computer`
- [Mobile](sync/mobile.md) - `agentbay.mobile`

## Asynchronous API

All asynchronous API classes are in the `async/` directory:

- [AsyncAgentBay](async/async-agentbay.md) - `agentbay.agentbay`
- [AsyncSession](async/async-session.md) - `agentbay.session`
- [AsyncCommand](async/async-command.md) - `agentbay.command`
- [AsyncContext](async/async-context.md) - `agentbay.context`
- [AsyncContextManager](async/async-context-manager.md) - `agentbay.context_manager`
- [AsyncFileSystem](async/async-filesystem.md) - `agentbay.filesystem`
- [AsyncAgent](async/async-agent.md) - `agentbay.agent`
- [AsyncOss](async/async-oss.md) - `agentbay.oss`
- [AsyncBrowser](async/async-browser.md) - `agentbay.browser`
- [AsyncExtension](async/async-extension.md) - `agentbay.extension`
- [AsyncCode](async/async-code.md) - `agentbay.code`
- [AsyncComputer](async/async-computer.md) - `agentbay.computer`
- [AsyncMobile](async/async-mobile.md) - `agentbay.mobile`

## Common Classes

Shared classes used by both sync and async APIs are in the `common/` directory:

- [Configuration](common/config.md) - `agentbay._common.config`
- [Exceptions](common/exceptions.md) - `agentbay._common.exceptions`
- [Logging](common/logging.md) - `agentbay._common.logger`
- [Context Sync](common/context-sync.md) - `agentbay._common.params.context_sync`

---

**Note**: This documentation is auto-generated from source code. Run `python scripts/generate_api_docs.py` to regenerate.



# AsyncAgent API Reference

> **üí° Sync Version**: This documentation covers the asynchronous API. For synchronous operations, see [`Agent`](../sync/agent.md).
>
> ‚ö° **Performance Advantage**: Async API enables concurrent operations with 4-6x performance improvements for parallel tasks.

## ü§ñ Related Tutorial

- [Agent Modules Guide](../../../../docs/guides/common-features/advanced/agent-modules.md) - Learn about agent modules and custom agents



## AsyncAgent

```python
class AsyncAgent(AsyncBaseService)
```

An Agent to manipulate applications to complete specific tasks.

### async\_execute\_task

```python
async def async_execute_task(task: str) -> ExecutionResult
```

Execute a specific task described in human language asynchronously.

This is an asynchronous interface that returns immediately with a task ID.
Call get_task_status to check the task status. You can control the timeout
of the task execution in your own code by setting the frequency of calling
get_task_status and the max_try_times.

**Arguments**:

    task: Task description in human language.
  

**Returns**:

    ExecutionResult: Result object containing success status, task ID,
  task status, and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
result = await session.agent.async_execute_task("Open Chrome browser")
print(f"Task ID: {result.task_id}, Status: {result.task_status}")
status = await session.agent.get_task_status(result.task_id)
print(f"Task status: {status.task_status}")
await session.delete()
```

### execute\_task

```python
async def execute_task(task: str, max_try_times: int) -> ExecutionResult
```

Execute a specific task described in human language synchronously.

This is a synchronous interface that blocks until the task is completed or
an error occurs, or timeout happens. The default polling interval is 3 seconds,
so set a proper max_try_times according to your task complexity.

**Arguments**:

    task: Task description in human language.
    max_try_times: Maximum number of retries.
  

**Returns**:

    ExecutionResult: Result object containing success status, task ID,
  task status, and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
result = await session.agent.execute_task("Open Chrome browser", max_try_times=20)
print(f"Task result: {result.task_result}")
await session.delete()
```

### get\_task\_status

```python
async def get_task_status(task_id: str) -> QueryResult
```

Get the status of the task with the given task ID.

**Arguments**:

    task_id: The ID of the task to query.
  

**Returns**:

    QueryResult: Result object containing success status, task status,
  task action, task product, and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
result = await session.agent.async_execute_task("Open Chrome browser")
status = await session.agent.get_task_status(result.task_id)
print(f"Status: {status.task_status}, Action: {status.task_action}")
await session.delete()
```

### terminate\_task

```python
async def terminate_task(task_id: str) -> ExecutionResult
```

Terminate a task with a specified task ID.

**Arguments**:

    task_id: The ID of the running task to terminate.
  

**Returns**:

    ExecutionResult: Result object containing success status, task ID,
  task status, and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
result = await session.agent.async_execute_task("Open Chrome browser")
terminate_result = await session.agent.terminate_task(result.task_id)
print(f"Terminated: {terminate_result.success}")
await session.delete()
```

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

**Related APIs:**
- [Session API Reference](./async-session.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# AsyncAgentBay API Reference

> **üí° Sync Version**: This documentation covers the asynchronous API. For synchronous operations, see [`AgentBay`](../sync/agentbay.md).
>
> ‚ö° **Performance Advantage**: Async API enables concurrent operations with 4-6x performance improvements for parallel tasks.

## üöÄ Related Tutorial

- [First Session Tutorial](../../../../docs/quickstart/first-session.md) - Get started with creating your first AgentBay session



## Config

```python
class Config()
```

## AsyncAgentBay

```python
class AsyncAgentBay()
```

AsyncAgentBay represents the main client for interacting with the AgentBay cloud runtime
environment asynchronously.

### create

```python
async def create(
        params: Optional[CreateSessionParams] = None) -> SessionResult
```

Create a new session in the AgentBay cloud environment asynchronously.

**Arguments**:

- `params` _Optional[CreateSessionParams], optional_ - Parameters for creating the session.
  Defaults to None (uses default configuration).
  

**Returns**:

    SessionResult: Result containing the created session and request ID.
  - success (bool): True if the operation succeeded
  - session (AsyncSession): The created session object (if success is True)
  - request_id (str): Unique identifier for this API request
  - error_message (str): Error description (if success is False)
  

**Raises**:

    ValueError: If API key is not provided and AGENTBAY_API_KEY environment variable is not set.
    ClientException: If the API request fails due to network or authentication issues.
  

**Example**:

```python
result = await agent_bay.create()
session = result.session
info_result = await session.info()
print(f"Session ID: {info_result.session_id}")
await session.delete()
```

### list

```python
async def list(labels: Optional[Dict[str, str]] = None,
               page: Optional[int] = None,
               limit: Optional[int] = None) -> SessionListResult
```

Returns paginated list of session IDs filtered by labels asynchronously.

**Arguments**:

- `labels` _Optional[Dict[str, str]], optional_ - Labels to filter sessions.
  Defaults to None (returns all sessions).
- `page` _Optional[int], optional_ - Page number for pagination (starting from 1).
  Defaults to None (returns first page).
- `limit` _Optional[int], optional_ - Maximum number of items per page.
  Defaults to None (uses default of 10).
  

**Returns**:

    SessionListResult: Paginated list of session IDs that match the labels.

### delete

```python
async def delete(session: AsyncSession,
                 sync_context: bool = False) -> DeleteResult
```

Delete a session by session object asynchronously.

**Arguments**:

- `session` _AsyncSession_ - The session to delete.
- `sync_context` _bool_ - Whether to sync context data (trigger file uploads)
  before deleting the session. Defaults to False.
  

**Returns**:

    DeleteResult: Result indicating success or failure and request ID.

### get\_session

```python
async def get_session(session_id: str) -> GetSessionResult
```

Get session information by session ID asynchronously.

This method retrieves detailed session metadata from the API. Unlike `get()`,
this returns raw session data without creating a Session object.

**Arguments**:

- `session_id` _str_ - The ID of the session to retrieve.
  

**Returns**:

    GetSessionResult: Result containing session information.

### get

```python
async def get(session_id: str) -> SessionResult
```

Get a session by its ID asynchronously.

**Arguments**:

- `session_id` _str_ - The ID of the session to retrieve. Must be a non-empty string.
  

**Returns**:

    SessionResult: Result containing the Session instance, request ID, and success status.

### pause

```python
async def pause(session: AsyncSession,
                timeout: int = 600,
                poll_interval: float = 2.0) -> SessionPauseResult
```

Asynchronously pause a session, putting it into a dormant state.

This method internally calls the PauseSessionAsync API and then polls the GetSession API
to check the session status until it becomes PAUSED or until timeout.

**Arguments**:

- `session` _AsyncSession_ - The session to pause.
- `timeout` _int, optional_ - Timeout in seconds to wait for the session to pause.
  Defaults to 600 seconds.
- `poll_interval` _float, optional_ - Interval in seconds between status polls.
  Defaults to 2.0 seconds.
  

**Returns**:

    SessionPauseResult: Result containing the request ID, success status, and final session status.

### pause\_async

```python
async def pause_async(session: AsyncSession) -> SessionPauseResult
```

Asynchronously pause a session, putting it into a dormant state.

This method directly calls the PauseSessionAsync API without waiting for the session
to reach the PAUSED state. For behavior that waits for the PAUSED state,
use the pause() method instead.

**Arguments**:

- `session` _AsyncSession_ - The session to pause.
  

**Returns**:

    SessionPauseResult: Result containing the request ID and success status.

### resume

```python
async def resume(session: AsyncSession,
                 timeout: int = 600,
                 poll_interval: float = 2.0) -> SessionResumeResult
```

Asynchronously resume a session from a paused state.

This method internally calls the ResumeSessionAsync API and then polls the GetSession API
to check the session status until it becomes RUNNING or until timeout.

**Arguments**:

- `session` _AsyncSession_ - The session to resume.
- `timeout` _int, optional_ - Timeout in seconds to wait for the session to resume.
  Defaults to 600 seconds.
- `poll_interval` _float, optional_ - Interval in seconds between status polls.
  Defaults to 2.0 seconds.
  

**Returns**:

    SessionResumeResult: Result containing the request ID, success status, and final session status.

### resume\_async

```python
async def resume_async(session: AsyncSession) -> SessionResumeResult
```

Asynchronously resume a session from a paused state.

This method directly calls the ResumeSessionAsync API without waiting for the session
to reach the RUNNING state. For behavior that waits for the RUNNING state,
use the resume() method instead.

**Arguments**:

- `session` _AsyncSession_ - The session to resume.
  

**Returns**:

    SessionResumeResult: Result containing the request ID and success status.

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

**Related APIs:**
- [Session API Reference](./async-session.md)
- [Context API Reference](./async-context.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# AsyncBrowser API Reference

> **üí° Sync Version**: This documentation covers the asynchronous API. For synchronous operations, see [`Browser`](../sync/browser.md).
>
> ‚ö° **Performance Advantage**: Async API enables concurrent operations with 4-6x performance improvements for parallel tasks.

## üåê Related Tutorial

- [Browser Use Guide](../../../../docs/guides/browser-use/README.md) - Complete guide to browser automation

## Overview

The Browser module provides comprehensive browser automation capabilities including navigation, element interaction,
screenshot capture, and content extraction. It enables automated testing and web scraping workflows.


## Requirements

- Requires `browser_latest` image for browser automation features



## AsyncBrowser

```python
class AsyncBrowser(AsyncBaseService)
```

Browser provides browser-related operations for the session.

### initialize

```python
async def initialize(option: Optional["BrowserOption"] = None) -> bool
```

Initialize the browser instance with the given options asynchronously.
Returns True if successful, False otherwise.

**Arguments**:

- `option` _BrowserOption, optional_ - Browser configuration options. If None, default options are used.
  

**Returns**:

    bool: True if initialization was successful, False otherwise.
  

**Example**:

```python
session = await agent_bay.create().session
# Use default options
await session.browser.initialize()
# Or with specific options
browser_option = BrowserOption(use_stealth=True)
await session.browser.initialize(browser_option)
await session.delete()
```

### init

```python
async def init(option: Optional["BrowserOption"] = None) -> bool
```

Alias for initialize.

### destroy

```python
async def destroy()
```

Destroy the browser instance manually.

### screenshot

```python
async def screenshot(page, full_page: bool = False, **options) -> bytes
```

Takes a screenshot of the specified page with enhanced options and error handling.

**Arguments**:

- `page` _Page_ - The Playwright Page object to take a screenshot of. This is a required parameter.
- `full_page` _bool_ - Whether to capture the full scrollable page. Defaults to False.
    **options: Additional screenshot options that will override defaults.
  Common options include:
  - type (str): Image type, either 'png' or 'jpeg' (default: 'png')
  - quality (int): Quality of the image, between 0-100 (jpeg only)
  - timeout (int): Maximum time in milliseconds (default: 60000)
  - animations (str): How to handle animations (default: 'disabled')
  - caret (str): How to handle the caret (default: 'hide')
  - scale (str): Scale setting (default: 'css')
  

**Returns**:

    bytes: Screenshot data as bytes.
  

**Raises**:

    BrowserError: If browser is not initialized.
    RuntimeError: If screenshot capture fails.

### get\_endpoint\_url

```python
async def get_endpoint_url() -> str
```

Returns the endpoint URL if the browser is initialized, otherwise raises an exception.
When initialized, always fetches the latest CDP url from session.get_link().

**Returns**:

    str: The browser CDP endpoint URL.
  

**Raises**:

    BrowserError: If browser is not initialized or endpoint URL cannot be retrieved.
  

**Example**:

```python
session = await agent_bay.create().session
browser_option = BrowserOption()
await session.browser.initialize(browser_option)
endpoint_url = await session.browser.get_endpoint_url()
print(f"CDP Endpoint: {endpoint_url}")
await session.delete()
```

### get\_option

```python
def get_option() -> Optional["BrowserOption"]
```

Returns the current BrowserOption used to initialize the browser, or None if not set.

**Returns**:

    Optional[BrowserOption]: The browser options if initialized, None otherwise.
  

**Example**:

```python
session = await agent_bay.create().session
browser_option = BrowserOption(use_stealth=True)
await session.browser.initialize(browser_option)
current_options = session.browser.get_option()
print(f"Stealth mode: {current_options.use_stealth}")
await session.delete()
```

### is\_initialized

```python
def is_initialized() -> bool
```

Returns True if the browser was initialized, False otherwise.

**Returns**:

    bool: True if browser is initialized, False otherwise.
  

**Example**:

```python
session = await agent_bay.create().session
print(f"Initialized: {session.browser.is_initialized()}")
browser_option = BrowserOption()
await session.browser.initialize(browser_option)
print(f"Initialized: {session.browser.is_initialized()}")
await session.delete()
```

## Best Practices

1. Wait for page load completion before interacting with elements
2. Use appropriate selectors (CSS, XPath) for reliable element identification
3. Handle navigation timeouts and errors gracefully
4. Take screenshots for debugging and verification
5. Clean up browser resources after automation tasks

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

**Related APIs:**
- [Session API Reference](./async-session.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# AsyncCode API Reference

> **üí° Sync Version**: This documentation covers the asynchronous API. For synchronous operations, see [`Code`](../sync/code.md).
>
> ‚ö° **Performance Advantage**: Async API enables concurrent operations with 4-6x performance improvements for parallel tasks.

## üíª Related Tutorial

- [Code Execution Guide](../../../../docs/guides/codespace/code-execution.md) - Execute code in isolated environments

## Overview

The Code module provides secure code execution capabilities in isolated environments.
It supports multiple programming languages including Python, JavaScript, and more.


## Requirements

- Requires `code_latest` image for code execution features



## AsyncCode

```python
class AsyncCode(AsyncBaseService)
```

Handles code execution operations in the AgentBay cloud environment.

### run\_code

```python
async def run_code(code: str,
                   language: str,
                   timeout_s: int = 60) -> CodeExecutionResult
```

Execute code in the specified language with a timeout.

**Arguments**:

    code: The code to execute.
    language: The programming language of the code. Must be either 'python'
  or 'javascript'.
    timeout_s: The timeout for the code execution in seconds. Default is 60s.
    Note: Due to gateway limitations, each request cannot exceed 60 seconds.
  

**Returns**:

    CodeExecutionResult: Result object containing success status, execution
  result, and error message if any.
  

**Raises**:

    CommandError: If the code execution fails or if an unsupported language is
  specified.
  
  Important:
  The `run_code` method requires a session created with the `code_latest`
  image to function properly. If you encounter errors indicating that the
  tool is not found, make sure to create your session with
  `image_id="code_latest"` in the `CreateSessionParams`.
  

**Example**:

Execute Python code in a code execution environment

```python
from agentbay import AsyncAgentBay, CreateSessionParams

agent_bay = AsyncAgentBay(api_key="your_api_key")
result = await agent_bay.create(CreateSessionParams(image_id="code_latest"))
code_result = await result.session.code.run_code("print('Hello')", "python")
print(code_result.result)
await result.session.delete()
```

## Best Practices

1. Validate code syntax before execution
2. Set appropriate execution timeouts
3. Handle execution errors and exceptions
4. Use proper resource limits to prevent resource exhaustion
5. Clean up temporary files after code execution

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

**Related APIs:**
- [Session API Reference](./async-session.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# AsyncCommand API Reference

> **üí° Sync Version**: This documentation covers the asynchronous API. For synchronous operations, see [`Command`](../sync/command.md).
>
> ‚ö° **Performance Advantage**: Async API enables concurrent operations with 4-6x performance improvements for parallel tasks.

## ‚ö° Related Tutorial

- [Command Execution Guide](../../../../docs/guides/common-features/basics/command-execution.md) - Learn how to execute commands in sessions

## Overview

The Command module provides methods for executing shell commands within a session in the AgentBay cloud environment.
It supports both synchronous command execution with configurable timeouts.




## AsyncCommand

```python
class AsyncCommand(AsyncBaseService)
```

Handles command execution operations in the AgentBay cloud environment.

### execute\_command

```python
async def execute_command(command: str,
                          timeout_ms: int = 60000) -> CommandResult
```

Execute a shell command with a timeout.

**Arguments**:

    command: The shell command to execute.
    timeout_ms: The timeout for the command execution in milliseconds. Default is 60000ms (60s).
  

**Returns**:

    CommandResult: Result object containing success status, execution
  output, and error message if any.
  

**Raises**:

    CommandError: If the command execution fails.
  

**Example**:

```python
result = await session.command.execute_command("ls -la")
print(result.output)
```

## Best Practices

1. Always specify appropriate timeout values based on expected command duration
2. Handle command execution errors gracefully
3. Use absolute paths when referencing files in commands
4. Be aware that commands run with session user permissions
5. Clean up temporary files created by commands

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

**Related APIs:**
- [Session API Reference](./async-session.md)
- [FileSystem API Reference](./async-filesystem.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# AsyncComputer API Reference

> **üí° Sync Version**: This documentation covers the asynchronous API. For synchronous operations, see [`Computer`](../sync/computer.md).
>
> ‚ö° **Performance Advantage**: Async API enables concurrent operations with 4-6x performance improvements for parallel tasks.

## üñ•Ô∏è Related Tutorial

- [Computer Use Guide](../../../../docs/guides/computer-use/README.md) - Automate desktop applications

## Overview

The Computer module provides comprehensive desktop automation capabilities including mouse operations,
keyboard input, screen capture, and window management. It enables automated UI testing and RPA workflows.


## Requirements

- Requires `windows_latest` image for computer use features

## Data Types

### MouseButton

Mouse button constants: Left, Right, Middle

### ScrollDirection

Scroll direction constants: Up, Down, Left, Right

### KeyModifier

Keyboard modifier keys: Ctrl, Alt, Shift, Win

## Important Notes

- Key names in PressKeys and ReleaseKeys are case-sensitive
- Coordinate validation: x and y must be non-negative integers
- Drag operation requires valid start and end coordinates
- Screenshot operations may have size limitations



Computer module for desktop UI automation.
Handles mouse operations, keyboard operations, window management,
application management, and screen operations.

## AsyncComputer

```python
class AsyncComputer(AsyncBaseService)
```

Handles computer UI automation operations in the AgentBay cloud environment.
Provides comprehensive desktop automation capabilities including mouse, keyboard,
window management, application management, and screen operations.

### click\_mouse

```python
async def click_mouse(
        x: int,
        y: int,
        button: Union[MouseButton, str] = MouseButton.LEFT) -> BoolResult
```

Clicks the mouse at the specified screen coordinates.

**Arguments**:

- `x` _int_ - X coordinate in pixels (0 is left edge of screen).
- `y` _int_ - Y coordinate in pixels (0 is top edge of screen).
- `button` _Union[MouseButton, str], optional_ - Mouse button to click. Options:
  - MouseButton.LEFT or "left": Single left click
  - MouseButton.RIGHT or "right": Right click (context menu)
  - MouseButton.MIDDLE or "middle": Middle click (scroll wheel)
  - MouseButton.DOUBLE_LEFT or "double_left": Double left click
  Defaults to MouseButton.LEFT.
  

**Returns**:

    BoolResult: Object containing:
  - success (bool): Whether the click succeeded
  - data (bool): True if successful, None otherwise
  - error_message (str): Error description if failed
  

**Raises**:

    ValueError: If button is not one of the valid options.
  
  Behavior:
  - Clicks at the exact pixel coordinates provided
  - Does not move the mouse cursor before clicking
  - For double-click, use MouseButton.DOUBLE_LEFT
  - Right-click typically opens context menus
  

**Example**:

```python
session = await agent_bay.create().session
await session.computer.click_mouse(100, 200)
await session.computer.click_mouse(300, 400, MouseButton.RIGHT)
await session.delete()
```


**Notes**:

- Coordinates are absolute screen positions, not relative to windows
- Use `get_screen_size()` to determine valid coordinate ranges
- Consider using `move_mouse()` first if you need to see cursor movement
- For UI automation, consider using higher-level methods from `ui` module


**See Also**:

move_mouse, drag_mouse, get_cursor_position, get_screen_size

### move\_mouse

```python
async def move_mouse(x: int, y: int) -> BoolResult
```

Moves the mouse to the specified coordinates.

**Arguments**:

- `x` _int_ - X coordinate.
- `y` _int_ - Y coordinate.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
await session.computer.move_mouse(500, 300)
position = await session.computer.get_cursor_position()
print(f"Cursor at: {position.data}")
await session.delete()
```


**Notes**:

- Moves the cursor smoothly to the target position
- Does not click after moving
- Use get_cursor_position() to verify the new position


**See Also**:

click_mouse, drag_mouse, get_cursor_position

### drag\_mouse

```python
async def drag_mouse(
        from_x: int,
        from_y: int,
        to_x: int,
        to_y: int,
        button: Union[MouseButton, str] = MouseButton.LEFT) -> BoolResult
```

Drags the mouse from one point to another.

**Arguments**:

- `from_x` _int_ - Starting X coordinate.
- `from_y` _int_ - Starting Y coordinate.
- `to_x` _int_ - Ending X coordinate.
- `to_y` _int_ - Ending Y coordinate.
- `button` _Union[MouseButton, str], optional_ - Button type. Can be MouseButton enum or string.
  Valid values: MouseButton.LEFT, MouseButton.RIGHT, MouseButton.MIDDLE
  or their string equivalents. Defaults to MouseButton.LEFT.
    Note: DOUBLE_LEFT is not supported for drag operations.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Raises**:

    ValueError: If button is not a valid option.
  

**Example**:

```python
session = await agent_bay.create().session
await session.computer.drag_mouse(100, 100, 300, 300)
await session.computer.drag_mouse(200, 200, 400, 400, MouseButton.RIGHT)
await session.delete()
```


**Notes**:

- Performs a click-and-drag operation from start to end coordinates
- Useful for selecting text, moving windows, or drawing
- DOUBLE_LEFT button is not supported for drag operations
- Use LEFT, RIGHT, or MIDDLE button only


**See Also**:

click_mouse, move_mouse

### scroll

```python
async def scroll(x: int,
                 y: int,
                 direction: Union[ScrollDirection, str] = ScrollDirection.UP,
                 amount: int = 1) -> BoolResult
```

Scrolls the mouse wheel at the specified coordinates.

**Arguments**:

- `x` _int_ - X coordinate.
- `y` _int_ - Y coordinate.
- `direction` _Union[ScrollDirection, str], optional_ - Scroll direction. Can be ScrollDirection enum or string.
  Valid values: ScrollDirection.UP, ScrollDirection.DOWN, ScrollDirection.LEFT, ScrollDirection.RIGHT
  or their string equivalents. Defaults to ScrollDirection.UP.
- `amount` _int, optional_ - Scroll amount. Defaults to 1.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Raises**:

    ValueError: If direction is not a valid option.
  

**Example**:

```python
session = await agent_bay.create().session
await session.computer.scroll(500, 500, ScrollDirection.DOWN, 3)
await session.computer.scroll(500, 500, ScrollDirection.UP, 2)
await session.delete()
```


**Notes**:

- Scroll operations are performed at the specified coordinates
- The amount parameter controls how many scroll units to move
- Larger amounts result in faster scrolling
- Useful for navigating long documents or web pages


**See Also**:

click_mouse, move_mouse

### get\_cursor\_position

```python
async def get_cursor_position() -> OperationResult
```

Gets the current cursor position.

**Returns**:

    OperationResult: Result object containing cursor position data
  with keys 'x' and 'y', and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
await session.computer.move_mouse(800, 600)
position = await session.computer.get_cursor_position()
print(f"Cursor is at x={position.data['x']}, y={position.data['y']}")
await session.delete()
```


**Notes**:

- Returns the absolute screen coordinates
- Useful for verifying mouse movements
- Position is in pixels from top-left corner (0, 0)


**See Also**:

move_mouse, click_mouse, get_screen_size

### input\_text

```python
async def input_text(text: str) -> BoolResult
```

Types text into the currently focused input field.

**Arguments**:

- `text` _str_ - The text to input. Supports Unicode characters.
  

**Returns**:

    BoolResult: Object with success status and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
await session.computer.click_mouse(500, 300)
await session.computer.input_text("Hello, World!")
await session.delete()
```


**Notes**:

- Requires an input field to be focused first
- Use click_mouse() or UI automation to focus the field
- Supports special characters and Unicode


**See Also**:

press_keys, click_mouse

### press\_keys

```python
async def press_keys(keys: List[str], hold: bool = False) -> BoolResult
```

Presses the specified keys.

**Arguments**:

- `keys` _List[str]_ - List of keys to press (e.g., ["Ctrl", "a"]).
- `hold` _bool, optional_ - Whether to hold the keys. Defaults to False.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
await session.computer.press_keys(["Ctrl", "c"])
await session.computer.press_keys(["Ctrl", "v"])
await session.delete()
```


**Notes**:

- Key names are case-sensitive
- When hold=True, remember to call release_keys() afterwards
- Supports modifier keys like Ctrl, Alt, Shift
- Can press multiple keys simultaneously for shortcuts


**See Also**:

release_keys, input_text

### release\_keys

```python
async def release_keys(keys: List[str]) -> BoolResult
```

Releases the specified keys.

**Arguments**:

- `keys` _List[str]_ - List of keys to release (e.g., ["Ctrl", "a"]).
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
await session.computer.press_keys(["Shift"], hold=True)
await session.computer.input_text("hello")
await session.computer.release_keys(["Shift"])
await session.delete()
```


**Notes**:

- Should be used after press_keys() with hold=True
- Key names are case-sensitive
- Releases all keys specified in the list


**See Also**:

press_keys, input_text

### get\_screen\_size

```python
async def get_screen_size() -> OperationResult
```

Gets the screen size and DPI scaling factor.

**Returns**:

    OperationResult: Result object containing screen size data
  with keys 'width', 'height', and 'dpiScalingFactor',
  and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
size = await session.computer.get_screen_size()
print(f"Screen: {size.data['width']}x{size.data['height']}, DPI: {size.data['dpiScalingFactor']}")
await session.delete()
```


**Notes**:

- Returns the full screen dimensions in pixels
- DPI scaling factor affects coordinate calculations on high-DPI displays
- Use this to determine valid coordinate ranges for mouse operations


**See Also**:

click_mouse, move_mouse, screenshot

### screenshot

```python
async def screenshot() -> OperationResult
```

Takes a screenshot of the current screen.

**Returns**:

    OperationResult: Result object containing the path to the screenshot
  and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
screenshot = await session.computer.screenshot()
print(f"Screenshot URL: {screenshot.data}")
await session.delete()
```


**Notes**:

- Returns an OSS URL to the screenshot image
- Screenshot captures the entire screen
- Useful for debugging and verification
- Image format is typically PNG


**See Also**:

get_screen_size

### list\_root\_windows

```python
async def list_root_windows(timeout_ms: int = 3000) -> WindowListResult
```

Lists all root windows.

**Arguments**:

- `timeout_ms` _int, optional_ - Timeout in milliseconds. Defaults to 3000.
  

**Returns**:

    WindowListResult: Result object containing list of windows and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
windows = await session.computer.list_root_windows()
for window in windows.windows:
  print(f"Window: {window.title}, ID: {window.window_id}")
await session.delete()
```

### get\_active\_window

```python
async def get_active_window(timeout_ms: int = 3000) -> WindowInfoResult
```

Gets the currently active window.

**Arguments**:

- `timeout_ms` _int, optional_ - Timeout in milliseconds. Defaults to 3000.
  

**Returns**:

    WindowInfoResult: Result object containing active window info and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
active = await session.computer.get_active_window()
print(f"Active window: {active.window.title}")
await session.delete()
```

### activate\_window

```python
async def activate_window(window_id: int) -> BoolResult
```

Activates the specified window.

**Arguments**:

- `window_id` _int_ - The ID of the window to activate.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
windows = await session.computer.list_root_windows()
if windows.windows:
  await session.computer.activate_window(windows.windows[0].window_id)
await session.delete()
```


**Notes**:

- The window must exist in the system
- Use list_root_windows() to get available window IDs
- Activating a window brings it to the foreground


**See Also**:

list_root_windows, get_active_window, close_window

### close\_window

```python
async def close_window(window_id: int) -> BoolResult
```

Closes the specified window.

**Arguments**:

- `window_id` _int_ - The ID of the window to close.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
windows = await session.computer.list_root_windows()
if windows.windows:
  await session.computer.close_window(windows.windows[0].window_id)
await session.delete()
```


**Notes**:

- The window must exist in the system
- Use list_root_windows() to get available window IDs
- Closing a window terminates it permanently


**See Also**:

list_root_windows, activate_window, minimize_window

### maximize\_window

```python
async def maximize_window(window_id: int) -> BoolResult
```

Maximizes the specified window.

**Arguments**:

- `window_id` _int_ - The ID of the window to maximize.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
active = await session.computer.get_active_window()
if active.window:
  await session.computer.maximize_window(active.window.window_id)
await session.delete()
```


**Notes**:

- The window must exist in the system
- Maximizing expands the window to fill the screen
- Use restore_window() to return to previous size


**See Also**:

minimize_window, restore_window, fullscreen_window, resize_window

### minimize\_window

```python
async def minimize_window(window_id: int) -> BoolResult
```

Minimizes the specified window.

**Arguments**:

- `window_id` _int_ - The ID of the window to minimize.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
active = await session.computer.get_active_window()
if active.window:
  await session.computer.minimize_window(active.window.window_id)
await session.delete()
```


**Notes**:

- The window must exist in the system
- Minimizing hides the window in the taskbar
- Use restore_window() or activate_window() to bring it back


**See Also**:

maximize_window, restore_window, activate_window

### restore\_window

```python
async def restore_window(window_id: int) -> BoolResult
```

Restores the specified window.

**Arguments**:

- `window_id` _int_ - The ID of the window to restore.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
active = await session.computer.get_active_window()
if active.window:
  wid = active.window.window_id
  await session.computer.minimize_window(wid)
  await session.computer.restore_window(wid)
await session.delete()
```


**Notes**:

- The window must exist in the system
- Restoring returns a minimized or maximized window to its normal state
- Works for windows that were previously minimized or maximized


**See Also**:

minimize_window, maximize_window, activate_window

### resize\_window

```python
async def resize_window(window_id: int, width: int, height: int) -> BoolResult
```

Resizes the specified window.

**Arguments**:

- `window_id` _int_ - The ID of the window to resize.
- `width` _int_ - New width of the window.
- `height` _int_ - New height of the window.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
active = await session.computer.get_active_window()
if active.window:
  await session.computer.resize_window(active.window.window_id, 800, 600)
await session.delete()
```


**Notes**:

- The window must exist in the system
- Width and height are in pixels
- Some windows may have minimum or maximum size constraints


**See Also**:

maximize_window, restore_window, get_screen_size

### fullscreen\_window

```python
async def fullscreen_window(window_id: int) -> BoolResult
```

Makes the specified window fullscreen.

**Arguments**:

- `window_id` _int_ - The ID of the window to make fullscreen.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
active = await session.computer.get_active_window()
if active.window:
  await session.computer.fullscreen_window(active.window.window_id)
await session.delete()
```


**Notes**:

- The window must exist in the system
- Fullscreen mode hides window borders and taskbar
- Different from maximize_window() which keeps window borders
- Press F11 or ESC to exit fullscreen in most applications


**See Also**:

maximize_window, restore_window

### focus\_mode

```python
async def focus_mode(on: bool) -> BoolResult
```

Toggles focus mode on or off.

**Arguments**:

- `on` _bool_ - True to enable focus mode, False to disable it.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
await session.computer.focus_mode(True)
await session.computer.focus_mode(False)
await session.delete()
```


**Notes**:

- Focus mode helps reduce distractions by managing window focus
- When enabled, may prevent background windows from stealing focus
- Behavior depends on the window manager and OS settings


**See Also**:

activate_window, get_active_window

### get\_installed\_apps

```python
async def get_installed_apps(
        start_menu: bool = True,
        desktop: bool = False,
        ignore_system_apps: bool = True) -> InstalledAppListResult
```

Gets the list of installed applications.

**Arguments**:

- `start_menu` _bool, optional_ - Whether to include start menu applications. Defaults to True.
- `desktop` _bool, optional_ - Whether to include desktop applications. Defaults to False.
- `ignore_system_apps` _bool, optional_ - Whether to ignore system applications. Defaults to True.
  

**Returns**:

    InstalledAppListResult: Result object containing list of installed apps and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
apps = await session.computer.get_installed_apps()
for app in apps.data:
  print(f"{app.name}: {app.start_cmd}")
await session.delete()
```


**Notes**:

- start_menu parameter includes applications from Windows Start Menu
- desktop parameter includes shortcuts from Desktop
- ignore_system_apps parameter filters out system applications
- Each app object contains name, start_cmd, stop_cmd, and work_directory


**See Also**:

start_app, list_visible_apps, stop_app_by_pname

### start\_app

```python
async def start_app(start_cmd: str,
                    work_directory: str = "",
                    activity: str = "") -> ProcessListResult
```

Starts the specified application.

**Arguments**:

- `start_cmd` _str_ - The command to start the application.
- `work_directory` _str, optional_ - Working directory for the application. Defaults to "".
- `activity` _str, optional_ - Activity name to launch (for mobile apps). Defaults to "".
  

**Returns**:

    ProcessListResult: Result object containing list of processes started and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
processes = await session.computer.start_app("notepad.exe")
print(f"Started {len(processes.data)} process(es)")
await session.delete()
```


**Notes**:

- The start_cmd can be an executable name or full path
- work_directory is optional and defaults to the system default
- activity parameter is for mobile apps (Android)
- Returns process information for all started processes


**See Also**:

get_installed_apps, stop_app_by_pname, list_visible_apps

### list\_visible\_apps

```python
async def list_visible_apps() -> ProcessListResult
```

Lists all applications with visible windows.

Returns detailed process information for applications that have visible windows,
including process ID, name, command line, and other system information.
This is useful for system monitoring and process management tasks.

**Returns**:

    ProcessListResult: Result object containing list of visible applications
  with detailed process information.
  

**Example**:

```python
session = await agent_bay.create().session
apps = await session.computer.list_visible_apps()
for app in apps.data:
  print(f"App: {app.pname}, PID: {app.pid}")
await session.delete()
```


**Notes**:

- Only returns applications with visible windows
- Hidden or minimized windows may not appear
- Useful for monitoring currently active applications
- Process information includes PID, name, and command line


**See Also**:

get_installed_apps, start_app, stop_app_by_pname, stop_app_by_pid

### stop\_app\_by\_pname

```python
async def stop_app_by_pname(pname: str) -> AppOperationResult
```

Stops an application by process name.

**Arguments**:

- `pname` _str_ - The process name of the application to stop.
  

**Returns**:

    AppOperationResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
await session.computer.start_app("notepad.exe")
result = await session.computer.stop_app_by_pname("notepad.exe")
await session.delete()
```


**Notes**:

- The process name should match exactly (case-sensitive on some systems)
- This will stop all processes matching the given name
- If multiple instances are running, all will be terminated
- The .exe extension may be required on Windows


**See Also**:

start_app, stop_app_by_pid, stop_app_by_cmd, list_visible_apps

### stop\_app\_by\_pid

```python
async def stop_app_by_pid(pid: int) -> AppOperationResult
```

Stops an application by process ID.

**Arguments**:

- `pid` _int_ - The process ID of the application to stop.
  

**Returns**:

    AppOperationResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
processes = await session.computer.start_app("notepad.exe")
pid = processes.data[0].pid
result = await session.computer.stop_app_by_pid(pid)
await session.delete()
```


**Notes**:

- PID must be a valid process ID
- More precise than stopping by name (only stops specific process)
- The process must be owned by the session or have appropriate permissions
- PID can be obtained from start_app() or list_visible_apps()


**See Also**:

start_app, stop_app_by_pname, stop_app_by_cmd, list_visible_apps

### stop\_app\_by\_cmd

```python
async def stop_app_by_cmd(stop_cmd: str) -> AppOperationResult
```

Stops an application by stop command.

**Arguments**:

- `stop_cmd` _str_ - The command to stop the application.
  

**Returns**:

    AppOperationResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = await agent_bay.create().session
apps = await session.computer.get_installed_apps()
if apps.data and apps.data[0].stop_cmd:
  result = await session.computer.stop_app_by_cmd(apps.data[0].stop_cmd)
await session.delete()
```


**Notes**:

- The stop_cmd should be the command registered to stop the application
- Typically obtained from get_installed_apps() which returns app metadata
- Some applications may not have a stop command defined
- The command is executed as-is without shell interpretation


**See Also**:

get_installed_apps, start_app, stop_app_by_pname, stop_app_by_pid

## Best Practices

1. Verify screen coordinates before mouse operations
2. Use appropriate delays between UI interactions
3. Handle window focus changes properly
4. Take screenshots for verification and debugging
5. Use keyboard shortcuts for efficient automation
6. Clean up windows and applications after automation

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# AsyncContextManager API Reference

> **üí° Sync Version**: This documentation covers the asynchronous API. For synchronous operations, see [`ContextManager`](../sync/context-manager.md).
>
> ‚ö° **Performance Advantage**: Async API enables concurrent operations with 4-6x performance improvements for parallel tasks.



## AsyncContextManager

```python
class AsyncContextManager()
```

Manages context operations within a session in the AgentBay cloud environment.

The AsyncContextManager provides methods to get information about context synchronization
status and to synchronize contexts with the session.

### info

```python
async def info(context_id: Optional[str] = None,
               path: Optional[str] = None,
               task_type: Optional[str] = None) -> ContextInfoResult
```

Get information about context synchronization status asynchronously.

**Arguments**:

    context_id: Optional ID of the context to get information for
    path: Optional path where the context is mounted
    task_type: Optional type of task to get information for (e.g., "upload", "download")
  

**Returns**:

    ContextInfoResult: Result object containing context status data and request ID

### sync

```python
async def sync(context_id: Optional[str] = None,
               path: Optional[str] = None,
               mode: Optional[str] = None,
               max_retries: int = 150,
               retry_interval: int = 1500) -> ContextSyncResult
```

Synchronize a context with the session asynchronously.

**Arguments**:

    context_id: Optional ID of the context to synchronize
    path: Optional path where the context should be mounted
    mode: Optional synchronization mode (e.g., "upload", "download")
    max_retries: Maximum number of retries for polling completion status (default: 150)
    retry_interval: Milliseconds to wait between retries (default: 1500)
  

**Returns**:

    ContextSyncResult: Result object containing success status and request ID

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# AsyncContext API Reference

> **üí° Sync Version**: This documentation covers the asynchronous API. For synchronous operations, see [`ContextService`](../sync/context.md).
>
> ‚ö° **Performance Advantage**: Async API enables concurrent operations with 4-6x performance improvements for parallel tasks.

## üíæ Related Tutorial

- [Data Persistence Guide](../../../../docs/guides/common-features/basics/data-persistence.md) - Learn about context management and data persistence



## Context

```python
class Context()
```

Represents a persistent storage context in the AgentBay cloud environment.

**Attributes**:

- `id` _str_ - The unique identifier of the context.
- `name` _str_ - The name of the context.
- `created_at` _str_ - Date and time when the Context was created.
- `last_used_at` _str_ - Date and time when the Context was last used.

## ContextResult

```python
class ContextResult(ApiResponse)
```

Result of operations returning a Context.

## ContextListResult

```python
class ContextListResult(ApiResponse)
```

Result of operations returning a list of Contexts.

## ContextFileEntry

```python
class ContextFileEntry()
```

Represents a file item in a context.

## FileUrlResult

```python
class FileUrlResult(ApiResponse)
```

Result of a presigned URL request.

## ContextFileListResult

```python
class ContextFileListResult(ApiResponse)
```

Result of file listing operation.

## ClearContextResult

```python
class ClearContextResult(OperationResult)
```

Result of context clear operations, including the real-time status.

**Attributes**:

- `request_id` _str_ - Unique identifier for the API request.
- `success` _bool_ - Whether the operation was successful.
- `error_message` _str_ - Error message if the operation failed.
- `status` _Optional[str]_ - Current status of the clearing task. This corresponds to the
  context's state field. Possible values:
  - "clearing": Context data is being cleared (in progress)
  - "available": Clearing completed successfully
  - Other values may indicate the context state after clearing
- `context_id` _Optional[str]_ - The unique identifier of the context being cleared.

## ContextListParams

```python
class ContextListParams()
```

Parameters for listing contexts with pagination support.

## AsyncContextService

```python
class AsyncContextService()
```

Provides methods to manage persistent contexts in the AgentBay cloud environment.

### list

```python
async def list(
        params: Optional[ContextListParams] = None) -> ContextListResult
```

Lists all available contexts with pagination support.

**Arguments**:

- `params` _Optional[ContextListParams], optional_ - Parameters for listing contexts.
  If None, defaults will be used.
  

**Returns**:

    ContextListResult: A result object containing the list of Context objects,
  pagination information, and request ID.
  

**Example**:

```python
result = await agent_bay.context.list()
params = ContextListParams(max_results=20, next_token=result.next_token)
next_result = await agent_bay.context.list(params)
```

### get

```python
async def get(name: Optional[str] = None,
              create: bool = False,
              context_id: Optional[str] = None) -> ContextResult
```

Gets a context by name or ID. Optionally creates it if it doesn't exist.

**Arguments**:

- `name` _Optional[str], optional_ - The name of the context to get. Defaults to None.
- `create` _bool, optional_ - Whether to create the context if it doesn't exist. Defaults to False.
- `context_id` _Optional[str], optional_ - The ID of the context to get. Defaults to None.
  

**Returns**:

    ContextResult: The ContextResult object containing the Context and request ID.
  - success (bool): True if the operation succeeded
  - context (Context): The context object (if success is True)
  - context_id (str): The ID of the context
  - request_id (str): Unique identifier for this API request
  - error_message (str): Error description (if success is False)
  

**Raises**:

    AgentBayError: If neither name nor context_id is provided, or if create=True with context_id.
  

**Example**:

```python
result = await agent_bay.context.get(name="my-context")
result = await agent_bay.context.get(name="new-context", create=True)
result = await agent_bay.context.get(context_id="ctx-04bdwfj7u22a1s30g")
```


**Notes**:

- Either name or context_id must be provided (not both)
- When create=True, only name parameter is allowed
- Created contexts are persistent and can be shared across sessions
- Context names must be unique within your account


**See Also**:

AsyncContextService.list, AsyncContextService.update, AsyncContextService.delete

### create

```python
async def create(name: str) -> ContextResult
```

Creates a new context with the given name.

**Arguments**:

- `name` _str_ - The name for the new context.
  

**Returns**:

    ContextResult: The created ContextResult object with request ID.
  

**Example**:

```python
result = await agent_bay.context.create("my-new-context")
```

### update

```python
async def update(context: Context) -> OperationResult
```

Updates the specified context (currently only name can be updated).

**Arguments**:

- `context` _Context_ - The Context object to update. Must have id and name attributes.
  

**Returns**:

    OperationResult: Result object containing success status and request ID.
  - success (bool): True if the operation succeeded
  - data (str): Success message (if success is True)
  - request_id (str): Unique identifier for this API request
  - error_message (str): Error description (if success is False)
  

**Raises**:

    AgentBayError: If the context update fails.
  

**Example**:

```python
result = await agent_bay.context.get(name="old-name")
result.context.name = "new-name"
update_result = await agent_bay.context.update(result.context)
```


**Notes**:

- Currently only the context name can be updated
- Context ID cannot be changed
- The context must exist before it can be updated
- Updated name must be unique within your account


**See Also**:

AsyncContextService.get, AsyncContextService.list, AsyncContextService.delete

### delete

```python
async def delete(context: Context) -> OperationResult
```

Deletes the specified context.

**Arguments**:

- `context` _Context_ - The Context object to delete.
  

**Returns**:

    OperationResult: Result object containing success status and request ID.
  

**Example**:

```python
result = await agent_bay.context.get(name="my-context")
delete_result = await agent_bay.context.delete(result.context)
```

### get\_file\_download\_url

```python
async def get_file_download_url(context_id: str,
                                file_path: str) -> FileUrlResult
```

Get a presigned download URL for a file in a context.

**Arguments**:

- `context_id` _str_ - The ID of the context.
- `file_path` _str_ - The path to the file in the context.
  

**Returns**:

    FileUrlResult: A result object containing the presigned URL, expire time, and request ID.
  

**Example**:

```python
ctx_result = await agent_bay.context.get(name="my-context", create=True)
url_result = await agent_bay.context.get_file_download_url(ctx_result.context_id, "/path/to/file.txt")
print(url_result.url)
```

### get\_file\_upload\_url

```python
async def get_file_upload_url(context_id: str,
                              file_path: str) -> FileUrlResult
```

Get a presigned upload URL for a file in a context.

**Arguments**:

- `context_id` _str_ - The ID of the context.
- `file_path` _str_ - The path to the file in the context.
  

**Returns**:

    FileUrlResult: A result object containing the presigned URL, expire time, and request ID.
  

**Example**:

```python
ctx_result = await agent_bay.context.get(name="my-context", create=True)
url_result = await agent_bay.context.get_file_upload_url(ctx_result.context_id, "/path/to/file.txt")
print(url_result.url)
```

### delete\_file

```python
async def delete_file(context_id: str, file_path: str) -> OperationResult
```

Delete a file in a context.

**Arguments**:

- `context_id` _str_ - The ID of the context.
- `file_path` _str_ - The path to the file to delete.
  

**Returns**:

    OperationResult: A result object containing success status and request ID.
  

**Example**:

```python
ctx_result = await agent_bay.context.get(name="my-context", create=True)
delete_result = await agent_bay.context.delete_file(ctx_result.context_id, "/path/to/file.txt")
```

### list\_files

```python
async def list_files(context_id: str,
                     parent_folder_path: str,
                     page_number: int = 1,
                     page_size: int = 50) -> ContextFileListResult
```

List files under a specific folder path in a context.

**Arguments**:

- `context_id` _str_ - The ID of the context.
- `parent_folder_path` _str_ - The parent folder path to list files from.
- `page_number` _int_ - The page number for pagination. Default is 1.
- `page_size` _int_ - The number of items per page. Default is 50.
  

**Returns**:

    ContextFileListResult: A result object containing the list of files and request ID.
  

**Example**:

```python
ctx_result = await agent_bay.context.get(name="my-context", create=True)
files_result = await agent_bay.context.list_files(ctx_result.context_id, "/")
print(f"Found {len(files_result.entries)} files")
```

### start\_clear

```python
async def start_clear(context_id: str) -> ClearContextResult
```

Asynchronously initiate a task to clear the context's persistent data.

This is a non-blocking method that returns immediately after initiating the clearing task
on the backend. The context's state will transition to "clearing" while the operation
is in progress.

**Arguments**:

    context_id: Unique ID of the context to clear.
  

**Returns**:

  A ClearContextResult object indicating the task has been successfully started,
  with status field set to "clearing".
  

**Raises**:

    AgentBayError: If the backend API rejects the clearing request (e.g., invalid ID).
  

**Example**:

```python
result = await agent_bay.context.get(name="my-context", create=True)
clear_result = await agent_bay.context.start_clear(result.context_id)
```

### get\_clear\_status

```python
async def get_clear_status(context_id: str) -> ClearContextResult
```

Query the status of the clearing task.

This method calls GetContext API directly and parses the raw response to extract
the state field, which indicates the current clearing status.

**Arguments**:

    context_id: ID of the context.
  

**Returns**:

  ClearContextResult object containing the current task status.
  

**Example**:

```python
result = await agent_bay.context.get(name="my-context", create=True)
clear_result = await agent_bay.context.clear_async(result.context_id)
status_result = await agent_bay.context.get_clear_status(result.context_id)
print(status_result.status)
```

### clear

```python
async def clear(context_id: str,
                timeout: int = 60,
                poll_interval: float = 2.0) -> ClearContextResult
```

Asynchronously clear the context's persistent data and wait for the final result.

This method wraps the `clear_async` and `_get_clear_status` polling logic,
providing the simplest and most direct way to handle clearing tasks.

The clearing process transitions through the following states:
- "clearing": Data clearing is in progress
- "available": Clearing completed successfully (final success state)

**Arguments**:

    context_id: Unique ID of the context to clear.
    timeout: Timeout in seconds to wait for task completion. Defaults to 60.
    poll_interval: Interval in seconds between status polls. Defaults to 2.0.
  

**Returns**:

  ClearContextResult object containing the final task result.
  The status field will be "available" on success.
  

**Raises**:

    ClearanceTimeoutError: If the task fails to complete within the timeout.
    AgentBayError: If an API or network error occurs during execution.
  

**Example**:

```python
result = await agent_bay.context.get(name="my-context", create=True)
clear_result = await agent_bay.context.clear(result.context_id, timeout=60)
```

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

**Related APIs:**
- [Session API Reference](./async-session.md)
- [Context Manager API Reference](./async-context-manager.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# AsyncExtension API Reference

> **üí° Sync Version**: This documentation covers the asynchronous API. For synchronous operations, see [`ExtensionsService`](../sync/extension.md).
>
> ‚ö° **Performance Advantage**: Async API enables concurrent operations with 4-6x performance improvements for parallel tasks.

## üß© Related Tutorial

- [Browser Extensions Guide](../../../../docs/guides/browser-use/core-features/extension.md) - Learn how to use browser extensions



#### EXTENSIONS\_BASE\_PATH

```python
EXTENSIONS_BASE_PATH = "/tmp/extensions"
```

## Extension

```python
class Extension()
```

Represents a browser extension as a cloud resource.

## ExtensionOption

```python
class ExtensionOption()
```

Configuration options for browser extension integration.

This class encapsulates the necessary parameters for setting up
browser extension synchronization and context management.

**Attributes**:

- `context_id` _str_ - ID of the extension context for browser extensions
- `extension_ids` _List[str]_ - List of extension IDs to be loaded/synchronized

### validate

```python
def validate() -> bool
```

Validate the extension option configuration.

**Returns**:

    bool: True if configuration is valid, False otherwise.
  

**Example**:

```python
ext_option = ExtensionOption("ctx-123", ["ext1.zip", "ext2.zip"])
is_valid = ext_option.validate()
print(f"Valid: {is_valid}")
```

## AsyncExtensionsService

```python
class AsyncExtensionsService()
```

Provides methods to manage user browser extensions asynchronously.
This service integrates with the existing context functionality for file operations.

**Usage** (Simplified - Auto-detection):
```python
# Service automatically detects if context exists and creates if needed
extensions_service = AsyncExtensionsService(agent_bay, "browser_extensions")

# Use the service immediately
extension = await extensions_service.create("/path/to/plugin.zip")
```

**Integration with ExtensionOption (Simplified)**:
```python
# Create extensions and configure for browser sessions
extensions_service = AsyncExtensionsService(agent_bay, "my_extensions")
ext1 = await extensions_service.create("/path/to/ext1.zip")
ext2 = await extensions_service.create("/path/to/ext2.zip")

# Create extension option for browser integration (no context_id needed!)
ext_option = extensions_service.create_extension_option([ext1.id, ext2.id])

# Use with BrowserContext for session creation
browser_context = BrowserContext(
    context_id="browser_session",
    auto_upload=True,
    extension_option=ext_option  # All extension config encapsulated
)
```

**Context Management**:
- If context_id provided and exists: Uses the existing context
- If context_id provided but doesn't exist: Creates context with provided name
- If context_id empty or not provided: Generates default name and creates context
- No need to manually manage context creation

### list

```python
async def list() -> List[Extension]
```

Lists all available browser extensions within this context from the cloud.
Uses the context service to list files under the extensions directory.

**Returns**:

    List[Extension]: List of all extensions in the context.
  

**Raises**:

    AgentBayError: If listing fails.
  

**Example**:

```python
extensions_service = AsyncExtensionsService(agent_bay, "my-extensions")
extensions = await extensions_service.list()
print(f"Found {len(extensions)} extensions")
```

### create

```python
async def create(local_path: str) -> Extension
```

Uploads a new browser extension from a local path into the current context.

**Arguments**:

- `local_path` _str_ - Path to the local extension ZIP file.
  

**Returns**:

    Extension: Extension object with generated ID and metadata.
  

**Raises**:

    FileNotFoundError: If the local file doesn't exist.
    ValueError: If the file format is not supported (only ZIP files allowed).
    AgentBayError: If upload fails.
  

**Example**:

```python
extensions_service = AsyncExtensionsService(agent_bay, "my-extensions")
extension = await extensions_service.create("/path/to/extension.zip")
print(f"Created extension: {extension.id}")
```

### update

```python
async def update(extension_id: str, new_local_path: str) -> Extension
```

Updates an existing browser extension in the current context with a new file.

**Arguments**:

- `extension_id` _str_ - ID of the extension to update.
- `new_local_path` _str_ - Path to the new extension ZIP file.
  

**Returns**:

    Extension: Updated extension object.
  

**Raises**:

    FileNotFoundError: If the new local file doesn't exist.
    ValueError: If the extension ID doesn't exist in the context.
    AgentBayError: If update fails.
  

**Example**:

```python
extensions_service = AsyncExtensionsService(agent_bay, "my-extensions")
updated = await extensions_service.update("ext_abc123.zip", "/path/to/new_version.zip")
print(f"Updated extension: {updated.id}")
```

### cleanup

```python
async def cleanup() -> bool
```

Cleans up the auto-created context if it was created by this service.

**Returns**:

    bool: True if cleanup was successful or not needed, False if cleanup failed.
  

**Notes**:

  This method only works if the context was auto-created by this service.
  For existing contexts, no cleanup is performed.
  

**Example**:

```python
extensions_service = AsyncExtensionsService(agent_bay)
success = await extensions_service.cleanup()
print(f"Cleanup success: {success}")
```

### delete

```python
async def delete(extension_id: str) -> bool
```

Deletes a browser extension from the current context.

**Arguments**:

- `extension_id` _str_ - ID of the extension to delete.
  

**Returns**:

    bool: True if deletion was successful, False otherwise.
  

**Example**:

```python
extensions_service = AsyncExtensionsService(agent_bay, "my-extensions")
success = await extensions_service.delete("ext_abc123.zip")
print(f"Delete success: {success}")
```

### create\_extension\_option

```python
def create_extension_option(extension_ids: List[str]) -> ExtensionOption
```

Create an ExtensionOption for the current context with specified extension IDs.

This is a convenience method that creates an ExtensionOption using the current
service's context_id and the provided extension IDs. This option can then be
used with BrowserContext for browser session creation.

**Arguments**:

- `extension_ids` _List[str]_ - List of extension IDs to include in the option.
  These should be extensions that exist in the current context.
  

**Returns**:

    ExtensionOption: Configuration object for browser extension integration.
  

**Raises**:

    ValueError: If extension_ids is empty or invalid.
  

**Example**:

```python
extensions_service = AsyncExtensionsService(agent_bay, "my-extensions")
ext_option = extensions_service.create_extension_option(["ext1.zip", "ext2.zip"])
print(f"Extension option: {ext_option}")
```

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

**Related APIs:**
- [Browser API Reference](./async-browser.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# AsyncFileSystem API Reference

> **üí° Sync Version**: This documentation covers the asynchronous API. For synchronous operations, see [`FileSystem`](../sync/filesystem.md).
>
> ‚ö° **Performance Advantage**: Async API enables concurrent operations with 4-6x performance improvements for parallel tasks.

## üìÅ Related Tutorial

- [File Operations Guide](../../../../docs/guides/common-features/basics/file-operations.md) - Complete guide to file system operations



## AsyncFileTransfer

```python
class AsyncFileTransfer()
```

AsyncFileTransfer provides pre-signed URL upload/download functionality between local and OSS,
with integration to Session Context synchronization.

Prerequisites and Constraints:
- Session must be associated with the corresponding context_id and path through
  CreateSessionParams.context_syncs, and remote_path should fall within that
  synchronization path (or conform to backend path rules).
- Requires available AgentBay context service (agent_bay.context) and session context.

### upload

```python
async def upload(
        local_path: str,
        remote_path: str,
        *,
        content_type: Optional[str] = None,
        wait: bool = True,
        wait_timeout: float = 30.0,
        poll_interval: float = 1.5,
        progress_cb: Optional[Callable[[int], None]] = None) -> UploadResult
```

Upload workflow:
1) Get OSS pre-signed URL via context.get_file_upload_url
2) Upload local file to OSS using the URL (HTTP PUT)
* 1) Trigger session.context.sync(mode="upload") to sync cloud disk data to OSS
4) If wait=True, poll session.context.info until upload task reaches completion or timeout

Returns UploadResult containing request_ids, HTTP status, ETag and other information.

### download

```python
async def download(
        remote_path: str,
        local_path: str,
        *,
        overwrite: bool = True,
        wait: bool = True,
        wait_timeout: float = 300.0,
        poll_interval: float = 1.5,
        progress_cb: Optional[Callable[[int], None]] = None) -> DownloadResult
```

Download workflow:
1) Trigger session.context.sync(mode="upload") to sync cloud disk data to OSS
2) Get pre-signed download URL via context.get_file_download_url
3) Download the file and save to local local_path
4) If wait=True, wait for download task to reach completion after step 1
   (ensuring backend has prepared the download object)

Returns DownloadResult containing sync and download request_ids, HTTP status, byte count, etc.

## AsyncFileSystem

```python
class AsyncFileSystem(BaseService)
```

Handles file operations in the AgentBay cloud environment.

#### DEFAULT\_CHUNK\_SIZE

```python
DEFAULT_CHUNK_SIZE = 50 * 1024
```

### create\_directory

```python
async def create_directory(path: str) -> BoolResult
```

Create a new directory at the specified path.

**Arguments**:

    path: The path of the directory to create.
  

**Returns**:

    BoolResult: Result object containing success status and error message if
  any.
  

**Example**:

```python
session = agent_bay.create().session
create_result = session.file_system.create_directory("/tmp/mydir")
nested_result = session.file_system.create_directory("/tmp/parent/child/grandchild")
session.delete()
```

### edit\_file

```python
async def edit_file(path: str,
                    edits: List[Dict[str, str]],
                    dry_run: bool = False) -> BoolResult
```

Edit a file by replacing occurrences of oldText with newText.

**Arguments**:

    path: The path of the file to edit.
    edits: A list of dictionaries specifying oldText and newText.
    dry_run: If True, preview changes without applying them.
  

**Returns**:

    BoolResult: Result object containing success status and error message if
  any.
  

**Example**:

```python
session = agent_bay.create().session
session.file_system.write_file("/tmp/config.txt", "DEBUG=false
LOG_LEVEL=info")
edits = [{"oldText": "false", "newText": "true"}]
edit_result = session.file_system.edit_file("/tmp/config.txt", edits)
session.delete()
```

### get\_file\_info

```python
async def get_file_info(path: str) -> FileInfoResult
```

Get information about a file or directory.

**Arguments**:

    path: The path of the file or directory to inspect.
  

**Returns**:

    FileInfoResult: Result object containing file info and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
session.file_system.write_file("/tmp/test.txt", "Sample content")
info_result = session.file_system.get_file_info("/tmp/test.txt")
print(info_result.file_info)
session.delete()
```

### list\_directory

```python
async def list_directory(path: str) -> DirectoryListResult
```

List the contents of a directory.

**Arguments**:

- `path` _str_ - The path of the directory to list.
  

**Returns**:

    DirectoryListResult: Result object containing directory entries and error message if any.
  - success (bool): True if the operation succeeded
  - entries (List[Dict[str, Union[str, bool]]]): List of directory entries (if success is True)
  Each entry contains:
  - name (str): Name of the file or directory
  - isDirectory (bool): True if entry is a directory, False if file
  - request_id (str): Unique identifier for this API request
  - error_message (str): Error description (if success is False)
  

**Raises**:

    FileError: If the directory does not exist or cannot be accessed.
  

**Example**:

```python
session = agent_bay.create().session
session.file_system.create_directory("/tmp/testdir")
session.file_system.write_file("/tmp/testdir/file1.txt", "Content 1")
list_result = session.file_system.list_directory("/tmp/testdir")
print(f"Found {len(list_result.entries)} entries")
session.delete()
```


**Notes**:

- Returns empty list for empty directories
- Each entry includes name and isDirectory flag
- Does not recursively list subdirectories


**See Also**:

FileSystem.create_directory, FileSystem.get_file_info, FileSystem.read_file

### move\_file

```python
async def move_file(source: str, destination: str) -> BoolResult
```

Move a file or directory from source path to destination path.

**Arguments**:

    source: The source path of the file or directory.
    destination: The destination path.
  

**Returns**:

    BoolResult: Result object containing success status and error message if
  any.
  

**Example**:

```python
session = agent_bay.create().session
session.file_system.write_file("/tmp/original.txt", "Test content")
move_result = session.file_system.move_file("/tmp/original.txt", "/tmp/moved.txt")
read_result = session.file_system.read_file("/tmp/moved.txt")
session.delete()
```

### read\_multiple\_files

```python
async def read_multiple_files(paths: List[str]) -> MultipleFileContentResult
```

Read the contents of multiple files at once.

**Arguments**:

    paths: A list of file paths to read.
  

**Returns**:

    MultipleFileContentResult: Result object containing a dictionary mapping
  file paths to contents,
  and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
session.file_system.write_file("/tmp/file1.txt", "Content of file 1")
session.file_system.write_file("/tmp/file2.txt", "Content of file 2")
session.file_system.write_file("/tmp/file3.txt", "Content of file 3")
paths = ["/tmp/file1.txt", "/tmp/file2.txt", "/tmp/file3.txt"]
read_result = session.file_system.read_multiple_files(paths)
session.delete()
```

### search\_files

```python
async def search_files(
        path: str,
        pattern: str,
        exclude_patterns: Optional[List[str]] = None) -> FileSearchResult
```

Search for files in the specified path using a wildcard pattern.

**Arguments**:

    path: The base directory path to search in.
    pattern: Wildcard pattern to match against file names. Supports * (any characters)
  and ? (single character). Examples: "*.py", "test_*", "*config*".
    exclude_patterns: Optional list of wildcard patterns to exclude from the search.
  

**Returns**:

    FileSearchResult: Result object containing matching file paths and error
  message if any.
  

**Example**:

```python
session = agent_bay.create().session
session.file_system.write_file("/tmp/test/test_file1.py", "print('hello')")
session.file_system.write_file("/tmp/test/test_file2.py", "print('world')")
session.file_system.write_file("/tmp/test/other.txt", "text content")
search_result = session.file_system.search_files("/tmp/test", "test_*")
session.delete()
```

### read\_file

```python
async def read_file(path: str) -> FileContentResult
```

Read the contents of a file. Automatically handles large files by chunking.

**Arguments**:

- `path` _str_ - The path of the file to read.
  

**Returns**:

    FileContentResult: Result object containing file content and error message if any.
  - success (bool): True if the operation succeeded
  - content (str): The file content (if success is True)
  - request_id (str): Unique identifier for this API request
  - error_message (str): Error description (if success is False)
  

**Raises**:

    FileError: If the file does not exist or is a directory.
  

**Example**:

```python
session = agent_bay.create().session
write_result = session.file_system.write_file("/tmp/test.txt", "Hello, World!")
read_result = session.file_system.read_file("/tmp/test.txt")
print(read_result.content)
session.delete()
```


**Notes**:

- Automatically handles large files by reading in chunks (default 50KB per chunk)
- Returns empty string for empty files
- Returns error if path is a directory


**See Also**:

FileSystem.write_file, FileSystem.list_directory, FileSystem.get_file_info

### write\_file

```python
async def write_file(path: str,
                     content: str,
                     mode: str = "overwrite") -> BoolResult
```

Write content to a file. Automatically handles large files by chunking.

**Arguments**:

- `path` _str_ - The path of the file to write.
- `content` _str_ - The content to write to the file.
- `mode` _str, optional_ - The write mode. Defaults to "overwrite".
  - "overwrite": Replace file content
  - "append": Append to existing content
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  - success (bool): True if the operation succeeded
  - data (bool): True if the file was written successfully
  - request_id (str): Unique identifier for this API request
  - error_message (str): Error description (if success is False)
  

**Raises**:

    FileError: If the write operation fails.
  

**Example**:

```python
session = agent_bay.create().session
write_result = session.file_system.write_file("/tmp/test.txt", "Hello, World!")
append_result = session.file_system.write_file("/tmp/test.txt", "
New line", mode="append")
read_result = session.file_system.read_file("/tmp/test.txt")
session.delete()
```


**Notes**:

- Automatically handles large files by writing in chunks (default 50KB per chunk)
- Creates parent directories if they don't exist
- In "overwrite" mode, replaces the entire file content
- In "append" mode, adds content to the end of the file


**See Also**:

FileSystem.read_file, FileSystem.create_directory, FileSystem.edit_file

### upload\_file

```python
async def upload_file(
        local_path: str,
        remote_path: str,
        *,
        content_type: Optional[str] = None,
        wait: bool = True,
        wait_timeout: float = 30.0,
        poll_interval: float = 1.5,
        progress_cb: Optional[Callable[[int], None]] = None) -> UploadResult
```

Upload a file from local to remote path using pre-signed URLs.

**Arguments**:

    local_path: Local file path to upload
    remote_path: Remote file path to upload to
    content_type: Optional content type for the file
    wait: Whether to wait for the sync operation to complete
    wait_timeout: Timeout for waiting for sync completion
    poll_interval: Interval between polling for sync completion
    progress_cb: Callback for upload progress updates
  

**Returns**:

    UploadResult: Result of the upload operation
  

**Example**:

```python
params = CreateSessionParams(context_syncs=[ContextSync(context_id="ctx-xxx", path="/workspace")])
session = await agent_bay.create(params)
upload_result = await session.session.file_system.upload_file("/local/file.txt", "/workspace/file.txt")
await session.session.delete()
```

### download\_file

```python
async def download_file(
        remote_path: str,
        local_path: str,
        *,
        overwrite: bool = True,
        wait: bool = True,
        wait_timeout: float = 30.0,
        poll_interval: float = 1.5,
        progress_cb: Optional[Callable[[int], None]] = None) -> DownloadResult
```

Download a file from remote path to local path using pre-signed URLs.

**Arguments**:

    remote_path: Remote file path to download from
    local_path: Local file path to download to
    overwrite: Whether to overwrite existing local file
    wait: Whether to wait for the sync operation to complete
    wait_timeout: Timeout for waiting for sync completion
    poll_interval: Interval between polling for sync completion
    progress_cb: Callback for download progress updates
  

**Returns**:

    DownloadResult: Result of the download operation
  

**Example**:

```python
params = CreateSessionParams(context_syncs=[ContextSync(context_id="ctx-xxx", path="/workspace")])
session = await agent_bay.create(params)
download_result = await session.session.file_system.download_file("/workspace/file.txt", "/local/file.txt")
await session.session.delete()
```

### watch\_directory

```python
def watch_directory(
        path: str,
        callback: Callable[[List[FileChangeEvent]], None],
        interval: float = 0.5,
        stop_event: Optional[threading.Event] = None) -> threading.Thread
```

Watch a directory for file changes and call the callback function when changes occur.

**Arguments**:

    path: The directory path to monitor for file changes.
    callback: Callback function that will be called with a list of FileChangeEvent
  objects when changes are detected.
    interval: Polling interval in seconds. Defaults to 0.5.
    stop_event: Optional threading.Event to stop the monitoring. If not provided,
  a new Event will be created and returned via the thread object.
  

**Returns**:

    threading.Thread: The monitoring thread. Call thread.start() to begin monitoring.
  Use the thread's stop_event attribute to stop monitoring.
  

**Example**:

```python
def on_changes(events):
  print(f"Detected {len(events)} changes")
session = agent_bay.create().session
session.file_system.create_directory("/tmp/watch_test")
monitor_thread = session.file_system.watch_directory("/tmp/watch_test", on_changes)
monitor_thread.start()
session.file_system.write_file("/tmp/watch_test/test1.txt", "content 1")
session.file_system.write_file("/tmp/watch_test/test2.txt", "content 2")
session.delete()
```

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

**Related APIs:**
- [Session API Reference](./async-session.md)
- [Command API Reference](./async-command.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# AsyncMobile API Reference

> **üí° Sync Version**: This documentation covers the asynchronous API. For synchronous operations, see [`Mobile`](../sync/mobile.md).
>
> ‚ö° **Performance Advantage**: Async API enables concurrent operations with 4-6x performance improvements for parallel tasks.

## üì± Related Tutorial

- [Mobile Use Guide](../../../../docs/guides/mobile-use/README.md) - Automate mobile applications

## Overview

The Mobile module provides mobile device automation capabilities including touch gestures,
text input, app management, and screenshot capture. It supports Android device automation.


## Requirements

- Requires `mobile_latest` image for mobile automation features



Mobile module for mobile device UI automation and configuration.
Handles touch operations, UI element interactions, application management, screenshot capabilities,
and mobile environment configuration operations.

## AsyncMobile

```python
class AsyncMobile(AsyncBaseService)
```

Handles mobile UI automation operations and configuration in the AgentBay cloud environment.
Provides comprehensive mobile automation capabilities including touch operations,
UI element interactions, application management, screenshot capabilities,
and mobile environment configuration operations.

### tap

```python
async def tap(x: int, y: int) -> BoolResult
```

Taps on the mobile screen at the specified coordinates.

**Arguments**:

- `x` _int_ - X coordinate in pixels.
- `y` _int_ - Y coordinate in pixels.
  

**Returns**:

    BoolResult: Object with success status and error message if any.
  

**Example**:

```python
session = await agent_bay.create(image="mobile_latest").session
await session.mobile.tap(500, 800)
await session.delete()
```


**See Also**:

swipe, long_press

### swipe

```python
async def swipe(start_x: int,
                start_y: int,
                end_x: int,
                end_y: int,
                duration_ms: int = 300) -> BoolResult
```

Performs a swipe gesture from one point to another.

**Arguments**:

- `start_x` _int_ - Starting X coordinate.
- `start_y` _int_ - Starting Y coordinate.
- `end_x` _int_ - Ending X coordinate.
- `end_y` _int_ - Ending Y coordinate.
- `duration_ms` _int, optional_ - Duration of the swipe in milliseconds.
  Defaults to 300.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = await agent_bay.create(image="mobile_latest").session
await session.mobile.swipe(100, 1000, 100, 200, duration_ms=500)
await session.delete()
```

### input\_text

```python
async def input_text(text: str) -> BoolResult
```

Inputs text into the active field.

**Arguments**:

- `text` _str_ - The text to input.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = await agent_bay.create(image="mobile_latest").session
await session.mobile.input_text("Hello Mobile!")
await session.delete()
```

### send\_key

```python
async def send_key(key: int) -> BoolResult
```

Sends a key press event.

**Arguments**:

- `key` _int_ - The key code to send. Supported key codes are:
  - 3 : HOME
  - 4 : BACK
  - 24 : VOLUME UP
  - 25 : VOLUME DOWN
  - 26 : POWER
  - 82 : MENU
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = await agent_bay.create(image="mobile_latest").session
await session.mobile.send_key(4)  # Press BACK button
await session.delete()
```

### get\_clickable\_ui\_elements

```python
async def get_clickable_ui_elements(
        timeout_ms: int = 2000) -> UIElementListResult
```

Retrieves all clickable UI elements within the specified timeout.

**Arguments**:

- `timeout_ms` _int, optional_ - Timeout in milliseconds. Defaults to 2000.
  

**Returns**:

    UIElementListResult: Result object containing clickable UI elements and
  error message if any.
  

**Example**:

```python
session = await agent_bay.create(image="mobile_latest").session
result = await session.mobile.get_clickable_ui_elements()
print(f"Found {len(result.elements)} clickable elements")
await session.delete()
```

### get\_all\_ui\_elements

```python
async def get_all_ui_elements(timeout_ms: int = 2000) -> UIElementListResult
```

Retrieves all UI elements within the specified timeout.

**Arguments**:

- `timeout_ms` _int, optional_ - Timeout in milliseconds. Defaults to 2000.
  

**Returns**:

    UIElementListResult: Result object containing UI elements and error
  message if any.
  

**Example**:

```python
session = await agent_bay.create(image="mobile_latest").session
result = await session.mobile.get_all_ui_elements()
print(f"Found {len(result.elements)} UI elements")
await session.delete()
```

### get\_installed\_apps

```python
async def get_installed_apps(
        start_menu: bool, desktop: bool,
        ignore_system_apps: bool) -> InstalledAppListResult
```

Retrieves a list of installed applications.

**Arguments**:

- `start_menu` _bool_ - Whether to include start menu applications.
- `desktop` _bool_ - Whether to include desktop applications.
- `ignore_system_apps` _bool_ - Whether to ignore system applications.
  

**Returns**:

    InstalledAppListResult: The result containing the list of installed
  applications.
  

**Example**:

```python
session = await agent_bay.create(image="mobile_latest").session
apps = await session.mobile.get_installed_apps(True, False, True)
print(f"Found {len(apps.data)} apps")
await session.delete()
```

### start\_app

```python
async def start_app(start_cmd: str,
                    work_directory: str = "",
                    activity: str = "") -> ProcessListResult
```

Starts an application with the given command, optional working directory and
optional activity.

**Arguments**:

- `start_cmd` _str_ - The command to start the application.
- `work_directory` _str, optional_ - The working directory for the application.
- `activity` _str, optional_ - Activity name to launch (e.g. ".SettingsActivity"
  or "com.package/.Activity"). Defaults to "".
  

**Returns**:

    ProcessListResult: The result containing the list of processes started.
  

**Example**:

```python
session = await agent_bay.create(image="mobile_latest").session
processes = await session.mobile.start_app("monkey -p com.android.settings 1")
print(f"Started {len(processes.data)} process(es)")
await session.delete()
```

### stop\_app\_by\_cmd

```python
async def stop_app_by_cmd(stop_cmd: str) -> AppOperationResult
```

Stops an application by stop command.

**Arguments**:

- `stop_cmd` _str_ - The command to stop the application.
  

**Returns**:

    AppOperationResult: The result of the operation.
  

**Example**:

```python
session = await agent_bay.create(image="mobile_latest").session
result = await session.mobile.stop_app_by_cmd("com.android.settings")
print(f"Stop successful: {result.success}")
await session.delete()
```

### screenshot

```python
async def screenshot() -> OperationResult
```

Takes a screenshot of the current screen.

**Returns**:

    OperationResult: Result object containing the path to the screenshot
  and error message if any.
  

**Example**:

```python
session = await agent_bay.create(image="mobile_latest").session
result = await session.mobile.screenshot()
print(f"Screenshot URL: {result.data}")
await session.delete()
```

### configure

```python
async def configure(mobile_config)
```

Configure mobile settings from MobileExtraConfig.

This method is typically called automatically during session creation when
MobileExtraConfig is provided in CreateSessionParams. It can also be called
manually to reconfigure mobile settings during a session.

**Arguments**:

- `mobile_config` _MobileExtraConfig_ - Mobile configuration object with settings for:
  - lock_resolution (bool): Whether to lock device resolution
  - app_manager_rule (AppManagerRule): App whitelist/blacklist rules
  - hide_navigation_bar (bool): Whether to hide navigation bar
  - uninstall_blacklist (List[str]): Apps protected from uninstallation
  

**Example**:

```python
from agentbay import AsyncAgentBay, CreateSessionParams, MobileExtraConfig
agent_bay = AsyncAgentBay(api_key="your_api_key")
result = await agent_bay.create(CreateSessionParams(image_id="mobile_latest"))
session = result.session
mobile_config = MobileExtraConfig(lock_resolution=True)
await session.mobile.configure(mobile_config)
await agent_bay.delete(session)
```


**Notes**:

- This method is called automatically during session creation if MobileExtraConfig is provided
- Configuration changes are applied immediately
- Resolution lock prevents resolution changes
- App whitelist/blacklist affects app launching permissions
- Uninstall blacklist protects apps from being uninstalled


**See Also**:

set_resolution_lock, set_app_whitelist, set_app_blacklist,
set_navigation_bar_visibility, set_uninstall_blacklist

### set\_resolution\_lock

```python
async def set_resolution_lock(enable: bool)
```

Set display resolution lock for mobile devices.

**Arguments**:

- `enable` _bool_ - True to enable, False to disable.
  

**Example**:

```python
session = await agent_bay.create(image="mobile_latest").session
await session.mobile.set_resolution_lock(True)
await session.mobile.set_resolution_lock(False)
await session.delete()
```

### set\_app\_whitelist

```python
async def set_app_whitelist(package_names: List[str])
```

Set application whitelist.

**Arguments**:

- `package_names` _List[str]_ - List of Android package names to whitelist.
  

**Example**:

```python
session = await agent_bay.create(image="mobile_latest").session
whitelist = ["com.android.settings", "com.android.chrome"]
await session.mobile.set_app_whitelist(whitelist)
await session.delete()
```


**Notes**:

- Only apps in the whitelist will be allowed to run
- System apps may be affected depending on the configuration
- Whitelist takes precedence over blacklist if both are set

### set\_app\_blacklist

```python
async def set_app_blacklist(package_names: List[str])
```

Set application blacklist.

**Arguments**:

- `package_names` _List[str]_ - List of Android package names to blacklist.
  

**Example**:

```python
session = await agent_bay.create(image="mobile_latest").session
blacklist = ["com.example.app1", "com.example.app2"]
await session.mobile.set_app_blacklist(blacklist)
await session.delete()
```


**Notes**:

- Apps in the blacklist will be blocked from running
- Whitelist takes precedence over blacklist if both are set

### set\_navigation\_bar\_visibility

```python
async def set_navigation_bar_visibility(hide: bool)
```

Set navigation bar visibility for mobile devices.

**Arguments**:

- `hide` _bool_ - True to hide navigation bar, False to show navigation bar.
  

**Example**:

```python
session = await agent_bay.create(image="mobile_latest").session
await session.mobile.set_navigation_bar_visibility(hide=True)
await session.mobile.set_navigation_bar_visibility(hide=False)
await session.delete()
```


**Notes**:

- Hiding the navigation bar provides a fullscreen experience
- The navigation bar can still be accessed by swiping from the edge

### set\_uninstall\_blacklist

```python
async def set_uninstall_blacklist(package_names: List[str])
```

Set uninstall protection blacklist for mobile devices.

**Arguments**:

- `package_names` _List[str]_ - List of Android package names to protect from uninstallation.
  

**Example**:

```python
session = await agent_bay.create(image="mobile_latest").session
protected_apps = ["com.android.settings", "com.android.chrome"]
await session.mobile.set_uninstall_blacklist(protected_apps)
await session.delete()
```


**Notes**:

- Apps in the uninstall blacklist cannot be uninstalled
- This is useful for protecting critical applications
- The protection persists for the session lifetime

### get\_adb\_url

```python
async def get_adb_url(adbkey_pub: str) -> AdbUrlResult
```

Retrieves the ADB connection URL for the mobile environment.

This method is only supported in mobile environments (mobile_latest image).
It uses the provided ADB public key to establish the connection and returns
the ADB connect URL.

**Arguments**:

- `adbkey_pub` _str_ - The ADB public key for connection authentication.
  

**Returns**:

    AdbUrlResult: Result object containing the ADB connection URL
    (format: "adb connect <IP>:<Port>") and request ID.
  Returns error if not in mobile environment.
  

**Raises**:

    SessionError: If the session is not in mobile environment.
  

**Example**:

```python
session = await agent_bay.create(image="mobile_latest").session
adbkey_pub = "your_adb_public_key"
adb_result = await session.mobile.get_adb_url(adbkey_pub)
print(f"ADB URL: {adb_result.data}")
await session.delete()
```

## Best Practices

1. Verify element coordinates before tap operations
2. Use appropriate swipe durations for smooth gestures
3. Wait for UI elements to load before interaction
4. Take screenshots for verification and debugging
5. Handle app installation and uninstallation properly
6. Configure app whitelists/blacklists for security

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

**Related APIs:**
- [Session API Reference](./async-session.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# AsyncOss API Reference

> **üí° Sync Version**: This documentation covers the asynchronous API. For synchronous operations, see [`Oss`](../sync/oss.md).
>
> ‚ö° **Performance Advantage**: Async API enables concurrent operations with 4-6x performance improvements for parallel tasks.

## ‚òÅÔ∏è Related Tutorial

- [OSS Integration Guide](../../../../docs/guides/common-features/advanced/oss-integration.md) - Integrate with Alibaba Cloud OSS for file storage



## OSSClientResult

```python
class OSSClientResult(ApiResponse)
```

Result of OSS client creation operations.

## OSSUploadResult

```python
class OSSUploadResult(ApiResponse)
```

Result of OSS upload operations.

## OSSDownloadResult

```python
class OSSDownloadResult(ApiResponse)
```

Result of OSS download operations.

## AsyncOss

```python
class AsyncOss(AsyncBaseService)
```

Handles Object Storage Service operations in the AgentBay cloud environment.

### env\_init

```python
async def env_init(access_key_id: str,
                   access_key_secret: str,
                   securityToken: str,
                   endpoint: Optional[str] = None,
                   region: Optional[str] = None) -> OSSClientResult
```

Create an OSS client with the provided STS temporary credentials.

**Arguments**:

    access_key_id: The Access Key ID from STS temporary credentials.
    access_key_secret: The Access Key Secret from STS temporary credentials.
    securityToken: Security token from STS temporary credentials. Required for security.
    endpoint: The OSS service endpoint. If not specified, the default is used.
    region: The OSS region. If not specified, the default is used.
  

**Returns**:

    OSSClientResult: Result object containing client configuration and error
  message if any.
  

**Example**:

```python
session = await agent_bay.create().session
await session.oss.env_init(
  access_key_id="your_sts_access_key_id",
  access_key_secret="your_sts_access_key_secret",
  securityToken="your_sts_security_token"
)
await session.delete()
```

### upload

```python
async def upload(bucket: str, object: str, path: str) -> OSSUploadResult
```

Upload a local file or directory to OSS.

Note: Before calling this API, you must first call env_init to initialize
the OSS environment.

**Arguments**:

    bucket: OSS bucket name.
    object: Object key in OSS.
    path: Local file or directory path to upload.
  

**Returns**:

    OSSUploadResult: Result object containing upload result and error message
  if any.
  

**Example**:

```python
session = await agent_bay.create().session
await session.oss.env_init(
  access_key_id="your_access_key_id",
  access_key_secret="your_access_key_secret"
)
result = await session.oss.upload("my-bucket", "file.txt", "/local/path/file.txt")
print(f"Upload result: {result.content}")
await session.delete()
```

### upload\_anonymous

```python
async def upload_anonymous(url: str, path: str) -> OSSUploadResult
```

Upload a local file or directory to a URL anonymously.

**Arguments**:

    url: The HTTP/HTTPS URL to upload the file to.
    path: Local file or directory path to upload.
  

**Returns**:

    OSSUploadResult: Result object containing upload result and error message
  if any.
  

**Example**:

```python
session = await agent_bay.create().session
result = await session.oss.upload_anonymous(
  "https://example.com/upload",
  "/local/path/file.txt"
)
print(f"Upload result: {result.content}")
await session.delete()
```

### download

```python
async def download(bucket: str, object: str, path: str) -> OSSDownloadResult
```

Download an object from OSS to a local file or directory.

Note: Before calling this API, you must first call env_init to initialize
the OSS environment.

**Arguments**:

    bucket: OSS bucket name.
    object: Object key in OSS.
    path: Local file or directory path to download to.
  

**Returns**:

    OSSDownloadResult: Result object containing download status and error
  message if any.
  

**Example**:

```python
session = await agent_bay.create().session
await session.oss.env_init(
  access_key_id="your_access_key_id",
  access_key_secret="your_access_key_secret"
)
result = await session.oss.download("my-bucket", "file.txt", "/local/path/file.txt")
print(f"Download result: {result.content}")
await session.delete()
```

### download\_anonymous

```python
async def download_anonymous(url: str, path: str) -> OSSDownloadResult
```

Download a file from a URL anonymously to a local file path.

**Arguments**:

    url: The HTTP/HTTPS URL to download the file from.
    path: Local file or directory path to download to.
  

**Returns**:

    OSSDownloadResult: Result object containing download status and error
  message if any.
  

**Example**:

```python
session = await agent_bay.create().session
result = await session.oss.download_anonymous(
  "https://example.com/file.txt",
  "/local/path/file.txt"
)
print(f"Download result: {result.content}")
await session.delete()
```

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

**Related APIs:**
- [Session API Reference](./async-session.md)
- [FileSystem API Reference](./async-filesystem.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# AsyncSession API Reference

> **üí° Sync Version**: This documentation covers the asynchronous API. For synchronous operations, see [`Session`](../sync/session.md).
>
> ‚ö° **Performance Advantage**: Async API enables concurrent operations with 4-6x performance improvements for parallel tasks.

## üîß Related Tutorial

- [Session Management Guide](../../../../docs/guides/common-features/basics/session-management.md) - Detailed tutorial on session lifecycle and management



## AsyncSession

```python
class AsyncSession()
```

AsyncSession represents a session in the AgentBay cloud environment.

### delete

```python
async def delete(sync_context: bool = False) -> DeleteResult
```

Delete this session and release all associated resources.

**Arguments**:

- `sync_context` _bool, optional_ - Whether to sync context data (trigger file uploads)
  before deleting the session. Defaults to False.
  

**Returns**:

    DeleteResult: Result indicating success or failure with request ID.
  - success (bool): True if deletion succeeded
  - error_message (str): Error details if deletion failed
  - request_id (str): Unique identifier for this API request
  

**Raises**:

    SessionError: If the deletion request fails or the response is invalid.

### set\_labels

```python
async def set_labels(labels: Dict[str, str]) -> OperationResult
```

Sets the labels for this session asynchronously.

### get\_labels

```python
async def get_labels() -> OperationResult
```

Gets the labels for this session asynchronously.

### info

```python
async def info() -> OperationResult
```

Get detailed information about this session asynchronously.

### get\_link

```python
async def get_link(protocol_type: Optional[str] = None,
                   port: Optional[int] = None,
                   options: Optional[str] = None) -> OperationResult
```

Asynchronously get a link associated with the current session.

### list\_mcp\_tools

```python
async def list_mcp_tools(image_id: Optional[str] = None)
```

List MCP tools available for this session asynchronously.

### call\_mcp\_tool

```python
async def call_mcp_tool(tool_name: str,
                        args: Dict[str, Any],
                        read_timeout: Optional[int] = None,
                        connect_timeout: Optional[int] = None,
                        auto_gen_session: bool = False)
```

Call an MCP tool directly asynchronously.

### pause

```python
async def pause(timeout: int = 600,
                poll_interval: float = 2.0) -> SessionPauseResult
```

Asynchronously pause this session, putting it into a dormant state.
This method waits until the session enters the PAUSED state.

### pause\_async

```python
async def pause_async() -> SessionPauseResult
```

Asynchronously initiate the pause session operation without waiting for completion.

### resume

```python
async def resume(timeout: int = 600,
                 poll_interval: float = 2.0) -> SessionResumeResult
```

Asynchronously resume this session from a paused state.
This method waits until the session enters the RUNNING state.

### resume\_async

```python
async def resume_async() -> SessionResumeResult
```

Asynchronously initiate the resume session operation without waiting for completion.

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

**Related APIs:**
- [FileSystem API Reference](./async-filesystem.md)
- [Command API Reference](./async-command.md)
- [Context API Reference](./async-context.md)
- [Context Manager API Reference](./async-context-manager.md)
- [OSS API Reference](./async-oss.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# Configuration API Reference

## Config

```python
class Config()
```

Configuration object for AgentBay client.

#### BROWSER\_RECORD\_PATH

```python
BROWSER_RECORD_PATH = "/home/wuying/record"
```

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# Context Sync API Reference

## UploadStrategy

```python
class UploadStrategy(Enum)
```

Upload strategy for context synchronization

#### UPLOAD\_BEFORE\_RESOURCE\_RELEASE

```python
UPLOAD_BEFORE_RESOURCE_RELEASE = "UploadBeforeResourceRelease"
```

## DownloadStrategy

```python
class DownloadStrategy(Enum)
```

Download strategy for context synchronization

#### DOWNLOAD\_ASYNC

```python
DOWNLOAD_ASYNC = "DownloadAsync"
```

## UploadMode

```python
class UploadMode(Enum)
```

Upload mode for context synchronization

#### FILE

```python
FILE = "File"
```

#### ARCHIVE

```python
ARCHIVE = "Archive"
```

## Lifecycle

```python
class Lifecycle(Enum)
```

Lifecycle options for recycle policy

#### LIFECYCLE\_1DAY

```python
LIFECYCLE_1DAY = "Lifecycle_1Day"
```

#### LIFECYCLE\_3DAYS

```python
LIFECYCLE_3DAYS = "Lifecycle_3Days"
```

#### LIFECYCLE\_5DAYS

```python
LIFECYCLE_5DAYS = "Lifecycle_5Days"
```

#### LIFECYCLE\_10DAYS

```python
LIFECYCLE_10DAYS = "Lifecycle_10Days"
```

#### LIFECYCLE\_15DAYS

```python
LIFECYCLE_15DAYS = "Lifecycle_15Days"
```

#### LIFECYCLE\_30DAYS

```python
LIFECYCLE_30DAYS = "Lifecycle_30Days"
```

#### LIFECYCLE\_90DAYS

```python
LIFECYCLE_90DAYS = "Lifecycle_90Days"
```

#### LIFECYCLE\_180DAYS

```python
LIFECYCLE_180DAYS = "Lifecycle_180Days"
```

#### LIFECYCLE\_360DAYS

```python
LIFECYCLE_360DAYS = "Lifecycle_360Days"
```

#### LIFECYCLE\_FOREVER

```python
LIFECYCLE_FOREVER = "Lifecycle_Forever"
```

## UploadPolicy

```python
@dataclass
class UploadPolicy()
```

Defines the upload policy for context synchronization

**Attributes**:

    auto_upload: Enables automatic upload
    upload_strategy: Defines the upload strategy
    upload_mode: Defines the upload mode (UploadMode.FILE or UploadMode.ARCHIVE)

#### auto\_upload: `bool`

```python
auto_upload = True
```

#### upload\_strategy: `UploadStrategy`

```python
upload_strategy = UploadStrategy.UPLOAD_BEFORE_RESOURCE_RELEASE
```

#### upload\_mode: `UploadMode`

```python
upload_mode = UploadMode.FILE
```

### default

```python
@classmethod
def default(cls)
```

Creates a new upload policy with default values

## DownloadPolicy

```python
@dataclass
class DownloadPolicy()
```

Defines the download policy for context synchronization

**Attributes**:

    auto_download: Enables automatic download
    download_strategy: Defines the download strategy

#### auto\_download: `bool`

```python
auto_download = True
```

#### download\_strategy: `DownloadStrategy`

```python
download_strategy = DownloadStrategy.DOWNLOAD_ASYNC
```

### default

```python
@classmethod
def default(cls)
```

Creates a new download policy with default values

## DeletePolicy

```python
@dataclass
class DeletePolicy()
```

Defines the delete policy for context synchronization

**Attributes**:

    sync_local_file: Enables synchronization of local file deletions

#### sync\_local\_file: `bool`

```python
sync_local_file = True
```

### default

```python
@classmethod
def default(cls)
```

Creates a new delete policy with default values

## ExtractPolicy

```python
@dataclass
class ExtractPolicy()
```

Defines the extract policy for context synchronization

**Attributes**:

    extract: Enables file extraction
    delete_src_file: Enables deletion of source file after extraction

#### extract: `bool`

```python
extract = True
```

#### delete\_src\_file: `bool`

```python
delete_src_file = True
```

#### extract\_current\_folder: `bool`

```python
extract_current_folder = False
```

### default

```python
@classmethod
def default(cls)
```

Creates a new extract policy with default values

## RecyclePolicy

```python
@dataclass
class RecyclePolicy()
```

Defines the recycle policy for context synchronization

**Attributes**:

    lifecycle: Defines how long the context data should be retained
  Available options:
  - LIFECYCLE_1DAY: Keep data for 1 day
  - LIFECYCLE_3DAYS: Keep data for 3 days
  - LIFECYCLE_5DAYS: Keep data for 5 days
  - LIFECYCLE_10DAYS: Keep data for 10 days
  - LIFECYCLE_15DAYS: Keep data for 15 days
  - LIFECYCLE_30DAYS: Keep data for 30 days
  - LIFECYCLE_90DAYS: Keep data for 90 days
  - LIFECYCLE_180DAYS: Keep data for 180 days
  - LIFECYCLE_360DAYS: Keep data for 360 days
  - LIFECYCLE_FOREVER: Keep data permanently (default)
    paths: Specifies which directories or files should be subject to the recycle policy
  Rules:
  - Must use exact directory/file paths
  - Wildcard patterns (* ? [ ]) are NOT supported
  - Empty string "" means apply to all paths in the context
  - Multiple paths can be specified as a list
    Default: [""] (applies to all paths)

#### lifecycle: `Lifecycle`

```python
lifecycle = Lifecycle.LIFECYCLE_FOREVER
```

#### paths: `List[str]`

```python
paths = field(default_factory=lambda: [""])
```

### default

```python
@classmethod
def default(cls)
```

Creates a new recycle policy with default values

## WhiteList

```python
@dataclass
class WhiteList()
```

Defines the white list configuration

**Attributes**:

    path: Path to include in the white list
    exclude_paths: Paths to exclude from the white list

#### path: `str`

```python
path = ""
```

#### exclude\_paths: `List[str]`

```python
exclude_paths = field(default_factory=list)
```

## BWList

```python
@dataclass
class BWList()
```

Defines the black and white list configuration

**Attributes**:

    white_lists: Defines the white lists

#### white\_lists: `List[WhiteList]`

```python
white_lists = field(default_factory=list)
```

## MappingPolicy

```python
@dataclass
class MappingPolicy()
```

Defines the mapping policy for cross-platform context synchronization

**Attributes**:

    path: The original path from a different OS that should be mapped to the current context path

#### path: `str`

```python
path = ""
```

### default

```python
@classmethod
def default(cls)
```

Creates a new mapping policy with default values

## SyncPolicy

```python
@dataclass
class SyncPolicy()
```

Defines the synchronization policy

**Attributes**:

    upload_policy: Defines the upload policy
    download_policy: Defines the download policy
    delete_policy: Defines the delete policy
    extract_policy: Defines the extract policy
    recycle_policy: Defines the recycle policy
    bw_list: Defines the black and white list
    mapping_policy: Defines the mapping policy for cross-platform context synchronization

#### upload\_policy: `Optional[UploadPolicy]`

```python
upload_policy = None
```

#### download\_policy: `Optional[DownloadPolicy]`

```python
download_policy = None
```

#### delete\_policy: `Optional[DeletePolicy]`

```python
delete_policy = None
```

#### extract\_policy: `Optional[ExtractPolicy]`

```python
extract_policy = None
```

#### recycle\_policy: `Optional[RecyclePolicy]`

```python
recycle_policy = None
```

#### bw\_list: `Optional[BWList]`

```python
bw_list = None
```

#### mapping\_policy: `Optional[MappingPolicy]`

```python
mapping_policy = None
```

### default

```python
@classmethod
def default(cls)
```

Creates a new sync policy with default values

## ContextSync

```python
@dataclass
class ContextSync()
```

Defines the context synchronization configuration

**Attributes**:

    context_id: ID of the context to synchronize
    path: Path where the context should be mounted
    policy: Defines the synchronization policy

#### context\_id: `str`

```python
context_id = None
```

#### path: `str`

```python
path = None
```

#### policy: `Optional[SyncPolicy]`

```python
policy = None
```

### new

```python
@classmethod
def new(cls, context_id: str, path: str, policy: Optional[SyncPolicy] = None)
```

Creates a new context sync configuration

### with\_policy

```python
def with_policy(policy: SyncPolicy)
```

Sets the policy

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# Exceptions API Reference

## AgentBayError

```python
class AgentBayError(Exception)
```

Base exception for all AgentBay SDK errors.

## AuthenticationError

```python
class AuthenticationError(AgentBayError)
```

Raised when there is an authentication error.

## APIError

```python
class APIError(AgentBayError)
```

Raised when there is an error with the API.

## FileError

```python
class FileError(AgentBayError)
```

Raised for errors related to file operations.

## CommandError

```python
class CommandError(AgentBayError)
```

Raised for errors related to command execution.

## SessionError

```python
class SessionError(AgentBayError)
```

Raised for errors related to session operations.

## OssError

```python
class OssError(AgentBayError)
```

Raised for errors related to OSS operations.

## BrowserError

```python
class BrowserError(AgentBayError)
```

Raised when there is an error with the browser.

## AgentError

```python
class AgentError(AgentBayError)
```

Raised for errors related to Agent actions.

## ClearanceTimeoutError

```python
class ClearanceTimeoutError(AgentBayError)
```

Raised when context clearing operation times out.

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# Logging API Reference

Unified logging configuration for AgentBay SDK using loguru.

This module provides a centralized logging configuration with beautiful formatting
and structured output for different log levels.

## AgentBayLogger

```python
class AgentBayLogger()
```

AgentBay SDK Logger with beautiful formatting.

### setup

```python
@classmethod
def setup(cls,
          level: str = "INFO",
          log_file: Optional[Union[str, Path]] = None,
          enable_console: bool = True,
          enable_file: bool = True,
          rotation: Optional[str] = None,
          retention: str = "30 days",
          max_file_size: Optional[str] = None,
          colorize: Optional[bool] = None,
          force_reinit: bool = True) -> None
```

Setup the logger with custom configuration.

This method should be called early in your application, before any logging occurs.
By default, it will not reinitialize if already configured. Use force_reinit=True
to override existing configuration.

**Arguments**:

    level: Log level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
    log_file: Path to log file (optional)
    enable_console: Whether to enable console logging
    enable_file: Whether to enable file logging
    rotation: Log file rotation size (deprecated, use max_file_size)
    retention: Log file retention period
    max_file_size: Maximum log file size before rotation (e.g., "10 MB", "100 MB")
    colorize: Whether to use colors in console output (None = auto-detect)
    force_reinit: Force reinitialization even if already initialized (default: False)
  

**Example**:

Configure logging for different scenarios

```python
from .logger import AgentBayLogger, get_logger

# Basic setup with debug level
AgentBayLogger.setup(level="DEBUG")
logger = get_logger("app")
logger.debug("Debug mode enabled")
# Output: Debug mode enabled

# Setup with custom log file and rotation
AgentBayLogger.setup(
level="INFO",
log_file="/var/log/agentbay/app.log",
max_file_size="50 MB",
retention="7 days"
)
logger = get_logger("app")
logger.info("Application started with file logging")
# Output: Application started with file logging
# Also written to /var/log/agentbay/app.log

# Console-only logging without colors (for CI/CD)
AgentBayLogger.setup(
level="WARNING",
enable_file=False,
colorize=False
)
logger = get_logger("ci")
logger.warning("This is a warning in CI environment")
# Output: This is a warning in CI environment (no colors)

# File-only logging (no console output)
AgentBayLogger.setup(
level="DEBUG",
log_file="/tmp/debug.log",
enable_console=False,
enable_file=True
)
logger = get_logger("debug")
logger.debug("This only appears in the log file")
# No console output, but written to /tmp/debug.log

```
### get\_logger

```python
@classmethod
def get_logger(cls, name: Optional[str] = None)
```

Get a logger instance.

**Arguments**:

    name: Logger name (optional)
  

**Returns**:

  Configured logger instance

### set\_level

```python
@classmethod
def set_level(cls, level: str) -> None
```

Set the logging level.

**Arguments**:

    level: New log level
  

**Example**:

Change log level during runtime

```python
from .logger import AgentBayLogger, get_logger

# Start with INFO level
AgentBayLogger.setup(level="INFO")
logger = get_logger("app")

logger.info("This will appear")
# Output: This will appear
logger.debug("This won't appear")
# No output (DEBUG < INFO)

# Change to DEBUG level at runtime
AgentBayLogger.set_level("DEBUG")
logger.debug("Now debug messages appear")
# Output: Now debug messages appear

# Change to WARNING level
AgentBayLogger.set_level("WARNING")
logger.info("This won't appear anymore")
# No output (INFO < WARNING)
logger.warning("But warnings still appear")
# Output: But warnings still appear

```
### get\_logger

```python
def get_logger(name: str = "agentbay")
```

Convenience function to get a named logger.

**Arguments**:

    name: Logger name (defaults to "agentbay")
  

**Returns**:

  Named logger instance

#### log

```python
log = get_logger("agentbay")
```

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# Agent API Reference

> **üí° Async Version**: This documentation covers the synchronous API. For async/await support, see [`AsyncAgent`](../async/async-agent.md) which provides the same functionality with async methods.

## ü§ñ Related Tutorial

- [Agent Modules Guide](../../../../docs/guides/common-features/advanced/agent-modules.md) - Learn about agent modules and custom agents



## Agent

```python
class Agent(BaseService)
```

An Agent to manipulate applications to complete specific tasks.

### async\_execute\_task

```python
def async_execute_task(task: str) -> ExecutionResult
```

Execute a specific task described in human language synchronously.

This is an asynchronous interface that returns immediately with a task ID.
Call get_task_status to check the task status. You can control the timeout
of the task execution in your own code by setting the frequency of calling
get_task_status and the max_try_times.

**Arguments**:

    task: Task description in human language.
  

**Returns**:

    ExecutionResult: Result object containing success status, task ID,
  task status, and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
result = session.agent.async_execute_task("Open Chrome browser")
print(f"Task ID: {result.task_id}, Status: {result.task_status}")
status = session.agent.get_task_status(result.task_id)
print(f"Task status: {status.task_status}")
session.delete()
```

### execute\_task

```python
def execute_task(task: str, max_try_times: int) -> ExecutionResult
```

Execute a specific task described in human language synchronously.

This is a synchronous interface that blocks until the task is completed or
an error occurs, or timeout happens. The default polling interval is 3 seconds,
so set a proper max_try_times according to your task complexity.

**Arguments**:

    task: Task description in human language.
    max_try_times: Maximum number of retries.
  

**Returns**:

    ExecutionResult: Result object containing success status, task ID,
  task status, and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
result = session.agent.execute_task("Open Chrome browser", max_try_times=20)
print(f"Task result: {result.task_result}")
session.delete()
```

### get\_task\_status

```python
def get_task_status(task_id: str) -> QueryResult
```

Get the status of the task with the given task ID.

**Arguments**:

    task_id: The ID of the task to query.
  

**Returns**:

    QueryResult: Result object containing success status, task status,
  task action, task product, and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
result = session.agent.async_execute_task("Open Chrome browser")
status = session.agent.get_task_status(result.task_id)
print(f"Status: {status.task_status}, Action: {status.task_action}")
session.delete()
```

### terminate\_task

```python
def terminate_task(task_id: str) -> ExecutionResult
```

Terminate a task with a specified task ID.

**Arguments**:

    task_id: The ID of the running task to terminate.
  

**Returns**:

    ExecutionResult: Result object containing success status, task ID,
  task status, and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
result = session.agent.async_execute_task("Open Chrome browser")
terminate_result = session.agent.terminate_task(result.task_id)
print(f"Terminated: {terminate_result.success}")
session.delete()
```

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

**Related APIs:**
- [Session API Reference](./session.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# AgentBay API Reference

> **üí° Async Version**: This documentation covers the synchronous API. For async/await support, see [`AsyncAgentBay`](../async/async-agentbay.md) which provides the same functionality with async methods.

## üöÄ Related Tutorial

- [First Session Tutorial](../../../../docs/quickstart/first-session.md) - Get started with creating your first AgentBay session



## Config

```python
class Config()
```

## AgentBay

```python
class AgentBay()
```

AgentBay represents the main client for interacting with the AgentBay cloud runtime
environment synchronously.

### create

```python
def create(params: Optional[CreateSessionParams] = None) -> SessionResult
```

Create a new session in the AgentBay cloud environment synchronously.

**Arguments**:

- `params` _Optional[CreateSessionParams], optional_ - Parameters for creating the session.
  Defaults to None (uses default configuration).
  

**Returns**:

    SessionResult: Result containing the created session and request ID.
  - success (bool): True if the operation succeeded
  - session (Session): The created session object (if success is True)
  - request_id (str): Unique identifier for this API request
  - error_message (str): Error description (if success is False)
  

**Raises**:

    ValueError: If API key is not provided and AGENTBAY_API_KEY environment variable is not set.
    ClientException: If the API request fails due to network or authentication issues.
  

**Example**:

```python
result = agent_bay.create()
session = result.session
info_result = session.info()
print(f"Session ID: {info_result.session_id}")
session.delete()
```

### list

```python
def list(labels: Optional[Dict[str, str]] = None,
         page: Optional[int] = None,
         limit: Optional[int] = None) -> SessionListResult
```

Returns paginated list of session IDs filtered by labels synchronously.

**Arguments**:

- `labels` _Optional[Dict[str, str]], optional_ - Labels to filter sessions.
  Defaults to None (returns all sessions).
- `page` _Optional[int], optional_ - Page number for pagination (starting from 1).
  Defaults to None (returns first page).
- `limit` _Optional[int], optional_ - Maximum number of items per page.
  Defaults to None (uses default of 10).
  

**Returns**:

    SessionListResult: Paginated list of session IDs that match the labels.

### delete

```python
def delete(session: Session, sync_context: bool = False) -> DeleteResult
```

Delete a session by session object synchronously.

**Arguments**:

- `session` _Session_ - The session to delete.
- `sync_context` _bool_ - Whether to sync context data (trigger file uploads)
  before deleting the session. Defaults to False.
  

**Returns**:

    DeleteResult: Result indicating success or failure and request ID.

### get\_session

```python
def get_session(session_id: str) -> GetSessionResult
```

Get session information by session ID synchronously.

This method retrieves detailed session metadata from the API. Unlike `get()`,
this returns raw session data without creating a Session object.

**Arguments**:

- `session_id` _str_ - The ID of the session to retrieve.
  

**Returns**:

    GetSessionResult: Result containing session information.

### get

```python
def get(session_id: str) -> SessionResult
```

Get a session by its ID synchronously.

**Arguments**:

- `session_id` _str_ - The ID of the session to retrieve. Must be a non-empty string.
  

**Returns**:

    SessionResult: Result containing the Session instance, request ID, and success status.

### pause

```python
def pause(session: Session,
          timeout: int = 600,
          poll_interval: float = 2.0) -> SessionPauseResult
```

Synchronously pause a session, putting it into a dormant state.

This method internally calls the PauseSessionAsync API and then polls the GetSession API
to check the session status until it becomes PAUSED or until timeout.

**Arguments**:

- `session` _Session_ - The session to pause.
- `timeout` _int, optional_ - Timeout in seconds to wait for the session to pause.
  Defaults to 600 seconds.
- `poll_interval` _float, optional_ - Interval in seconds between status polls.
  Defaults to 2.0 seconds.
  

**Returns**:

    SessionPauseResult: Result containing the request ID, success status, and final session status.

### pause\_async

```python
def pause_async(session: Session) -> SessionPauseResult
```

Synchronously pause a session, putting it into a dormant state.

This method directly calls the PauseSessionAsync API without waiting for the session
to reach the PAUSED state. For behavior that waits for the PAUSED state,
use the pause() method instead.

**Arguments**:

- `session` _Session_ - The session to pause.
  

**Returns**:

    SessionPauseResult: Result containing the request ID and success status.

### resume

```python
def resume(session: Session,
           timeout: int = 600,
           poll_interval: float = 2.0) -> SessionResumeResult
```

Synchronously resume a session from a paused state.

This method internally calls the ResumeSessionAsync API and then polls the GetSession API
to check the session status until it becomes RUNNING or until timeout.

**Arguments**:

- `session` _Session_ - The session to resume.
- `timeout` _int, optional_ - Timeout in seconds to wait for the session to resume.
  Defaults to 600 seconds.
- `poll_interval` _float, optional_ - Interval in seconds between status polls.
  Defaults to 2.0 seconds.
  

**Returns**:

    SessionResumeResult: Result containing the request ID, success status, and final session status.

### resume\_async

```python
def resume_async(session: Session) -> SessionResumeResult
```

Synchronously resume a session from a paused state.

This method directly calls the ResumeSessionAsync API without waiting for the session
to reach the RUNNING state. For behavior that waits for the RUNNING state,
use the resume() method instead.

**Arguments**:

- `session` _Session_ - The session to resume.
  

**Returns**:

    SessionResumeResult: Result containing the request ID and success status.

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

**Related APIs:**
- [Session API Reference](./session.md)
- [Context API Reference](./context.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# Browser API Reference

> **üí° Async Version**: This documentation covers the synchronous API. For async/await support, see [`AsyncBrowser`](../async/async-browser.md) which provides the same functionality with async methods.

## üåê Related Tutorial

- [Browser Use Guide](../../../../docs/guides/browser-use/README.md) - Complete guide to browser automation

## Overview

The Browser module provides comprehensive browser automation capabilities including navigation, element interaction,
screenshot capture, and content extraction. It enables automated testing and web scraping workflows.


## Requirements

- Requires `browser_latest` image for browser automation features



## Browser

```python
class Browser(BaseService)
```

Browser provides browser-related operations for the session.

### initialize

```python
def initialize(option: Optional["BrowserOption"] = None) -> bool
```

Initialize the browser instance with the given options synchronously.
Returns True if successful, False otherwise.

**Arguments**:

- `option` _BrowserOption, optional_ - Browser configuration options. If None, default options are used.
  

**Returns**:

    bool: True if initialization was successful, False otherwise.
  

**Example**:

```python
session = agent_bay.create().session
# Use default options
session.browser.initialize()
# Or with specific options
browser_option = BrowserOption(use_stealth=True)
session.browser.initialize(browser_option)
session.delete()
```

### init

```python
def init(option: Optional["BrowserOption"] = None) -> bool
```

Alias for initialize.

### destroy

```python
def destroy()
```

Destroy the browser instance manually.

### screenshot

```python
def screenshot(page, full_page: bool = False, **options) -> bytes
```

Takes a screenshot of the specified page with enhanced options and error handling.

**Arguments**:

- `page` _Page_ - The Playwright Page object to take a screenshot of. This is a required parameter.
- `full_page` _bool_ - Whether to capture the full scrollable page. Defaults to False.
    **options: Additional screenshot options that will override defaults.
  Common options include:
  - type (str): Image type, either 'png' or 'jpeg' (default: 'png')
  - quality (int): Quality of the image, between 0-100 (jpeg only)
  - timeout (int): Maximum time in milliseconds (default: 60000)
  - animations (str): How to handle animations (default: 'disabled')
  - caret (str): How to handle the caret (default: 'hide')
  - scale (str): Scale setting (default: 'css')
  

**Returns**:

    bytes: Screenshot data as bytes.
  

**Raises**:

    BrowserError: If browser is not initialized.
    RuntimeError: If screenshot capture fails.

### get\_endpoint\_url

```python
def get_endpoint_url() -> str
```

Returns the endpoint URL if the browser is initialized, otherwise raises an exception.
When initialized, always fetches the latest CDP url from session.get_link().

**Returns**:

    str: The browser CDP endpoint URL.
  

**Raises**:

    BrowserError: If browser is not initialized or endpoint URL cannot be retrieved.
  

**Example**:

```python
session = agent_bay.create().session
browser_option = BrowserOption()
session.browser.initialize(browser_option)
endpoint_url = session.browser.get_endpoint_url()
print(f"CDP Endpoint: {endpoint_url}")
session.delete()
```

### get\_option

```python
def get_option() -> Optional["BrowserOption"]
```

Returns the current BrowserOption used to initialize the browser, or None if not set.

**Returns**:

    Optional[BrowserOption]: The browser options if initialized, None otherwise.
  

**Example**:

```python
session = agent_bay.create().session
browser_option = BrowserOption(use_stealth=True)
session.browser.initialize(browser_option)
current_options = session.browser.get_option()
print(f"Stealth mode: {current_options.use_stealth}")
session.delete()
```

### is\_initialized

```python
def is_initialized() -> bool
```

Returns True if the browser was initialized, False otherwise.

**Returns**:

    bool: True if browser is initialized, False otherwise.
  

**Example**:

```python
session = agent_bay.create().session
print(f"Initialized: {session.browser.is_initialized()}")
browser_option = BrowserOption()
session.browser.initialize(browser_option)
print(f"Initialized: {session.browser.is_initialized()}")
session.delete()
```

## Best Practices

1. Wait for page load completion before interacting with elements
2. Use appropriate selectors (CSS, XPath) for reliable element identification
3. Handle navigation timeouts and errors gracefully
4. Take screenshots for debugging and verification
5. Clean up browser resources after automation tasks

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

**Related APIs:**
- [Session API Reference](./session.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# Code API Reference

> **üí° Async Version**: This documentation covers the synchronous API. For async/await support, see [`AsyncCode`](../async/async-code.md) which provides the same functionality with async methods.

## üíª Related Tutorial

- [Code Execution Guide](../../../../docs/guides/codespace/code-execution.md) - Execute code in isolated environments

## Overview

The Code module provides secure code execution capabilities in isolated environments.
It supports multiple programming languages including Python, JavaScript, and more.


## Requirements

- Requires `code_latest` image for code execution features



## Code

```python
class Code(BaseService)
```

Handles code execution operations in the AgentBay cloud environment.

### run\_code

```python
def run_code(code: str,
             language: str,
             timeout_s: int = 60) -> CodeExecutionResult
```

Execute code in the specified language with a timeout.

**Arguments**:

    code: The code to execute.
    language: The programming language of the code. Must be either 'python'
  or 'javascript'.
    timeout_s: The timeout for the code execution in seconds. Default is 60s.
    Note: Due to gateway limitations, each request cannot exceed 60 seconds.
  

**Returns**:

    CodeExecutionResult: Result object containing success status, execution
  result, and error message if any.
  

**Raises**:

    CommandError: If the code execution fails or if an unsupported language is
  specified.
  
  Important:
  The `run_code` method requires a session created with the `code_latest`
  image to function properly. If you encounter errors indicating that the
  tool is not found, make sure to create your session with
  `image_id="code_latest"` in the `CreateSessionParams`.
  

**Example**:

Execute Python code in a code execution environment

```python
from agentbay import AgentBay, CreateSessionParams

agent_bay = AgentBay(api_key="your_api_key")
result = agent_bay.create(CreateSessionParams(image_id="code_latest"))
code_result = result.session.code.run_code("print('Hello')", "python")
print(code_result.result)
result.session.delete()
```

## Best Practices

1. Validate code syntax before execution
2. Set appropriate execution timeouts
3. Handle execution errors and exceptions
4. Use proper resource limits to prevent resource exhaustion
5. Clean up temporary files after code execution

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

**Related APIs:**
- [Session API Reference](./session.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# Command API Reference

> **üí° Async Version**: This documentation covers the synchronous API. For async/await support, see [`AsyncCommand`](../async/async-command.md) which provides the same functionality with async methods.

## ‚ö° Related Tutorial

- [Command Execution Guide](../../../../docs/guides/common-features/basics/command-execution.md) - Learn how to execute commands in sessions

## Overview

The Command module provides methods for executing shell commands within a session in the AgentBay cloud environment.
It supports both synchronous command execution with configurable timeouts.




## Command

```python
class Command(BaseService)
```

Handles command execution operations in the AgentBay cloud environment.

### execute\_command

```python
def execute_command(command: str, timeout_ms: int = 60000) -> CommandResult
```

Execute a shell command with a timeout.

**Arguments**:

    command: The shell command to execute.
    timeout_ms: The timeout for the command execution in milliseconds. Default is 60000ms (60s).
  

**Returns**:

    CommandResult: Result object containing success status, execution
  output, and error message if any.
  

**Raises**:

    CommandError: If the command execution fails.
  

**Example**:

```python
result = session.command.execute_command("ls -la")
print(result.output)
```

## Best Practices

1. Always specify appropriate timeout values based on expected command duration
2. Handle command execution errors gracefully
3. Use absolute paths when referencing files in commands
4. Be aware that commands run with session user permissions
5. Clean up temporary files created by commands

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

**Related APIs:**
- [Session API Reference](./session.md)
- [FileSystem API Reference](./filesystem.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# Computer API Reference

> **üí° Async Version**: This documentation covers the synchronous API. For async/await support, see [`AsyncComputer`](../async/async-computer.md) which provides the same functionality with async methods.

## üñ•Ô∏è Related Tutorial

- [Computer Use Guide](../../../../docs/guides/computer-use/README.md) - Automate desktop applications

## Overview

The Computer module provides comprehensive desktop automation capabilities including mouse operations,
keyboard input, screen capture, and window management. It enables automated UI testing and RPA workflows.


## Requirements

- Requires `windows_latest` image for computer use features

## Data Types

### MouseButton

Mouse button constants: Left, Right, Middle

### ScrollDirection

Scroll direction constants: Up, Down, Left, Right

### KeyModifier

Keyboard modifier keys: Ctrl, Alt, Shift, Win

## Important Notes

- Key names in PressKeys and ReleaseKeys are case-sensitive
- Coordinate validation: x and y must be non-negative integers
- Drag operation requires valid start and end coordinates
- Screenshot operations may have size limitations



Computer module for desktop UI automation.
Handles mouse operations, keyboard operations, window management,
application management, and screen operations.

## Computer

```python
class Computer(BaseService)
```

Handles computer UI automation operations in the AgentBay cloud environment.
Provides comprehensive desktop automation capabilities including mouse, keyboard,
window management, application management, and screen operations.

### click\_mouse

```python
def click_mouse(
        x: int,
        y: int,
        button: Union[MouseButton, str] = MouseButton.LEFT) -> BoolResult
```

Clicks the mouse at the specified screen coordinates.

**Arguments**:

- `x` _int_ - X coordinate in pixels (0 is left edge of screen).
- `y` _int_ - Y coordinate in pixels (0 is top edge of screen).
- `button` _Union[MouseButton, str], optional_ - Mouse button to click. Options:
  - MouseButton.LEFT or "left": Single left click
  - MouseButton.RIGHT or "right": Right click (context menu)
  - MouseButton.MIDDLE or "middle": Middle click (scroll wheel)
  - MouseButton.DOUBLE_LEFT or "double_left": Double left click
  Defaults to MouseButton.LEFT.
  

**Returns**:

    BoolResult: Object containing:
  - success (bool): Whether the click succeeded
  - data (bool): True if successful, None otherwise
  - error_message (str): Error description if failed
  

**Raises**:

    ValueError: If button is not one of the valid options.
  
  Behavior:
  - Clicks at the exact pixel coordinates provided
  - Does not move the mouse cursor before clicking
  - For double-click, use MouseButton.DOUBLE_LEFT
  - Right-click typically opens context menus
  

**Example**:

```python
session = agent_bay.create().session
session.computer.click_mouse(100, 200)
session.computer.click_mouse(300, 400, MouseButton.RIGHT)
session.delete()
```


**Notes**:

- Coordinates are absolute screen positions, not relative to windows
- Use `get_screen_size()` to determine valid coordinate ranges
- Consider using `move_mouse()` first if you need to see cursor movement
- For UI automation, consider using higher-level methods from `ui` module


**See Also**:

move_mouse, drag_mouse, get_cursor_position, get_screen_size

### move\_mouse

```python
def move_mouse(x: int, y: int) -> BoolResult
```

Moves the mouse to the specified coordinates.

**Arguments**:

- `x` _int_ - X coordinate.
- `y` _int_ - Y coordinate.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
session.computer.move_mouse(500, 300)
position = session.computer.get_cursor_position()
print(f"Cursor at: {position.data}")
session.delete()
```


**Notes**:

- Moves the cursor smoothly to the target position
- Does not click after moving
- Use get_cursor_position() to verify the new position


**See Also**:

click_mouse, drag_mouse, get_cursor_position

### drag\_mouse

```python
def drag_mouse(
        from_x: int,
        from_y: int,
        to_x: int,
        to_y: int,
        button: Union[MouseButton, str] = MouseButton.LEFT) -> BoolResult
```

Drags the mouse from one point to another.

**Arguments**:

- `from_x` _int_ - Starting X coordinate.
- `from_y` _int_ - Starting Y coordinate.
- `to_x` _int_ - Ending X coordinate.
- `to_y` _int_ - Ending Y coordinate.
- `button` _Union[MouseButton, str], optional_ - Button type. Can be MouseButton enum or string.
  Valid values: MouseButton.LEFT, MouseButton.RIGHT, MouseButton.MIDDLE
  or their string equivalents. Defaults to MouseButton.LEFT.
    Note: DOUBLE_LEFT is not supported for drag operations.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Raises**:

    ValueError: If button is not a valid option.
  

**Example**:

```python
session = agent_bay.create().session
session.computer.drag_mouse(100, 100, 300, 300)
session.computer.drag_mouse(200, 200, 400, 400, MouseButton.RIGHT)
session.delete()
```


**Notes**:

- Performs a click-and-drag operation from start to end coordinates
- Useful for selecting text, moving windows, or drawing
- DOUBLE_LEFT button is not supported for drag operations
- Use LEFT, RIGHT, or MIDDLE button only


**See Also**:

click_mouse, move_mouse

### scroll

```python
def scroll(x: int,
           y: int,
           direction: Union[ScrollDirection, str] = ScrollDirection.UP,
           amount: int = 1) -> BoolResult
```

Scrolls the mouse wheel at the specified coordinates.

**Arguments**:

- `x` _int_ - X coordinate.
- `y` _int_ - Y coordinate.
- `direction` _Union[ScrollDirection, str], optional_ - Scroll direction. Can be ScrollDirection enum or string.
  Valid values: ScrollDirection.UP, ScrollDirection.DOWN, ScrollDirection.LEFT, ScrollDirection.RIGHT
  or their string equivalents. Defaults to ScrollDirection.UP.
- `amount` _int, optional_ - Scroll amount. Defaults to 1.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Raises**:

    ValueError: If direction is not a valid option.
  

**Example**:

```python
session = agent_bay.create().session
session.computer.scroll(500, 500, ScrollDirection.DOWN, 3)
session.computer.scroll(500, 500, ScrollDirection.UP, 2)
session.delete()
```


**Notes**:

- Scroll operations are performed at the specified coordinates
- The amount parameter controls how many scroll units to move
- Larger amounts result in faster scrolling
- Useful for navigating long documents or web pages


**See Also**:

click_mouse, move_mouse

### get\_cursor\_position

```python
def get_cursor_position() -> OperationResult
```

Gets the current cursor position.

**Returns**:

    OperationResult: Result object containing cursor position data
  with keys 'x' and 'y', and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
session.computer.move_mouse(800, 600)
position = session.computer.get_cursor_position()
print(f"Cursor is at x={position.data['x']}, y={position.data['y']}")
session.delete()
```


**Notes**:

- Returns the absolute screen coordinates
- Useful for verifying mouse movements
- Position is in pixels from top-left corner (0, 0)


**See Also**:

move_mouse, click_mouse, get_screen_size

### input\_text

```python
def input_text(text: str) -> BoolResult
```

Types text into the currently focused input field.

**Arguments**:

- `text` _str_ - The text to input. Supports Unicode characters.
  

**Returns**:

    BoolResult: Object with success status and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
session.computer.click_mouse(500, 300)
session.computer.input_text("Hello, World!")
session.delete()
```


**Notes**:

- Requires an input field to be focused first
- Use click_mouse() or UI automation to focus the field
- Supports special characters and Unicode


**See Also**:

press_keys, click_mouse

### press\_keys

```python
def press_keys(keys: List[str], hold: bool = False) -> BoolResult
```

Presses the specified keys.

**Arguments**:

- `keys` _List[str]_ - List of keys to press (e.g., ["Ctrl", "a"]).
- `hold` _bool, optional_ - Whether to hold the keys. Defaults to False.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
session.computer.press_keys(["Ctrl", "c"])
session.computer.press_keys(["Ctrl", "v"])
session.delete()
```


**Notes**:

- Key names are case-sensitive
- When hold=True, remember to call release_keys() afterwards
- Supports modifier keys like Ctrl, Alt, Shift
- Can press multiple keys simultaneously for shortcuts


**See Also**:

release_keys, input_text

### release\_keys

```python
def release_keys(keys: List[str]) -> BoolResult
```

Releases the specified keys.

**Arguments**:

- `keys` _List[str]_ - List of keys to release (e.g., ["Ctrl", "a"]).
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
session.computer.press_keys(["Shift"], hold=True)
session.computer.input_text("hello")
session.computer.release_keys(["Shift"])
session.delete()
```


**Notes**:

- Should be used after press_keys() with hold=True
- Key names are case-sensitive
- Releases all keys specified in the list


**See Also**:

press_keys, input_text

### get\_screen\_size

```python
def get_screen_size() -> OperationResult
```

Gets the screen size and DPI scaling factor.

**Returns**:

    OperationResult: Result object containing screen size data
  with keys 'width', 'height', and 'dpiScalingFactor',
  and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
size = session.computer.get_screen_size()
print(f"Screen: {size.data['width']}x{size.data['height']}, DPI: {size.data['dpiScalingFactor']}")
session.delete()
```


**Notes**:

- Returns the full screen dimensions in pixels
- DPI scaling factor affects coordinate calculations on high-DPI displays
- Use this to determine valid coordinate ranges for mouse operations


**See Also**:

click_mouse, move_mouse, screenshot

### screenshot

```python
def screenshot() -> OperationResult
```

Takes a screenshot of the current screen.

**Returns**:

    OperationResult: Result object containing the path to the screenshot
  and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
screenshot = session.computer.screenshot()
print(f"Screenshot URL: {screenshot.data}")
session.delete()
```


**Notes**:

- Returns an OSS URL to the screenshot image
- Screenshot captures the entire screen
- Useful for debugging and verification
- Image format is typically PNG


**See Also**:

get_screen_size

### list\_root\_windows

```python
def list_root_windows(timeout_ms: int = 3000) -> WindowListResult
```

Lists all root windows.

**Arguments**:

- `timeout_ms` _int, optional_ - Timeout in milliseconds. Defaults to 3000.
  

**Returns**:

    WindowListResult: Result object containing list of windows and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
windows = session.computer.list_root_windows()
for window in windows.windows:
  print(f"Window: {window.title}, ID: {window.window_id}")
session.delete()
```

### get\_active\_window

```python
def get_active_window(timeout_ms: int = 3000) -> WindowInfoResult
```

Gets the currently active window.

**Arguments**:

- `timeout_ms` _int, optional_ - Timeout in milliseconds. Defaults to 3000.
  

**Returns**:

    WindowInfoResult: Result object containing active window info and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
active = session.computer.get_active_window()
print(f"Active window: {active.window.title}")
session.delete()
```

### activate\_window

```python
def activate_window(window_id: int) -> BoolResult
```

Activates the specified window.

**Arguments**:

- `window_id` _int_ - The ID of the window to activate.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
windows = session.computer.list_root_windows()
if windows.windows:
  session.computer.activate_window(windows.windows[0].window_id)
session.delete()
```


**Notes**:

- The window must exist in the system
- Use list_root_windows() to get available window IDs
- Activating a window brings it to the foreground


**See Also**:

list_root_windows, get_active_window, close_window

### close\_window

```python
def close_window(window_id: int) -> BoolResult
```

Closes the specified window.

**Arguments**:

- `window_id` _int_ - The ID of the window to close.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
windows = session.computer.list_root_windows()
if windows.windows:
  session.computer.close_window(windows.windows[0].window_id)
session.delete()
```


**Notes**:

- The window must exist in the system
- Use list_root_windows() to get available window IDs
- Closing a window terminates it permanently


**See Also**:

list_root_windows, activate_window, minimize_window

### maximize\_window

```python
def maximize_window(window_id: int) -> BoolResult
```

Maximizes the specified window.

**Arguments**:

- `window_id` _int_ - The ID of the window to maximize.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
active = session.computer.get_active_window()
if active.window:
  session.computer.maximize_window(active.window.window_id)
session.delete()
```


**Notes**:

- The window must exist in the system
- Maximizing expands the window to fill the screen
- Use restore_window() to return to previous size


**See Also**:

minimize_window, restore_window, fullscreen_window, resize_window

### minimize\_window

```python
def minimize_window(window_id: int) -> BoolResult
```

Minimizes the specified window.

**Arguments**:

- `window_id` _int_ - The ID of the window to minimize.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
active = session.computer.get_active_window()
if active.window:
  session.computer.minimize_window(active.window.window_id)
session.delete()
```


**Notes**:

- The window must exist in the system
- Minimizing hides the window in the taskbar
- Use restore_window() or activate_window() to bring it back


**See Also**:

maximize_window, restore_window, activate_window

### restore\_window

```python
def restore_window(window_id: int) -> BoolResult
```

Restores the specified window.

**Arguments**:

- `window_id` _int_ - The ID of the window to restore.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
active = session.computer.get_active_window()
if active.window:
  wid = active.window.window_id
  session.computer.minimize_window(wid)
  session.computer.restore_window(wid)
session.delete()
```


**Notes**:

- The window must exist in the system
- Restoring returns a minimized or maximized window to its normal state
- Works for windows that were previously minimized or maximized


**See Also**:

minimize_window, maximize_window, activate_window

### resize\_window

```python
def resize_window(window_id: int, width: int, height: int) -> BoolResult
```

Resizes the specified window.

**Arguments**:

- `window_id` _int_ - The ID of the window to resize.
- `width` _int_ - New width of the window.
- `height` _int_ - New height of the window.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
active = session.computer.get_active_window()
if active.window:
  session.computer.resize_window(active.window.window_id, 800, 600)
session.delete()
```


**Notes**:

- The window must exist in the system
- Width and height are in pixels
- Some windows may have minimum or maximum size constraints


**See Also**:

maximize_window, restore_window, get_screen_size

### fullscreen\_window

```python
def fullscreen_window(window_id: int) -> BoolResult
```

Makes the specified window fullscreen.

**Arguments**:

- `window_id` _int_ - The ID of the window to make fullscreen.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
active = session.computer.get_active_window()
if active.window:
  session.computer.fullscreen_window(active.window.window_id)
session.delete()
```


**Notes**:

- The window must exist in the system
- Fullscreen mode hides window borders and taskbar
- Different from maximize_window() which keeps window borders
- Press F11 or ESC to exit fullscreen in most applications


**See Also**:

maximize_window, restore_window

### focus\_mode

```python
def focus_mode(on: bool) -> BoolResult
```

Toggles focus mode on or off.

**Arguments**:

- `on` _bool_ - True to enable focus mode, False to disable it.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
session.computer.focus_mode(True)
session.computer.focus_mode(False)
session.delete()
```


**Notes**:

- Focus mode helps reduce distractions by managing window focus
- When enabled, may prevent background windows from stealing focus
- Behavior depends on the window manager and OS settings


**See Also**:

activate_window, get_active_window

### get\_installed\_apps

```python
def get_installed_apps(
        start_menu: bool = True,
        desktop: bool = False,
        ignore_system_apps: bool = True) -> InstalledAppListResult
```

Gets the list of installed applications.

**Arguments**:

- `start_menu` _bool, optional_ - Whether to include start menu applications. Defaults to True.
- `desktop` _bool, optional_ - Whether to include desktop applications. Defaults to False.
- `ignore_system_apps` _bool, optional_ - Whether to ignore system applications. Defaults to True.
  

**Returns**:

    InstalledAppListResult: Result object containing list of installed apps and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
apps = session.computer.get_installed_apps()
for app in apps.data:
  print(f"{app.name}: {app.start_cmd}")
session.delete()
```


**Notes**:

- start_menu parameter includes applications from Windows Start Menu
- desktop parameter includes shortcuts from Desktop
- ignore_system_apps parameter filters out system applications
- Each app object contains name, start_cmd, stop_cmd, and work_directory


**See Also**:

start_app, list_visible_apps, stop_app_by_pname

### start\_app

```python
def start_app(start_cmd: str,
              work_directory: str = "",
              activity: str = "") -> ProcessListResult
```

Starts the specified application.

**Arguments**:

- `start_cmd` _str_ - The command to start the application.
- `work_directory` _str, optional_ - Working directory for the application. Defaults to "".
- `activity` _str, optional_ - Activity name to launch (for mobile apps). Defaults to "".
  

**Returns**:

    ProcessListResult: Result object containing list of processes started and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
processes = session.computer.start_app("notepad.exe")
print(f"Started {len(processes.data)} process(es)")
session.delete()
```


**Notes**:

- The start_cmd can be an executable name or full path
- work_directory is optional and defaults to the system default
- activity parameter is for mobile apps (Android)
- Returns process information for all started processes


**See Also**:

get_installed_apps, stop_app_by_pname, list_visible_apps

### list\_visible\_apps

```python
def list_visible_apps() -> ProcessListResult
```

Lists all applications with visible windows.

Returns detailed process information for applications that have visible windows,
including process ID, name, command line, and other system information.
This is useful for system monitoring and process management tasks.

**Returns**:

    ProcessListResult: Result object containing list of visible applications
  with detailed process information.
  

**Example**:

```python
session = agent_bay.create().session
apps = session.computer.list_visible_apps()
for app in apps.data:
  print(f"App: {app.pname}, PID: {app.pid}")
session.delete()
```


**Notes**:

- Only returns applications with visible windows
- Hidden or minimized windows may not appear
- Useful for monitoring currently active applications
- Process information includes PID, name, and command line


**See Also**:

get_installed_apps, start_app, stop_app_by_pname, stop_app_by_pid

### stop\_app\_by\_pname

```python
def stop_app_by_pname(pname: str) -> AppOperationResult
```

Stops an application by process name.

**Arguments**:

- `pname` _str_ - The process name of the application to stop.
  

**Returns**:

    AppOperationResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
session.computer.start_app("notepad.exe")
result = session.computer.stop_app_by_pname("notepad.exe")
session.delete()
```


**Notes**:

- The process name should match exactly (case-sensitive on some systems)
- This will stop all processes matching the given name
- If multiple instances are running, all will be terminated
- The .exe extension may be required on Windows


**See Also**:

start_app, stop_app_by_pid, stop_app_by_cmd, list_visible_apps

### stop\_app\_by\_pid

```python
def stop_app_by_pid(pid: int) -> AppOperationResult
```

Stops an application by process ID.

**Arguments**:

- `pid` _int_ - The process ID of the application to stop.
  

**Returns**:

    AppOperationResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
processes = session.computer.start_app("notepad.exe")
pid = processes.data[0].pid
result = session.computer.stop_app_by_pid(pid)
session.delete()
```


**Notes**:

- PID must be a valid process ID
- More precise than stopping by name (only stops specific process)
- The process must be owned by the session or have appropriate permissions
- PID can be obtained from start_app() or list_visible_apps()


**See Also**:

start_app, stop_app_by_pname, stop_app_by_cmd, list_visible_apps

### stop\_app\_by\_cmd

```python
def stop_app_by_cmd(stop_cmd: str) -> AppOperationResult
```

Stops an application by stop command.

**Arguments**:

- `stop_cmd` _str_ - The command to stop the application.
  

**Returns**:

    AppOperationResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
apps = session.computer.get_installed_apps()
if apps.data and apps.data[0].stop_cmd:
  result = session.computer.stop_app_by_cmd(apps.data[0].stop_cmd)
session.delete()
```


**Notes**:

- The stop_cmd should be the command registered to stop the application
- Typically obtained from get_installed_apps() which returns app metadata
- Some applications may not have a stop command defined
- The command is executed as-is without shell interpretation


**See Also**:

get_installed_apps, start_app, stop_app_by_pname, stop_app_by_pid

## Best Practices

1. Verify screen coordinates before mouse operations
2. Use appropriate delays between UI interactions
3. Handle window focus changes properly
4. Take screenshots for verification and debugging
5. Use keyboard shortcuts for efficient automation
6. Clean up windows and applications after automation

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# Context Manager API Reference

> **üí° Async Version**: This documentation covers the synchronous API. For async/await support, see [`AsyncContextManager`](../async/async-context-manager.md) which provides the same functionality with async methods.



## ContextManager

```python
class ContextManager()
```

Manages context operations within a session in the AgentBay cloud environment.

The ContextManager provides methods to get information about context synchronization
status and to synchronize contexts with the session.

### info

```python
def info(context_id: Optional[str] = None,
         path: Optional[str] = None,
         task_type: Optional[str] = None) -> ContextInfoResult
```

Get information about context synchronization status synchronously.

**Arguments**:

    context_id: Optional ID of the context to get information for
    path: Optional path where the context is mounted
    task_type: Optional type of task to get information for (e.g., "upload", "download")
  

**Returns**:

    ContextInfoResult: Result object containing context status data and request ID

### sync

```python
def sync(context_id: Optional[str] = None,
         path: Optional[str] = None,
         mode: Optional[str] = None,
         max_retries: int = 150,
         retry_interval: int = 1500) -> ContextSyncResult
```

Synchronize a context with the session synchronously.

**Arguments**:

    context_id: Optional ID of the context to synchronize
    path: Optional path where the context should be mounted
    mode: Optional synchronization mode (e.g., "upload", "download")
    max_retries: Maximum number of retries for polling completion status (default: 150)
    retry_interval: Milliseconds to wait between retries (default: 1500)
  

**Returns**:

    ContextSyncResult: Result object containing success status and request ID

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# Context API Reference

> **üí° Async Version**: This documentation covers the synchronous API. For async/await support, see [`AsyncContextService`](../async/async-context.md) which provides the same functionality with async methods.

## üíæ Related Tutorial

- [Data Persistence Guide](../../../../docs/guides/common-features/basics/data-persistence.md) - Learn about context management and data persistence



## Context

```python
class Context()
```

Represents a persistent storage context in the AgentBay cloud environment.

**Attributes**:

- `id` _str_ - The unique identifier of the context.
- `name` _str_ - The name of the context.
- `created_at` _str_ - Date and time when the Context was created.
- `last_used_at` _str_ - Date and time when the Context was last used.

## ContextResult

```python
class ContextResult(ApiResponse)
```

Result of operations returning a Context.

## ContextListResult

```python
class ContextListResult(ApiResponse)
```

Result of operations returning a list of Contexts.

## ContextFileEntry

```python
class ContextFileEntry()
```

Represents a file item in a context.

## FileUrlResult

```python
class FileUrlResult(ApiResponse)
```

Result of a presigned URL request.

## ContextFileListResult

```python
class ContextFileListResult(ApiResponse)
```

Result of file listing operation.

## ClearContextResult

```python
class ClearContextResult(OperationResult)
```

Result of context clear operations, including the real-time status.

**Attributes**:

- `request_id` _str_ - Unique identifier for the API request.
- `success` _bool_ - Whether the operation was successful.
- `error_message` _str_ - Error message if the operation failed.
- `status` _Optional[str]_ - Current status of the clearing task. This corresponds to the
  context's state field. Possible values:
  - "clearing": Context data is being cleared (in progress)
  - "available": Clearing completed successfully
  - Other values may indicate the context state after clearing
- `context_id` _Optional[str]_ - The unique identifier of the context being cleared.

## ContextListParams

```python
class ContextListParams()
```

Parameters for listing contexts with pagination support.

## ContextService

```python
class ContextService()
```

Provides methods to manage persistent contexts in the AgentBay cloud environment.

### list

```python
def list(params: Optional[ContextListParams] = None) -> ContextListResult
```

Lists all available contexts with pagination support.

**Arguments**:

- `params` _Optional[ContextListParams], optional_ - Parameters for listing contexts.
  If None, defaults will be used.
  

**Returns**:

    ContextListResult: A result object containing the list of Context objects,
  pagination information, and request ID.
  

**Example**:

```python
result = agent_bay.context.list()
params = ContextListParams(max_results=20, next_token=result.next_token)
next_result = agent_bay.context.list(params)
```

### get

```python
def get(name: Optional[str] = None,
        create: bool = False,
        context_id: Optional[str] = None) -> ContextResult
```

Gets a context by name or ID. Optionally creates it if it doesn't exist.

**Arguments**:

- `name` _Optional[str], optional_ - The name of the context to get. Defaults to None.
- `create` _bool, optional_ - Whether to create the context if it doesn't exist. Defaults to False.
- `context_id` _Optional[str], optional_ - The ID of the context to get. Defaults to None.
  

**Returns**:

    ContextResult: The ContextResult object containing the Context and request ID.
  - success (bool): True if the operation succeeded
  - context (Context): The context object (if success is True)
  - context_id (str): The ID of the context
  - request_id (str): Unique identifier for this API request
  - error_message (str): Error description (if success is False)
  

**Raises**:

    AgentBayError: If neither name nor context_id is provided, or if create=True with context_id.
  

**Example**:

```python
result = agent_bay.context.get(name="my-context")
result = agent_bay.context.get(name="new-context", create=True)
result = agent_bay.context.get(context_id="ctx-04bdwfj7u22a1s30g")
```


**Notes**:

- Either name or context_id must be provided (not both)
- When create=True, only name parameter is allowed
- Created contexts are persistent and can be shared across sessions
- Context names must be unique within your account


**See Also**:

ContextService.list, ContextService.update, ContextService.delete

### create

```python
def create(name: str) -> ContextResult
```

Creates a new context with the given name.

**Arguments**:

- `name` _str_ - The name for the new context.
  

**Returns**:

    ContextResult: The created ContextResult object with request ID.
  

**Example**:

```python
result = agent_bay.context.create("my-new-context")
```

### update

```python
def update(context: Context) -> OperationResult
```

Updates the specified context (currently only name can be updated).

**Arguments**:

- `context` _Context_ - The Context object to update. Must have id and name attributes.
  

**Returns**:

    OperationResult: Result object containing success status and request ID.
  - success (bool): True if the operation succeeded
  - data (str): Success message (if success is True)
  - request_id (str): Unique identifier for this API request
  - error_message (str): Error description (if success is False)
  

**Raises**:

    AgentBayError: If the context update fails.
  

**Example**:

```python
result = agent_bay.context.get(name="old-name")
result.context.name = "new-name"
update_result = agent_bay.context.update(result.context)
```


**Notes**:

- Currently only the context name can be updated
- Context ID cannot be changed
- The context must exist before it can be updated
- Updated name must be unique within your account


**See Also**:

ContextService.get, ContextService.list, ContextService.delete

### delete

```python
def delete(context: Context) -> OperationResult
```

Deletes the specified context.

**Arguments**:

- `context` _Context_ - The Context object to delete.
  

**Returns**:

    OperationResult: Result object containing success status and request ID.
  

**Example**:

```python
result = agent_bay.context.get(name="my-context")
delete_result = agent_bay.context.delete(result.context)
```

### get\_file\_download\_url

```python
def get_file_download_url(context_id: str, file_path: str) -> FileUrlResult
```

Get a presigned download URL for a file in a context.

**Arguments**:

- `context_id` _str_ - The ID of the context.
- `file_path` _str_ - The path to the file in the context.
  

**Returns**:

    FileUrlResult: A result object containing the presigned URL, expire time, and request ID.
  

**Example**:

```python
ctx_result = agent_bay.context.get(name="my-context", create=True)
url_result = agent_bay.context.get_file_download_url(ctx_result.context_id, "/path/to/file.txt")
print(url_result.url)
```

### get\_file\_upload\_url

```python
def get_file_upload_url(context_id: str, file_path: str) -> FileUrlResult
```

Get a presigned upload URL for a file in a context.

**Arguments**:

- `context_id` _str_ - The ID of the context.
- `file_path` _str_ - The path to the file in the context.
  

**Returns**:

    FileUrlResult: A result object containing the presigned URL, expire time, and request ID.
  

**Example**:

```python
ctx_result = agent_bay.context.get(name="my-context", create=True)
url_result = agent_bay.context.get_file_upload_url(ctx_result.context_id, "/path/to/file.txt")
print(url_result.url)
```

### delete\_file

```python
def delete_file(context_id: str, file_path: str) -> OperationResult
```

Delete a file in a context.

**Arguments**:

- `context_id` _str_ - The ID of the context.
- `file_path` _str_ - The path to the file to delete.
  

**Returns**:

    OperationResult: A result object containing success status and request ID.
  

**Example**:

```python
ctx_result = agent_bay.context.get(name="my-context", create=True)
delete_result = agent_bay.context.delete_file(ctx_result.context_id, "/path/to/file.txt")
```

### list\_files

```python
def list_files(context_id: str,
               parent_folder_path: str,
               page_number: int = 1,
               page_size: int = 50) -> ContextFileListResult
```

List files under a specific folder path in a context.

**Arguments**:

- `context_id` _str_ - The ID of the context.
- `parent_folder_path` _str_ - The parent folder path to list files from.
- `page_number` _int_ - The page number for pagination. Default is 1.
- `page_size` _int_ - The number of items per page. Default is 50.
  

**Returns**:

    ContextFileListResult: A result object containing the list of files and request ID.
  

**Example**:

```python
ctx_result = agent_bay.context.get(name="my-context", create=True)
files_result = agent_bay.context.list_files(ctx_result.context_id, "/")
print(f"Found {len(files_result.entries)} files")
```

### clear\_async

```python
def clear_async(context_id: str) -> ClearContextResult
```

Synchronously initiate a task to clear the context's persistent data.

This is a non-blocking method that returns immediately after initiating the clearing task
on the backend. The context's state will transition to "clearing" while the operation
is in progress.

**Arguments**:

    context_id: Unique ID of the context to clear.
  

**Returns**:

  A ClearContextResult object indicating the task has been successfully started,
  with status field set to "clearing".
  

**Raises**:

    AgentBayError: If the backend API rejects the clearing request (e.g., invalid ID).
  

**Example**:

```python
result = agent_bay.context.get(name="my-context", create=True)
clear_result = agent_bay.context.start_clear(result.context_id)
```

### get\_clear\_status

```python
def get_clear_status(context_id: str) -> ClearContextResult
```

Query the status of the clearing task.

This method calls GetContext API directly and parses the raw response to extract
the state field, which indicates the current clearing status.

**Arguments**:

    context_id: ID of the context.
  

**Returns**:

  ClearContextResult object containing the current task status.
  

**Example**:

```python
result = agent_bay.context.get(name="my-context", create=True)
clear_result = agent_bay.context.clear_async(result.context_id)
status_result = agent_bay.context.get_clear_status(result.context_id)
print(status_result.status)
```

### clear

```python
def clear(context_id: str,
          timeout: int = 60,
          poll_interval: float = 2.0) -> ClearContextResult
```

Synchronously clear the context's persistent data and wait for the final result.

This method wraps the `clear_async` and `_get_clear_status` polling logic,
providing the simplest and most direct way to handle clearing tasks.

The clearing process transitions through the following states:
- "clearing": Data clearing is in progress
- "available": Clearing completed successfully (final success state)

**Arguments**:

    context_id: Unique ID of the context to clear.
    timeout: Timeout in seconds to wait for task completion. Defaults to 60.
    poll_interval: Interval in seconds between status polls. Defaults to 2.0.
  

**Returns**:

  ClearContextResult object containing the final task result.
  The status field will be "available" on success.
  

**Raises**:

    ClearanceTimeoutError: If the task fails to complete within the timeout.
    AgentBayError: If an API or network error occurs during execution.
  

**Example**:

```python
result = agent_bay.context.get(name="my-context", create=True)
clear_result = agent_bay.context.clear(result.context_id, timeout=60)
```

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

**Related APIs:**
- [Session API Reference](./session.md)
- [Context Manager API Reference](./context-manager.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# Extension API Reference

> **üí° Async Version**: This documentation covers the synchronous API. For async/await support, see [`AsyncExtensionsService`](../async/async-extension.md) which provides the same functionality with async methods.

## üß© Related Tutorial

- [Browser Extensions Guide](../../../../docs/guides/browser-use/core-features/extension.md) - Learn how to use browser extensions



#### EXTENSIONS\_BASE\_PATH

```python
EXTENSIONS_BASE_PATH = "/tmp/extensions"
```

## Extension

```python
class Extension()
```

Represents a browser extension as a cloud resource.

## ExtensionOption

```python
class ExtensionOption()
```

Configuration options for browser extension integration.

This class encapsulates the necessary parameters for setting up
browser extension synchronization and context management.

**Attributes**:

- `context_id` _str_ - ID of the extension context for browser extensions
- `extension_ids` _List[str]_ - List of extension IDs to be loaded/synchronized

### validate

```python
def validate() -> bool
```

Validate the extension option configuration.

**Returns**:

    bool: True if configuration is valid, False otherwise.
  

**Example**:

```python
ext_option = ExtensionOption("ctx-123", ["ext1.zip", "ext2.zip"])
is_valid = ext_option.validate()
print(f"Valid: {is_valid}")
```

## ExtensionsService

```python
class ExtensionsService()
```

Provides methods to manage user browser extensions synchronously.
This service integrates with the existing context functionality for file operations.

**Usage** (Simplified - Auto-detection):
```python
# Service automatically detects if context exists and creates if needed
extensions_service = ExtensionsService(agent_bay, "browser_extensions")

# Use the service immediately
extension = extensions_service.create("/path/to/plugin.zip")
```

**Integration with ExtensionOption (Simplified)**:
```python
# Create extensions and configure for browser sessions
extensions_service = ExtensionsService(agent_bay, "my_extensions")
ext1 = extensions_service.create("/path/to/ext1.zip")
ext2 = extensions_service.create("/path/to/ext2.zip")

# Create extension option for browser integration (no context_id needed!)
ext_option = extensions_service.create_extension_option([ext1.id, ext2.id])

# Use with BrowserContext for session creation
browser_context = BrowserContext(
    context_id="browser_session",
    auto_upload=True,
    extension_option=ext_option  # All extension config encapsulated
)
```

**Context Management**:
- If context_id provided and exists: Uses the existing context
- If context_id provided but doesn't exist: Creates context with provided name
- If context_id empty or not provided: Generates default name and creates context
- No need to manually manage context creation

### list

```python
def list() -> List[Extension]
```

Lists all available browser extensions within this context from the cloud.
Uses the context service to list files under the extensions directory.

**Returns**:

    List[Extension]: List of all extensions in the context.
  

**Raises**:

    AgentBayError: If listing fails.
  

**Example**:

```python
extensions_service = ExtensionsService(agent_bay, "my-extensions")
extensions = extensions_service.list()
print(f"Found {len(extensions)} extensions")
```

### create

```python
def create(local_path: str) -> Extension
```

Uploads a new browser extension from a local path into the current context.

**Arguments**:

- `local_path` _str_ - Path to the local extension ZIP file.
  

**Returns**:

    Extension: Extension object with generated ID and metadata.
  

**Raises**:

    FileNotFoundError: If the local file doesn't exist.
    ValueError: If the file format is not supported (only ZIP files allowed).
    AgentBayError: If upload fails.
  

**Example**:

```python
extensions_service = ExtensionsService(agent_bay, "my-extensions")
extension = extensions_service.create("/path/to/extension.zip")
print(f"Created extension: {extension.id}")
```

### update

```python
def update(extension_id: str, new_local_path: str) -> Extension
```

Updates an existing browser extension in the current context with a new file.

**Arguments**:

- `extension_id` _str_ - ID of the extension to update.
- `new_local_path` _str_ - Path to the new extension ZIP file.
  

**Returns**:

    Extension: Updated extension object.
  

**Raises**:

    FileNotFoundError: If the new local file doesn't exist.
    ValueError: If the extension ID doesn't exist in the context.
    AgentBayError: If update fails.
  

**Example**:

```python
extensions_service = ExtensionsService(agent_bay, "my-extensions")
updated = extensions_service.update("ext_abc123.zip", "/path/to/new_version.zip")
print(f"Updated extension: {updated.id}")
```

### cleanup

```python
def cleanup() -> bool
```

Cleans up the auto-created context if it was created by this service.

**Returns**:

    bool: True if cleanup was successful or not needed, False if cleanup failed.
  

**Notes**:

  This method only works if the context was auto-created by this service.
  For existing contexts, no cleanup is performed.
  

**Example**:

```python
extensions_service = ExtensionsService(agent_bay)
success = extensions_service.cleanup()
print(f"Cleanup success: {success}")
```

### delete

```python
def delete(extension_id: str) -> bool
```

Deletes a browser extension from the current context.

**Arguments**:

- `extension_id` _str_ - ID of the extension to delete.
  

**Returns**:

    bool: True if deletion was successful, False otherwise.
  

**Example**:

```python
extensions_service = ExtensionsService(agent_bay, "my-extensions")
success = extensions_service.delete("ext_abc123.zip")
print(f"Delete success: {success}")
```

### create\_extension\_option

```python
def create_extension_option(extension_ids: List[str]) -> ExtensionOption
```

Create an ExtensionOption for the current context with specified extension IDs.

This is a convenience method that creates an ExtensionOption using the current
service's context_id and the provided extension IDs. This option can then be
used with BrowserContext for browser session creation.

**Arguments**:

- `extension_ids` _List[str]_ - List of extension IDs to include in the option.
  These should be extensions that exist in the current context.
  

**Returns**:

    ExtensionOption: Configuration object for browser extension integration.
  

**Raises**:

    ValueError: If extension_ids is empty or invalid.
  

**Example**:

```python
extensions_service = ExtensionsService(agent_bay, "my-extensions")
ext_option = extensions_service.create_extension_option(["ext1.zip", "ext2.zip"])
print(f"Extension option: {ext_option}")
```

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

**Related APIs:**
- [Browser API Reference](./browser.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# File System API Reference

> **üí° Async Version**: This documentation covers the synchronous API. For async/await support, see [`AsyncFileSystem`](../async/async-filesystem.md) which provides the same functionality with async methods.

## üìÅ Related Tutorial

- [File Operations Guide](../../../../docs/guides/common-features/basics/file-operations.md) - Complete guide to file system operations



## FileTransfer

```python
class FileTransfer()
```

AsyncFileTransfer provides pre-signed URL upload/download functionality between local and OSS,
with integration to Session Context synchronization.

Prerequisites and Constraints:
- Session must be associated with the corresponding context_id and path through
  CreateSessionParams.context_syncs, and remote_path should fall within that
  synchronization path (or conform to backend path rules).
- Requires available AgentBay context service (agent_bay.context) and session context.

### upload

```python
def upload(
        local_path: str,
        remote_path: str,
        *,
        content_type: Optional[str] = None,
        wait: bool = True,
        wait_timeout: float = 30.0,
        poll_interval: float = 1.5,
        progress_cb: Optional[Callable[[int], None]] = None) -> UploadResult
```

Upload workflow:
1) Get OSS pre-signed URL via context.get_file_upload_url
2) Upload local file to OSS using the URL (HTTP PUT)
* 1) Trigger session.context.sync(mode="upload") to sync cloud disk data to OSS
4) If wait=True, poll session.context.info until upload task reaches completion or timeout

Returns UploadResult containing request_ids, HTTP status, ETag and other information.

### download

```python
def download(
        remote_path: str,
        local_path: str,
        *,
        overwrite: bool = True,
        wait: bool = True,
        wait_timeout: float = 300.0,
        poll_interval: float = 1.5,
        progress_cb: Optional[Callable[[int], None]] = None) -> DownloadResult
```

Download workflow:
1) Trigger session.context.sync(mode="upload") to sync cloud disk data to OSS
2) Get pre-signed download URL via context.get_file_download_url
3) Download the file and save to local local_path
4) If wait=True, wait for download task to reach completion after step 1
   (ensuring backend has prepared the download object)

Returns DownloadResult containing sync and download request_ids, HTTP status, byte count, etc.

## FileSystem

```python
class FileSystem(BaseService)
```

Handles file operations in the AgentBay cloud environment.

#### DEFAULT\_CHUNK\_SIZE

```python
DEFAULT_CHUNK_SIZE = 50 * 1024
```

### create\_directory

```python
def create_directory(path: str) -> BoolResult
```

Create a new directory at the specified path.

**Arguments**:

    path: The path of the directory to create.
  

**Returns**:

    BoolResult: Result object containing success status and error message if
  any.
  

**Example**:

```python
session = agent_bay.create().session
create_result = session.file_system.create_directory("/tmp/mydir")
nested_result = session.file_system.create_directory("/tmp/parent/child/grandchild")
session.delete()
```

### edit\_file

```python
def edit_file(path: str,
              edits: List[Dict[str, str]],
              dry_run: bool = False) -> BoolResult
```

Edit a file by replacing occurrences of oldText with newText.

**Arguments**:

    path: The path of the file to edit.
    edits: A list of dictionaries specifying oldText and newText.
    dry_run: If True, preview changes without applying them.
  

**Returns**:

    BoolResult: Result object containing success status and error message if
  any.
  

**Example**:

```python
session = agent_bay.create().session
session.file_system.write_file("/tmp/config.txt", "DEBUG=false
LOG_LEVEL=info")
edits = [{"oldText": "false", "newText": "true"}]
edit_result = session.file_system.edit_file("/tmp/config.txt", edits)
session.delete()
```

### get\_file\_info

```python
def get_file_info(path: str) -> FileInfoResult
```

Get information about a file or directory.

**Arguments**:

    path: The path of the file or directory to inspect.
  

**Returns**:

    FileInfoResult: Result object containing file info and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
session.file_system.write_file("/tmp/test.txt", "Sample content")
info_result = session.file_system.get_file_info("/tmp/test.txt")
print(info_result.file_info)
session.delete()
```

### list\_directory

```python
def list_directory(path: str) -> DirectoryListResult
```

List the contents of a directory.

**Arguments**:

- `path` _str_ - The path of the directory to list.
  

**Returns**:

    DirectoryListResult: Result object containing directory entries and error message if any.
  - success (bool): True if the operation succeeded
  - entries (List[Dict[str, Union[str, bool]]]): List of directory entries (if success is True)
  Each entry contains:
  - name (str): Name of the file or directory
  - isDirectory (bool): True if entry is a directory, False if file
  - request_id (str): Unique identifier for this API request
  - error_message (str): Error description (if success is False)
  

**Raises**:

    FileError: If the directory does not exist or cannot be accessed.
  

**Example**:

```python
session = agent_bay.create().session
session.file_system.create_directory("/tmp/testdir")
session.file_system.write_file("/tmp/testdir/file1.txt", "Content 1")
list_result = session.file_system.list_directory("/tmp/testdir")
print(f"Found {len(list_result.entries)} entries")
session.delete()
```


**Notes**:

- Returns empty list for empty directories
- Each entry includes name and isDirectory flag
- Does not recursively list subdirectories


**See Also**:

FileSystem.create_directory, FileSystem.get_file_info, FileSystem.read_file

### move\_file

```python
def move_file(source: str, destination: str) -> BoolResult
```

Move a file or directory from source path to destination path.

**Arguments**:

    source: The source path of the file or directory.
    destination: The destination path.
  

**Returns**:

    BoolResult: Result object containing success status and error message if
  any.
  

**Example**:

```python
session = agent_bay.create().session
session.file_system.write_file("/tmp/original.txt", "Test content")
move_result = session.file_system.move_file("/tmp/original.txt", "/tmp/moved.txt")
read_result = session.file_system.read_file("/tmp/moved.txt")
session.delete()
```

### read\_multiple\_files

```python
def read_multiple_files(paths: List[str]) -> MultipleFileContentResult
```

Read the contents of multiple files at once.

**Arguments**:

    paths: A list of file paths to read.
  

**Returns**:

    MultipleFileContentResult: Result object containing a dictionary mapping
  file paths to contents,
  and error message if any.
  

**Example**:

```python
session = agent_bay.create().session
session.file_system.write_file("/tmp/file1.txt", "Content of file 1")
session.file_system.write_file("/tmp/file2.txt", "Content of file 2")
session.file_system.write_file("/tmp/file3.txt", "Content of file 3")
paths = ["/tmp/file1.txt", "/tmp/file2.txt", "/tmp/file3.txt"]
read_result = session.file_system.read_multiple_files(paths)
session.delete()
```

### search\_files

```python
def search_files(
        path: str,
        pattern: str,
        exclude_patterns: Optional[List[str]] = None) -> FileSearchResult
```

Search for files in the specified path using a wildcard pattern.

**Arguments**:

    path: The base directory path to search in.
    pattern: Wildcard pattern to match against file names. Supports * (any characters)
  and ? (single character). Examples: "*.py", "test_*", "*config*".
    exclude_patterns: Optional list of wildcard patterns to exclude from the search.
  

**Returns**:

    FileSearchResult: Result object containing matching file paths and error
  message if any.
  

**Example**:

```python
session = agent_bay.create().session
session.file_system.write_file("/tmp/test/test_file1.py", "print('hello')")
session.file_system.write_file("/tmp/test/test_file2.py", "print('world')")
session.file_system.write_file("/tmp/test/other.txt", "text content")
search_result = session.file_system.search_files("/tmp/test", "test_*")
session.delete()
```

### read\_file

```python
def read_file(path: str) -> FileContentResult
```

Read the contents of a file. Automatically handles large files by chunking.

**Arguments**:

- `path` _str_ - The path of the file to read.
  

**Returns**:

    FileContentResult: Result object containing file content and error message if any.
  - success (bool): True if the operation succeeded
  - content (str): The file content (if success is True)
  - request_id (str): Unique identifier for this API request
  - error_message (str): Error description (if success is False)
  

**Raises**:

    FileError: If the file does not exist or is a directory.
  

**Example**:

```python
session = agent_bay.create().session
write_result = session.file_system.write_file("/tmp/test.txt", "Hello, World!")
read_result = session.file_system.read_file("/tmp/test.txt")
print(read_result.content)
session.delete()
```


**Notes**:

- Automatically handles large files by reading in chunks (default 50KB per chunk)
- Returns empty string for empty files
- Returns error if path is a directory


**See Also**:

FileSystem.write_file, FileSystem.list_directory, FileSystem.get_file_info

### write\_file

```python
def write_file(path: str, content: str, mode: str = "overwrite") -> BoolResult
```

Write content to a file. Automatically handles large files by chunking.

**Arguments**:

- `path` _str_ - The path of the file to write.
- `content` _str_ - The content to write to the file.
- `mode` _str, optional_ - The write mode. Defaults to "overwrite".
  - "overwrite": Replace file content
  - "append": Append to existing content
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  - success (bool): True if the operation succeeded
  - data (bool): True if the file was written successfully
  - request_id (str): Unique identifier for this API request
  - error_message (str): Error description (if success is False)
  

**Raises**:

    FileError: If the write operation fails.
  

**Example**:

```python
session = agent_bay.create().session
write_result = session.file_system.write_file("/tmp/test.txt", "Hello, World!")
append_result = session.file_system.write_file("/tmp/test.txt", "
New line", mode="append")
read_result = session.file_system.read_file("/tmp/test.txt")
session.delete()
```


**Notes**:

- Automatically handles large files by writing in chunks (default 50KB per chunk)
- Creates parent directories if they don't exist
- In "overwrite" mode, replaces the entire file content
- In "append" mode, adds content to the end of the file


**See Also**:

FileSystem.read_file, FileSystem.create_directory, FileSystem.edit_file

### upload\_file

```python
def upload_file(
        local_path: str,
        remote_path: str,
        *,
        content_type: Optional[str] = None,
        wait: bool = True,
        wait_timeout: float = 30.0,
        poll_interval: float = 1.5,
        progress_cb: Optional[Callable[[int], None]] = None) -> UploadResult
```

Upload a file from local to remote path using pre-signed URLs.

**Arguments**:

    local_path: Local file path to upload
    remote_path: Remote file path to upload to
    content_type: Optional content type for the file
    wait: Whether to wait for the sync operation to complete
    wait_timeout: Timeout for waiting for sync completion
    poll_interval: Interval between polling for sync completion
    progress_cb: Callback for upload progress updates
  

**Returns**:

    UploadResult: Result of the upload operation
  

**Example**:

```python
params = CreateSessionParams(context_syncs=[ContextSync(context_id="ctx-xxx", path="/workspace")])
session = agent_bay.create(params)
upload_result = session.session.file_system.upload_file("/local/file.txt", "/workspace/file.txt")
session.session.delete()
```

### download\_file

```python
def download_file(
        remote_path: str,
        local_path: str,
        *,
        overwrite: bool = True,
        wait: bool = True,
        wait_timeout: float = 30.0,
        poll_interval: float = 1.5,
        progress_cb: Optional[Callable[[int], None]] = None) -> DownloadResult
```

Download a file from remote path to local path using pre-signed URLs.

**Arguments**:

    remote_path: Remote file path to download from
    local_path: Local file path to download to
    overwrite: Whether to overwrite existing local file
    wait: Whether to wait for the sync operation to complete
    wait_timeout: Timeout for waiting for sync completion
    poll_interval: Interval between polling for sync completion
    progress_cb: Callback for download progress updates
  

**Returns**:

    DownloadResult: Result of the download operation
  

**Example**:

```python
params = CreateSessionParams(context_syncs=[ContextSync(context_id="ctx-xxx", path="/workspace")])
session = agent_bay.create(params)
download_result = session.session.file_system.download_file("/workspace/file.txt", "/local/file.txt")
session.session.delete()
```

### watch\_directory

```python
def watch_directory(
        path: str,
        callback: Callable[[List[FileChangeEvent]], None],
        interval: float = 0.5,
        stop_event: Optional[threading.Event] = None) -> threading.Thread
```

Watch a directory for file changes and call the callback function when changes occur.

**Arguments**:

    path: The directory path to monitor for file changes.
    callback: Callback function that will be called with a list of FileChangeEvent
  objects when changes are detected.
    interval: Polling interval in seconds. Defaults to 0.5.
    stop_event: Optional threading.Event to stop the monitoring. If not provided,
  a new Event will be created and returned via the thread object.
  

**Returns**:

    threading.Thread: The monitoring thread. Call thread.start() to begin monitoring.
  Use the thread's stop_event attribute to stop monitoring.
  

**Example**:

```python
def on_changes(events):
  print(f"Detected {len(events)} changes")
session = agent_bay.create().session
session.file_system.create_directory("/tmp/watch_test")
monitor_thread = session.file_system.watch_directory("/tmp/watch_test", on_changes)
monitor_thread.start()
session.file_system.write_file("/tmp/watch_test/test1.txt", "content 1")
session.file_system.write_file("/tmp/watch_test/test2.txt", "content 2")
session.delete()
```

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

**Related APIs:**
- [Session API Reference](./session.md)
- [Command API Reference](./command.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# Mobile API Reference

> **üí° Async Version**: This documentation covers the synchronous API. For async/await support, see [`AsyncMobile`](../async/async-mobile.md) which provides the same functionality with async methods.

## üì± Related Tutorial

- [Mobile Use Guide](../../../../docs/guides/mobile-use/README.md) - Automate mobile applications

## Overview

The Mobile module provides mobile device automation capabilities including touch gestures,
text input, app management, and screenshot capture. It supports Android device automation.


## Requirements

- Requires `mobile_latest` image for mobile automation features



Mobile module for mobile device UI automation and configuration.
Handles touch operations, UI element interactions, application management, screenshot capabilities,
and mobile environment configuration operations.

## Mobile

```python
class Mobile(BaseService)
```

Handles mobile UI automation operations and configuration in the AgentBay cloud environment.
Provides comprehensive mobile automation capabilities including touch operations,
UI element interactions, application management, screenshot capabilities,
and mobile environment configuration operations.

### tap

```python
def tap(x: int, y: int) -> BoolResult
```

Taps on the mobile screen at the specified coordinates.

**Arguments**:

- `x` _int_ - X coordinate in pixels.
- `y` _int_ - Y coordinate in pixels.
  

**Returns**:

    BoolResult: Object with success status and error message if any.
  

**Example**:

```python
session = agent_bay.create(image="mobile_latest").session
session.mobile.tap(500, 800)
session.delete()
```


**See Also**:

swipe, long_press

### swipe

```python
def swipe(start_x: int,
          start_y: int,
          end_x: int,
          end_y: int,
          duration_ms: int = 300) -> BoolResult
```

Performs a swipe gesture from one point to another.

**Arguments**:

- `start_x` _int_ - Starting X coordinate.
- `start_y` _int_ - Starting Y coordinate.
- `end_x` _int_ - Ending X coordinate.
- `end_y` _int_ - Ending Y coordinate.
- `duration_ms` _int, optional_ - Duration of the swipe in milliseconds.
  Defaults to 300.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = agent_bay.create(image="mobile_latest").session
session.mobile.swipe(100, 1000, 100, 200, duration_ms=500)
session.delete()
```

### input\_text

```python
def input_text(text: str) -> BoolResult
```

Inputs text into the active field.

**Arguments**:

- `text` _str_ - The text to input.
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = agent_bay.create(image="mobile_latest").session
session.mobile.input_text("Hello Mobile!")
session.delete()
```

### send\_key

```python
def send_key(key: int) -> BoolResult
```

Sends a key press event.

**Arguments**:

- `key` _int_ - The key code to send. Supported key codes are:
  - 3 : HOME
  - 4 : BACK
  - 24 : VOLUME UP
  - 25 : VOLUME DOWN
  - 26 : POWER
  - 82 : MENU
  

**Returns**:

    BoolResult: Result object containing success status and error message if any.
  

**Example**:

```python
session = agent_bay.create(image="mobile_latest").session
session.mobile.send_key(4)  # Press BACK button
session.delete()
```

### get\_clickable\_ui\_elements

```python
def get_clickable_ui_elements(timeout_ms: int = 2000) -> UIElementListResult
```

Retrieves all clickable UI elements within the specified timeout.

**Arguments**:

- `timeout_ms` _int, optional_ - Timeout in milliseconds. Defaults to 2000.
  

**Returns**:

    UIElementListResult: Result object containing clickable UI elements and
  error message if any.
  

**Example**:

```python
session = agent_bay.create(image="mobile_latest").session
result = session.mobile.get_clickable_ui_elements()
print(f"Found {len(result.elements)} clickable elements")
session.delete()
```

### get\_all\_ui\_elements

```python
def get_all_ui_elements(timeout_ms: int = 2000) -> UIElementListResult
```

Retrieves all UI elements within the specified timeout.

**Arguments**:

- `timeout_ms` _int, optional_ - Timeout in milliseconds. Defaults to 2000.
  

**Returns**:

    UIElementListResult: Result object containing UI elements and error
  message if any.
  

**Example**:

```python
session = agent_bay.create(image="mobile_latest").session
result = session.mobile.get_all_ui_elements()
print(f"Found {len(result.elements)} UI elements")
session.delete()
```

### get\_installed\_apps

```python
def get_installed_apps(start_menu: bool, desktop: bool,
                       ignore_system_apps: bool) -> InstalledAppListResult
```

Retrieves a list of installed applications.

**Arguments**:

- `start_menu` _bool_ - Whether to include start menu applications.
- `desktop` _bool_ - Whether to include desktop applications.
- `ignore_system_apps` _bool_ - Whether to ignore system applications.
  

**Returns**:

    InstalledAppListResult: The result containing the list of installed
  applications.
  

**Example**:

```python
session = agent_bay.create(image="mobile_latest").session
apps = session.mobile.get_installed_apps(True, False, True)
print(f"Found {len(apps.data)} apps")
session.delete()
```

### start\_app

```python
def start_app(start_cmd: str,
              work_directory: str = "",
              activity: str = "") -> ProcessListResult
```

Starts an application with the given command, optional working directory and
optional activity.

**Arguments**:

- `start_cmd` _str_ - The command to start the application.
- `work_directory` _str, optional_ - The working directory for the application.
- `activity` _str, optional_ - Activity name to launch (e.g. ".SettingsActivity"
  or "com.package/.Activity"). Defaults to "".
  

**Returns**:

    ProcessListResult: The result containing the list of processes started.
  

**Example**:

```python
session = agent_bay.create(image="mobile_latest").session
processes = session.mobile.start_app("monkey -p com.android.settings 1")
print(f"Started {len(processes.data)} process(es)")
session.delete()
```

### stop\_app\_by\_cmd

```python
def stop_app_by_cmd(stop_cmd: str) -> AppOperationResult
```

Stops an application by stop command.

**Arguments**:

- `stop_cmd` _str_ - The command to stop the application.
  

**Returns**:

    AppOperationResult: The result of the operation.
  

**Example**:

```python
session = agent_bay.create(image="mobile_latest").session
result = session.mobile.stop_app_by_cmd("com.android.settings")
print(f"Stop successful: {result.success}")
session.delete()
```

### screenshot

```python
def screenshot() -> OperationResult
```

Takes a screenshot of the current screen.

**Returns**:

    OperationResult: Result object containing the path to the screenshot
  and error message if any.
  

**Example**:

```python
session = agent_bay.create(image="mobile_latest").session
result = session.mobile.screenshot()
print(f"Screenshot URL: {result.data}")
session.delete()
```

### configure

```python
def configure(mobile_config)
```

Configure mobile settings from MobileExtraConfig.

This method is typically called automatically during session creation when
MobileExtraConfig is provided in CreateSessionParams. It can also be called
manually to reconfigure mobile settings during a session.

**Arguments**:

- `mobile_config` _MobileExtraConfig_ - Mobile configuration object with settings for:
  - lock_resolution (bool): Whether to lock device resolution
  - app_manager_rule (AppManagerRule): App whitelist/blacklist rules
  - hide_navigation_bar (bool): Whether to hide navigation bar
  - uninstall_blacklist (List[str]): Apps protected from uninstallation
  

**Example**:

```python
from agentbay import AgentBay, CreateSessionParams, MobileExtraConfig
agent_bay = AgentBay(api_key="your_api_key")
result = agent_bay.create(CreateSessionParams(image_id="mobile_latest"))
session = result.session
mobile_config = MobileExtraConfig(lock_resolution=True)
session.mobile.configure(mobile_config)
agent_bay.delete(session)
```


**Notes**:

- This method is called automatically during session creation if MobileExtraConfig is provided
- Configuration changes are applied immediately
- Resolution lock prevents resolution changes
- App whitelist/blacklist affects app launching permissions
- Uninstall blacklist protects apps from being uninstalled


**See Also**:

set_resolution_lock, set_app_whitelist, set_app_blacklist,
set_navigation_bar_visibility, set_uninstall_blacklist

### set\_resolution\_lock

```python
def set_resolution_lock(enable: bool)
```

Set display resolution lock for mobile devices.

**Arguments**:

- `enable` _bool_ - True to enable, False to disable.
  

**Example**:

```python
session = agent_bay.create(image="mobile_latest").session
session.mobile.set_resolution_lock(True)
session.mobile.set_resolution_lock(False)
session.delete()
```

### set\_app\_whitelist

```python
def set_app_whitelist(package_names: List[str])
```

Set application whitelist.

**Arguments**:

- `package_names` _List[str]_ - List of Android package names to whitelist.
  

**Example**:

```python
session = agent_bay.create(image="mobile_latest").session
whitelist = ["com.android.settings", "com.android.chrome"]
session.mobile.set_app_whitelist(whitelist)
session.delete()
```


**Notes**:

- Only apps in the whitelist will be allowed to run
- System apps may be affected depending on the configuration
- Whitelist takes precedence over blacklist if both are set

### set\_app\_blacklist

```python
def set_app_blacklist(package_names: List[str])
```

Set application blacklist.

**Arguments**:

- `package_names` _List[str]_ - List of Android package names to blacklist.
  

**Example**:

```python
session = agent_bay.create(image="mobile_latest").session
blacklist = ["com.example.app1", "com.example.app2"]
session.mobile.set_app_blacklist(blacklist)
session.delete()
```


**Notes**:

- Apps in the blacklist will be blocked from running
- Whitelist takes precedence over blacklist if both are set

### set\_navigation\_bar\_visibility

```python
def set_navigation_bar_visibility(hide: bool)
```

Set navigation bar visibility for mobile devices.

**Arguments**:

- `hide` _bool_ - True to hide navigation bar, False to show navigation bar.
  

**Example**:

```python
session = agent_bay.create(image="mobile_latest").session
session.mobile.set_navigation_bar_visibility(hide=True)
session.mobile.set_navigation_bar_visibility(hide=False)
session.delete()
```


**Notes**:

- Hiding the navigation bar provides a fullscreen experience
- The navigation bar can still be accessed by swiping from the edge

### set\_uninstall\_blacklist

```python
def set_uninstall_blacklist(package_names: List[str])
```

Set uninstall protection blacklist for mobile devices.

**Arguments**:

- `package_names` _List[str]_ - List of Android package names to protect from uninstallation.
  

**Example**:

```python
session = agent_bay.create(image="mobile_latest").session
protected_apps = ["com.android.settings", "com.android.chrome"]
session.mobile.set_uninstall_blacklist(protected_apps)
session.delete()
```


**Notes**:

- Apps in the uninstall blacklist cannot be uninstalled
- This is useful for protecting critical applications
- The protection persists for the session lifetime

### get\_adb\_url

```python
def get_adb_url(adbkey_pub: str) -> AdbUrlResult
```

Retrieves the ADB connection URL for the mobile environment.

This method is only supported in mobile environments (mobile_latest image).
It uses the provided ADB public key to establish the connection and returns
the ADB connect URL.

**Arguments**:

- `adbkey_pub` _str_ - The ADB public key for connection authentication.
  

**Returns**:

    AdbUrlResult: Result object containing the ADB connection URL
    (format: "adb connect <IP>:<Port>") and request ID.
  Returns error if not in mobile environment.
  

**Raises**:

    SessionError: If the session is not in mobile environment.
  

**Example**:

```python
session = agent_bay.create(image="mobile_latest").session
adbkey_pub = "your_adb_public_key"
adb_result = session.mobile.get_adb_url(adbkey_pub)
print(f"ADB URL: {adb_result.data}")
session.delete()
```

## Best Practices

1. Verify element coordinates before tap operations
2. Use appropriate swipe durations for smooth gestures
3. Wait for UI elements to load before interaction
4. Take screenshots for verification and debugging
5. Handle app installation and uninstallation properly
6. Configure app whitelists/blacklists for security

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

**Related APIs:**
- [Session API Reference](./session.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# OSS API Reference

> **üí° Async Version**: This documentation covers the synchronous API. For async/await support, see [`AsyncOss`](../async/async-oss.md) which provides the same functionality with async methods.

## ‚òÅÔ∏è Related Tutorial

- [OSS Integration Guide](../../../../docs/guides/common-features/advanced/oss-integration.md) - Integrate with Alibaba Cloud OSS for file storage



## OSSClientResult

```python
class OSSClientResult(ApiResponse)
```

Result of OSS client creation operations.

## OSSUploadResult

```python
class OSSUploadResult(ApiResponse)
```

Result of OSS upload operations.

## OSSDownloadResult

```python
class OSSDownloadResult(ApiResponse)
```

Result of OSS download operations.

## Oss

```python
class Oss(BaseService)
```

Handles Object Storage Service operations in the AgentBay cloud environment.

### env\_init

```python
def env_init(access_key_id: str,
             access_key_secret: str,
             securityToken: str,
             endpoint: Optional[str] = None,
             region: Optional[str] = None) -> OSSClientResult
```

Create an OSS client with the provided STS temporary credentials.

**Arguments**:

    access_key_id: The Access Key ID from STS temporary credentials.
    access_key_secret: The Access Key Secret from STS temporary credentials.
    securityToken: Security token from STS temporary credentials. Required for security.
    endpoint: The OSS service endpoint. If not specified, the default is used.
    region: The OSS region. If not specified, the default is used.
  

**Returns**:

    OSSClientResult: Result object containing client configuration and error
  message if any.
  

**Example**:

```python
session = agent_bay.create().session
session.oss.env_init(
  access_key_id="your_sts_access_key_id",
  access_key_secret="your_sts_access_key_secret",
  securityToken="your_sts_security_token"
)
session.delete()
```

### upload

```python
def upload(bucket: str, object: str, path: str) -> OSSUploadResult
```

Upload a local file or directory to OSS.

Note: Before calling this API, you must first call env_init to initialize
the OSS environment.

**Arguments**:

    bucket: OSS bucket name.
    object: Object key in OSS.
    path: Local file or directory path to upload.
  

**Returns**:

    OSSUploadResult: Result object containing upload result and error message
  if any.
  

**Example**:

```python
session = agent_bay.create().session
session.oss.env_init(
  access_key_id="your_access_key_id",
  access_key_secret="your_access_key_secret"
)
result = session.oss.upload("my-bucket", "file.txt", "/local/path/file.txt")
print(f"Upload result: {result.content}")
session.delete()
```

### upload\_anonymous

```python
def upload_anonymous(url: str, path: str) -> OSSUploadResult
```

Upload a local file or directory to a URL anonymously.

**Arguments**:

    url: The HTTP/HTTPS URL to upload the file to.
    path: Local file or directory path to upload.
  

**Returns**:

    OSSUploadResult: Result object containing upload result and error message
  if any.
  

**Example**:

```python
session = agent_bay.create().session
result = session.oss.upload_anonymous(
  "https://example.com/upload",
  "/local/path/file.txt"
)
print(f"Upload result: {result.content}")
session.delete()
```

### download

```python
def download(bucket: str, object: str, path: str) -> OSSDownloadResult
```

Download an object from OSS to a local file or directory.

Note: Before calling this API, you must first call env_init to initialize
the OSS environment.

**Arguments**:

    bucket: OSS bucket name.
    object: Object key in OSS.
    path: Local file or directory path to download to.
  

**Returns**:

    OSSDownloadResult: Result object containing download status and error
  message if any.
  

**Example**:

```python
session = agent_bay.create().session
session.oss.env_init(
  access_key_id="your_access_key_id",
  access_key_secret="your_access_key_secret"
)
result = session.oss.download("my-bucket", "file.txt", "/local/path/file.txt")
print(f"Download result: {result.content}")
session.delete()
```

### download\_anonymous

```python
def download_anonymous(url: str, path: str) -> OSSDownloadResult
```

Download a file from a URL anonymously to a local file path.

**Arguments**:

    url: The HTTP/HTTPS URL to download the file from.
    path: Local file or directory path to download to.
  

**Returns**:

    OSSDownloadResult: Result object containing download status and error
  message if any.
  

**Example**:

```python
session = agent_bay.create().session
result = session.oss.download_anonymous(
  "https://example.com/file.txt",
  "/local/path/file.txt"
)
print(f"Download result: {result.content}")
session.delete()
```

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

**Related APIs:**
- [Session API Reference](./session.md)
- [FileSystem API Reference](./filesystem.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# Session API Reference

> **üí° Async Version**: This documentation covers the synchronous API. For async/await support, see [`AsyncSession`](../async/async-session.md) which provides the same functionality with async methods.

## üîß Related Tutorial

- [Session Management Guide](../../../../docs/guides/common-features/basics/session-management.md) - Detailed tutorial on session lifecycle and management



## Session

```python
class Session()
```

Session represents a session in the AgentBay cloud environment.

### delete

```python
def delete(sync_context: bool = False) -> DeleteResult
```

Delete this session and release all associated resources.

**Arguments**:

- `sync_context` _bool, optional_ - Whether to sync context data (trigger file uploads)
  before deleting the session. Defaults to False.
  

**Returns**:

    DeleteResult: Result indicating success or failure with request ID.
  - success (bool): True if deletion succeeded
  - error_message (str): Error details if deletion failed
  - request_id (str): Unique identifier for this API request
  

**Raises**:

    SessionError: If the deletion request fails or the response is invalid.

### set\_labels

```python
def set_labels(labels: Dict[str, str]) -> OperationResult
```

Sets the labels for this session synchronously.

### get\_labels

```python
def get_labels() -> OperationResult
```

Gets the labels for this session synchronously.

### info

```python
def info() -> OperationResult
```

Get detailed information about this session synchronously.

### get\_link

```python
def get_link(protocol_type: Optional[str] = None,
             port: Optional[int] = None,
             options: Optional[str] = None) -> OperationResult
```

Synchronously get a link associated with the current session.

### list\_mcp\_tools

```python
def list_mcp_tools(image_id: Optional[str] = None)
```

List MCP tools available for this session synchronously.

### call\_mcp\_tool

```python
def call_mcp_tool(tool_name: str,
                  args: Dict[str, Any],
                  read_timeout: Optional[int] = None,
                  connect_timeout: Optional[int] = None,
                  auto_gen_session: bool = False)
```

Call an MCP tool directly synchronously.

### pause

```python
def pause(timeout: int = 600,
          poll_interval: float = 2.0) -> SessionPauseResult
```

Synchronously pause this session, putting it into a dormant state.
This method waits until the session enters the PAUSED state.

### pause\_async

```python
def pause_async() -> SessionPauseResult
```

Synchronously initiate the pause session operation without waiting for completion.

### resume

```python
def resume(timeout: int = 600,
           poll_interval: float = 2.0) -> SessionResumeResult
```

Synchronously resume this session from a paused state.
This method waits until the session enters the RUNNING state.

### resume\_async

```python
def resume_async() -> SessionResumeResult
```

Synchronously initiate the resume session operation without waiting for completion.

## See Also

- [Synchronous vs Asynchronous API](../../../../python/docs/guides/async-programming/sync-vs-async.md)

**Related APIs:**
- [FileSystem API Reference](./filesystem.md)
- [Command API Reference](./command.md)
- [Context API Reference](./context.md)
- [Context Manager API Reference](./context-manager.md)
- [OSS API Reference](./oss.md)

---

*Documentation generated automatically from source code using pydoc-markdown.*




# AgentBay Python SDK Examples

This directory contains comprehensive examples demonstrating various features of the AgentBay Python SDK.

## Directory Structure

```
examples/
‚îú‚îÄ‚îÄ _async/          # Async examples (Source of Truth)
‚îÇ   ‚îú‚îÄ‚îÄ browser-use/
‚îÇ   ‚îú‚îÄ‚îÄ codespace/
‚îÇ   ‚îú‚îÄ‚îÄ common-features/
‚îÇ   ‚îú‚îÄ‚îÄ computer-use/
‚îÇ   ‚îî‚îÄ‚îÄ mobile-use/
‚îî‚îÄ‚îÄ _sync/           # Sync examples (Auto-generated)
    ‚îú‚îÄ‚îÄ browser-use/
    ‚îú‚îÄ‚îÄ codespace/
    ‚îú‚îÄ‚îÄ common-features/
    ‚îú‚îÄ‚îÄ computer-use/
    ‚îî‚îÄ‚îÄ mobile-use/
```

## About Async/Sync Versions

- **`_async/`**: Contains asynchronous examples using `AsyncAgentBay` and `async/await` syntax
- **`_sync/`**: Contains synchronous examples using `AgentBay` (auto-generated from async versions)

Both versions provide the same functionality. Choose based on your project requirements:
- Use **async** for modern async/await applications
- Use **sync** for traditional synchronous applications

## Example Categories (in _async/ and _sync/ directories)

### 1. Browser-use Examples

Located in `browser-use/browser/` and `browser-use/extension/`

**Basic Browser Operations:**
- `browser_screenshot.py` - Taking screenshots
- `browser_viewport.py` - Managing viewport sizes
- `browser_type_example.py` - Different browser types

**Navigation and Interaction:**
- `navigation_and_interaction.py` - Browser navigation and element interaction
- `page_analysis.py` - Page metadata and content extraction
- `multi_tab_management.py` - Managing multiple browser tabs

**Advanced Browser Features:**
- `javascript_execution.py` - Executing JavaScript in browser context
- `authentication_flow.py` - Handling authentication and login flows
- `responsive_testing.py` - Testing responsive design across viewports
- `network_monitoring.py` - Monitoring network requests and responses
- `popup_handling.py` - Managing popups and dialogs
- `iframe_handling.py` - Working with iframes

**File Operations:**
- `file_upload_download.py` - File upload/download operations

**Browser Automation:**
- `form_automation.py` - Automated form filling
- `web_scraping.py` - Web scraping techniques
- `cookies_management.py` - Cookie management
- `local_storage_management.py` - Local storage operations
- `screenshot_comparison.py` - Screenshot comparison

**Browser Configuration:**
- `browser_fingerprint_*.py` - Browser fingerprinting
- `browser_context_cookie_persistence.py` - Cookie persistence
- `browser-proxies.py` - Proxy configuration
- `browser_command_args.py` - Browser command arguments
- `browser_replay.py` - Browser session replay

**Extension Development:**
- `basic_extension_usage.py` - Basic extension usage
- `extension_development_workflow.py` - Extension development
- `extension_testing_automation.py` - Extension testing

**Real-world Examples:**
- `search_agentbay_doc*.py` - Documentation search examples
- `game_*.py` - Game automation examples
- Various domain-specific examples

### 2. Codespace Examples

Located in `codespace/`

**Development Environments:**
- `python_development.py` - Python environment setup and package management
- `nodejs_development.py` - Node.js environment and npm operations

**Version Control:**
- `git_operations.py` - Git repository initialization and commits

**Containerization:**
- `docker_operations.py` - Docker container management

**Data Management:**
- `database_operations.py` - SQLite database operations

**Text Processing:**
- `text_processing.py` - Text manipulation with grep/sed/awk

**System Operations:**
- `system_monitoring.py` - System resource monitoring
- `file_compression.py` - File compression and archiving

**Web Development:**
- `web_server_setup.py` - HTTP server setup and configuration

**Build Systems:**
- `build_automation.py` - Build automation with Makefiles

**Code Execution:**
- `code_execution_example.py` - Code execution patterns

### 3. Common-features Examples

Located in `common-features/basics/` and `common-features/advanced/`

**Basic Operations:**
- `session_creation/` - Creating and managing sessions
- `command_execution_patterns.py` - Various command execution patterns
- `file_operations_patterns.py` - File operation patterns
- `file_system/` - File system operations
- `session_info.py` - Session information retrieval
- `working_directory.py` - Working directory management
- `environment_setup.py` - Environment variable configuration
- `process_management.py` - Process monitoring and management
- `data_transfer.py` - Data transfer operations

**Session Management:**
- `list_sessions/` - Listing sessions
- `get/` - Getting session information
- `session_pause_resume/` - Pausing and resuming sessions
- `label_management/` - Managing session labels

**Data Persistence:**
- `data_persistence/` - Context synchronization and data persistence
- `context_management/` - Context management
- `archive-upload-mode-example/` - Archive upload modes

**Advanced Features:**
- `concurrent_sessions.py` - Managing multiple sessions concurrently
- `resource_cleanup.py` - Proper resource cleanup patterns
- `error_recovery.py` - Error handling and recovery
- `error_handling/` - Comprehensive error handling
- `batch_operations/` - Batch operations
- `parallel_execution/` - Parallel execution patterns
- `multi_session_management/` - Multi-session coordination

**Testing and Monitoring:**
- `api_testing/` - API testing patterns
- `network_testing/` - Network diagnostics
- `logging_monitoring/` - Logging and monitoring
- `performance_monitoring/` - Performance monitoring
- `screenshot_download/` - Screenshot operations

**Infrastructure:**
- `environment_variables/` - Environment variable management
- `retry_mechanism/` - Retry patterns with circuit breaker
- `session_pooling/` - Session pooling for efficiency
- `vpc_session/` - VPC session management
- `oss_management/` - OSS operations

**Filesystem:**
- `filesystem_example/` - Advanced filesystem operations
- `mcp_tool_direct_call/` - MCP tool direct calls

**Agent Integration:**
- `agent_module/` - Agent module usage

### 4. Computer-use Examples

Located in `computer-use/computer/`

- `windows_app_management_example.py` - Windows application management

### 5. Mobile-use Examples

Located in `mobile-use/`

- `mobile_get_adb_url_example.py` - Getting ADB connection URL
- `mobile_system/` - Mobile system operations

## Getting Started

### Prerequisites

```bash
pip install agentbay
```

### Running Examples

**Async version:**
```bash
python python/docs/examples/_async/codespace/python_development.py
```

**Sync version:**
```bash
python python/docs/examples/_sync/codespace/python_development.py
```

### Environment Variables

Most examples require the `AGENTBAY_API_KEY` environment variable:

```bash
export AGENTBAY_API_KEY="your_api_key_here"
```

## Example Template

### Async Example Template

```python
import asyncio
from agentbay import AsyncAgentBay
from agentbay import CreateSessionParams

async def main():
    client = AsyncAgentBay()
    session = None

    try:
        # Create session
        session_result = await client.create(
            CreateSessionParams(image_id="linux_latest")
        )
        session = session_result.session

        # Your code here
        result = await session.command.execute_command("echo 'Hello'")
        print(result.output)

    finally:
        if session:
            await client.delete(session)

if __name__ == "__main__":
    asyncio.run(main())
```

### Sync Example Template

```python
from agentbay import AgentBay
from agentbay import CreateSessionParams

def main():
    client = AgentBay()
    session = None

    try:
        # Create session
        session_result = client.create(
            CreateSessionParams(image_id="linux_latest")
        )
        session = session_result.session

        # Your code here
        result = session.command.execute_command("echo 'Hello'")
        print(result.output)

    finally:
        if session:
            client.delete(session)

if __name__ == "__main__":
    main()
```

## Contributing

When adding new examples:

1. **Always create async version first** in `_async/` directory
2. **Run the generation script** to create sync version:
   ```bash
   cd python
   make generate-examples-sync
   ```
3. **Verify both versions** work correctly
4. **Update this README** with the new example

## Maintenance

The sync examples are auto-generated from async examples. To regenerate:

```bash
cd python
python scripts/generate_sync.py
```

Or use the Makefile:

```bash
cd python
make generate-examples-sync
```

## Need Help?

- Check the [API Documentation](../api/)
- Visit the [Guides](../../../docs/guides/)
- See the [Quickstart](../../../docs/quickstart/)

## License

These examples are part of the AgentBay SDK and follow the same license.




# Browser Use Examples

This directory contains examples demonstrating browser automation capabilities in AgentBay SDK.

## Overview

Browser Use environment (`browser_latest` image) provides cloud-based browser automation with:
- Playwright integration for browser control
- Stealth mode to avoid detection
- Cookie and session persistence
- CAPTCHA handling capabilities
- Browser extension support
- AI-powered automation

## Directory Structure

```
browser-use/
‚îú‚îÄ‚îÄ browser/        # Browser automation examples
‚îî‚îÄ‚îÄ extension/      # Browser extension management examples
```

## Browser Examples

### Core Features

#### browser_context_cookie_persistence.py
Cookie persistence across multiple sessions:
- Creating sessions with Browser Context
- Setting cookies manually using Playwright
- Deleting sessions with context synchronization
- Verifying cookie persistence in new sessions

#### browser_stealth.py
Stealth mode to avoid bot detection:
- Browser fingerprint randomization
- Anti-detection techniques
- Stealth configuration options

#### browser_viewport.py
Custom viewport configuration:
- Setting custom screen resolutions
- Device emulation
- Responsive testing

#### browser_proxies.py
Proxy configuration for network routing:
- HTTP/HTTPS proxy setup
- SOCKS proxy support
- Authentication configuration

#### browser_type_example.py
Browser type selection:
- Chrome browser usage
- Chromium browser usage
- Default browser configuration

#### browser_command_args.py
Custom browser launch arguments:
- Performance optimization
- Feature flags
- Security settings

#### browser_replay.py
Session replay functionality:
- Recording browser sessions
- Replaying recorded sessions
- Session state restoration

### AI-Powered Automation

#### search_agentbay_doc.py
Manual browser automation with Playwright:
- Direct Playwright interactions
- Element selection and interaction
- Search operations

#### search_agentbay_doc_by_agent.py
AI-powered automation using Agent module:
- Natural language commands
- AI-driven element detection
- Simplified complex interactions

### Real-World Use Cases

#### Game Automation
- **game_2048.py**: 2048 game automation
- **game_sudoku.py**: Sudoku game automation
- **sudoku_solver.py**: Advanced Sudoku solving

#### E-commerce and Business
- **admin_add_product.py**: Product management automation
- **shop_inspector.py**: E-commerce shop inspection
- **expense_upload_invoices.py**: Invoice upload automation
- **gv_quick_buy_seat.py**: Quick seat booking

#### Web Interaction
- **visit_aliyun.py**: Basic website navigation
- **alimeeting_availability.py**: Meeting availability checking
- **call_for_user_jd.py**: JD.com user interaction
- **mini_max.py**: MiniMax platform automation

#### CAPTCHA Handling
- **captcha_tongcheng.py**: CAPTCHA solving example

## Extension Examples

### basic_extension_usage.py
Loading and using browser extensions:
- Extension installation
- Extension configuration
- Using extensions in automation

### extension_development_workflow.py
Extension development patterns:
- Development mode setup
- Testing extensions
- Debugging workflows

### extension_testing_automation.py
Automated extension testing:
- Test automation for extensions
- Validation workflows
- CI/CD integration

## Prerequisites

1. **Install Python SDK**:
   ```bash
   pip install wuying-agentbay-sdk
   ```

2. **Install Playwright**:
   ```bash
   pip install playwright
   playwright install chromium
   ```

3. **Set API Key**:
   ```bash
   export AGENTBAY_API_KEY=your_api_key_here
   ```

## Quick Start

```bash
# Set your API key
export AGENTBAY_API_KEY=your_api_key_here

# Run any example
cd browser
python browser_automation.py
```

## Browser Configuration

- **Browser Types**: Chrome, Chromium, Default
- **Stealth Mode**: Fingerprint randomization and anti-detection
- **Cookie Persistence**: Browser Context for session continuity
- **Proxy Support**: HTTP/HTTPS and SOCKS proxy configuration
- **Extension Support**: Load and manage browser extensions

## Best Practices

1. **Always use context synchronization**: When deleting sessions with important browser data, use `sync_context=True`
2. **Proper cleanup**: Always delete sessions and contexts when done
3. **Error handling**: Implement proper error handling for network and browser operations
4. **Resource management**: Close browser connections properly
5. **Unique context names**: Use unique context names to avoid conflicts
6. **Stealth mode**: Use stealth mode for production web scraping
7. **Rate limiting**: Respect website rate limits and robots.txt

## Related Documentation

- [Browser Use Guide](../../../../../docs/guides/browser-use/README.md)
- [Core Features](../../../../../docs/guides/browser-use/core-features.md)
- [Advanced Features](../../../../../docs/guides/browser-use/advance-features.md)
- [Browser Extensions](../../../../../docs/guides/browser-use/browser-extensions.md)
- [Browser Replay](../../../../../docs/guides/browser-use/browser-replay.md)

## Troubleshooting

### Browser Initialization Failed

If browser fails to initialize:
- Check session is created successfully
- Verify image_id is `browser_latest`
- Wait a few seconds after session creation

### Playwright Connection Issues

If Playwright can't connect:
- Verify endpoint URL is correct
- Check network connectivity
- Ensure Playwright is installed: `playwright install chromium`

### Cookie Persistence Not Working

Ensure you're using Browser Context:
- Create context with `agent_bay.context.get()`
- Use `BrowserContext` in session params
- Delete session with `sync_context=True`

### Detection by Websites

If websites detect automation:
- Enable stealth mode: `use_stealth=True`
- Randomize fingerprints
- Add delays between actions
- Use residential proxies



# Browser Examples

This directory contains examples demonstrating various capabilities of the AgentBay browser automation system.

## Screenshot Examples

### [browser_screenshot.py](../browser/browser_screenshot.py) - Browser Screenshot Demo

Demonstrates how to capture screenshots using both the browser agent and direct Playwright integration methods:

- Creating a browser session with AgentBay
- Using Playwright to connect to the browser instance
- Taking screenshots using the browser agent (returns base64 data)
- Taking screenshots using direct Playwright integration (returns bytes data)
- Saving screenshots to local files
- Customizing screenshot options (full page, image format, quality)

**Key Features:**
1. **Browser Agent Screenshots** - Uses `session.browser.agent.screenshot_async()` which returns base64 encoded data
2. **Direct Playwright Screenshots** - Uses `session.browser.screenshot(page)` which returns raw bytes data
3. **Multiple Formats** - Supports both PNG and JPEG formats with customizable quality
4. **Full Page Capture** - Ability to capture entire web pages including content below the fold
5. **Custom Options** - Configurable timeout, viewport settings, and other advanced options

**Usage:**
```bash
export AGENTBAY_API_KEY=your_api_key_here
python browser_screenshot.py
```

This will generate several screenshot files in the current directory:
- `temp_agent_screenshot.png` - Screenshot taken with browser agent
- `temp_agent_full_page_screenshot.png` - Full page screenshot taken with browser agent
- `temp_browser_screenshot.png` - Screenshot taken with direct Playwright integration
- `temp_browser_full_page_screenshot.jpg` - Full page screenshot in JPEG format
- `temp_browser_custom_screenshot.png` - Screenshot with custom options

## Other Examples

### [visit_aliyun.py](../browser/visit_aliyun.py) - Basic Browser Usage
Demonstrates basic browser automation capabilities:
- Create browser session
- Use Playwright to connect to browser instance through CDP protocol
- Navigate to websites and interact with page content

### [browser_viewport.py](../browser/browser_viewport.py) - Viewport Configuration
Shows how to configure browser viewport and screen dimensions:
- Custom viewport sizes for different device types
- Screen resolution configuration
- Responsive design testing

### [browser-proxies.py](../browser/browser-proxies.py) - Proxy Configuration
Shows how to configure browser proxies:
- Custom proxy servers
- Authentication with username/password
- Wuying proxy integration

### [browser_type_example.py](../browser/browser_type_example.py) - Browser Type Selection
Demonstrates browser type selection:
- Chrome vs Chromium selection
- Computer use image requirements
- Browser compatibility considerations

### [browser_command_args.py](../browser/browser_command_args.py) - Command Line Arguments
Shows how to customize browser behavior with command-line arguments:
- Feature flags and switches
- Performance optimizations
- Debugging options

### [captcha_tongcheng.py](../browser/captcha_tongcheng.py) - CAPTCHA Handling
Demonstrates CAPTCHA solving capabilities:
- Automated CAPTCHA detection
- Integration with solving services
- Error handling and retry logic

### [game_2048.py](../browser/game_2048.py) - Game Automation
Advanced example of game automation:
- Complex interaction patterns
- State detection and response
- AI-driven decision making

### [shop_inspector.py](../browser/shop_inspector.py) - E-commerce Scraping
Comprehensive e-commerce site inspection:
- Product extraction and normalization
- Screenshot capture for verification
- Data validation and filtering

### [search_agentbay_doc.py](../browser/search_agentbay_doc.py) - Documentation Search
Demonstrates search automation:
- Form filling and submission
- Result parsing and extraction
- Multi-page navigation

### [admin_add_product.py](../browser/admin_add_product.py) - Admin Panel Automation
Complex admin panel workflow automation:
- Authentication and session management
- Multi-step form completion
- File uploads and image processing

### [mini_max.py](../browser/mini_max.py) - AI Platform Integration
Integration with AI platforms:
- Login and authentication workflows
- Content generation and management
- Result validation and processing

### [expense_upload_invoices.py](../browser/expense_upload_invoices.py) - File Upload Automation
File upload and processing automation:
- Document upload workflows
- Form completion and submission
- Status monitoring and verification

### [game_sudoku.py](../browser/game_sudoku.py) - Logic Game Automation
Logic puzzle automation:
- Grid recognition and parsing
- Rule-based solving algorithms
- Interactive gameplay

### [gv_quick_buy_seat.py](../browser/gv_quick_buy_seat.py) - Ticket Booking Automation
High-speed booking automation:
- Time-sensitive operations
- Multi-step checkout processes
- Error handling and recovery

### [alimeeting_availability.py](../browser/alimeeting_availability.py) - Calendar Integration
Calendar and scheduling automation:
- Availability checking
- Time slot selection
- Meeting scheduling workflows

### [sudoku_solver.py](../browser/sudoku_solver.py) - Simple Game Solver
Simple game automation example:
- Basic interaction patterns
- State evaluation
- Move execution

### [search_agentbay_doc_by_agent.py](../browser/search_agentbay_doc_by_agent.py) - Agent-Based Search
Agent-driven search automation:
- Natural language instructions
- Autonomous navigation
- Result extraction

### [browser_context_cookie_persistence.py](../browser/browser_context_cookie_persistence.py) - Cookie Management
Cookie persistence and management:
- Session preservation
- Authentication state management
- Context isolation

### [browser_replay.py](../browser/browser_replay.py) - Browser Replay
Browser session recording and replay:
- Action recording
- Playback automation
- Screenshot capture for verification

### [call_for_user_jd.py](../browser/call_for_user_jd.py) - User Simulation
User behavior simulation:
- Realistic interaction patterns
- Timing variations
- Error handling



# Extension Examples

This directory contains Python examples demonstrating browser extension management capabilities of the AgentBay SDK.

## Examples

### 1. basic_extension_usage.py
Demonstrates fundamental extension management and browser session creation:
- Uploading browser extensions to the cloud
- Creating browser sessions with extensions
- Extension synchronization and file access
- Multiple extension handling
- Proper resource cleanup

**Key features demonstrated:**
- ExtensionsService initialization and context management
- Extension upload and validation
- ExtensionOption creation for browser sessions
- Extension file access in sessions at `/tmp/extensions/`

### 2. extension_development_workflow.py
Shows a complete development workflow for browser extensions:
- Extension upload for development testing
- Test session creation with extensions
- Extension updates during development
- Iterative development cycle management
- Development resource cleanup

**Key features demonstrated:**
- ExtensionDevelopmentWorkflow class usage
- Extension versioning and updates
- Development session management
- Extension testing patterns

### 3. extension_testing_automation.py
Advanced example for automated extension testing:
- Automated test suite execution
- Multi-extension testing scenarios
- Test result reporting and analysis
- CI/CD integration patterns
- Comprehensive error handling

**Key features demonstrated:**
- ExtensionTestRunner class for automation
- Test suite configuration and execution
- Automated test reporting
- CI/CD compatible testing workflows

## Running the Examples

1. Install required dependencies:
```bash
pip install wuying-agentbay-sdk
```

2. Set your API key:
```bash
export AGENTBAY_API_KEY=your_api_key_here
```

3. Update extension paths in the examples with your actual extension ZIP files.

4. Run any example:
```bash
python basic_extension_usage.py
python extension_development_workflow.py
python extension_testing_automation.py
```

## Extension Requirements

- Extensions must be packaged as ZIP files
- Extensions must include a valid `manifest.json` file
- Extensions are synchronized to `/tmp/extensions/{extension_id}/` in browser sessions

## Best Practices

1. **Context Management**:
   - Use descriptive context names for different projects
   - Always call `cleanup()` when done
   - Let the service auto-generate contexts for simple use cases

2. **File Management**:
   - Use ZIP format for all extension packages
   - Validate file existence before upload
   - Include proper manifest.json in extensions

3. **Session Management**:
   - Use meaningful labels for sessions
   - Wait for extension synchronization before testing
   - Create one ExtensionOption per session

4. **Error Handling**:
   - Implement comprehensive error handling
   - Use try-finally blocks for cleanup
   - Validate extension configurations

## Extension File Structure

Extensions are synchronized to browser sessions at:
```
/tmp/extensions/
‚îú‚îÄ‚îÄ {extension_id_1}/
‚îÇ   ‚îú‚îÄ‚îÄ manifest.json
‚îÇ   ‚îú‚îÄ‚îÄ content.js
‚îÇ   ‚îî‚îÄ‚îÄ ... (other extension files)
‚îú‚îÄ‚îÄ {extension_id_2}/
‚îÇ   ‚îú‚îÄ‚îÄ manifest.json
‚îÇ   ‚îî‚îÄ‚îÄ ... (other extension files)
‚îî‚îÄ‚îÄ ...
```

## Related Documentation

- [Extension API Reference](../../../../../../typescript/docs/api/browser-use/extension.md) - Complete API documentation
- [Browser Extensions Guide](../../../../../../docs/guides/browser-use/browser-extensions.md) - Tutorial and best practices
- [Browser Examples](../browser/README.md) - Additional browser automation examples

## Troubleshooting

**Extension not found in session:**
- Check that extension was uploaded successfully
- Verify session was created with proper ExtensionOption
- Wait for synchronization to complete before accessing files

**Upload failures:**
- Ensure file is in ZIP format
- Check file permissions and accessibility
- Verify API key and network connectivity

**Context errors:**
- Use unique context names to avoid conflicts
- Don't mix extensions from different sources
- Clean up contexts when no longer needed



# Codespace Examples

This directory contains examples demonstrating code execution capabilities in AgentBay SDK.

## Overview

Codespace environment (`linux_latest` image) provides cloud-based code execution with:
- Python and JavaScript runtime support
- File system operations
- Command execution
- Package installation and management
- Development environment setup

## Examples

### Code Execution
- **code_execution_example.py**: Basic Python and JavaScript code execution
- **python_development.py**: Python development workflow
- **nodejs_development.py**: Node.js development setup
- **web_server_setup.py**: Web server configuration

### File Operations
- **file_compression.py**: File compression and archiving
- **text_processing.py**: Text file processing operations

### System Operations
- **system_monitoring.py**: System resource monitoring
- **git_operations.py**: Git repository management
- **database_operations.py**: Database setup and operations

### Build and Automation
- **build_automation.py**: Automated build processes

## Prerequisites

- Python 3.8 or later
- AgentBay SDK installed: `pip install wuying-agentbay-sdk`
- Valid `AGENTBAY_API_KEY` environment variable

## Quick Start

```bash
# Set your API key
export AGENTBAY_API_KEY=your_api_key_here

# Run any example
python code_execution_example.py
```

## API Methods Used

| Method | Purpose |
|--------|---------|
| `session.code.run_code()` | Execute Python or JavaScript code |
| `session.file_system.write_file()` | Write content to a file |
| `session.file_system.read_file()` | Read content from a file |
| `session.command.execute_command()` | Execute shell commands |

## Common Use Cases

### Development Workflows
- Set up development environments
- Install packages and dependencies
- Run automated tests
- Build and deploy applications

### Data Processing
- Process large datasets
- Run data analysis scripts
- Generate reports and visualizations

### Automation Tasks
- Automated testing and CI/CD
- System administration tasks
- File processing and manipulation

## Best Practices

1. **Environment Setup**: Install required packages before running code
2. **Error Handling**: Check execution results for errors
3. **Resource Management**: Clean up temporary files and processes
4. **Security**: Avoid executing untrusted code
5. **Performance**: Consider memory and CPU usage for large operations

## Related Documentation

- [Codespace Guide](../../../../../docs/guides/codespace/code-execution.md)
- [File Operations Guide](../../../../../docs/guides/common-features/basics/file-operations.md)
- [Command Execution Guide](../../../../../docs/guides/common-features/basics/command-execution.md)

## Troubleshooting

### Code Execution Fails
- Check syntax errors in the code
- Verify required packages are installed
- Check memory and timeout limits

### Package Installation Issues
- Use correct package manager (pip for Python, npm for Node.js)
- Check network connectivity
- Verify package names and versions

### File Permission Issues
- Ensure proper file permissions
- Use appropriate file paths
- Check disk space availability



# Common Features Examples

This directory contains examples demonstrating features available across all AgentBay environment types (browser, computer, mobile, and codespace).

## Directory Structure

```
common-features/
‚îú‚îÄ‚îÄ basics/          # Fundamental features for all users
‚îî‚îÄ‚îÄ advanced/        # Advanced features and integrations
```

## Basics

Essential features that every AgentBay user should know:

### [session_creation](basics/session_creation/)
Session lifecycle management examples:
- Creating sessions with default parameters
- Session creation with labels
- Session creation with context synchronization
- Browser context for cookie persistence
- Mobile configuration with app management

### [file_system](basics/file_system/)
File operations in cloud environments:
- Reading and writing files
- Directory operations
- File information retrieval
- File editing and moving
- File searching
- Large file operations with chunking

### [filesystem_example](basics/filesystem_example/)
Practical filesystem use cases:
- **file_transfer_example.py**: File transfer between local and cloud
- **watch_directory_example.py**: Directory monitoring and change detection

### [context_management](basics/context_management/)
Context creation and management:
- Creating and managing contexts
- Data storage and retrieval
- Cross-session data sharing

### [data_persistence](basics/data_persistence/)
Data persistence across sessions:
- Storing data across sessions
- Data retrieval patterns
- Context synchronization demonstration
- Recycle policy configuration

### [label_management](basics/label_management/)
Session organization with labels:
- Adding labels to sessions
- Filtering and searching sessions
- Label-based session management

### [list_sessions](basics/list_sessions/)
Session listing and filtering:
- Listing all sessions
- Filtering by labels
- Session status monitoring

### [get](basics/get/)
Session retrieval:
- Getting session by ID
- Session information retrieval

## Advanced

Advanced features for power users and integrations:

### [agent_module](advanced/agent_module/)
AI-powered automation:
- Using Agent for task execution
- Natural language task descriptions
- Intelligent automation workflows

### [oss_management](advanced/oss_management/)
Object Storage Service integration:
- OSS environment initialization
- File upload to OSS
- File download from OSS
- Anonymous upload/download

### [vpc_session](advanced/vpc_session/)
Secure isolated network environments:
- Creating VPC sessions
- VPC network configuration
- Secure session management

### [screenshot_download](advanced/screenshot_download/)
Screenshot capture and download:
- Taking screenshots
- Downloading screenshots locally
- Image format handling

## Prerequisites

- Python 3.8 or later
- AgentBay SDK installed: `pip install wuying-agentbay-sdk`
- Valid `AGENTBAY_API_KEY` environment variable

## Quick Start

```bash
# Set your API key
export AGENTBAY_API_KEY=your_api_key_here

# Run any example
cd basics/session_creation
python main.py

cd ../file_system
python main.py
```

## Usage

Each subdirectory contains specific examples with detailed documentation. Check the individual README files and Python scripts for complete usage examples.

## Best Practices

1. **Always Clean Up**: Delete sessions when done to free resources
2. **Error Handling**: Check `result.success` before using data
3. **Use Labels**: Organize sessions with meaningful labels
4. **Context Sync**: Use context synchronization for data persistence
5. **Resource Limits**: Be aware of concurrent session limits

## Related Documentation

- [Session Management Guide](../../../../../docs/guides/common-features/basics/session-management.md)
- [File Operations Guide](../../../../../docs/guides/common-features/basics/file-operations.md)
- [Data Persistence Guide](../../../../../docs/guides/common-features/basics/data-persistence.md)
- [Agent Modules Guide](../../../../../docs/guides/common-features/advanced/agent-modules.md)

## Troubleshooting

### Resource Creation Delay

If you see "The system is creating resources" message:
- Wait 90 seconds and retry
- This is normal for resource initialization
- Consider using session pooling for production

### API Key Issues

Ensure your API key is properly set:
```bash
export AGENTBAY_API_KEY=your_api_key_here
# Verify
echo $AGENTBAY_API_KEY
```

### Context Synchronization Timeout

For large contexts:
- Increase timeout settings
- Use selective synchronization
- Consider splitting into smaller contexts





# Agent Module Example

This example demonstrates how to use the Agent module to execute AI-powered tasks using natural language descriptions.

## Overview

The Agent module allows you to execute complex tasks using human-readable instructions, monitor task status, and terminate running tasks. This capability extends the functionality of cloud sessions by adding AI-powered automation.

## Running the Example

1. Ensure you have the AgentBay SDK installed
2. Set the `AGENTBAY_API_KEY` environment variable with your valid API key
3. Run the example:

```bash
cd docs/examples/python/agent_module
python main.py
```

## What the Example Does

1. Initializes the AgentBay client with your API key
2. Creates a new session
3. Executes a simple task using the Agent module ("Create a word document, input some words and save the document.")
4. Displays the task results
5. Cleans up by deleting the session

## Key Concepts

- **Session Creation**: All Agent operations happen within a session context
- **Task Execution**: Tasks are executed using natural language descriptions
- **Result Handling**: Task results include success status, output, and error information
- **Resource Management**: Sessions should be properly deleted when no longer needed

## Next Steps

Try modifying the task description to perform different operations, such as:
- "Find out the current weather in New York City by Google/Baidu"
- "Copy all the text files from folder A to folder B"
- "Navigate to bilibili.com and search for 'Wuying AgentBay ' and play the first video."



# OSS Management Example

This example demonstrates how to use the Object Storage Service (OSS) features of the AgentBay SDK for Python.

## Features Demonstrated

- Initializing OSS credentials in a session
- Uploading files to OSS buckets
- Downloading files from OSS buckets
- Anonymous uploads to OSS using URLs
- Anonymous downloads from OSS using URLs
- Handling OSS operations in a session environment

## Running the Example

1. Make sure you have installed the AgentBay SDK:

```bash
pip install wuying-agentbay-sdk
```

2. Set your API key as an environment variable (recommended):

```bash
export AGENTBAY_API_KEY=your_api_key_here
```

3. Optionally, set OSS credentials as environment variables:

```bash
export OSS_ACCESS_KEY_ID=your_access_key_id
export OSS_ACCESS_KEY_SECRET=your_access_key_secret
export OSS_SECURITY_TOKEN=your_security_token
export OSS_ENDPOINT=https://oss-cn-hangzhou.aliyuncs.com
export OSS_REGION=cn-hangzhou
export OSS_TEST_BUCKET=your_test_bucket
```

4. Run the example:

```bash
python main.py
```

## Code Explanation

The example demonstrates OSS integration with AgentBay:

1. Create a new session
2. Initialize OSS environment with credentials
3. Create a test file in the session
4. Upload the file to an OSS bucket
5. Upload a file anonymously using a URL
6. Download a file from an OSS bucket
7. Download a file anonymously using a URL
8. Clean up by deleting the session

OSS integration allows you to:

- Transfer files between your local environment and the cloud session
- Store session artifacts in permanent storage
- Share files across multiple sessions
- Download resources from external sources
- Implement file backup and restore functionality

For more details on OSS integration, see the [OSS API Reference](../../../../../../../typescript/docs/api/common-features/advanced/oss.md).



# VPC Session Example

This example demonstrates how to create and use VPC (Virtual Private Cloud) sessions with the AgentBay SDK.

## Overview

VPC sessions provide enhanced security and networking capabilities by running your cloud sessions within a private network environment. This example shows how to create a VPC session and use its available modules.

## Running the Example

1. Ensure you have the AgentBay SDK installed
2. Set the `AGENTBAY_API_KEY` environment variable with your valid API key
3. Run the example:

```bash
cd docs/examples/python/vpc_session
python main.py
```

## What the Example Does

1. Initializes the AgentBay client with your API key
2. Creates a new VPC session with specific parameters
3. Tests FileSystem operations by writing and reading a file
4. Tests Command operations by executing system commands
5. Cleans up by deleting the session

## Key Concepts

- **VPC Session Creation**: VPC sessions are created by setting the `is_vpc` parameter to `True`
- **Module Availability**: VPC sessions have limited module availability compared to standard sessions
- **Resource Management**: VPC sessions should be properly deleted when no longer needed
- **Security**: VPC sessions provide network isolation for sensitive operations

## Available Modules in VPC Sessions

1. **FileSystem**: File and directory operations
2. **Command**: Command execution
3. **System Tools**: Specialized system-level tools
4. **Browser Tools**: Browser automation capabilities

## Next Steps

Try modifying the example to:
- Use context synchronization with VPC sessions
- Test different command executions
- Implement error handling for unavailable modules



# Archive Upload Mode Context Sync Example

This directory contains examples demonstrating the Archive upload mode functionality for context synchronization in the AgentBay SDK.

## Overview

The Archive upload mode is designed for efficient file transfer by compressing files before uploading them to the context storage. This is particularly useful when:

- Working with large files
- Dealing with many files
- Optimizing bandwidth usage
- Reducing upload time for compressible content

## Files

### `main.py`

A comprehensive example that demonstrates:

1. **Context Creation**: Creating a context for Archive upload mode
2. **Sync Policy Configuration**: Setting up sync policy with Archive uploadMode
3. **Session Management**: Creating and managing sessions with context sync
4. **File Operations**: Writing files to the context path
5. **Context Sync**: Synchronizing context before retrieving information
6. **Context Info**: Retrieving context status information
7. **File Listing**: Listing files in context sync directory
8. **Cleanup**: Proper session cleanup and error handling

## Key Features Demonstrated

### Archive Upload Mode Configuration

```python
# Configure sync policy with Archive upload mode
upload_policy = UploadPolicy(upload_mode=UploadMode.ARCHIVE)
sync_policy = SyncPolicy(upload_policy=upload_policy)

# Create context sync with Archive mode
context_sync = ContextSync(
    context_id=context_result.context_id,
    path="/tmp/archive-mode-test",
    policy=sync_policy
)
```

### Session Creation with Context Sync

```python
session_params = CreateSessionParams(
    labels={
        "example": f"archive-mode-{unique_id}",
        "type": "archive-upload-demo",
        "uploadMode": UploadMode.ARCHIVE.value
    },
    context_syncs=[context_sync]
)

session_result = await agent_bay.create(session_params)
```

### File Operations

```python
# Write file to context path
write_result = session.file_system.write_file(file_path, file_content, mode="overwrite")
```

### Context Sync and Information Retrieval

```python
# Call context sync before getting info (async operation)
import asyncio

async def run_sync():
    return await session.context.sync()

sync_result = asyncio.run(run_sync())

# Get context status information after sync
info_result = session.context.info()

# Display context status details
for index, status in enumerate(info_result.context_status_data):
    print(f"Context ID: {status.context_id}")
    print(f"Path: {status.path}")
    print(f"Status: {status.status}")
    print(f"Task Type: {status.task_type}")
```

### File Listing in Context Directory

```python
# List files in context sync directory
list_result = await agent_bay.context.list_files(context_id, sync_dir_path, page_number=1, page_size=10)

# Display file entries
for index, entry in enumerate(list_result.entries):
    print(f"FilePath: {entry.file_path}")
    print(f"FileType: {entry.file_type}")
    print(f"FileName: {entry.file_name}")
    print(f"Size: {entry.size} bytes")
```

## Running the Example

### Prerequisites

1. **Environment Setup**: Set your AgentBay API key
   ```bash
   export AGENTBAY_API_KEY="your-api-key-here"
   ```

2. **Dependencies**: Ensure you have the AgentBay SDK installed
   ```bash
   pip install wuying-agentbay-sdk-test
   ```

### Execution

```bash
# Navigate to the python directory
cd python

# Run the example
python docs/examples/archive-upload-mode-example/main.py
```

### Expected Output

The example will output detailed logs showing:

```
üöÄ AgentBay Archive Upload Mode Context Sync Example
============================================================

üì¶ Step 1: Creating context for Archive upload mode...
‚úÖ Context created successfully!
   Context ID: ctx_xxxxx
   Request ID: req_xxxxx

‚öôÔ∏è  Step 2: Configuring sync policy with Archive upload mode...
‚úÖ Sync policy configured with uploadMode: Archive

üîß Step 3: Creating context sync configuration...
‚úÖ Context sync created:
   Context ID: ctx_xxxxx
   Path: /tmp/archive-mode-test
   Upload Mode: Archive

üèóÔ∏è  Step 4: Creating session with Archive mode context sync...
‚úÖ Session created successfully!
   Session ID: sess_xxxxx
   Request ID: req_xxxxx
   App Instance ID: app_xxxxx

üìù Step 5: Creating test files in Archive mode context...
üìÑ Creating file: /tmp/archive-mode-test/test-file-5kb.txt
üìä File content size: 5120 bytes
‚úÖ File write successful!
   Request ID: req_xxxxx

üìä Step 6: Testing context sync and info functionality...
üîÑ Calling context sync before getting info...
‚úÖ Context sync successful!
   Sync Request ID: req_xxxxx
üìã Calling context info after sync...
‚úÖ Context info retrieved successfully!
   Info Request ID: req_xxxxx
   Context status data count: X

üìã Context status details:
   [0] Context ID: ctx_xxxxx
       Path: /tmp/archive-mode-test
       Status: Success
       Task Type: upload

üîç Step 7: Listing files in context sync directory...
‚úÖ List files successful!
   Request ID: req_xxxxx
   Total files found: X

üìã Files in context sync directory:
   [0] FilePath: /tmp/archive-mode-test/test-file-5kb.txt
       FileType: file
       FileName: test-file-5kb.txt
       Size: 5120 bytes

üéâ Archive upload mode example completed successfully!
‚úÖ All operations completed without errors.

üßπ Step 8: Cleaning up session...
‚úÖ Session deleted successfully!
   Success: true
   Request ID: req_xxxxx
```

## Related Documentation

- [Context Sync Documentation](../../../../../../../docs/guides/common-features/basics/data-persistence.md)
- [Session Management Guide](../../../../../../../docs/guides/common-features/basics/session-management.md)
- [File Operations Guide](../../../../../../../docs/guides/common-features/basics/file-operations.md)

## Troubleshooting

### Common Issues

1. **API Key Not Set**
   ```
   Warning: AGENTBAY_API_KEY environment variable not set
   ```
   **Solution**: Set the environment variable or update the API key in the code

2. **Context Creation Failed**
   ```
   Context creation failed: [error message]
   ```
   **Solution**: Check your API key and network connectivity

3. **Session Creation Failed**
   ```
   Session creation failed: [error message]
   ```
   **Solution**: Verify context sync configuration and try again

4. **File Operation Failed**
   ```
   File write failed: [error message]
   ```
   **Solution**: Check file path permissions and available disk space

## Support

For additional help:
- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../../../../README.md)



# Context Management Example

This example demonstrates how to use the Context Management features of the AgentBay SDK for Python.

## Features Demonstrated

- Listing all contexts
- Getting or creating a context (by name or context ID)
- Creating a session with a context
- Updating a context
- Clearing context data (removing persistent data)
- Deleting a context

## Running the Example

1. Make sure you have installed the AgentBay SDK:

```bash
pip install wuying-agentbay-sdk
```

2. Set your API key as an environment variable (recommended):

```bash
export AGENTBAY_API_KEY=your_api_key_here
```

3. Run the example:

```bash
python main.py
```

## Code Explanation

The example demonstrates a full lifecycle of context management:

1. Initialize the AgentBay client with an API key
2. List all existing contexts to see what's available
3. Get an existing context by name or context ID, or create it if it doesn't exist
4. Create a session using the context
5. Update the context's properties
6. Clear context data (remove persistent data while keeping the context)
7. Clean up by deleting the session and context

For more details on context management, see the [Context API Reference](../../../../../../../typescript/docs/api/common-features/basics/context.md) and [Data Persistence Tutorial](../../../../../../../docs/guides/common-features/basics/data-persistence.md).



# Data Persistence Examples

This directory contains examples demonstrating data persistence functionality in AgentBay SDK.

## Examples

### 1. `main.py` - Basic Data Persistence

Demonstrates the fundamental data persistence features:

- Context creation for persistent storage
- File persistence across multiple sessions
- Context synchronization and file sharing
- Multi-session data verification

### 2. `context_sync_demo.py` - Advanced Sync with Callbacks

Demonstrates the new callback-based context synchronization:

- Async context sync with callback functions
- Timing analysis and performance monitoring
- Status verification using `context.info()`
- Multiple sync operations and error handling
- Backward compatibility with traditional sync

### 3. `recycle_policy_example.py` - Data Lifecycle Management

Demonstrates RecyclePolicy for controlling context data lifecycle:

- Using default RecyclePolicy (keeps data forever)
- Setting custom lifecycle durations (1 day, 3 days, etc.)
- Applying RecyclePolicy to specific paths
- Available lifecycle options
- Error handling (wildcard patterns validation)

## Key Features

### Data Persistence

- **Context Creation**: Create persistent storage contexts
- **Cross-Session Persistence**: Data survives session deletion
- **File Synchronization**: Automatic sync of files to persistent storage
- **Multi-Session Access**: Access data from different sessions

### Context Sync Callbacks

- **Async Operations**: Non-blocking sync operations
- **Real-time Feedback**: Immediate notification on completion
- **Timing Information**: Detailed performance metrics
- **Error Handling**: Graceful handling of failures and timeouts
- **Status Monitoring**: Track sync progress and completion

### Data Lifecycle Management

- **RecyclePolicy**: Control how long context data is retained in the cloud
- **Lifecycle Options**: 1 day to forever (11 options available)
- **Path-Specific Policies**: Apply different lifecycles to different directories
- **Automatic Cleanup**: Data is automatically deleted after specified duration
- **Wildcard Validation**: Ensures path safety by rejecting wildcard patterns

## Usage

### Basic Data Persistence

```bash
cd python/docs/examples/data_persistence
python main.py
```

### Context Sync Callbacks

```bash
cd python/docs/examples/data_persistence
python context_sync_demo.py
```

### RecyclePolicy Example

```bash
cd python/docs/examples/data_persistence
python recycle_policy_example.py
```

## Prerequisites

- AgentBay SDK installed
- Valid API key configured (via environment variable `AGENTBAY_API_KEY` or default configuration)
- Network access to AgentBay services

## Expected Behavior

Both examples will:

1. Create a persistent context
2. Create a session with context synchronization
3. Write test data to the persistent storage
4. Demonstrate data persistence across sessions
5. Clean up resources

The callback example additionally shows:

- Async sync operations with timing
- Callback notifications
- Status monitoring
- Error handling scenarios

## Output

Both examples provide detailed console output showing:

- Step-by-step progress
- Success/failure status for each operation
- Timing information (callback example)
- Data verification results
- Cleanup confirmation

## Notes

- Examples use temporary contexts that are cleaned up after execution
- File paths use `/tmp/` for demonstration purposes
- Timing may vary based on network conditions and file sizes
- The callback example includes timeout handling for robustness




# Context Sync Demo Example

This example demonstrates the `session.context.sync()` method for synchronizing context data with the AgentBay cloud environment.

## Overview

The example showcases:

- **Context Creation**: Creating persistent contexts for data storage
- **Context Synchronization**: Using `sync()` to sync data to cloud storage
- **Timing Analysis**: Measuring sync operation duration
- **File Management**: Creating and managing test files in the context
- **Error Handling**: Managing sync failures and API errors

## Key Features Demonstrated

### 1. Context Sync Function

The `session.context.sync()` method provides asynchronous context synchronization:

```python
# Async call - wait for completion
sync_result = await session.context.sync()
if sync_result.success:
    print("‚úÖ Sync completed successfully")
    print(f"Duration: {sync_duration:.2f} seconds")
```

### 2. Timing Analysis

The example includes timing analysis for sync operations:

- **Small files** (< 1KB): Typically under 1 second
- **Medium files** (1-10KB): Typically 1-5 seconds
- **Multiple files**: Duration depends on total size and file count

### 3. Test Data Creation

Creates structured test data to demonstrate sync functionality:

```python
test_files = [
    ("/tmp/sync_data/test_files/small.txt", "Small test file content\n" * 10),
    ("/tmp/sync_data/test_files/medium.txt", "Medium test file content\n" * 100),
    ("/tmp/sync_data/config.json", json.dumps({...}, indent=2))
]
```

### 4. Session Management

Demonstrates proper session lifecycle management:

```python
# Create session with context sync
params = CreateSessionParams()
params.context_syncs = [context_sync]
session_result = await agent_bay.create(params)

# Clean up session after use
delete_result = await agent_bay.delete(session)
```

## Example Structure

### Step 1: Context Creation

- Creates a persistent context for data storage using `agent_bay.context.get()`
- Configures sync policy and context sync settings

### Step 2: Session Setup

- Creates session with context synchronization enabled
- Mounts context to `/tmp/sync_data` path in the session environment

### Step 3: Test Data Creation

- Creates multiple test files of different sizes
- Sets up directory structure for organized file management
- Writes configuration and log files to demonstrate various data types

### Step 4: Context Synchronization

- Calls `session.context.sync()` to sync all data to cloud storage
- Measures and reports sync timing and success status
- Handles both success and failure scenarios with appropriate logging




# FileSystem Examples

This directory contains comprehensive examples demonstrating the FileSystem functionality in the AgentBay SDK for Python. It covers both basic file operations and advanced features like file monitoring and transfers.

## Examples

### Basic Operations Example ([main.py](./main.py))

Demonstrates fundamental file system operations:

- Basic file reading and writing
- Directory creation and listing
- File information retrieval
- File editing and moving
- File searching
- Multiple file reading
- Large file operations with automatic chunking

### Watch Directory Example ([watch_directory_example.py](./watch_directory_example.py))

Demonstrates how to monitor file changes in a directory:

- Creating directories for monitoring
- Setting up file change monitoring with callbacks
- Performing file operations to trigger events
- Processing different types of file events (create, modify, delete)
- Proper resource cleanup

### File Transfer Example ([file_transfer_example.py](./file_transfer_example.py))

Demonstrates file upload and download operations:

- Creating contexts and sessions with file transfer capabilities
- Using the simplified FileSystem API for file transfers
- Uploading files from local storage to the cloud
- Downloading files from the cloud to local storage
- Tracking file transfer progress with callbacks
- Verifying file content integrity after transfers
- Proper resource cleanup

## Features Demonstrated

### Basic File Operations
- **File Writing**: Create new files with content
- **File Reading**: Read file contents
- **File Appending**: Add content to existing files

### Directory Operations
- **Directory Creation**: Create new directories
- **Directory Listing**: List contents of directories

### File Information
- **File Info Retrieval**: Get detailed information about files (size, permissions, etc.)

### File Manipulation
- **File Editing**: Edit specific parts of file content
- **File Moving**: Move files between directories

### Search Operations
- **File Searching**: Search for files containing specific patterns

### Multiple File Operations
- **Multiple File Reading**: Read multiple files in a single operation

### Large File Operations
- **Large File Writing**: Write files larger than the default API size limits using automatic chunking
- **Large File Reading**: Read large files using automatic chunking
- **Custom Chunk Size**: Specify custom chunk sizes for both reading and writing operations
- **Performance Measurement**: Measure and compare operation times with different chunk sizes

### Advanced Features
- **Real-time File Monitoring**: Monitor directory changes with event callbacks
- **File Transfer Operations**: Upload and download files with progress tracking
- **Context Synchronization**: Use contexts for persistent file operations

## Prerequisites

- Python 3.10 or later
- Wuying AgentBay SDK installed:
  ```bash
  pip install wuying-agentbay-sdk
  ```

## Running the Examples

1. Make sure you have set the `AGENTBAY_API_KEY` environment variable:

```bash
export AGENTBAY_API_KEY=your_api_key_here
```

2. Run any of the examples:

```bash
# Basic file operations
python main.py

# Directory monitoring
python watch_directory_example.py

# File transfers
python file_transfer_example.py
```

## Code Explanation

### Basic Operations Example (main.py)

The basic operations example demonstrates the following workflow:

1. **Session Creation**: Creates a new session with the specified image ID
2. **Basic File Operations**: Demonstrates writing, reading, and appending to files
3. **Directory Operations**: Shows how to create directories and list their contents
4. **File Information**: Retrieves and displays detailed file information
5. **File Editing**: Demonstrates how to edit specific parts of a file
6. **File Moving**: Shows how to move files between directories
7. **File Searching**: Searches for files containing specific patterns
8. **Multiple File Reading**: Reads multiple files in a single operation
9. **Large File Operations**: Demonstrates reading and writing large files with both default and custom chunk sizes
10. **Content Verification**: Verifies that file operations maintain content integrity
11. **Performance Comparison**: Measures and reports the time taken for large file operations

### Watch Directory Example

The watch directory example demonstrates real-time file monitoring capabilities:

1. Initialize the AgentBay client with an API key
2. Create a session with a suitable image
3. Create a test directory to monitor
4. Set up monitoring with a callback function to handle file events
5. Perform various file operations to trigger events
6. Process and display the detected file changes
7. Clean up resources properly

### File Transfer Example

The file transfer example demonstrates uploading and downloading files:

1. Initialize the AgentBay client with an API key
2. Create a context for file operations
3. Create a browser session with context synchronization
4. Create test files for upload
5. Upload files to the cloud using the simplified API
6. Download files from the cloud to local storage
7. Track progress during transfers
8. Verify file content integrity
9. Clean up resources properly

Each section of the examples is clearly marked and includes verification steps to ensure operations are working correctly.

## API Reference

For more detailed information on the FileSystem API methods, refer to the SDK documentation.



# Get API Example

This example demonstrates how to use the `get` API to retrieve a session by its ID.

## Description

The `get` API allows you to retrieve a session object by providing its session ID. This is useful when you have a session ID from a previous operation and want to access or manage that session.

## Prerequisites

- Python 3.8 or higher
- Valid API key set in `AGENTBAY_API_KEY` environment variable
- agentbay package installed

## Installation

```bash
pip install agentbay
```

## Usage

```bash
# Set your API key
export AGENTBAY_API_KEY="your-api-key-here"

# Run the example
python main.py
```

## API Reference

### get

```python
async def get(session_id: str) -> SessionResult
```

Get a session by its ID.

**Parameters:**
- `session_id` (str): The ID of the session to retrieve

**Returns:**
- `SessionResult`: Result object containing:
  - `success` (bool): Whether the operation succeeded
  - `session` (Session): The Session instance if successful
  - `request_id` (str): The API request ID
  - `error_message` (str): Error message if failed

## Expected Output

```
Creating a session...
Created session with ID: session-xxxxxxxxxxxxx

Retrieving session using Get API...
Successfully retrieved session:
  Session ID: session-xxxxxxxxxxxxx
  Request ID: DAD825FE-2CD8-19C8-BB30-CC3BA26B9398

Session is ready for use

Cleaning up...
Session session-xxxxxxxxxxxxx deleted successfully

Attempting to get the deleted session...
Expected behavior: Cannot retrieve deleted session
Error message: Failed to get session: session not found or has been deleted
```

## Notes

- The session ID must be valid and from an existing session
- The get API internally calls the GetSession API endpoint
- The returned session object can be used for all session operations (commands, files, etc.)
- Always clean up sessions when done to avoid resource waste
- Attempting to get a deleted session will return an error, demonstrating proper lifecycle management

## Error Handling

The `get` method returns a `SessionResult` object with error information:

1. **Empty session_id**: Result will have `success=False`
2. **Non-existent session**: Result will have `success=False`
3. **Deleted session**: Result will have `success=False`



# Label Management Example

This example demonstrates how to use the label management features of the AgentBay SDK for Python.

## Features Demonstrated

- Creating sessions with custom labels
- Getting labels from a session
- Updating labels for a session
- Listing all sessions
- Filtering sessions by labels
- Retrieving label information from filtered sessions

## Running the Example

1. Make sure you have installed the AgentBay SDK:

```bash
pip install wuying-agentbay-sdk
```

2. Set your API key as an environment variable (recommended):

```bash
export AGENTBAY_API_KEY=your_api_key_here
```

3. Run the example:

```bash
python main.py
```

## Code Explanation

The example demonstrates a full lifecycle of label management:

1. Create a session with initial labels
2. Retrieve the labels from the session
3. Create another session with different labels
4. Update the labels for the second session
5. Retrieve the updated labels
6. List all sessions
7. Filter sessions by label criteria
8. Clean up by deleting the sessions

Labels are useful for organizing and categorizing sessions, making it easier to find and manage them. You can use labels to:

- Group sessions by project
- Mark sessions with their purpose
- Tag sessions with version information
- Indicate session status
- Filter sessions based on any criteria

For more details on session management, see the [Session API Reference](../../../../../../../typescript/docs/api/common-features/basics/session.md) and [Session Management Tutorial](../../../../../../../docs/guides/common-features/basics/session-management.md). 



# List Sessions Example

This example demonstrates how to use the `list()` API to query and filter sessions in AgentBay.

## Overview

The `list()` API provides a simple and intuitive interface for querying sessions with optional filtering and pagination support. It's designed to be more user-friendly than the deprecated `list_by_labels()` API.

## Features Demonstrated

This example shows:

1. **List all sessions** - Query all sessions without any filters
2. **Filter by labels** - Query sessions that match specific labels
3. **Multiple label filtering** - Query sessions that match multiple label criteria
4. **Pagination** - Retrieve results page by page
5. **Iterate all pages** - Automatically fetch all results across multiple pages

## Prerequisites

Before running this example, ensure you have:

1. **AgentBay SDK installed**:
   ```bash
   pip install wuying-agentbay-sdk
   ```

2. **API Key configured**:
   ```bash
   export AGENTBAY_API_KEY='your-api-key-here'
   ```

## Running the Example

```bash
cd /path/to/wuying-agentbay-sdk/python/docs/examples/list_sessions
python main.py
```

## API Reference

### Method Signature

```python
async def list(
    labels: Optional[Dict[str, str]] = None,
    page: Optional[int] = None,
    limit: Optional[int] = None
) -> SessionListResult
```

### Parameters

- **labels** (Optional[Dict[str, str]]): Labels to filter sessions. All specified labels must match.
  - Default: `None` (no filtering, returns all sessions)
  - Example: `{"project": "demo", "environment": "prod"}`

- **page** (Optional[int]): Page number for pagination, starting from 1.
  - Default: `None` (returns first page)
  - Example: `2` (returns second page)

- **limit** (Optional[int]): Maximum number of items per page.
  - Default: `None` (uses default of 10)
  - Example: `20` (returns up to 20 items per page)

### Return Value

Returns a `SessionListResult` object with:

- **success** (bool): Whether the operation was successful
- **sessions** (List[Session]): List of Session objects matching the filter
- **total_count** (int): Total number of matching sessions
- **next_token** (str): Token for the next page (empty if no more pages)
- **max_results** (int): Maximum results per page
- **request_id** (str): Unique request identifier for tracking
- **error_message** (str): Error message if operation failed

## Use Cases

### 1. Session Inventory
List all sessions to get an overview of your current session inventory.

### 2. Project Management
Find all sessions for a specific project.

### 3. Environment-Specific Queries
Query sessions by environment (dev, staging, prod).

### 4. Bulk Operations
Retrieve all matching sessions and perform batch operations.

## Key Advantages over list_by_labels()

The new `list()` API offers several advantages:

1. **Simpler Interface**: No need to create `ListSessionParams` objects
2. **Intuitive Pagination**: Use familiar `page` and `limit` parameters
3. **Request Tracking**: All responses include `request_id` for debugging
4. **Cleaner Code**: More readable and maintainable code
5. **Type Safety**: Better IDE autocomplete support

## Expected Output

```
‚úÖ AgentBay client initialized

üìù Creating test sessions...
‚úÖ Created session 1: session-xxxxx
   Request ID: xxxxx-xxxxx-xxxxx
‚úÖ Created session 2: session-yyyyy
   Request ID: yyyyy-yyyyy-yyyyy
‚úÖ Created session 3: session-zzzzz
   Request ID: zzzzz-zzzzz-zzzzz

============================================================
Example 1: List all sessions (no filter)
============================================================
‚úÖ Found 15 total sessions
üìÑ Showing 10 sessions on this page
üîë Request ID: req-xxxxx-xxxxx
üìä Max results per page: 10
   1. Session ID: session-xxxxx
   2. Session ID: session-yyyyy
   3. Session ID: session-zzzzz

[... more examples ...]

============================================================
üßπ Cleaning up test sessions...
============================================================
‚úÖ Deleted session: session-xxxxx
   Request ID: req-delete-xxxxx
‚úÖ Deleted session: session-yyyyy
   Request ID: req-delete-yyyyy
‚úÖ Deleted session: session-zzzzz
   Request ID: req-delete-zzzzz

‚ú® Demo completed successfully!
```

## Troubleshooting

### API Key Not Set
```
Error: AGENTBAY_API_KEY environment variable not set
```
**Solution**: Set your API key:
```bash
export AGENTBAY_API_KEY='your-api-key-here'
```

### No Sessions Found
```
Found 0 sessions with specified labels
```
**Solution**: Check that:
1. You have active sessions with the specified labels
2. Label keys and values match exactly (case-sensitive)
3. All specified labels must match (AND logic, not OR)

### Rate Limiting
If you encounter rate limiting, add delays between requests.

## Related Documentation

- [Session Management Guide](../../../../../../../docs/guides/common-features/basics/session-management.md)
- [AgentBay API Reference](../../../../../../../typescript/docs/api/common-features/basics/agentbay.md)
- [Label Management Example](../label_management/README.md)

## Support

For issues or questions:
- GitHub Issues: https://github.com/aliyun/wuying-agentbay-sdk/issues
- Documentation: https://github.com/aliyun/wuying-agentbay-sdk



# MCP Tool Direct Call Example (Python)

This example demonstrates how to list available MCP tools and call them directly using the AgentBay Python SDK.

## Prerequisites

- Python 3.8 or higher
- AgentBay Python SDK installed (`pip install wuying-agentbay-sdk`)
- AgentBay API Key (set as environment variable `AGENTBAY_API_KEY`)

## Running the Example

```bash
# Set your API key
export AGENTBAY_API_KEY=your_api_key_here

# Run the example
cd python/docs/examples/common-features/advanced/mcp_tool_direct_call
python main.py
```

## What This Example Does

1. **Creates a Session**: Initializes an AgentBay session
2. **Lists MCP Tools**: Retrieves all available MCP tools using `session.list_mcp_tools()`
3. **Finds Shell Tool**: Locates the 'shell' tool and displays its details
4. **Calls Shell Tool**: Executes commands using `session.call_mcp_tool()`:
   - Echo command: `echo 'Hello from MCP Tool!'`
   - Directory command: `pwd`
   - Error handling: Invalid command demonstration
5. **Cleanup**: Properly deletes the session

## Expected Output

```
Initializing AgentBay client...

1. Creating session...
‚úì Session created successfully
  Session ID: sess-xxxxx
  Request ID: req-xxxxx

2. Listing available MCP tools...
‚úì Found 69 MCP tools
  Request ID: req-xxxxx

  Available tools (showing first 10):
  1. get_resource
     Description: The command to retrieve a wuying mcp runtime URL...
     Server: mcp-server

  2. system_screenshot
     Description: Captures a full-screen screenshot...
     Server: mcp-server

  ...

3. Finding 'shell' tool details...
‚úì Found 'shell' tool
  Description: Executes an shell command with timeout...
  Server: wuying_shell
  Input Schema:
    {
      "type": "object",
      "required": ["command", "timeout_ms"],
      "properties": {
        "command": {
          "type": "string",
          "description": "client input command"
        },
        "timeout_ms": {
          "type": "integer",
          "default": 1000,
          "description": "Command execution timeout (unit: milliseconds)..."
        }
      }
    }

4. Calling 'shell' tool...
‚úì Tool call successful
  Request ID: req-xxxxx
  Output:
    Hello from MCP Tool!

5. Calling 'shell' tool with different command...
‚úì Tool call successful
  Request ID: req-xxxxx
  Current directory:
    /home/wuying

6. Demonstrating error handling (invalid command)...
‚úì Error handled correctly
  Request ID: req-xxxxx
  Error message: Execution failed. Error code:127 Error message: sh: 1: this_command_does_not_exist_12345: not found

7. Cleaning up...
‚úì Session deleted successfully
  Request ID: req-xxxxx

============================================================
Example completed successfully!
============================================================
```

## Key API Methods

### `session.list_mcp_tools()`

Lists all available MCP tools for the session.

**Returns:** `McpToolsResult` containing:
- `tools`: List of `McpTool` objects
- `request_id`: API request identifier

### `session.call_mcp_tool(tool_name, args)`

Calls an MCP tool directly.

**Parameters:**
- `tool_name` (str): Name of the MCP tool
- `args` (dict): Tool arguments

**Returns:** `McpToolResult` containing:
- `success` (bool): Whether the call succeeded
- `data` (str): Tool output
- `error_message` (str): Error message if failed
- `request_id` (str): API request identifier

## Use Cases

This direct MCP tool calling approach is useful when you need to:

1. **Discover Available Tools**: List all tools before deciding which to use
2. **Call Tools Directly**: Bypass module-specific wrappers for direct access
3. **Custom Tool Integration**: Build custom workflows with any available tool
4. **Tool Exploration**: Inspect tool schemas and test different arguments

## Related Documentation

- [Session API Reference](../../../../../../docs/api/async/async-session.md)
- [Common Features Guide](../../../../../../../docs/guides/common-features/README.md)





# Session Creation and Management Example

This example demonstrates comprehensive session creation and management using the Wuying AgentBay SDK. It covers various session types and configurations:

## Features Demonstrated

### 1. Basic Session Management
- Initializing the AgentBay client
- Creating a session with default parameters
- Listing all available sessions
- Deleting sessions
- Verifying session deletion

### 2. Session with Labels
- Creating sessions with custom labels for organization
- Retrieving and displaying session labels
- Using labels for project management and environment tracking

### 3. Context-Enabled Sessions
- Creating sessions with predefined contexts
- Context synchronization during session creation
- Managing persistent data across sessions

### 4. Context Synchronization
- Advanced context management with multiple contexts
- Listing and managing synchronized contexts
- Understanding context states and availability

### 5. Browser Context Sessions
- Creating sessions with browser-specific contexts
- Persistent browser data (cookies, localStorage, etc.)
- Context synchronization on session deletion

### 6. Mobile Configuration Sessions 
- Creating mobile sessions with app management rules
- Resolution Control: Locking screen resolution for consistent testing
- Package Management: Configuring allowed app packages
- Mobile-specific session parameters and cleanup


This example is useful for understanding the complete session lifecycle, advanced configuration options, and mobile-specific session management.

## Running the Example

```bash
cd session_creation
python main.py
```

Make sure you have set the `AGENTBAY_API_KEY` environment variable or replace the placeholder in the code with your actual API key.




# Computer Use Examples

This directory contains examples demonstrating Windows desktop automation capabilities in AgentBay SDK.

## Overview

Computer Use environment (`windows_latest` image) provides cloud-based Windows desktop automation with:
- Application management (start, stop, list)
- Window operations (maximize, minimize, resize, close)
- Focus management
- Desktop UI automation workflows
- Process monitoring

## Examples

### windows_app_management_example.py

Comprehensive Windows application management example demonstrating:

1. **Finding Installed Applications**
   - Discover all applications in Windows start menu
   - Filter system applications
   - Search for specific applications

2. **Launching Applications**
   - Start applications by command
   - Monitor spawned processes
   - Track process IDs

3. **Monitoring Running Applications**
   - List currently visible applications
   - Get application window information
   - Track application states

4. **Stopping Applications**
   - Stop by process ID (PID)
   - Stop by process name
   - Graceful termination

## Prerequisites

- Python 3.8 or later
- AgentBay SDK installed: `pip install wuying-agentbay-sdk`
- Valid `AGENTBAY_API_KEY` environment variable

## Quick Start

```bash
# Set your API key
export AGENTBAY_API_KEY=your_api_key_here

# Run the example
cd computer
python windows_app_management_example.py
```

## Features Demonstrated

### Application Discovery
- Find installed applications in start menu
- Filter system applications
- Search by application name
- Get application start commands

### Process Management
- Start applications by command
- Monitor process creation
- Track process IDs and names
- List visible applications with windows

### Application Control
- Stop applications by PID
- Stop applications by process name
- Graceful vs forceful termination
- Error handling for process operations

### Window Operations
- List all windows
- Focus specific windows
- Maximize/minimize windows
- Close windows
- Get window information

## API Methods Used

| Method | Purpose |
|--------|---------|
| `session.computer.get_installed_apps()` | Get list of installed applications |
| `session.computer.start_app()` | Start an application |
| `session.computer.list_visible_apps()` | List currently visible applications |
| `session.computer.stop_app_by_pid()` | Stop application by process ID |
| `session.computer.stop_app_by_pname()` | Stop application by process name |
| `session.window.list_windows()` | List all windows |
| `session.window.focus_window()` | Focus a specific window |
| `session.window.maximize_window()` | Maximize a window |
| `session.window.minimize_window()` | Minimize a window |
| `session.window.close_window()` | Close a window |
| `session.ui.screenshot()` | Take a screenshot |
| `session.ui.click()` | Click at coordinates |
| `session.ui.type()` | Type text |
| `session.ui.key()` | Send keyboard key |

## Common Use Cases

### 1. Automated Testing
- Start application and wait for window
- Interact with UI elements
- Verify results with screenshots

### 2. Application Monitoring
- Monitor running applications
- Track application lifecycle
- Performance monitoring

### 3. Automated Workflows
- Open applications in sequence
- Perform data entry tasks
- Generate reports and save files

## Best Practices

1. **Wait for Application Load**: Add delays after starting applications
2. **Error Handling**: Always check `result.success` before proceeding
3. **Resource Cleanup**: Stop applications and delete sessions when done
4. **Process Identification**: Use PIDs for reliable process management
5. **Retry Logic**: Implement retries for resource creation delays
6. **Window Focus**: Ensure window has focus before UI interactions
7. **Screenshot Verification**: Use screenshots to verify UI state

## Related Documentation

- [Computer Use Guide](../../../../../docs/guides/computer-use/README.md)
- [Computer Application Management](../../../../../docs/guides/computer-use/computer-application-management.md)
- [Computer UI Automation](../../../../../docs/guides/computer-use/computer-ui-automation.md)
- [Window Management](../../../../../docs/guides/computer-use/window-management.md)

## Troubleshooting

### Resource Creation Delay

If you see "Resource creation in progress" message:
- Wait 90 seconds and retry
- This is normal for Windows session initialization
- Consider session pooling for production

### Application Not Found

If application is not in the list:
- Check application is installed in start menu
- Try using full path to executable
- Verify application name spelling

### Application Won't Start

If application fails to start:
- Verify start command is correct
- Check application permissions
- Ensure application is compatible with Windows version
- Review application dependencies

### Window Operations Fail

If window operations don't work:
- Verify window handle is valid
- Check window still exists
- Ensure window is not minimized (for some operations)
- Wait for window to be ready

### UI Automation Issues

If UI interactions fail:
- Take screenshot to verify UI state
- Ensure window has focus
- Add delays between actions
- Verify coordinates are correct
- Check for popup dialogs blocking interaction



# Windows Application Management Example

This example demonstrates how to use the AgentBay SDK to manage desktop applications on Windows.

## Overview

The example shows a complete workflow:

1. **Find installed applications** - Discover all applications available in the Windows environment
2. **Launch an application** - Start Notepad as an example
3. **Monitor running applications** - List currently visible applications with windows
4. **Stop the application** - Gracefully terminate the running application

## Prerequisites

- Python 3.7+
- AgentBay SDK
- Valid `AGENTBAY_API_KEY` environment variable

## Installation

```bash
# Create virtual environment
python3 -m venv venv

# Activate virtual environment
# On macOS/Linux:
source venv/bin/activate
# On Windows:
# venv\Scripts\activate

# Install AgentBay SDK
pip install -e /path/to/wuying-agentbay-sdk/python
```

## Usage

```bash
# Set your API key
export AGENTBAY_API_KEY="your_api_key_here"

# Run the example
python windows_app_management_example.py
```

## What the Example Does

### Step 1: Finding Installed Applications

```python
apps_result = session.computer.get_installed_apps(
    start_menu=True,
    desktop=False,
    ignore_system_apps=True
)
```

Discovers all installed applications in the Windows start menu, filtering out system apps.

### Step 2: Finding Target Application

Searches for Notepad in the list of installed applications. Falls back to the default Windows path if not found.

### Step 3: Launching Application

```python
start_result = session.computer.start_app(notepad_cmd)
```

Starts Notepad and returns information about all spawned processes.

### Step 4: Monitoring Running Applications

```python
visible_result = session.computer.list_visible_apps()
```

Lists all applications with visible windows currently running.

### Step 5: Stopping Application

```python
# Method 1: Stop by Process ID
stop_result = session.computer.stop_app_by_pid(pid)

# Method 2: Stop by Process Name (fallback)
stop_result = session.computer.stop_app_by_pname(process_name)
```

Attempts to stop the application, first by PID, then by process name if needed.

## Expected Output

```
================================================================================
Windows Application Management Example
================================================================================

Initializing AgentBay client...
‚úÖ Client initialized

Creating Windows session...
  Attempt 1/2...
‚úÖ Session created: session-xxxxxxxxxxxxxxxxx

================================================================================
Step 1: Finding installed applications...
================================================================================
‚úÖ Found 120 installed applications

First 5 applications:

1. Notepad
   Start Command: C:\Windows\System32\notepad.exe

2. Paint
   Start Command: C:\Windows\System32\mspaint.exe

...

================================================================================
Step 2: Finding Notepad application...
================================================================================
‚úÖ Found application: Notepad
Start Command: C:\Windows\System32\notepad.exe

================================================================================
Step 3: Launching application...
================================================================================
‚úÖ Application started with 1 process(es)
  - notepad.exe (PID: 12345)
    Command: C:\Windows\System32\notepad.exe

================================================================================
Step 4: Waiting for application to load...
================================================================================
Waiting 5 seconds...
‚úÖ Wait complete

================================================================================
Step 5: Checking running applications...
================================================================================
‚úÖ Found 1 visible application(s)
  - notepad.exe (PID: 12345)

================================================================================
Step 6: Stopping application...
================================================================================
Attempting to stop process by PID: 12345
‚úÖ Application stopped successfully (by PID)

================================================================================
Workflow Summary
================================================================================
‚úÖ Session creation: Success
‚úÖ Get installed apps: 120 applications found
‚úÖ Find target app: Found
‚úÖ Start application: 1 processes started
‚úÖ List visible apps: 1 visible applications
‚úÖ Stop application: Success
================================================================================

üéâ Workflow completed successfully!

================================================================================
Cleaning up session...
================================================================================
‚úÖ Session deleted
```

## Features Demonstrated

- **Session Management**: Creating and cleaning up Windows sessions
- **Application Discovery**: Finding installed desktop applications
- **Process Management**: Starting and stopping applications
- **Process Monitoring**: Listing visible applications
- **Error Handling**: Robust error handling with fallback strategies
- **Retry Logic**: Automatic retry for resource creation delays

## API Methods Used

| Method | Purpose |
|--------|---------|
| `session.computer.get_installed_apps()` | Get list of installed applications |
| `session.computer.start_app()` | Start an application |
| `session.computer.list_visible_apps()` | List currently visible applications |
| `session.computer.stop_app_by_pid()` | Stop application by process ID |
| `session.computer.stop_app_by_pname()` | Stop application by process name |

## Troubleshooting

### Resource Creation Delay

If you see "Resource creation in progress" message, the script will automatically wait and retry. This is normal for Windows sessions.

### Application Not Found

The example uses Notepad which is available on all Windows systems. If you want to use a different application:

1. Run the example once to see the list of available applications
2. Modify the code to search for your target application
3. Update the start command accordingly

## Related Documentation

- [Computer Application Management Guide](../../../../../../docs/guides/computer-use/computer-application-management.md)
- [Session Management](../../../../../../docs/guides/common-features/basics/session-management.md)
- [Computer UI Automation](../../../../../../docs/guides/computer-use/computer-ui-automation.md)

## License

This example is part of the Wuying AgentBay SDK.




# Mobile Use Examples

This directory contains examples demonstrating mobile UI automation capabilities in AgentBay SDK.

## Overview

Mobile Use environment (`mobile_latest` image) provides cloud-based Android mobile automation with:
- UI element detection and interaction
- Touch gestures (tap, swipe, scroll)
- Text input and key events
- Screenshot capture
- Mobile application management
- ADB (Android Debug Bridge) integration

## Examples

### mobile_system/main.py

Comprehensive mobile automation example demonstrating:

1. **Application Management**
   - Get installed applications
   - Start applications
   - Stop applications
   - Application state monitoring

2. **UI Element Detection**
   - Get clickable UI elements
   - Get all UI elements (tree structure)
   - Element property inspection

3. **Touch Interactions**
   - Tap at coordinates
   - Swipe gestures
   - Multi-touch operations

4. **Text Input**
   - Input text to focused elements
   - Send key events
   - Keyboard operations

5. **Screenshot Capture**
   - Capture mobile screen
   - Save screenshots locally

### mobile_get_adb_url_example.py

ADB URL retrieval example:
- Get ADB connection URL
- Connect external tools to mobile session
- Remote debugging setup

### mobile_simulate_basic_usage.py

Basic mobile simulate example:
- Upload mobile device info file
- Create sessions with mobile simulate configuration
- Simulate different mobile devices across sessions
- Verify device properties after simulation

### mobile_simulate_with_ctx.py

Mobile simulate with user specific context example:
- Get or create user specific context
- Check and upload mobile device info to context
- Create session with mobile simulate and context sync
- Persist device information across sessions
- Sync context on session deletion

## Prerequisites

- Python 3.8 or later
- AgentBay SDK installed: `pip install wuying-agentbay-sdk`
- Valid `AGENTBAY_API_KEY` environment variable

## Quick Start

```bash
# Set your API key
export AGENTBAY_API_KEY=your_api_key_here

# Run the main example
cd mobile_system
python main.py

# Run ADB URL example
cd ..
python mobile_get_adb_url_example.py

# Run mobile simulate basic usage example
python mobile_simulate_basic_usage.py

# Run mobile simulate with context example
python mobile_simulate_with_ctx.py
```

## Features Demonstrated

### Application Management
- List installed applications
- Filter system applications
- Start applications with monkey command
- Start with specific activity
- Stop applications by command
- Monitor application processes

### UI Element Detection
- Get clickable elements only
- Get complete UI element tree
- Element property inspection
- Resource ID and text extraction
- Hierarchical element structure

### Touch Interactions
- Single tap at coordinates
- Long press
- Swipe gestures with duration
- Multi-point touch
- Drag and drop

### Text Input
- Input text to focused elements
- Send individual key events
- Special keys (HOME, BACK, etc.)
- Keyboard shortcuts

### Screenshot Operations
- Capture full screen
- Save to local file
- Base64 encoding support
- Image format handling

## API Methods Used

| Method | Purpose |
|--------|---------|
| `session.mobile.get_installed_apps()` | Get list of installed applications |
| `session.mobile.start_app()` | Start an application |
| `session.mobile.stop_app_by_cmd()` | Stop application by command |
| `session.mobile.get_clickable_ui_elements()` | Get clickable UI elements |
| `session.mobile.get_all_ui_elements()` | Get complete UI element tree |
| `session.mobile.tap()` | Tap at coordinates |
| `session.mobile.swipe()` | Perform swipe gesture |
| `session.mobile.input_text()` | Input text |
| `session.mobile.send_key()` | Send key event |
| `session.mobile.screenshot()` | Take screenshot |
| `session.mobile.get_adb_url()` | Get ADB connection URL |
| `MobileSimulateService.upload_mobile_info()` | Upload mobile device info |
| `MobileSimulateService.has_mobile_info()` | Check if mobile info exists in context |
| `MobileSimulateService.set_simulate_enable()` | Enable/disable mobile simulate |
| `MobileSimulateService.set_simulate_mode()` | Set mobile simulate mode |
| `MobileSimulateService.set_simulate_context_id()` | Set simulate context id for reuse |
| `MobileSimulateService.get_simulate_config()` | Get mobile simulate configuration |
| `agent_bay.context.get()` | Get or create user context |

## Common Use Cases

### 1. App Testing Automation
- Start app and wait for load
- Get UI elements and find target elements
- Input credentials and submit forms
- Verify results with screenshots

### 2. UI Element Inspection
- Get all elements and find specific elements by text
- Navigate UI hierarchy
- Extract element properties

### 3. Gesture Automation
- Swipe up/down for scrolling
- Swipe left/right for navigation
- Long press for context menus

## Best Practices

1. **Wait for UI Load**: Add delays after starting apps or navigation
2. **Element Verification**: Verify elements exist before interaction
3. **Error Handling**: Check `result.success` for all operations
4. **Resource Cleanup**: Stop apps and delete sessions when done
5. **Screenshot Verification**: Use screenshots to verify UI state
6. **Coordinate Accuracy**: Use element coordinates from UI tree
7. **Gesture Timing**: Adjust swipe duration for different effects
8. **Key Events**: Use appropriate key codes for device buttons

## Related Documentation

- [Mobile Use Guide](../../../../../docs/guides/mobile-use/README.md)
- [Mobile Application Management](../../../../../docs/guides/mobile-use/mobile-application-management.md)
- [Mobile UI Automation](../../../../../docs/guides/mobile-use/mobile-ui-automation.md)

## Troubleshooting

### Application Not Starting

If application fails to start:
- Verify package name is correct
- Check application is installed
- Ensure monkey command syntax is correct
- Try with specific activity

### UI Elements Not Found

If UI elements are missing:
- Wait longer for UI to load
- Check timeout parameter
- Verify app is in correct state
- Take screenshot to inspect UI

### Touch Interactions Not Working

If taps/swipes don't work:
- Verify coordinates are within screen bounds
- Check element is visible and enabled
- Ensure no overlay blocking interaction
- Add delay before interaction

### ADB Connection Issues

If ADB URL doesn't work:
- Verify session is mobile_latest image
- Check network connectivity
- Ensure ADB is installed locally
- Try reconnecting: `adb disconnect` then `adb connect`

### Screenshot Issues

If screenshots fail or are corrupted:
- Check session is active
- Verify sufficient memory
- Try smaller screen resolution
- Handle base64 decoding correctly



# Mobile System Example

This example demonstrates how to use the mobile system features of the AgentBay SDK for Python.

## Features Demonstrated

- Creating a session with a mobile image
- Getting installed applications
- Starting and stopping applications
- Getting clickable UI elements
- Getting all UI elements with hierarchy information
- Sending key events
- Input text
- Swipe screen gestures
- Click screen operations
- Taking screenshots
- Starting applications with specific activities

## Running the Example

1. Make sure you have installed the AgentBay SDK:

```bash
pip install wuying-agentbay-sdk
```

2. Set your API key as an environment variable (recommended):

```bash
export AGENTBAY_API_KEY=your_api_key_here
```

3. Run the example:

```bash
python main.py
```

## Code Explanation

The example demonstrates mobile system operations:

1. Create a new session with a mobile image
2. Get a list of installed applications
3. Start an application using a package name
4. Stop an application
5. Interact with the UI using various methods:
   - Get clickable UI elements
   - Get all UI elements with their hierarchy
   - Send key events (HOME key)
   - Input text
   - Perform swipe gestures
   - Perform click operations
6. Take screenshots
7. Start an application with a specific activity
8. Clean up by deleting the session

Mobile system features are particularly useful for:

- Mobile application testing
- Automated UI testing
- Creating mobile app demos
- Building mobile app automation tools
- Implementing mobile device control applications

For more details on mobile system features, see the [Application API Reference](../../../../../docs/api/async/async-computer.md) and [UI API Reference](../../../../../docs/api/async/async-mobile.md).




# Browser Use Examples

This directory contains examples demonstrating browser automation capabilities in AgentBay SDK.

## Overview

Browser Use environment (`browser_latest` image) provides cloud-based browser automation with:
- Playwright integration for browser control
- Stealth mode to avoid detection
- Cookie and session persistence
- CAPTCHA handling capabilities
- Browser extension support
- AI-powered automation

## Directory Structure

```
browser-use/
‚îú‚îÄ‚îÄ browser/        # Browser automation examples
‚îî‚îÄ‚îÄ extension/      # Browser extension management examples
```

## Browser Examples

### Core Features

#### browser_context_cookie_persistence.py
Cookie persistence across multiple sessions:
- Creating sessions with Browser Context
- Setting cookies manually using Playwright
- Deleting sessions with context synchronization
- Verifying cookie persistence in new sessions

#### browser_stealth.py
Stealth mode to avoid bot detection:
- Browser fingerprint randomization
- Anti-detection techniques
- Stealth configuration options

#### browser_viewport.py
Custom viewport configuration:
- Setting custom screen resolutions
- Device emulation
- Responsive testing

#### browser_proxies.py
Proxy configuration for network routing:
- HTTP/HTTPS proxy setup
- SOCKS proxy support
- Authentication configuration

#### browser_type_example.py
Browser type selection:
- Chrome browser usage
- Chromium browser usage
- Default browser configuration

#### browser_command_args.py
Custom browser launch arguments:
- Performance optimization
- Feature flags
- Security settings

#### browser_replay.py
Session replay functionality:
- Recording browser sessions
- Replaying recorded sessions
- Session state restoration

### AI-Powered Automation

#### search_agentbay_doc.py
Manual browser automation with Playwright:
- Direct Playwright interactions
- Element selection and interaction
- Search operations

#### search_agentbay_doc_by_agent.py
AI-powered automation using Agent module:
- Natural language commands
- AI-driven element detection
- Simplified complex interactions

### Real-World Use Cases

#### Game Automation
- **game_2048.py**: 2048 game automation
- **game_sudoku.py**: Sudoku game automation
- **sudoku_solver.py**: Advanced Sudoku solving

#### E-commerce and Business
- **admin_add_product.py**: Product management automation
- **shop_inspector.py**: E-commerce shop inspection
- **expense_upload_invoices.py**: Invoice upload automation
- **gv_quick_buy_seat.py**: Quick seat booking

#### Web Interaction
- **visit_aliyun.py**: Basic website navigation
- **alimeeting_availability.py**: Meeting availability checking
- **call_for_user_jd.py**: JD.com user interaction
- **mini_max.py**: MiniMax platform automation

#### CAPTCHA Handling
- **captcha_tongcheng.py**: CAPTCHA solving example

## Extension Examples

### basic_extension_usage.py
Loading and using browser extensions:
- Extension installation
- Extension configuration
- Using extensions in automation

### extension_development_workflow.py
Extension development patterns:
- Development mode setup
- Testing extensions
- Debugging workflows

### extension_testing_automation.py
Automated extension testing:
- Test automation for extensions
- Validation workflows
- CI/CD integration

## Prerequisites

1. **Install Python SDK**:
   ```bash
   pip install wuying-agentbay-sdk
   ```

2. **Install Playwright**:
   ```bash
   pip install playwright
   playwright install chromium
   ```

3. **Set API Key**:
   ```bash
   export AGENTBAY_API_KEY=your_api_key_here
   ```

## Quick Start

```bash
# Set your API key
export AGENTBAY_API_KEY=your_api_key_here

# Run any example
cd browser
python browser_automation.py
```

## Browser Configuration

- **Browser Types**: Chrome, Chromium, Default
- **Stealth Mode**: Fingerprint randomization and anti-detection
- **Cookie Persistence**: Browser Context for session continuity
- **Proxy Support**: HTTP/HTTPS and SOCKS proxy configuration
- **Extension Support**: Load and manage browser extensions

## Best Practices

1. **Always use context synchronization**: When deleting sessions with important browser data, use `sync_context=True`
2. **Proper cleanup**: Always delete sessions and contexts when done
3. **Error handling**: Implement proper error handling for network and browser operations
4. **Resource management**: Close browser connections properly
5. **Unique context names**: Use unique context names to avoid conflicts
6. **Stealth mode**: Use stealth mode for production web scraping
7. **Rate limiting**: Respect website rate limits and robots.txt

## Related Documentation

- [Browser Use Guide](../../../../../docs/guides/browser-use/README.md)
- [Core Features](../../../../../docs/guides/browser-use/core-features.md)
- [Advanced Features](../../../../../docs/guides/browser-use/advance-features.md)
- [Browser Extensions](../../../../../docs/guides/browser-use/browser-extensions.md)
- [Browser Replay](../../../../../docs/guides/browser-use/browser-replay.md)

## Troubleshooting

### Browser Initialization Failed

If browser fails to initialize:
- Check session is created successfully
- Verify image_id is `browser_latest`
- Wait a few seconds after session creation

### Playwright Connection Issues

If Playwright can't connect:
- Verify endpoint URL is correct
- Check network connectivity
- Ensure Playwright is installed: `playwright install chromium`

### Cookie Persistence Not Working

Ensure you're using Browser Context:
- Create context with `agent_bay.context.get()`
- Use `BrowserContext` in session params
- Delete session with `sync_context=True`

### Detection by Websites

If websites detect automation:
- Enable stealth mode: `use_stealth=True`
- Randomize fingerprints
- Add delays between actions
- Use residential proxies



# Browser Examples

This directory contains examples demonstrating various capabilities of the AgentBay browser automation system.

## Screenshot Examples

### [browser_screenshot.py](../browser/browser_screenshot.py) - Browser Screenshot Demo

Demonstrates how to capture screenshots using both the browser agent and direct Playwright integration methods:

- Creating a browser session with AgentBay
- Using Playwright to connect to the browser instance
- Taking screenshots using the browser agent (returns base64 data)
- Taking screenshots using direct Playwright integration (returns bytes data)
- Saving screenshots to local files
- Customizing screenshot options (full page, image format, quality)

**Key Features:**
1. **Browser Agent Screenshots** - Uses `session.browser.agent.screenshot_async()` which returns base64 encoded data
2. **Direct Playwright Screenshots** - Uses `session.browser.screenshot(page)` which returns raw bytes data
3. **Multiple Formats** - Supports both PNG and JPEG formats with customizable quality
4. **Full Page Capture** - Ability to capture entire web pages including content below the fold
5. **Custom Options** - Configurable timeout, viewport settings, and other advanced options

**Usage:**
```bash
export AGENTBAY_API_KEY=your_api_key_here
python browser_screenshot.py
```

This will generate several screenshot files in the current directory:
- `temp_agent_screenshot.png` - Screenshot taken with browser agent
- `temp_agent_full_page_screenshot.png` - Full page screenshot taken with browser agent
- `temp_browser_screenshot.png` - Screenshot taken with direct Playwright integration
- `temp_browser_full_page_screenshot.jpg` - Full page screenshot in JPEG format
- `temp_browser_custom_screenshot.png` - Screenshot with custom options

## Other Examples

### [visit_aliyun.py](../browser/visit_aliyun.py) - Basic Browser Usage
Demonstrates basic browser automation capabilities:
- Create browser session
- Use Playwright to connect to browser instance through CDP protocol
- Navigate to websites and interact with page content

### [browser_viewport.py](../browser/browser_viewport.py) - Viewport Configuration
Shows how to configure browser viewport and screen dimensions:
- Custom viewport sizes for different device types
- Screen resolution configuration
- Responsive design testing

### [browser-proxies.py](../browser/browser-proxies.py) - Proxy Configuration
Shows how to configure browser proxies:
- Custom proxy servers
- Authentication with username/password
- Wuying proxy integration

### [browser_type_example.py](../browser/browser_type_example.py) - Browser Type Selection
Demonstrates browser type selection:
- Chrome vs Chromium selection
- Computer use image requirements
- Browser compatibility considerations

### [browser_command_args.py](../browser/browser_command_args.py) - Command Line Arguments
Shows how to customize browser behavior with command-line arguments:
- Feature flags and switches
- Performance optimizations
- Debugging options

### [captcha_tongcheng.py](../browser/captcha_tongcheng.py) - CAPTCHA Handling
Demonstrates CAPTCHA solving capabilities:
- Automated CAPTCHA detection
- Integration with solving services
- Error handling and retry logic

### [game_2048.py](../browser/game_2048.py) - Game Automation
Advanced example of game automation:
- Complex interaction patterns
- State detection and response
- AI-driven decision making

### [shop_inspector.py](../browser/shop_inspector.py) - E-commerce Scraping
Comprehensive e-commerce site inspection:
- Product extraction and normalization
- Screenshot capture for verification
- Data validation and filtering

### [search_agentbay_doc.py](../browser/search_agentbay_doc.py) - Documentation Search
Demonstrates search automation:
- Form filling and submission
- Result parsing and extraction
- Multi-page navigation

### [admin_add_product.py](../browser/admin_add_product.py) - Admin Panel Automation
Complex admin panel workflow automation:
- Authentication and session management
- Multi-step form completion
- File uploads and image processing

### [mini_max.py](../browser/mini_max.py) - AI Platform Integration
Integration with AI platforms:
- Login and authentication workflows
- Content generation and management
- Result validation and processing

### [expense_upload_invoices.py](../browser/expense_upload_invoices.py) - File Upload Automation
File upload and processing automation:
- Document upload workflows
- Form completion and submission
- Status monitoring and verification

### [game_sudoku.py](../browser/game_sudoku.py) - Logic Game Automation
Logic puzzle automation:
- Grid recognition and parsing
- Rule-based solving algorithms
- Interactive gameplay

### [gv_quick_buy_seat.py](../browser/gv_quick_buy_seat.py) - Ticket Booking Automation
High-speed booking automation:
- Time-sensitive operations
- Multi-step checkout processes
- Error handling and recovery

### [alimeeting_availability.py](../browser/alimeeting_availability.py) - Calendar Integration
Calendar and scheduling automation:
- Availability checking
- Time slot selection
- Meeting scheduling workflows

### [sudoku_solver.py](../browser/sudoku_solver.py) - Simple Game Solver
Simple game automation example:
- Basic interaction patterns
- State evaluation
- Move execution

### [search_agentbay_doc_by_agent.py](../browser/search_agentbay_doc_by_agent.py) - Agent-Based Search
Agent-driven search automation:
- Natural language instructions
- Autonomous navigation
- Result extraction

### [browser_context_cookie_persistence.py](../browser/browser_context_cookie_persistence.py) - Cookie Management
Cookie persistence and management:
- Session preservation
- Authentication state management
- Context isolation

### [browser_replay.py](../browser/browser_replay.py) - Browser Replay
Browser session recording and replay:
- Action recording
- Playback automation
- Screenshot capture for verification

### [call_for_user_jd.py](../browser/call_for_user_jd.py) - User Simulation
User behavior simulation:
- Realistic interaction patterns
- Timing variations
- Error handling



# Extension Examples

This directory contains Python examples demonstrating browser extension management capabilities of the AgentBay SDK.

## Examples

### 1. basic_extension_usage.py
Demonstrates fundamental extension management and browser session creation:
- Uploading browser extensions to the cloud
- Creating browser sessions with extensions
- Extension synchronization and file access
- Multiple extension handling
- Proper resource cleanup

**Key features demonstrated:**
- ExtensionsService initialization and context management
- Extension upload and validation
- ExtensionOption creation for browser sessions
- Extension file access in sessions at `/tmp/extensions/`

### 2. extension_development_workflow.py
Shows a complete development workflow for browser extensions:
- Extension upload for development testing
- Test session creation with extensions
- Extension updates during development
- Iterative development cycle management
- Development resource cleanup

**Key features demonstrated:**
- ExtensionDevelopmentWorkflow class usage
- Extension versioning and updates
- Development session management
- Extension testing patterns

### 3. extension_testing_automation.py
Advanced example for automated extension testing:
- Automated test suite execution
- Multi-extension testing scenarios
- Test result reporting and analysis
- CI/CD integration patterns
- Comprehensive error handling

**Key features demonstrated:**
- ExtensionTestRunner class for automation
- Test suite configuration and execution
- Automated test reporting
- CI/CD compatible testing workflows

## Running the Examples

1. Install required dependencies:
```bash
pip install wuying-agentbay-sdk
```

2. Set your API key:
```bash
export AGENTBAY_API_KEY=your_api_key_here
```

3. Update extension paths in the examples with your actual extension ZIP files.

4. Run any example:
```bash
python basic_extension_usage.py
python extension_development_workflow.py
python extension_testing_automation.py
```

## Extension Requirements

- Extensions must be packaged as ZIP files
- Extensions must include a valid `manifest.json` file
- Extensions are synchronized to `/tmp/extensions/{extension_id}/` in browser sessions

## Best Practices

1. **Context Management**:
   - Use descriptive context names for different projects
   - Always call `cleanup()` when done
   - Let the service auto-generate contexts for simple use cases

2. **File Management**:
   - Use ZIP format for all extension packages
   - Validate file existence before upload
   - Include proper manifest.json in extensions

3. **Session Management**:
   - Use meaningful labels for sessions
   - Wait for extension synchronization before testing
   - Create one ExtensionOption per session

4. **Error Handling**:
   - Implement comprehensive error handling
   - Use try-finally blocks for cleanup
   - Validate extension configurations

## Extension File Structure

Extensions are synchronized to browser sessions at:
```
/tmp/extensions/
‚îú‚îÄ‚îÄ {extension_id_1}/
‚îÇ   ‚îú‚îÄ‚îÄ manifest.json
‚îÇ   ‚îú‚îÄ‚îÄ content.js
‚îÇ   ‚îî‚îÄ‚îÄ ... (other extension files)
‚îú‚îÄ‚îÄ {extension_id_2}/
‚îÇ   ‚îú‚îÄ‚îÄ manifest.json
‚îÇ   ‚îî‚îÄ‚îÄ ... (other extension files)
‚îî‚îÄ‚îÄ ...
```

## Related Documentation

- [Extension API Reference](../../../../../../typescript/docs/api/browser-use/extension.md) - Complete API documentation
- [Browser Extensions Guide](../../../../../../docs/guides/browser-use/browser-extensions.md) - Tutorial and best practices
- [Browser Examples](../browser/README.md) - Additional browser automation examples

## Troubleshooting

**Extension not found in session:**
- Check that extension was uploaded successfully
- Verify session was created with proper ExtensionOption
- Wait for synchronization to complete before accessing files

**Upload failures:**
- Ensure file is in ZIP format
- Check file permissions and accessibility
- Verify API key and network connectivity

**Context errors:**
- Use unique context names to avoid conflicts
- Don't mix extensions from different sources
- Clean up contexts when no longer needed



# Codespace Examples

This directory contains examples demonstrating code execution capabilities in AgentBay SDK.

## Overview

Codespace environment (`linux_latest` image) provides cloud-based code execution with:
- Python and JavaScript runtime support
- File system operations
- Command execution
- Package installation and management
- Development environment setup

## Examples

### Code Execution
- **code_execution_example.py**: Basic Python and JavaScript code execution
- **python_development.py**: Python development workflow
- **nodejs_development.py**: Node.js development setup
- **web_server_setup.py**: Web server configuration

### File Operations
- **file_compression.py**: File compression and archiving
- **text_processing.py**: Text file processing operations

### System Operations
- **system_monitoring.py**: System resource monitoring
- **git_operations.py**: Git repository management
- **database_operations.py**: Database setup and operations

### Build and Automation
- **build_automation.py**: Automated build processes

## Prerequisites

- Python 3.8 or later
- AgentBay SDK installed: `pip install wuying-agentbay-sdk`
- Valid `AGENTBAY_API_KEY` environment variable

## Quick Start

```bash
# Set your API key
export AGENTBAY_API_KEY=your_api_key_here

# Run any example
python code_execution_example.py
```

## API Methods Used

| Method | Purpose |
|--------|---------|
| `session.code.run_code()` | Execute Python or JavaScript code |
| `session.file_system.write_file()` | Write content to a file |
| `session.file_system.read_file()` | Read content from a file |
| `session.command.execute_command()` | Execute shell commands |

## Common Use Cases

### Development Workflows
- Set up development environments
- Install packages and dependencies
- Run automated tests
- Build and deploy applications

### Data Processing
- Process large datasets
- Run data analysis scripts
- Generate reports and visualizations

### Automation Tasks
- Automated testing and CI/CD
- System administration tasks
- File processing and manipulation

## Best Practices

1. **Environment Setup**: Install required packages before running code
2. **Error Handling**: Check execution results for errors
3. **Resource Management**: Clean up temporary files and processes
4. **Security**: Avoid executing untrusted code
5. **Performance**: Consider memory and CPU usage for large operations

## Related Documentation

- [Codespace Guide](../../../../../docs/guides/codespace/code-execution.md)
- [File Operations Guide](../../../../../docs/guides/common-features/basics/file-operations.md)
- [Command Execution Guide](../../../../../docs/guides/common-features/basics/command-execution.md)

## Troubleshooting

### Code Execution Fails
- Check syntax errors in the code
- Verify required packages are installed
- Check memory and timeout limits

### Package Installation Issues
- Use correct package manager (pip for Python, npm for Node.js)
- Check network connectivity
- Verify package names and versions

### File Permission Issues
- Ensure proper file permissions
- Use appropriate file paths
- Check disk space availability



# Common Features Examples

This directory contains examples demonstrating features available across all AgentBay environment types (browser, computer, mobile, and codespace).

## Directory Structure

```
common-features/
‚îú‚îÄ‚îÄ basics/          # Fundamental features for all users
‚îî‚îÄ‚îÄ advanced/        # Advanced features and integrations
```

## Basics

Essential features that every AgentBay user should know:

### [session_creation](basics/session_creation/)
Session lifecycle management examples:
- Creating sessions with default parameters
- Session creation with labels
- Session creation with context synchronization
- Browser context for cookie persistence
- Mobile configuration with app management

### [file_system](basics/file_system/)
File operations in cloud environments:
- Reading and writing files
- Directory operations
- File information retrieval
- File editing and moving
- File searching
- Large file operations with chunking

### [filesystem_example](basics/filesystem_example/)
Practical filesystem use cases:
- **file_transfer_example.py**: File transfer between local and cloud
- **watch_directory_example.py**: Directory monitoring and change detection

### [context_management](basics/context_management/)
Context creation and management:
- Creating and managing contexts
- Data storage and retrieval
- Cross-session data sharing

### [data_persistence](basics/data_persistence/)
Data persistence across sessions:
- Storing data across sessions
- Data retrieval patterns
- Context synchronization demonstration
- Recycle policy configuration

### [label_management](basics/label_management/)
Session organization with labels:
- Adding labels to sessions
- Filtering and searching sessions
- Label-based session management

### [list_sessions](basics/list_sessions/)
Session listing and filtering:
- Listing all sessions
- Filtering by labels
- Session status monitoring

### [get](basics/get/)
Session retrieval:
- Getting session by ID
- Session information retrieval

## Advanced

Advanced features for power users and integrations:

### [agent_module](advanced/agent_module/)
AI-powered automation:
- Using Agent for task execution
- Natural language task descriptions
- Intelligent automation workflows

### [oss_management](advanced/oss_management/)
Object Storage Service integration:
- OSS environment initialization
- File upload to OSS
- File download from OSS
- Anonymous upload/download

### [vpc_session](advanced/vpc_session/)
Secure isolated network environments:
- Creating VPC sessions
- VPC network configuration
- Secure session management

### [screenshot_download](advanced/screenshot_download/)
Screenshot capture and download:
- Taking screenshots
- Downloading screenshots locally
- Image format handling

## Prerequisites

- Python 3.8 or later
- AgentBay SDK installed: `pip install wuying-agentbay-sdk`
- Valid `AGENTBAY_API_KEY` environment variable

## Quick Start

```bash
# Set your API key
export AGENTBAY_API_KEY=your_api_key_here

# Run any example
cd basics/session_creation
python main.py

cd ../file_system
python main.py
```

## Usage

Each subdirectory contains specific examples with detailed documentation. Check the individual README files and Python scripts for complete usage examples.

## Best Practices

1. **Always Clean Up**: Delete sessions when done to free resources
2. **Error Handling**: Check `result.success` before using data
3. **Use Labels**: Organize sessions with meaningful labels
4. **Context Sync**: Use context synchronization for data persistence
5. **Resource Limits**: Be aware of concurrent session limits

## Related Documentation

- [Session Management Guide](../../../../../docs/guides/common-features/basics/session-management.md)
- [File Operations Guide](../../../../../docs/guides/common-features/basics/file-operations.md)
- [Data Persistence Guide](../../../../../docs/guides/common-features/basics/data-persistence.md)
- [Agent Modules Guide](../../../../../docs/guides/common-features/advanced/agent-modules.md)

## Troubleshooting

### Resource Creation Delay

If you see "The system is creating resources" message:
- Wait 90 seconds and retry
- This is normal for resource initialization
- Consider using session pooling for production

### API Key Issues

Ensure your API key is properly set:
```bash
export AGENTBAY_API_KEY=your_api_key_here
# Verify
echo $AGENTBAY_API_KEY
```

### Context Synchronization Timeout

For large contexts:
- Increase timeout settings
- Use selective synchronization
- Consider splitting into smaller contexts





# Agent Module Example

This example demonstrates how to use the Agent module to execute AI-powered tasks using natural language descriptions.

## Overview

The Agent module allows you to execute complex tasks using human-readable instructions, monitor task status, and terminate running tasks. This capability extends the functionality of cloud sessions by adding AI-powered automation.

## Running the Example

1. Ensure you have the AgentBay SDK installed
2. Set the `AGENTBAY_API_KEY` environment variable with your valid API key
3. Run the example:

```bash
cd docs/examples/python/agent_module
python main.py
```

## What the Example Does

1. Initializes the AgentBay client with your API key
2. Creates a new session
3. Executes a simple task using the Agent module ("Create a word document, input some words and save the document.")
4. Displays the task results
5. Cleans up by deleting the session

## Key Concepts

- **Session Creation**: All Agent operations happen within a session context
- **Task Execution**: Tasks are executed using natural language descriptions
- **Result Handling**: Task results include success status, output, and error information
- **Resource Management**: Sessions should be properly deleted when no longer needed

## Next Steps

Try modifying the task description to perform different operations, such as:
- "Find out the current weather in New York City by Google/Baidu"
- "Copy all the text files from folder A to folder B"
- "Navigate to bilibili.com and search for 'Wuying AgentBay ' and play the first video."



# OSS Management Example

This example demonstrates how to use the Object Storage Service (OSS) features of the AgentBay SDK for Python.

## Features Demonstrated

- Initializing OSS credentials in a session
- Uploading files to OSS buckets
- Downloading files from OSS buckets
- Anonymous uploads to OSS using URLs
- Anonymous downloads from OSS using URLs
- Handling OSS operations in a session environment

## Running the Example

1. Make sure you have installed the AgentBay SDK:

```bash
pip install wuying-agentbay-sdk
```

2. Set your API key as an environment variable (recommended):

```bash
export AGENTBAY_API_KEY=your_api_key_here
```

3. Optionally, set OSS credentials as environment variables:

```bash
export OSS_ACCESS_KEY_ID=your_access_key_id
export OSS_ACCESS_KEY_SECRET=your_access_key_secret
export OSS_SECURITY_TOKEN=your_security_token
export OSS_ENDPOINT=https://oss-cn-hangzhou.aliyuncs.com
export OSS_REGION=cn-hangzhou
export OSS_TEST_BUCKET=your_test_bucket
```

4. Run the example:

```bash
python main.py
```

## Code Explanation

The example demonstrates OSS integration with AgentBay:

1. Create a new session
2. Initialize OSS environment with credentials
3. Create a test file in the session
4. Upload the file to an OSS bucket
5. Upload a file anonymously using a URL
6. Download a file from an OSS bucket
7. Download a file anonymously using a URL
8. Clean up by deleting the session

OSS integration allows you to:

- Transfer files between your local environment and the cloud session
- Store session artifacts in permanent storage
- Share files across multiple sessions
- Download resources from external sources
- Implement file backup and restore functionality

For more details on OSS integration, see the [OSS API Reference](../../../../../../../typescript/docs/api/common-features/advanced/oss.md).



# VPC Session Example

This example demonstrates how to create and use VPC (Virtual Private Cloud) sessions with the AgentBay SDK.

## Overview

VPC sessions provide enhanced security and networking capabilities by running your cloud sessions within a private network environment. This example shows how to create a VPC session and use its available modules.

## Running the Example

1. Ensure you have the AgentBay SDK installed
2. Set the `AGENTBAY_API_KEY` environment variable with your valid API key
3. Run the example:

```bash
cd docs/examples/python/vpc_session
python main.py
```

## What the Example Does

1. Initializes the AgentBay client with your API key
2. Creates a new VPC session with specific parameters
3. Tests FileSystem operations by writing and reading a file
4. Tests Command operations by executing system commands
5. Cleans up by deleting the session

## Key Concepts

- **VPC Session Creation**: VPC sessions are created by setting the `is_vpc` parameter to `True`
- **Module Availability**: VPC sessions have limited module availability compared to standard sessions
- **Resource Management**: VPC sessions should be properly deleted when no longer needed
- **Security**: VPC sessions provide network isolation for sensitive operations

## Available Modules in VPC Sessions

1. **FileSystem**: File and directory operations
2. **Command**: Command execution
3. **System Tools**: Specialized system-level tools
4. **Browser Tools**: Browser automation capabilities

## Next Steps

Try modifying the example to:
- Use context synchronization with VPC sessions
- Test different command executions
- Implement error handling for unavailable modules



# Archive Upload Mode Context Sync Example

This directory contains examples demonstrating the Archive upload mode functionality for context synchronization in the AgentBay SDK.

## Overview

The Archive upload mode is designed for efficient file transfer by compressing files before uploading them to the context storage. This is particularly useful when:

- Working with large files
- Dealing with many files
- Optimizing bandwidth usage
- Reducing upload time for compressible content

## Files

### `main.py`

A comprehensive example that demonstrates:

1. **Context Creation**: Creating a context for Archive upload mode
2. **Sync Policy Configuration**: Setting up sync policy with Archive uploadMode
3. **Session Management**: Creating and managing sessions with context sync
4. **File Operations**: Writing files to the context path
5. **Context Sync**: Synchronizing context before retrieving information
6. **Context Info**: Retrieving context status information
7. **File Listing**: Listing files in context sync directory
8. **Cleanup**: Proper session cleanup and error handling

## Key Features Demonstrated

### Archive Upload Mode Configuration

```python
# Configure sync policy with Archive upload mode
upload_policy = UploadPolicy(upload_mode=UploadMode.ARCHIVE)
sync_policy = SyncPolicy(upload_policy=upload_policy)

# Create context sync with Archive mode
context_sync = ContextSync(
    context_id=context_result.context_id,
    path="/tmp/archive-mode-test",
    policy=sync_policy
)
```

### Session Creation with Context Sync

```python
session_params = CreateSessionParams(
    labels={
        "example": f"archive-mode-{unique_id}",
        "type": "archive-upload-demo",
        "uploadMode": UploadMode.ARCHIVE.value
    },
    context_syncs=[context_sync]
)

session_result = agent_bay.create(session_params)
```

### File Operations

```python
# Write file to context path
write_result = session.file_system.write_file(file_path, file_content, mode="overwrite")
```

### Context Sync and Information Retrieval

```python
# Call context sync before getting info (async operation)
import asyncio

def run_sync():
    return session.context.sync()

sync_result = asyncio.run(run_sync())

# Get context status information after sync
info_result = session.context.info()

# Display context status details
for index, status in enumerate(info_result.context_status_data):
    print(f"Context ID: {status.context_id}")
    print(f"Path: {status.path}")
    print(f"Status: {status.status}")
    print(f"Task Type: {status.task_type}")
```

### File Listing in Context Directory

```python
# List files in context sync directory
list_result = agent_bay.context.list_files(context_id, sync_dir_path, page_number=1, page_size=10)

# Display file entries
for index, entry in enumerate(list_result.entries):
    print(f"FilePath: {entry.file_path}")
    print(f"FileType: {entry.file_type}")
    print(f"FileName: {entry.file_name}")
    print(f"Size: {entry.size} bytes")
```

## Running the Example

### Prerequisites

1. **Environment Setup**: Set your AgentBay API key
   ```bash
   export AGENTBAY_API_KEY="your-api-key-here"
   ```

2. **Dependencies**: Ensure you have the AgentBay SDK installed
   ```bash
   pip install wuying-agentbay-sdk-test
   ```

### Execution

```bash
# Navigate to the python directory
cd python

# Run the example
python docs/examples/archive-upload-mode-example/main.py
```

### Expected Output

The example will output detailed logs showing:

```
üöÄ AgentBay Archive Upload Mode Context Sync Example
============================================================

üì¶ Step 1: Creating context for Archive upload mode...
‚úÖ Context created successfully!
   Context ID: ctx_xxxxx
   Request ID: req_xxxxx

‚öôÔ∏è  Step 2: Configuring sync policy with Archive upload mode...
‚úÖ Sync policy configured with uploadMode: Archive

üîß Step 3: Creating context sync configuration...
‚úÖ Context sync created:
   Context ID: ctx_xxxxx
   Path: /tmp/archive-mode-test
   Upload Mode: Archive

üèóÔ∏è  Step 4: Creating session with Archive mode context sync...
‚úÖ Session created successfully!
   Session ID: sess_xxxxx
   Request ID: req_xxxxx
   App Instance ID: app_xxxxx

üìù Step 5: Creating test files in Archive mode context...
üìÑ Creating file: /tmp/archive-mode-test/test-file-5kb.txt
üìä File content size: 5120 bytes
‚úÖ File write successful!
   Request ID: req_xxxxx

üìä Step 6: Testing context sync and info functionality...
üîÑ Calling context sync before getting info...
‚úÖ Context sync successful!
   Sync Request ID: req_xxxxx
üìã Calling context info after sync...
‚úÖ Context info retrieved successfully!
   Info Request ID: req_xxxxx
   Context status data count: X

üìã Context status details:
   [0] Context ID: ctx_xxxxx
       Path: /tmp/archive-mode-test
       Status: Success
       Task Type: upload

üîç Step 7: Listing files in context sync directory...
‚úÖ List files successful!
   Request ID: req_xxxxx
   Total files found: X

üìã Files in context sync directory:
   [0] FilePath: /tmp/archive-mode-test/test-file-5kb.txt
       FileType: file
       FileName: test-file-5kb.txt
       Size: 5120 bytes

üéâ Archive upload mode example completed successfully!
‚úÖ All operations completed without errors.

üßπ Step 8: Cleaning up session...
‚úÖ Session deleted successfully!
   Success: true
   Request ID: req_xxxxx
```

## Related Documentation

- [Context Sync Documentation](../../../../../../../docs/guides/common-features/basics/data-persistence.md)
- [Session Management Guide](../../../../../../../docs/guides/common-features/basics/session-management.md)
- [File Operations Guide](../../../../../../../docs/guides/common-features/basics/file-operations.md)

## Troubleshooting

### Common Issues

1. **API Key Not Set**
   ```
   Warning: AGENTBAY_API_KEY environment variable not set
   ```
   **Solution**: Set the environment variable or update the API key in the code

2. **Context Creation Failed**
   ```
   Context creation failed: [error message]
   ```
   **Solution**: Check your API key and network connectivity

3. **Session Creation Failed**
   ```
   Session creation failed: [error message]
   ```
   **Solution**: Verify context sync configuration and try again

4. **File Operation Failed**
   ```
   File write failed: [error message]
   ```
   **Solution**: Check file path permissions and available disk space

## Support

For additional help:
- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../../../../README.md)



# Context Management Example

This example demonstrates how to use the Context Management features of the AgentBay SDK for Python.

## Features Demonstrated

- Listing all contexts
- Getting or creating a context (by name or context ID)
- Creating a session with a context
- Updating a context
- Clearing context data (removing persistent data)
- Deleting a context

## Running the Example

1. Make sure you have installed the AgentBay SDK:

```bash
pip install wuying-agentbay-sdk
```

2. Set your API key as an environment variable (recommended):

```bash
export AGENTBAY_API_KEY=your_api_key_here
```

3. Run the example:

```bash
python main.py
```

## Code Explanation

The example demonstrates a full lifecycle of context management:

1. Initialize the AgentBay client with an API key
2. List all existing contexts to see what's available
3. Get an existing context by name or context ID, or create it if it doesn't exist
4. Create a session using the context
5. Update the context's properties
6. Clear context data (remove persistent data while keeping the context)
7. Clean up by deleting the session and context

For more details on context management, see the [Context API Reference](../../../../../../../typescript/docs/api/common-features/basics/context.md) and [Data Persistence Tutorial](../../../../../../../docs/guides/common-features/basics/data-persistence.md).



# Data Persistence Examples

This directory contains examples demonstrating data persistence functionality in AgentBay SDK.

## Examples

### 1. `main.py` - Basic Data Persistence

Demonstrates the fundamental data persistence features:

- Context creation for persistent storage
- File persistence across multiple sessions
- Context synchronization and file sharing
- Multi-session data verification

### 2. `context_sync_demo.py` - Advanced Sync with Callbacks

Demonstrates the new callback-based context synchronization:

- Async context sync with callback functions
- Timing analysis and performance monitoring
- Status verification using `context.info()`
- Multiple sync operations and error handling
- Backward compatibility with traditional sync

### 3. `recycle_policy_example.py` - Data Lifecycle Management

Demonstrates RecyclePolicy for controlling context data lifecycle:

- Using default RecyclePolicy (keeps data forever)
- Setting custom lifecycle durations (1 day, 3 days, etc.)
- Applying RecyclePolicy to specific paths
- Available lifecycle options
- Error handling (wildcard patterns validation)

## Key Features

### Data Persistence

- **Context Creation**: Create persistent storage contexts
- **Cross-Session Persistence**: Data survives session deletion
- **File Synchronization**: Automatic sync of files to persistent storage
- **Multi-Session Access**: Access data from different sessions

### Context Sync Callbacks

- **Async Operations**: Non-blocking sync operations
- **Real-time Feedback**: Immediate notification on completion
- **Timing Information**: Detailed performance metrics
- **Error Handling**: Graceful handling of failures and timeouts
- **Status Monitoring**: Track sync progress and completion

### Data Lifecycle Management

- **RecyclePolicy**: Control how long context data is retained in the cloud
- **Lifecycle Options**: 1 day to forever (11 options available)
- **Path-Specific Policies**: Apply different lifecycles to different directories
- **Automatic Cleanup**: Data is automatically deleted after specified duration
- **Wildcard Validation**: Ensures path safety by rejecting wildcard patterns

## Usage

### Basic Data Persistence

```bash
cd python/docs/examples/data_persistence
python main.py
```

### Context Sync Callbacks

```bash
cd python/docs/examples/data_persistence
python context_sync_demo.py
```

### RecyclePolicy Example

```bash
cd python/docs/examples/data_persistence
python recycle_policy_example.py
```

## Prerequisites

- AgentBay SDK installed
- Valid API key configured (via environment variable `AGENTBAY_API_KEY` or default configuration)
- Network access to AgentBay services

## Expected Behavior

Both examples will:

1. Create a persistent context
2. Create a session with context synchronization
3. Write test data to the persistent storage
4. Demonstrate data persistence across sessions
5. Clean up resources

The callback example additionally shows:

- Async sync operations with timing
- Callback notifications
- Status monitoring
- Error handling scenarios

## Output

Both examples provide detailed console output showing:

- Step-by-step progress
- Success/failure status for each operation
- Timing information (callback example)
- Data verification results
- Cleanup confirmation

## Notes

- Examples use temporary contexts that are cleaned up after execution
- File paths use `/tmp/` for demonstration purposes
- Timing may vary based on network conditions and file sizes
- The callback example includes timeout handling for robustness




# Context Sync Demo Example

This example demonstrates the `session.context.sync()` method for synchronizing context data with the AgentBay cloud environment.

## Overview

The example showcases:

- **Context Creation**: Creating persistent contexts for data storage
- **Context Synchronization**: Using `sync()` to sync data to cloud storage
- **Timing Analysis**: Measuring sync operation duration
- **File Management**: Creating and managing test files in the context
- **Error Handling**: Managing sync failures and API errors

## Key Features Demonstrated

### 1. Context Sync Function

The `session.context.sync()` method provides asynchronous context synchronization:

```python
# Async call - wait for completion
sync_result = session.context.sync()
if sync_result.success:
    print("‚úÖ Sync completed successfully")
    print(f"Duration: {sync_duration:.2f} seconds")
```

### 2. Timing Analysis

The example includes timing analysis for sync operations:

- **Small files** (< 1KB): Typically under 1 second
- **Medium files** (1-10KB): Typically 1-5 seconds
- **Multiple files**: Duration depends on total size and file count

### 3. Test Data Creation

Creates structured test data to demonstrate sync functionality:

```python
test_files = [
    ("/tmp/sync_data/test_files/small.txt", "Small test file content\n" * 10),
    ("/tmp/sync_data/test_files/medium.txt", "Medium test file content\n" * 100),
    ("/tmp/sync_data/config.json", json.dumps({...}, indent=2))
]
```

### 4. Session Management

Demonstrates proper session lifecycle management:

```python
# Create session with context sync
params = CreateSessionParams()
params.context_syncs = [context_sync]
session_result = agent_bay.create(params)

# Clean up session after use
delete_result = agent_bay.delete(session)
```

## Example Structure

### Step 1: Context Creation

- Creates a persistent context for data storage using `agent_bay.context.get()`
- Configures sync policy and context sync settings

### Step 2: Session Setup

- Creates session with context synchronization enabled
- Mounts context to `/tmp/sync_data` path in the session environment

### Step 3: Test Data Creation

- Creates multiple test files of different sizes
- Sets up directory structure for organized file management
- Writes configuration and log files to demonstrate various data types

### Step 4: Context Synchronization

- Calls `session.context.sync()` to sync all data to cloud storage
- Measures and reports sync timing and success status
- Handles both success and failure scenarios with appropriate logging




# FileSystem Examples

This directory contains comprehensive examples demonstrating the FileSystem functionality in the AgentBay SDK for Python. It covers both basic file operations and advanced features like file monitoring and transfers.

## Examples

### Basic Operations Example ([main.py](./main.py))

Demonstrates fundamental file system operations:

- Basic file reading and writing
- Directory creation and listing
- File information retrieval
- File editing and moving
- File searching
- Multiple file reading
- Large file operations with automatic chunking

### Watch Directory Example ([watch_directory_example.py](./watch_directory_example.py))

Demonstrates how to monitor file changes in a directory:

- Creating directories for monitoring
- Setting up file change monitoring with callbacks
- Performing file operations to trigger events
- Processing different types of file events (create, modify, delete)
- Proper resource cleanup

### File Transfer Example ([file_transfer_example.py](./file_transfer_example.py))

Demonstrates file upload and download operations:

- Creating contexts and sessions with file transfer capabilities
- Using the simplified FileSystem API for file transfers
- Uploading files from local storage to the cloud
- Downloading files from the cloud to local storage
- Tracking file transfer progress with callbacks
- Verifying file content integrity after transfers
- Proper resource cleanup

## Features Demonstrated

### Basic File Operations
- **File Writing**: Create new files with content
- **File Reading**: Read file contents
- **File Appending**: Add content to existing files

### Directory Operations
- **Directory Creation**: Create new directories
- **Directory Listing**: List contents of directories

### File Information
- **File Info Retrieval**: Get detailed information about files (size, permissions, etc.)

### File Manipulation
- **File Editing**: Edit specific parts of file content
- **File Moving**: Move files between directories

### Search Operations
- **File Searching**: Search for files containing specific patterns

### Multiple File Operations
- **Multiple File Reading**: Read multiple files in a single operation

### Large File Operations
- **Large File Writing**: Write files larger than the default API size limits using automatic chunking
- **Large File Reading**: Read large files using automatic chunking
- **Custom Chunk Size**: Specify custom chunk sizes for both reading and writing operations
- **Performance Measurement**: Measure and compare operation times with different chunk sizes

### Advanced Features
- **Real-time File Monitoring**: Monitor directory changes with event callbacks
- **File Transfer Operations**: Upload and download files with progress tracking
- **Context Synchronization**: Use contexts for persistent file operations

## Prerequisites

- Python 3.10 or later
- Wuying AgentBay SDK installed:
  ```bash
  pip install wuying-agentbay-sdk
  ```

## Running the Examples

1. Make sure you have set the `AGENTBAY_API_KEY` environment variable:

```bash
export AGENTBAY_API_KEY=your_api_key_here
```

2. Run any of the examples:

```bash
# Basic file operations
python main.py

# Directory monitoring
python watch_directory_example.py

# File transfers
python file_transfer_example.py
```

## Code Explanation

### Basic Operations Example (main.py)

The basic operations example demonstrates the following workflow:

1. **Session Creation**: Creates a new session with the specified image ID
2. **Basic File Operations**: Demonstrates writing, reading, and appending to files
3. **Directory Operations**: Shows how to create directories and list their contents
4. **File Information**: Retrieves and displays detailed file information
5. **File Editing**: Demonstrates how to edit specific parts of a file
6. **File Moving**: Shows how to move files between directories
7. **File Searching**: Searches for files containing specific patterns
8. **Multiple File Reading**: Reads multiple files in a single operation
9. **Large File Operations**: Demonstrates reading and writing large files with both default and custom chunk sizes
10. **Content Verification**: Verifies that file operations maintain content integrity
11. **Performance Comparison**: Measures and reports the time taken for large file operations

### Watch Directory Example

The watch directory example demonstrates real-time file monitoring capabilities:

1. Initialize the AgentBay client with an API key
2. Create a session with a suitable image
3. Create a test directory to monitor
4. Set up monitoring with a callback function to handle file events
5. Perform various file operations to trigger events
6. Process and display the detected file changes
7. Clean up resources properly

### File Transfer Example

The file transfer example demonstrates uploading and downloading files:

1. Initialize the AgentBay client with an API key
2. Create a context for file operations
3. Create a browser session with context synchronization
4. Create test files for upload
5. Upload files to the cloud using the simplified API
6. Download files from the cloud to local storage
7. Track progress during transfers
8. Verify file content integrity
9. Clean up resources properly

Each section of the examples is clearly marked and includes verification steps to ensure operations are working correctly.

## API Reference

For more detailed information on the FileSystem API methods, refer to the SDK documentation.



# Get API Example

This example demonstrates how to use the `get` API to retrieve a session by its ID.

## Description

The `get` API allows you to retrieve a session object by providing its session ID. This is useful when you have a session ID from a previous operation and want to access or manage that session.

## Prerequisites

- Python 3.8 or higher
- Valid API key set in `AGENTBAY_API_KEY` environment variable
- agentbay package installed

## Installation

```bash
pip install agentbay
```

## Usage

```bash
# Set your API key
export AGENTBAY_API_KEY="your-api-key-here"

# Run the example
python main.py
```

## API Reference

### get

```python
def get(session_id: str) -> SessionResult
```

Get a session by its ID.

**Parameters:**
- `session_id` (str): The ID of the session to retrieve

**Returns:**
- `SessionResult`: Result object containing:
  - `success` (bool): Whether the operation succeeded
  - `session` (Session): The Session instance if successful
  - `request_id` (str): The API request ID
  - `error_message` (str): Error message if failed

## Expected Output

```
Creating a session...
Created session with ID: session-xxxxxxxxxxxxx

Retrieving session using Get API...
Successfully retrieved session:
  Session ID: session-xxxxxxxxxxxxx
  Request ID: DAD825FE-2CD8-19C8-BB30-CC3BA26B9398

Session is ready for use

Cleaning up...
Session session-xxxxxxxxxxxxx deleted successfully

Attempting to get the deleted session...
Expected behavior: Cannot retrieve deleted session
Error message: Failed to get session: session not found or has been deleted
```

## Notes

- The session ID must be valid and from an existing session
- The get API internally calls the GetSession API endpoint
- The returned session object can be used for all session operations (commands, files, etc.)
- Always clean up sessions when done to avoid resource waste
- Attempting to get a deleted session will return an error, demonstrating proper lifecycle management

## Error Handling

The `get` method returns a `SessionResult` object with error information:

1. **Empty session_id**: Result will have `success=False`
2. **Non-existent session**: Result will have `success=False`
3. **Deleted session**: Result will have `success=False`



# Label Management Example

This example demonstrates how to use the label management features of the AgentBay SDK for Python.

## Features Demonstrated

- Creating sessions with custom labels
- Getting labels from a session
- Updating labels for a session
- Listing all sessions
- Filtering sessions by labels
- Retrieving label information from filtered sessions

## Running the Example

1. Make sure you have installed the AgentBay SDK:

```bash
pip install wuying-agentbay-sdk
```

2. Set your API key as an environment variable (recommended):

```bash
export AGENTBAY_API_KEY=your_api_key_here
```

3. Run the example:

```bash
python main.py
```

## Code Explanation

The example demonstrates a full lifecycle of label management:

1. Create a session with initial labels
2. Retrieve the labels from the session
3. Create another session with different labels
4. Update the labels for the second session
5. Retrieve the updated labels
6. List all sessions
7. Filter sessions by label criteria
8. Clean up by deleting the sessions

Labels are useful for organizing and categorizing sessions, making it easier to find and manage them. You can use labels to:

- Group sessions by project
- Mark sessions with their purpose
- Tag sessions with version information
- Indicate session status
- Filter sessions based on any criteria

For more details on session management, see the [Session API Reference](../../../../../../../typescript/docs/api/common-features/basics/session.md) and [Session Management Tutorial](../../../../../../../docs/guides/common-features/basics/session-management.md). 



# List Sessions Example

This example demonstrates how to use the `list()` API to query and filter sessions in AgentBay.

## Overview

The `list()` API provides a simple and intuitive interface for querying sessions with optional filtering and pagination support. It's designed to be more user-friendly than the deprecated `list_by_labels()` API.

## Features Demonstrated

This example shows:

1. **List all sessions** - Query all sessions without any filters
2. **Filter by labels** - Query sessions that match specific labels
3. **Multiple label filtering** - Query sessions that match multiple label criteria
4. **Pagination** - Retrieve results page by page
5. **Iterate all pages** - Automatically fetch all results across multiple pages

## Prerequisites

Before running this example, ensure you have:

1. **AgentBay SDK installed**:
   ```bash
   pip install wuying-agentbay-sdk
   ```

2. **API Key configured**:
   ```bash
   export AGENTBAY_API_KEY='your-api-key-here'
   ```

## Running the Example

```bash
cd /path/to/wuying-agentbay-sdk/python/docs/examples/list_sessions
python main.py
```

## API Reference

### Method Signature

```python
def list(
    labels: Optional[Dict[str, str]] = None,
    page: Optional[int] = None,
    limit: Optional[int] = None
) -> SessionListResult
```

### Parameters

- **labels** (Optional[Dict[str, str]]): Labels to filter sessions. All specified labels must match.
  - Default: `None` (no filtering, returns all sessions)
  - Example: `{"project": "demo", "environment": "prod"}`

- **page** (Optional[int]): Page number for pagination, starting from 1.
  - Default: `None` (returns first page)
  - Example: `2` (returns second page)

- **limit** (Optional[int]): Maximum number of items per page.
  - Default: `None` (uses default of 10)
  - Example: `20` (returns up to 20 items per page)

### Return Value

Returns a `SessionListResult` object with:

- **success** (bool): Whether the operation was successful
- **sessions** (List[Session]): List of Session objects matching the filter
- **total_count** (int): Total number of matching sessions
- **next_token** (str): Token for the next page (empty if no more pages)
- **max_results** (int): Maximum results per page
- **request_id** (str): Unique request identifier for tracking
- **error_message** (str): Error message if operation failed

## Use Cases

### 1. Session Inventory
List all sessions to get an overview of your current session inventory.

### 2. Project Management
Find all sessions for a specific project.

### 3. Environment-Specific Queries
Query sessions by environment (dev, staging, prod).

### 4. Bulk Operations
Retrieve all matching sessions and perform batch operations.

## Key Advantages over list_by_labels()

The new `list()` API offers several advantages:

1. **Simpler Interface**: No need to create `ListSessionParams` objects
2. **Intuitive Pagination**: Use familiar `page` and `limit` parameters
3. **Request Tracking**: All responses include `request_id` for debugging
4. **Cleaner Code**: More readable and maintainable code
5. **Type Safety**: Better IDE autocomplete support

## Expected Output

```
‚úÖ AgentBay client initialized

üìù Creating test sessions...
‚úÖ Created session 1: session-xxxxx
   Request ID: xxxxx-xxxxx-xxxxx
‚úÖ Created session 2: session-yyyyy
   Request ID: yyyyy-yyyyy-yyyyy
‚úÖ Created session 3: session-zzzzz
   Request ID: zzzzz-zzzzz-zzzzz

============================================================
Example 1: List all sessions (no filter)
============================================================
‚úÖ Found 15 total sessions
üìÑ Showing 10 sessions on this page
üîë Request ID: req-xxxxx-xxxxx
üìä Max results per page: 10
   1. Session ID: session-xxxxx
   2. Session ID: session-yyyyy
   3. Session ID: session-zzzzz

[... more examples ...]

============================================================
üßπ Cleaning up test sessions...
============================================================
‚úÖ Deleted session: session-xxxxx
   Request ID: req-delete-xxxxx
‚úÖ Deleted session: session-yyyyy
   Request ID: req-delete-yyyyy
‚úÖ Deleted session: session-zzzzz
   Request ID: req-delete-zzzzz

‚ú® Demo completed successfully!
```

## Troubleshooting

### API Key Not Set
```
Error: AGENTBAY_API_KEY environment variable not set
```
**Solution**: Set your API key:
```bash
export AGENTBAY_API_KEY='your-api-key-here'
```

### No Sessions Found
```
Found 0 sessions with specified labels
```
**Solution**: Check that:
1. You have active sessions with the specified labels
2. Label keys and values match exactly (case-sensitive)
3. All specified labels must match (AND logic, not OR)

### Rate Limiting
If you encounter rate limiting, add delays between requests.

## Related Documentation

- [Session Management Guide](../../../../../../../docs/guides/common-features/basics/session-management.md)
- [AgentBay API Reference](../../../../../../../typescript/docs/api/common-features/basics/agentbay.md)
- [Label Management Example](../label_management/README.md)

## Support

For issues or questions:
- GitHub Issues: https://github.com/aliyun/wuying-agentbay-sdk/issues
- Documentation: https://github.com/aliyun/wuying-agentbay-sdk



# MCP Tool Direct Call Example (Python)

This example demonstrates how to list available MCP tools and call them directly using the AgentBay Python SDK.

## Prerequisites

- Python 3.8 or higher
- AgentBay Python SDK installed (`pip install wuying-agentbay-sdk`)
- AgentBay API Key (set as environment variable `AGENTBAY_API_KEY`)

## Running the Example

```bash
# Set your API key
export AGENTBAY_API_KEY=your_api_key_here

# Run the example
cd python/docs/examples/common-features/advanced/mcp_tool_direct_call
python main.py
```

## What This Example Does

1. **Creates a Session**: Initializes an AgentBay session
2. **Lists MCP Tools**: Retrieves all available MCP tools using `session.list_mcp_tools()`
3. **Finds Shell Tool**: Locates the 'shell' tool and displays its details
4. **Calls Shell Tool**: Executes commands using `session.call_mcp_tool()`:
   - Echo command: `echo 'Hello from MCP Tool!'`
   - Directory command: `pwd`
   - Error handling: Invalid command demonstration
5. **Cleanup**: Properly deletes the session

## Expected Output

```
Initializing AgentBay client...

1. Creating session...
‚úì Session created successfully
  Session ID: sess-xxxxx
  Request ID: req-xxxxx

2. Listing available MCP tools...
‚úì Found 69 MCP tools
  Request ID: req-xxxxx

  Available tools (showing first 10):
  1. get_resource
     Description: The command to retrieve a wuying mcp runtime URL...
     Server: mcp-server

  2. system_screenshot
     Description: Captures a full-screen screenshot...
     Server: mcp-server

  ...

3. Finding 'shell' tool details...
‚úì Found 'shell' tool
  Description: Executes an shell command with timeout...
  Server: wuying_shell
  Input Schema:
    {
      "type": "object",
      "required": ["command", "timeout_ms"],
      "properties": {
        "command": {
          "type": "string",
          "description": "client input command"
        },
        "timeout_ms": {
          "type": "integer",
          "default": 1000,
          "description": "Command execution timeout (unit: milliseconds)..."
        }
      }
    }

4. Calling 'shell' tool...
‚úì Tool call successful
  Request ID: req-xxxxx
  Output:
    Hello from MCP Tool!

5. Calling 'shell' tool with different command...
‚úì Tool call successful
  Request ID: req-xxxxx
  Current directory:
    /home/wuying

6. Demonstrating error handling (invalid command)...
‚úì Error handled correctly
  Request ID: req-xxxxx
  Error message: Execution failed. Error code:127 Error message: sh: 1: this_command_does_not_exist_12345: not found

7. Cleaning up...
‚úì Session deleted successfully
  Request ID: req-xxxxx

============================================================
Example completed successfully!
============================================================
```

## Key API Methods

### `session.list_mcp_tools()`

Lists all available MCP tools for the session.

**Returns:** `McpToolsResult` containing:
- `tools`: List of `McpTool` objects
- `request_id`: API request identifier

### `session.call_mcp_tool(tool_name, args)`

Calls an MCP tool directly.

**Parameters:**
- `tool_name` (str): Name of the MCP tool
- `args` (dict): Tool arguments

**Returns:** `McpToolResult` containing:
- `success` (bool): Whether the call succeeded
- `data` (str): Tool output
- `error_message` (str): Error message if failed
- `request_id` (str): API request identifier

## Use Cases

This direct MCP tool calling approach is useful when you need to:

1. **Discover Available Tools**: List all tools before deciding which to use
2. **Call Tools Directly**: Bypass module-specific wrappers for direct access
3. **Custom Tool Integration**: Build custom workflows with any available tool
4. **Tool Exploration**: Inspect tool schemas and test different arguments

## Related Documentation

- [Session API Reference](../../../../../../docs/api/sync/session.md)
- [Common Features Guide](../../../../../../../docs/guides/common-features/README.md)





# Session Creation and Management Example

This example demonstrates comprehensive session creation and management using the Wuying AgentBay SDK. It covers various session types and configurations:

## Features Demonstrated

### 1. Basic Session Management
- Initializing the AgentBay client
- Creating a session with default parameters
- Listing all available sessions
- Deleting sessions
- Verifying session deletion

### 2. Session with Labels
- Creating sessions with custom labels for organization
- Retrieving and displaying session labels
- Using labels for project management and environment tracking

### 3. Context-Enabled Sessions
- Creating sessions with predefined contexts
- Context synchronization during session creation
- Managing persistent data across sessions

### 4. Context Synchronization
- Advanced context management with multiple contexts
- Listing and managing synchronized contexts
- Understanding context states and availability

### 5. Browser Context Sessions
- Creating sessions with browser-specific contexts
- Persistent browser data (cookies, localStorage, etc.)
- Context synchronization on session deletion

### 6. Mobile Configuration Sessions 
- Creating mobile sessions with app management rules
- Resolution Control: Locking screen resolution for consistent testing
- Package Management: Configuring allowed app packages
- Mobile-specific session parameters and cleanup


This example is useful for understanding the complete session lifecycle, advanced configuration options, and mobile-specific session management.

## Running the Example

```bash
cd session_creation
python main.py
```

Make sure you have set the `AGENTBAY_API_KEY` environment variable or replace the placeholder in the code with your actual API key.




# Computer Use Examples

This directory contains examples demonstrating Windows desktop automation capabilities in AgentBay SDK.

## Overview

Computer Use environment (`windows_latest` image) provides cloud-based Windows desktop automation with:
- Application management (start, stop, list)
- Window operations (maximize, minimize, resize, close)
- Focus management
- Desktop UI automation workflows
- Process monitoring

## Examples

### windows_app_management_example.py

Comprehensive Windows application management example demonstrating:

1. **Finding Installed Applications**
   - Discover all applications in Windows start menu
   - Filter system applications
   - Search for specific applications

2. **Launching Applications**
   - Start applications by command
   - Monitor spawned processes
   - Track process IDs

3. **Monitoring Running Applications**
   - List currently visible applications
   - Get application window information
   - Track application states

4. **Stopping Applications**
   - Stop by process ID (PID)
   - Stop by process name
   - Graceful termination

## Prerequisites

- Python 3.8 or later
- AgentBay SDK installed: `pip install wuying-agentbay-sdk`
- Valid `AGENTBAY_API_KEY` environment variable

## Quick Start

```bash
# Set your API key
export AGENTBAY_API_KEY=your_api_key_here

# Run the example
cd computer
python windows_app_management_example.py
```

## Features Demonstrated

### Application Discovery
- Find installed applications in start menu
- Filter system applications
- Search by application name
- Get application start commands

### Process Management
- Start applications by command
- Monitor process creation
- Track process IDs and names
- List visible applications with windows

### Application Control
- Stop applications by PID
- Stop applications by process name
- Graceful vs forceful termination
- Error handling for process operations

### Window Operations
- List all windows
- Focus specific windows
- Maximize/minimize windows
- Close windows
- Get window information

## API Methods Used

| Method | Purpose |
|--------|---------|
| `session.computer.get_installed_apps()` | Get list of installed applications |
| `session.computer.start_app()` | Start an application |
| `session.computer.list_visible_apps()` | List currently visible applications |
| `session.computer.stop_app_by_pid()` | Stop application by process ID |
| `session.computer.stop_app_by_pname()` | Stop application by process name |
| `session.window.list_windows()` | List all windows |
| `session.window.focus_window()` | Focus a specific window |
| `session.window.maximize_window()` | Maximize a window |
| `session.window.minimize_window()` | Minimize a window |
| `session.window.close_window()` | Close a window |
| `session.ui.screenshot()` | Take a screenshot |
| `session.ui.click()` | Click at coordinates |
| `session.ui.type()` | Type text |
| `session.ui.key()` | Send keyboard key |

## Common Use Cases

### 1. Automated Testing
- Start application and wait for window
- Interact with UI elements
- Verify results with screenshots

### 2. Application Monitoring
- Monitor running applications
- Track application lifecycle
- Performance monitoring

### 3. Automated Workflows
- Open applications in sequence
- Perform data entry tasks
- Generate reports and save files

## Best Practices

1. **Wait for Application Load**: Add delays after starting applications
2. **Error Handling**: Always check `result.success` before proceeding
3. **Resource Cleanup**: Stop applications and delete sessions when done
4. **Process Identification**: Use PIDs for reliable process management
5. **Retry Logic**: Implement retries for resource creation delays
6. **Window Focus**: Ensure window has focus before UI interactions
7. **Screenshot Verification**: Use screenshots to verify UI state

## Related Documentation

- [Computer Use Guide](../../../../../docs/guides/computer-use/README.md)
- [Computer Application Management](../../../../../docs/guides/computer-use/computer-application-management.md)
- [Computer UI Automation](../../../../../docs/guides/computer-use/computer-ui-automation.md)
- [Window Management](../../../../../docs/guides/computer-use/window-management.md)

## Troubleshooting

### Resource Creation Delay

If you see "Resource creation in progress" message:
- Wait 90 seconds and retry
- This is normal for Windows session initialization
- Consider session pooling for production

### Application Not Found

If application is not in the list:
- Check application is installed in start menu
- Try using full path to executable
- Verify application name spelling

### Application Won't Start

If application fails to start:
- Verify start command is correct
- Check application permissions
- Ensure application is compatible with Windows version
- Review application dependencies

### Window Operations Fail

If window operations don't work:
- Verify window handle is valid
- Check window still exists
- Ensure window is not minimized (for some operations)
- Wait for window to be ready

### UI Automation Issues

If UI interactions fail:
- Take screenshot to verify UI state
- Ensure window has focus
- Add delays between actions
- Verify coordinates are correct
- Check for popup dialogs blocking interaction



# Windows Application Management Example

This example demonstrates how to use the AgentBay SDK to manage desktop applications on Windows.

## Overview

The example shows a complete workflow:

1. **Find installed applications** - Discover all applications available in the Windows environment
2. **Launch an application** - Start Notepad as an example
3. **Monitor running applications** - List currently visible applications with windows
4. **Stop the application** - Gracefully terminate the running application

## Prerequisites

- Python 3.7+
- AgentBay SDK
- Valid `AGENTBAY_API_KEY` environment variable

## Installation

```bash
# Create virtual environment
python3 -m venv venv

# Activate virtual environment
# On macOS/Linux:
source venv/bin/activate
# On Windows:
# venv\Scripts\activate

# Install AgentBay SDK
pip install -e /path/to/wuying-agentbay-sdk/python
```

## Usage

```bash
# Set your API key
export AGENTBAY_API_KEY="your_api_key_here"

# Run the example
python windows_app_management_example.py
```

## What the Example Does

### Step 1: Finding Installed Applications

```python
apps_result = session.computer.get_installed_apps(
    start_menu=True,
    desktop=False,
    ignore_system_apps=True
)
```

Discovers all installed applications in the Windows start menu, filtering out system apps.

### Step 2: Finding Target Application

Searches for Notepad in the list of installed applications. Falls back to the default Windows path if not found.

### Step 3: Launching Application

```python
start_result = session.computer.start_app(notepad_cmd)
```

Starts Notepad and returns information about all spawned processes.

### Step 4: Monitoring Running Applications

```python
visible_result = session.computer.list_visible_apps()
```

Lists all applications with visible windows currently running.

### Step 5: Stopping Application

```python
# Method 1: Stop by Process ID
stop_result = session.computer.stop_app_by_pid(pid)

# Method 2: Stop by Process Name (fallback)
stop_result = session.computer.stop_app_by_pname(process_name)
```

Attempts to stop the application, first by PID, then by process name if needed.

## Expected Output

```
================================================================================
Windows Application Management Example
================================================================================

Initializing AgentBay client...
‚úÖ Client initialized

Creating Windows session...
  Attempt 1/2...
‚úÖ Session created: session-xxxxxxxxxxxxxxxxx

================================================================================
Step 1: Finding installed applications...
================================================================================
‚úÖ Found 120 installed applications

First 5 applications:

1. Notepad
   Start Command: C:\Windows\System32\notepad.exe

2. Paint
   Start Command: C:\Windows\System32\mspaint.exe

...

================================================================================
Step 2: Finding Notepad application...
================================================================================
‚úÖ Found application: Notepad
Start Command: C:\Windows\System32\notepad.exe

================================================================================
Step 3: Launching application...
================================================================================
‚úÖ Application started with 1 process(es)
  - notepad.exe (PID: 12345)
    Command: C:\Windows\System32\notepad.exe

================================================================================
Step 4: Waiting for application to load...
================================================================================
Waiting 5 seconds...
‚úÖ Wait complete

================================================================================
Step 5: Checking running applications...
================================================================================
‚úÖ Found 1 visible application(s)
  - notepad.exe (PID: 12345)

================================================================================
Step 6: Stopping application...
================================================================================
Attempting to stop process by PID: 12345
‚úÖ Application stopped successfully (by PID)

================================================================================
Workflow Summary
================================================================================
‚úÖ Session creation: Success
‚úÖ Get installed apps: 120 applications found
‚úÖ Find target app: Found
‚úÖ Start application: 1 processes started
‚úÖ List visible apps: 1 visible applications
‚úÖ Stop application: Success
================================================================================

üéâ Workflow completed successfully!

================================================================================
Cleaning up session...
================================================================================
‚úÖ Session deleted
```

## Features Demonstrated

- **Session Management**: Creating and cleaning up Windows sessions
- **Application Discovery**: Finding installed desktop applications
- **Process Management**: Starting and stopping applications
- **Process Monitoring**: Listing visible applications
- **Error Handling**: Robust error handling with fallback strategies
- **Retry Logic**: Automatic retry for resource creation delays

## API Methods Used

| Method | Purpose |
|--------|---------|
| `session.computer.get_installed_apps()` | Get list of installed applications |
| `session.computer.start_app()` | Start an application |
| `session.computer.list_visible_apps()` | List currently visible applications |
| `session.computer.stop_app_by_pid()` | Stop application by process ID |
| `session.computer.stop_app_by_pname()` | Stop application by process name |

## Troubleshooting

### Resource Creation Delay

If you see "Resource creation in progress" message, the script will automatically wait and retry. This is normal for Windows sessions.

### Application Not Found

The example uses Notepad which is available on all Windows systems. If you want to use a different application:

1. Run the example once to see the list of available applications
2. Modify the code to search for your target application
3. Update the start command accordingly

## Related Documentation

- [Computer Application Management Guide](../../../../../../docs/guides/computer-use/computer-application-management.md)
- [Session Management](../../../../../../docs/guides/common-features/basics/session-management.md)
- [Computer UI Automation](../../../../../../docs/guides/computer-use/computer-ui-automation.md)

## License

This example is part of the Wuying AgentBay SDK.




# Mobile Use Examples

This directory contains examples demonstrating mobile UI automation capabilities in AgentBay SDK.

## Overview

Mobile Use environment (`mobile_latest` image) provides cloud-based Android mobile automation with:
- UI element detection and interaction
- Touch gestures (tap, swipe, scroll)
- Text input and key events
- Screenshot capture
- Mobile application management
- ADB (Android Debug Bridge) integration

## Examples

### mobile_system/main.py

Comprehensive mobile automation example demonstrating:

1. **Application Management**
   - Get installed applications
   - Start applications
   - Stop applications
   - Application state monitoring

2. **UI Element Detection**
   - Get clickable UI elements
   - Get all UI elements (tree structure)
   - Element property inspection

3. **Touch Interactions**
   - Tap at coordinates
   - Swipe gestures
   - Multi-touch operations

4. **Text Input**
   - Input text to focused elements
   - Send key events
   - Keyboard operations

5. **Screenshot Capture**
   - Capture mobile screen
   - Save screenshots locally

### mobile_get_adb_url_example.py

ADB URL retrieval example:
- Get ADB connection URL
- Connect external tools to mobile session
- Remote debugging setup

## Prerequisites

- Python 3.8 or later
- AgentBay SDK installed: `pip install wuying-agentbay-sdk`
- Valid `AGENTBAY_API_KEY` environment variable

## Quick Start

```bash
# Set your API key
export AGENTBAY_API_KEY=your_api_key_here

# Run the main example
cd mobile_system
python main.py

# Run ADB URL example
cd ..
python mobile_get_adb_url_example.py
```

## Features Demonstrated

### Application Management
- List installed applications
- Filter system applications
- Start applications with monkey command
- Start with specific activity
- Stop applications by command
- Monitor application processes

### UI Element Detection
- Get clickable elements only
- Get complete UI element tree
- Element property inspection
- Resource ID and text extraction
- Hierarchical element structure

### Touch Interactions
- Single tap at coordinates
- Long press
- Swipe gestures with duration
- Multi-point touch
- Drag and drop

### Text Input
- Input text to focused elements
- Send individual key events
- Special keys (HOME, BACK, etc.)
- Keyboard shortcuts

### Screenshot Operations
- Capture full screen
- Save to local file
- Base64 encoding support
- Image format handling

## API Methods Used

| Method | Purpose |
|--------|---------|
| `session.mobile.get_installed_apps()` | Get list of installed applications |
| `session.mobile.start_app()` | Start an application |
| `session.mobile.stop_app_by_cmd()` | Stop application by command |
| `session.mobile.get_clickable_ui_elements()` | Get clickable UI elements |
| `session.mobile.get_all_ui_elements()` | Get complete UI element tree |
| `session.mobile.tap()` | Tap at coordinates |
| `session.mobile.swipe()` | Perform swipe gesture |
| `session.mobile.input_text()` | Input text |
| `session.mobile.send_key()` | Send key event |
| `session.mobile.screenshot()` | Take screenshot |
| `session.mobile.get_adb_url()` | Get ADB connection URL |

## Common Use Cases

### 1. App Testing Automation
- Start app and wait for load
- Get UI elements and find target elements
- Input credentials and submit forms
- Verify results with screenshots

### 2. UI Element Inspection
- Get all elements and find specific elements by text
- Navigate UI hierarchy
- Extract element properties

### 3. Gesture Automation
- Swipe up/down for scrolling
- Swipe left/right for navigation
- Long press for context menus

## Best Practices

1. **Wait for UI Load**: Add delays after starting apps or navigation
2. **Element Verification**: Verify elements exist before interaction
3. **Error Handling**: Check `result.success` for all operations
4. **Resource Cleanup**: Stop apps and delete sessions when done
5. **Screenshot Verification**: Use screenshots to verify UI state
6. **Coordinate Accuracy**: Use element coordinates from UI tree
7. **Gesture Timing**: Adjust swipe duration for different effects
8. **Key Events**: Use appropriate key codes for device buttons

## Related Documentation

- [Mobile Use Guide](../../../../../docs/guides/mobile-use/README.md)
- [Mobile Application Management](../../../../../docs/guides/mobile-use/mobile-application-management.md)
- [Mobile UI Automation](../../../../../docs/guides/mobile-use/mobile-ui-automation.md)

## Troubleshooting

### Application Not Starting

If application fails to start:
- Verify package name is correct
- Check application is installed
- Ensure monkey command syntax is correct
- Try with specific activity

### UI Elements Not Found

If UI elements are missing:
- Wait longer for UI to load
- Check timeout parameter
- Verify app is in correct state
- Take screenshot to inspect UI

### Touch Interactions Not Working

If taps/swipes don't work:
- Verify coordinates are within screen bounds
- Check element is visible and enabled
- Ensure no overlay blocking interaction
- Add delay before interaction

### ADB Connection Issues

If ADB URL doesn't work:
- Verify session is mobile_latest image
- Check network connectivity
- Ensure ADB is installed locally
- Try reconnecting: `adb disconnect` then `adb connect`

### Screenshot Issues

If screenshots fail or are corrupted:
- Check session is active
- Verify sufficient memory
- Try smaller screen resolution
- Handle base64 decoding correctly



# Mobile System Example

This example demonstrates how to use the mobile system features of the AgentBay SDK for Python.

## Features Demonstrated

- Creating a session with a mobile image
- Getting installed applications
- Starting and stopping applications
- Getting clickable UI elements
- Getting all UI elements with hierarchy information
- Sending key events
- Input text
- Swipe screen gestures
- Click screen operations
- Taking screenshots
- Starting applications with specific activities

## Running the Example

1. Make sure you have installed the AgentBay SDK:

```bash
pip install wuying-agentbay-sdk
```

2. Set your API key as an environment variable (recommended):

```bash
export AGENTBAY_API_KEY=your_api_key_here
```

3. Run the example:

```bash
python main.py
```

## Code Explanation

The example demonstrates mobile system operations:

1. Create a new session with a mobile image
2. Get a list of installed applications
3. Start an application using a package name
4. Stop an application
5. Interact with the UI using various methods:
   - Get clickable UI elements
   - Get all UI elements with their hierarchy
   - Send key events (HOME key)
   - Input text
   - Perform swipe gestures
   - Perform click operations
6. Take screenshots
7. Start an application with a specific activity
8. Clean up by deleting the session

Mobile system features are particularly useful for:

- Mobile application testing
- Automated UI testing
- Creating mobile app demos
- Building mobile app automation tools
- Implementing mobile device control applications

For more details on mobile system features, see the [Application API Reference](../../../../../docs/api/sync/computer.md) and [UI API Reference](../../../../../docs/api/sync/mobile.md).




# Migration Guide

Migrate from AgentBay Python SDK v0.12.x to v0.13.0+ with sync/async separated architecture.

## Overview

**Version Change**: v0.12.0 ‚Üí v0.13.0+

In v0.12.x and earlier, the SDK used async APIs extensively. Starting from v0.13.0, the SDK provides separate sync (`AgentBay`) and async (`AsyncAgentBay`) APIs.

**Migration scope**: 69 async methods across 26 files need updating.

## Quick Migration Steps

### 1. Import Changes

**Key Change**: The import structure has been completely refactored from a single API to a dual sync/async API system.

```python
# Before (v0.12.x) - Single API, flat module structure
from agentbay import AgentBay, Config, Session, Command
# Only one AgentBay class, was async-based

# After (v0.13.0+) - Dual API, unified imports
from agentbay import AgentBay, AsyncAgentBay  # Two separate APIs
from agentbay import Session, AsyncSession    # Separate sync/async classes
from agentbay import Browser, AsyncBrowser    # All modules have both versions
```

### 2. Choose Your API

**For scripts/CLI**: Use sync API
```python
# Before (v0.12.x)
from agentbay import AgentBay
async with AgentBay() as agent_bay:
    # operations

# After (v0.13.0+)
from agentbay import AgentBay
agent_bay = AgentBay()
# operations
```

**For web servers**: Use async API
```python
# Before (v0.12.x)
from agentbay import AgentBay
async with AgentBay() as agent_bay:
    # operations

# After (v0.13.0+)
from agentbay import AsyncAgentBay
agent_bay = AsyncAgentBay()
# operations (still async)
```

### 2. Method Name Changes

Remove `_async` suffix from all method names:

```python
# Before (v0.12.x)
await session.browser.agent.navigate_async(url)
await session.command.execute_command("ls")

# After (v0.13.0+ sync)
session.browser.agent.navigate(url)
session.command.execute_command("ls")

# After (v0.13.0+ async)
await session.browser.agent.navigate(url)
await session.command.execute_command("ls")
```

## Module Import Mapping

### Core Modules
```python
# v0.12.x (flat structure)
from agentbay import AgentBay, Session, Command, Computer, Mobile

# v0.13.0+ (unified imports with sync/async variants)
from agentbay import (
    AgentBay, AsyncAgentBay,           # Main client classes
    Session, AsyncSession,             # Session management
    Command, AsyncCommand,             # Command execution
    Computer, AsyncComputer,           # Computer automation
    Mobile, AsyncMobile,               # Mobile automation
    Browser, AsyncBrowser,             # Browser automation
    FileSystem, AsyncFileSystem,       # File operations
    Agent, AsyncAgent,                 # AI agent functionality
)
```

### Shared Components (No Change)
```python
# These imports remain the same
from agentbay import (
    Config, AgentBayError, APIError,
    CreateSessionParams, ListSessionParams,
    ContextSync, SyncPolicy, UploadPolicy
)
```

## Complete Method Mapping

### Core Session Methods
```python
# v0.12.x ‚Üí v0.13.0+
pause_async() ‚Üí pause()
resume_async() ‚Üí resume()
get_link_async() ‚Üí get_link()
```

### Browser Methods
```python
# v0.12.x ‚Üí v0.13.0+
initialize_async() ‚Üí initialize()
navigate_async() ‚Üí navigate()
screenshot_async() ‚Üí screenshot()
act_async() ‚Üí act()
observe_async() ‚Üí observe()
extract_async() ‚Üí extract()
close_async() ‚Üí close()
```

### File System Methods
```python
# v0.12.x ‚Üí v0.13.0+
upload_async() ‚Üí upload()
download_async() ‚Üí download()
```



## Error Handling Changes

### Sync API
```python
# Current sync approach
result = session.command.execute_command("ls")
if result.success:
    print(result.output)
else:
    print(f"Error: {result.error_message}")
```

### Async API
```python
# Current async approach
result = await session.command.execute_command("ls")
if result.success:
    print(result.output)
else:
    print(f"Error: {result.error_message}")
```

## Context Manager Changes

### v0.12.x Version
```python
# Context manager approach (deprecated in v0.13.0+)
async with AgentBay() as agent_bay:
    session = await agent_bay.create(params)
```

### v0.13.0+ Version
```python
# Sync approach
agent_bay = AgentBay()
result = agent_bay.create(params)
session = result.session
# ... use session
agent_bay.delete(session)

# Async approach
agent_bay = AsyncAgentBay()
result = await agent_bay.create(params)
session = result.session
# ... use session
await agent_bay.delete(session)
```

## Common Migration Patterns

### Pattern 1: Simple Script Migration
```python
# Before (v0.12.x)
import asyncio
from agentbay import AgentBay

async def main():
    async with AgentBay() as agent_bay:
        session = await agent_bay.create(params)
        result = await session.command.execute_command("ls")
        print(result.output)

asyncio.run(main())

# After (v0.13.0+ sync)
from agentbay import AgentBay

agent_bay = AgentBay()
result = agent_bay.create(params)
session = result.session
result = session.command.execute_command("ls")
print(result.output)
agent_bay.delete(session)
```

### Pattern 2: Web Server Migration
```python
# Before (v0.12.x)
async def handle_request():
    async with AgentBay() as agent_bay:
        session = await agent_bay.create(params)
        result = await session.command.execute_command(cmd)
        return result.output

# After (v0.13.0+ async)
async def handle_request():
    agent_bay = AsyncAgentBay()
    result = await agent_bay.create(params)
    session = result.session
    result = await session.command.execute_command(cmd)
    await agent_bay.delete(session)
    return result.output
```

## Validation Steps

After migration:

1. **Remove all `_async` suffixes** from method names
2. **Update imports** (`AgentBay` for sync, `AsyncAgentBay` for async)
3. **Test basic operations** (create session, run command, delete session)
4. **Verify error handling** uses `result.success` pattern
5. **Check context management** follows new patterns

## Notes

- **File operations** remain synchronous in both APIs
- **API compatibility** maintained except for async/sync differences
- **New features** available in current version not in backup
- **Performance** may differ due to architectural changes

For API comparison, see [Sync vs Async Guide](sync-vs-async.md).



# Synchronous vs Asynchronous Guide

This guide explains the differences between synchronous and asynchronous programming patterns in the AgentBay Python SDK.

## Overview

The AgentBay Python SDK provides both synchronous and asynchronous APIs to accommodate different use cases and programming styles.

## When to Use Synchronous API

Use the synchronous API (`AgentBay`) for:
- Simple scripts and CLI tools
- Learning and experimentation
- Sequential operations where concurrency is not needed

## When to Use Asynchronous API

Use the asynchronous API (`AsyncAgentBay`) for:
- Web servers (FastAPI, Django)
- High-concurrency applications
- Applications that need to handle multiple sessions simultaneously

## Code Examples

### Synchronous Example

```python
from agentbay import AgentBay, CreateSessionParams

# Create client
agentbay = AgentBay(api_key="your_api_key")

# Create session
result = agentbay.create(CreateSessionParams())
session = result.session

# Use session
session.command.run("echo 'Hello World'")

# Cleanup
session.delete()
```

### Asynchronous Example

```python
import asyncio
from agentbay import AsyncAgentBay, CreateSessionParams

async def main():
    # Create client
    agentbay = AsyncAgentBay(api_key="your_api_key")
    
    # Create session
    result = await agentbay.create(CreateSessionParams())
    session = result.session
    
    # Use session
    await session.command.run("echo 'Hello World'")
    
    # Cleanup
    await session.delete()

# Run async function
asyncio.run(main())
```

## Key Differences

| Aspect | Synchronous | Asynchronous |
|--------|-------------|--------------|
| Import | `from agentbay import AgentBay` | `from agentbay import AsyncAgentBay` |
| Method calls | `session.command.run()` | `await session.command.run()` |
| Error handling | Standard try/except | Async try/except |
| Concurrency | Sequential | Concurrent with asyncio |

## Migration Guide

To migrate from synchronous to asynchronous code:

1. Change imports from `AgentBay` to `AsyncAgentBay`
2. Add `async` keyword to function definitions
3. Add `await` keyword before SDK method calls
4. Use `asyncio.run()` to execute the main function

For migrating from backup versions or between sync/async, see [Migration Guide](migration-guide.md).




# Typescript SDK Documentation


# AgentBay SDK for TypeScript

> Execute commands, manipulate files, and run code in cloud environments

## üì¶ Installation

```bash
npm install wuying-agentbay-sdk
```

## üöÄ Prerequisites

Before using the SDK, you need to:

1. Register an Alibaba Cloud account: [https://aliyun.com](https://aliyun.com)
2. Get API credentials: [AgentBay Console](https://agentbay.console.aliyun.com/service-management)
3. Set environment variable: `export AGENTBAY_API_KEY=your_api_key`

## üöÄ Quick Start
```typescript
import { AgentBay } from 'wuying-agentbay-sdk';

async function main() {
    // Create session
    const agentBay = new AgentBay();
    const result = await agentBay.create();
    // Verified: ‚úì Client initialized and session created successfully

    if (result.success) {
        const session = result.session;

        // Execute command
        const cmdResult = await session.command.executeCommand("ls -la");
        console.log(cmdResult.output);
        // Verified: ‚úì Command executed successfully
        // Sample output: "ÊÄªËÆ° 100\ndrwxr-x--- 16 wuying wuying 4096..."

        // File operations
        await session.fileSystem.writeFile("/tmp/test.txt", "Hello World");
        const content = await session.fileSystem.readFile("/tmp/test.txt");
        console.log(content.content);
        // Verified: ‚úì File written and read successfully
        // Output: "Hello World"
    }
}

main().catch(console.error);
```

## üìñ Complete Documentation

### üÜï New Users
- [üìö Quick Start Tutorial](https://github.com/aliyun/wuying-agentbay-sdk/tree/main/docs/quickstart/README.md) - Get started in 5 minutes
- [üéØ Core Concepts](https://github.com/aliyun/wuying-agentbay-sdk/tree/main/docs/quickstart/basic-concepts.md) - Understanding cloud environments and sessions

### üöÄ Experienced Users
**Choose Your Cloud Environment:**
- üåê [Browser Use](https://github.com/aliyun/wuying-agentbay-sdk/tree/main/docs/guides/browser-use/README.md) - Web scraping, browser testing, form automation
- üñ•Ô∏è [Computer Use](https://github.com/aliyun/wuying-agentbay-sdk/tree/main/docs/guides/computer-use/README.md) - Windows desktop automation, UI testing
- üì± [Mobile Use](https://github.com/aliyun/wuying-agentbay-sdk/tree/main/docs/guides/mobile-use/README.md) - Android UI testing, mobile app automation
- üíª [CodeSpace](https://github.com/aliyun/wuying-agentbay-sdk/tree/main/docs/guides/codespace/README.md) - Code execution, development environments

**Additional Resources:**
- [üìñ Feature Guides](https://github.com/aliyun/wuying-agentbay-sdk/tree/main/docs/guides/README.md) - Complete feature introduction
- [üîß TypeScript API Reference](docs/api/README.md) - Detailed API documentation
- [üíª TypeScript Examples](docs/examples/README.md) - Complete example code
- [üìã Logging Configuration](https://github.com/aliyun/wuying-agentbay-sdk/tree/main/docs/guides/common-features/configuration/logging.md) - Configure logging levels and output

### üÜò Need Help
- [üîß TypeScript API Reference](docs/api/README.md) - Local API documentation
- [üí° TypeScript Examples](docs/examples/README.md) - Local example code

## üîß Core Features Quick Reference

### Session Management
```typescript
// Create session
const session = (await agentBay.create()).session;
// Verified: ‚úì Session created successfully
```

### File Operations
```typescript
// Read and write files
await session.fileSystem.writeFile("/path/file.txt", "content");
const content = await session.fileSystem.readFile("/path/file.txt");
// Verified: ‚úì File operations work correctly
// content.content contains the file's text content

// List directory
const files = await session.fileSystem.listDirectory("/path");
// Verified: ‚úì Returns list of file/directory information
```

### Command Execution
```typescript
// Execute command
const result = await session.command.executeCommand("node script.js");
console.log(result.output);
// Verified: ‚úì Command executed successfully
// result.output contains the command's stdout
```

### Data Persistence
```typescript
// Create context
const context = (await agentBay.context.get("my-project", true)).context;
// Verified: ‚úì Context created or retrieved successfully

// Create session with context
import { ContextSync, SyncPolicy } from 'wuying-agentbay-sdk';
const contextSync = new ContextSync({
    contextId: context.id,
    path: "/tmp/data",
    policy: SyncPolicy.default()
});
const session = (await agentBay.create({ contextSync: [contextSync] })).session;
// Verified: ‚úì Session created with context synchronization
// Data in /tmp/data will be synchronized to the context
```

## üÜò Get Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Complete Documentation](https://github.com/aliyun/wuying-agentbay-sdk/tree/main/docs/README.md)

## üìÑ License

This project is licensed under the Apache License 2.0 - see the [LICENSE](../LICENSE) file for details.



# TypeScript SDK API Reference

These documents are generated automatically using TypeDoc. Run `npm run docs:generate` to refresh them after changing the SDK.

## Structure
- `browser-use`
  - browser.md
  - extension.md
- `codespace`
  - code.md
- `common-features/advanced`
  - agent.md
  - oss.md
- `common-features/basics`
  - agentbay.md
  - command.md
  - context-manager.md
  - context-sync.md
  - context.md
  - filesystem.md
  - logging.md
  - session.md
- `computer-use`
  - computer.md
- `mobile-use`
  - mobile.md




# Class: Browser

## üåê Related Tutorial

- [Browser Use Guide](../../../../docs/guides/browser-use/README.md) - Complete guide to browser automation

## Overview

The Browser module provides comprehensive browser automation capabilities including navigation, element interaction,
screenshot capture, and content extraction. It enables automated testing and web scraping workflows.


## Requirements

- Requires `browser_latest` image for browser automation features

## Table of contents


### Properties


### Methods

- [destroy](#destroy)
- [initialize](#initialize)
- [initializeAsync](#initializeasync)
- [isInitialized](#isinitialized)
- [screenshot](#screenshot)

## Properties

```typescript
agent: ``BrowserAgent``
```


## Methods

### destroy

‚ñ∏ **destroy**(): `Promise`\<`void`\>

Destroy the browser instance.

#### Returns

`Promise`\<`void`\>

### initialize

‚ñ∏ **initialize**(`option`): `boolean`

Initialize the browser instance with the given options.
Returns true if successful, false otherwise.

#### Parameters

| Name | Type |
| :------ | :------ |
| `option` | ``BrowserOption`` \| ``BrowserOptionClass`` |

#### Returns

`boolean`

___

### initializeAsync

‚ñ∏ **initializeAsync**(`option`): `Promise`\<`boolean`\>

Initialize the browser instance with the given options asynchronously.
Returns true if successful, false otherwise.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `option` | ``BrowserOption`` \| ``BrowserOptionClass`` | Browser configuration options |

#### Returns

`Promise`\<`boolean`\>

Promise resolving to true if successful, false otherwise

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'browser_latest' });
if (result.success) {
  const success = await result.session.browser.initializeAsync(new BrowserOptionClass());
  console.log('Browser initialized:', success);
  await result.session.delete();
}
```

___

### isInitialized

‚ñ∏ **isInitialized**(): `boolean`

Returns true if the browser was initialized, false otherwise.

#### Returns

`boolean`

___

### screenshot

‚ñ∏ **screenshot**(`page`, `fullPage?`, `options?`): `Promise`\<`Uint8Array`\>

Takes a screenshot of the specified page with enhanced options and error handling.
This method requires the caller to connect to the browser via Playwright or similar
and pass the page object to this method.

Note: This is a placeholder method that indicates where screenshot functionality
should be implemented. In a complete implementation, this would use Playwright's
page.screenshot() method or similar browser automation API.

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `page` | `any` | `undefined` | The Playwright Page object to take a screenshot of. This is a required parameter. |
| `fullPage` | `boolean` | `false` | Whether to capture the full scrollable page. Defaults to false. |
| `options` | `Record`\<`string`, `any`\> | `{}` | Additional screenshot options that will override defaults. Common options include: - type: Image type, either 'png' or 'jpeg' (default: 'png') - quality: Quality of the image, between 0-100 (jpeg only) - timeout: Maximum time in milliseconds (default: 60000) - animations: How to handle animations (default: 'disabled') - caret: How to handle the caret (default: 'hide') - scale: Scale setting (default: 'css') |

#### Returns

`Promise`\<`Uint8Array`\>

Screenshot data as Uint8Array.

**`Throws`**

BrowserError If browser is not initialized.

**`Throws`**

Error If screenshot capture fails.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'browser_latest' });
if (result.success) {
  await result.session.browser.initializeAsync(new BrowserOptionClass());
  const browser = await chromium.connectOverCDP(await result.session.browser.getEndpointUrl());
  const page = await browser.contexts()[0].newPage();
  await page.goto('https://example.com');
  const screenshot = await result.session.browser.screenshot(page);
  await writeFile('screenshot.png', Buffer.from(screenshot));
  await browser.close();
  await result.session.delete();
}
```

## Best Practices

1. Wait for page load completion before interacting with elements
2. Use appropriate selectors (CSS, XPath) for reliable element identification
3. Handle navigation timeouts and errors gracefully
4. Take screenshots for debugging and verification
5. Clean up browser resources after automation tasks


## Related Resources

- [Session API Reference](../common-features/basics/session.md)





# Class: ExtensionsService

## üß© Related Tutorial

- [Browser Extensions Guide](../../../../docs/guides/browser-use/core-features/extension.md) - Learn how to use browser extensions

Provides methods to manage user browser extensions.
This service integrates with the existing context functionality for file operations.

**Usage** (Simplified - Auto-detection):
```typescript
// Service automatically detects if context exists and creates if needed
const extensionsService = new ExtensionsService(agentBay, "browser_extensions");

// Or use with empty contextId to auto-generate context name
const extensionsService = new ExtensionsService(agentBay);  // Uses default generated name

// Use the service immediately - initialization happens automatically
const extension = await extensionsService.create("/path/to/plugin.zip");
```

**Integration with ExtensionOption (Simplified)**:
```typescript
// Create extensions and configure for browser sessions
const extensionsService = new ExtensionsService(agentBay, "my_extensions");
const ext1 = await extensionsService.create("/path/to/ext1.zip");
const ext2 = await extensionsService.create("/path/to/ext2.zip");

// Create extension option for browser integration (no contextId needed!)
const extOption = extensionsService.createExtensionOption([ext1.id, ext2.id]);

// Use with BrowserContext for session creation
const browserContext = new BrowserContext({
  contextId: "browser_session",
  autoUpload: true,
  extensionOption: extOption  // All extension config encapsulated
});
```

**Context Management**:
- If contextId provided and exists: Uses the existing context
- If contextId provided but doesn't exist: Creates context with provided name
- If contextId empty or not provided: Generates default name and creates context
- No need to manually manage context creation or call initialize()
- Context initialization happens automatically on first method call

## Table of contents


### Methods

- [cleanup](#cleanup)
- [create](#create)
- [createExtensionOption](#createextensionoption)
- [delete](#delete)
- [list](#list)
- [update](#update)

## Methods

### cleanup

‚ñ∏ **cleanup**(): `Promise`\<`boolean`\>

Cleans up the auto-created context if it was created by this service.

#### Returns

`Promise`\<`boolean`\>

Promise that resolves to true if cleanup was successful or not needed, false if cleanup failed.

Note:
  This method only works if the context was auto-created by this service.
  For existing contexts, no cleanup is performed.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const service = new ExtensionsService(agentBay);
await service.create('/path/to/my-extension.zip');
const success = await service.cleanup();
console.log('Cleanup success:', success);
```

___

### create

‚ñ∏ **create**(`localPath`): `Promise`\<``Extension``\>

Uploads a new browser extension from a local path into the current context.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `localPath` | `string` | Path to the local extension file (must be a .zip file). |

#### Returns

`Promise`\<``Extension``\>

Promise that resolves to an Extension object.

**`Throws`**

If the local file doesn't exist.

**`Throws`**

If the file format is not supported (only .zip is supported).

**`Throws`**

If upload fails.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const service = new ExtensionsService(agentBay);
const extension = await service.create('/path/to/my-extension.zip');
console.log(`Extension ID: ${extension.id}`);
await service.cleanup();
```

___

### createExtensionOption

‚ñ∏ **createExtensionOption**(`extensionIds`): ``ExtensionOption``

Create an ExtensionOption for the current context with specified extension IDs.

This is a convenience method that creates an ExtensionOption using the current
service's contextId and the provided extension IDs. This option can then be
used with BrowserContext for browser session creation.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `extensionIds` | `string`[] | List of extension IDs to include in the option. These should be extensions that exist in the current context. |

#### Returns

``ExtensionOption``

ExtensionOption configuration object for browser extension integration.

**`Throws`**

If extensionIds is empty or invalid.

**`Example`**

```typescript
// Create extensions
const ext1 = await extensionsService.create("/path/to/ext1.zip");
const ext2 = await extensionsService.create("/path/to/ext2.zip");

// Create extension option for browser integration
const extOption = extensionsService.createExtensionOption([ext1.id, ext2.id]);

// Use with BrowserContext
const browserContext = new BrowserContext({
  contextId: "browser_session",
  autoUpload: true,
  extensionContextId: extOption.contextId,
  extensionIds: extOption.extensionIds
});
```

___

### delete

‚ñ∏ **delete**(`extensionId`): `Promise`\<`boolean`\>

Deletes a browser extension from the current context.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `extensionId` | `string` | ID of the extension to delete. |

#### Returns

`Promise`\<`boolean`\>

Promise that resolves to true if deletion was successful, false otherwise.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const service = new ExtensionsService(agentBay, 'my_extensions');
const ext = await service.create('/path/to/my-extension.zip');
const success = await service.delete(ext.id);
console.log('Delete success:', success);
await service.cleanup();
```

___

### list

‚ñ∏ **list**(): `Promise`\<``Extension``[]\>

Lists all available browser extensions within this context from the cloud.
Uses the context service to list files under the extensions directory.

#### Returns

`Promise`\<``Extension``[]\>

Promise that resolves to an array of Extension objects.

**`Throws`**

If listing extensions fails.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const service = new ExtensionsService(agentBay, 'my_extensions');
await service.create('/path/to/ext1.zip');
const extensions = await service.list();
console.log(`Found ${extensions.length} extensions`);
await service.cleanup();
```

___

### update

‚ñ∏ **update**(`extensionId`, `newLocalPath`): `Promise`\<``Extension``\>

Updates an existing browser extension in the current context with a new file.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `extensionId` | `string` | ID of the extension to update. |
| `newLocalPath` | `string` | Path to the new local extension file. |

#### Returns

`Promise`\<``Extension``\>

Promise that resolves to an Extension object.

**`Throws`**

If the new local file doesn't exist.

**`Throws`**

If the extension doesn't exist in the context.

**`Throws`**

If update fails.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const service = new ExtensionsService(agentBay, 'my_extensions');
const ext = await service.create('/path/to/ext-v1.zip');
const updated = await service.update(ext.id, '/path/to/ext-v2.zip');
console.log('Extension updated:', updated.name);
await service.cleanup();
```

## Related Resources

- [Browser API Reference](browser.md)





# Class: Code

## üíª Related Tutorial

- [Code Execution Guide](../../../../docs/guides/codespace/code-execution.md) - Execute code in isolated environments

## Overview

The Code module provides secure code execution capabilities in isolated environments.
It supports multiple programming languages including Python, JavaScript, and more.


## Requirements

- Requires `code_latest` image for code execution features

Handles code execution operations in the AgentBay cloud environment.

## Table of contents


### Methods

- [runCode](#runcode)

## Methods

### runCode

‚ñ∏ **runCode**(`code`, `language`, `timeoutS?`): `Promise`\<`CodeExecutionResult`\>

Execute code in the specified language with a timeout.
Corresponds to Python's run_code() method

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `code` | `string` | `undefined` | The code to execute. |
| `language` | `string` | `undefined` | The programming language of the code. Must be either 'python' or 'javascript'. |
| `timeoutS` | `number` | `60` | The timeout for the code execution in seconds. Default is 60s. Note: Due to gateway limitations, each request cannot exceed 60 seconds. |

#### Returns

`Promise`\<`CodeExecutionResult`\>

CodeExecutionResult with code execution output and requestId

**`Throws`**

Error if an unsupported language is specified.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create({ imageId: "code_latest" });
if (result.success) {
  const codeResult = await result.session.code.runCode('print("Hello")', "python");
  console.log(codeResult.result);
  await result.session.delete();
}
```

## Best Practices

1. Validate code syntax before execution
2. Set appropriate execution timeouts
3. Handle execution errors and exceptions
4. Use proper resource limits to prevent resource exhaustion
5. Clean up temporary files after code execution


## Related Resources

- [Session API Reference](../common-features/basics/session.md)





# Class: Agent

## ü§ñ Related Tutorial

- [Agent Modules Guide](../../../../../docs/guides/common-features/advanced/agent-modules.md) - Learn about agent modules and custom agents

An Agent to manipulate applications to complete specific tasks.

## Table of contents


### Methods

- [executeTask](#executetask)
- [terminateTask](#terminatetask)

## Methods

### executeTask

‚ñ∏ **executeTask**(`task`, `maxTryTimes`): `Promise`\<``ExecutionResult``\>

Execute a specific task described in human language.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `task` | `string` | Task description in human language. |
| `maxTryTimes` | `number` | Maximum number of retry attempts. |

#### Returns

`Promise`\<``ExecutionResult``\>

ExecutionResult containing success status, task output, and error message if any.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  const taskResult = await result.session.agent.executeTask('Open notepad', 10);
  console.log(`Task status: ${taskResult.taskStatus}`);
  await result.session.delete();
}
```

### terminateTask

‚ñ∏ **terminateTask**(`taskId`): `Promise`\<``ExecutionResult``\>

Terminate a task with a specified task ID.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `taskId` | `string` | The ID of the running task. |

#### Returns

`Promise`\<``ExecutionResult``\>

ExecutionResult containing success status, task output, and error message if any.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  const taskResult = await result.session.agent.executeTask('Open notepad', 5);
  const terminateResult = await result.session.agent.terminateTask(taskResult.taskId);
  console.log(`Terminated: ${terminateResult.taskStatus}`);
  await result.session.delete();
}
```

## Related Resources

- [Session API Reference](../../common-features/basics/session.md)





# Class: Oss

## ‚òÅÔ∏è Related Tutorial

- [OSS Integration Guide](../../../../../docs/guides/common-features/advanced/oss-integration.md) - Integrate with Alibaba Cloud OSS for file storage

Handles OSS operations in the AgentBay cloud environment.

## Table of contents


### Methods

- [download](#download)
- [downloadAnonymous](#downloadanonymous)
- [envInit](#envinit)
- [upload](#upload)
- [uploadAnonymous](#uploadanonymous)

## Methods

### download

‚ñ∏ **download**(`bucket`, `object`, `path`): `Promise`\<`OSSDownloadResult`\>

Download a file from OSS.
Corresponds to Python's download() method

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `bucket` | `string` | The OSS bucket name |
| `object` | `string` | The OSS object key |
| `path` | `string` | The local file path to save the downloaded file |

#### Returns

`Promise`\<`OSSDownloadResult`\>

OSSDownloadResult with download result and requestId

**`Throws`**

APIError if the operation fails.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const createResult = await agentBay.create();
if (createResult.success) {
  await createResult.session.oss.envInit('key_id', 'key_secret', 'token', 'oss-cn-hangzhou.aliyuncs.com', 'cn-hangzhou');
  const result = await createResult.session.oss.download('my-bucket', 'my-folder/file.txt', '/path/to/save/file.txt');
  console.log('Download success:', result.success);
  await createResult.session.delete();
}
```

___

### downloadAnonymous

‚ñ∏ **downloadAnonymous**(`url`, `path`): `Promise`\<`OSSDownloadResult`\>

Download a file from OSS using an anonymous URL.
Corresponds to Python's download_anonymous() method

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `url` | `string` | The anonymous download URL |
| `path` | `string` | The local file path to save the downloaded file |

#### Returns

`Promise`\<`OSSDownloadResult`\>

OSSDownloadResult with download result and requestId

**`Throws`**

APIError if the operation fails.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const createResult = await agentBay.create();
if (createResult.success) {
  const result = await createResult.session.oss.downloadAnonymous('https://example.com/file.txt', '/path/to/save/file.txt');
  console.log('Anonymous download success:', result.success);
  await createResult.session.delete();
}
```

___

### envInit

‚ñ∏ **envInit**(`accessKeyId`, `accessKeySecret`, `securityToken`, `endpoint?`, `region?`): `Promise`\<`OSSClientResult`\>

Initialize OSS environment variables with the specified STS temporary credentials.
Corresponds to Python's env_init() method

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `accessKeyId` | `string` | The access key ID from STS temporary credentials |
| `accessKeySecret` | `string` | The access key secret from STS temporary credentials |
| `securityToken` | `string` | The security token from STS temporary credentials (required) |
| `endpoint?` | `string` | The OSS endpoint (optional) |
| `region?` | `string` | The OSS region (optional) |

#### Returns

`Promise`\<`OSSClientResult`\>

OSSClientResult with client configuration and requestId

**`Throws`**

APIError if the operation fails.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const createResult = await agentBay.create();
if (createResult.success) {
  const result = await createResult.session.oss.envInit('sts_key_id', 'sts_key_secret', 'sts_token', 'oss-cn-hangzhou.aliyuncs.com', 'cn-hangzhou');
  console.log('OSS initialized:', result.success);
  await createResult.session.delete();
}
```

___

### upload

‚ñ∏ **upload**(`bucket`, `object`, `path`): `Promise`\<`OSSUploadResult`\>

Upload a file to OSS.
Corresponds to Python's upload() method

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `bucket` | `string` | The OSS bucket name |
| `object` | `string` | The OSS object key |
| `path` | `string` | The local file path to upload |

#### Returns

`Promise`\<`OSSUploadResult`\>

OSSUploadResult with upload result and requestId

**`Throws`**

APIError if the operation fails.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const createResult = await agentBay.create();
if (createResult.success) {
  await createResult.session.oss.envInit('key_id', 'key_secret', 'token', 'oss-cn-hangzhou.aliyuncs.com', 'cn-hangzhou');
  const result = await createResult.session.oss.upload('my-bucket', 'my-folder/file.txt', '/path/to/local/file.txt');
  console.log('Upload success:', result.success);
  await createResult.session.delete();
}
```

___

### uploadAnonymous

‚ñ∏ **uploadAnonymous**(`url`, `path`): `Promise`\<`OSSUploadResult`\>

Upload a file to OSS using an anonymous URL.
Corresponds to Python's upload_anonymous() method

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `url` | `string` | The anonymous upload URL |
| `path` | `string` | The local file path to upload |

#### Returns

`Promise`\<`OSSUploadResult`\>

OSSUploadResult with upload result and requestId

**`Throws`**

APIError if the operation fails.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const createResult = await agentBay.create();
if (createResult.success) {
  const result = await createResult.session.oss.uploadAnonymous('https://example.com/upload', '/path/to/local/file.txt');
  console.log('Anonymous upload success:', result.success);
  await createResult.session.delete();
}
```

## Related Resources

- [Session API Reference](../../common-features/basics/session.md)
- [FileSystem API Reference](../../common-features/basics/filesystem.md)





# Class: AgentBay

## üöÄ Related Tutorial

- [First Session Tutorial](../../../../../docs/quickstart/first-session.md) - Get started with creating your first AgentBay session

Main class for interacting with the AgentBay cloud runtime environment.

## Table of contents


### Properties


### Methods

- [create](#create)
- [delete](#delete)
- [get](#get)
- [list](#list)
- [pauseAsync](#pauseasync)
- [resumeAsync](#resumeasync)

## Properties

```typescript
context: [`ContextService`](context.md)
```


## Methods

### create

‚ñ∏ **create**(`params?`): `Promise`\<`SessionResult`\>

Creates a new AgentBay session with specified configuration.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `params` | ``CreateSessionParams`` | Configuration parameters for the session: - labels: Key-value pairs for session metadata - imageId: Custom image ID for the session environment - contextSync: Array of context synchronization configurations - browserContext: Browser-specific context configuration - isVpc: Whether to create a VPC session - policyId: Security policy ID - enableBrowserReplay: Enable browser session recording - extraConfigs: Additional configuration options - framework: Framework identifier for tracking |

#### Returns

`Promise`\<`SessionResult`\>

Promise resolving to SessionResult containing:
         - success: Whether session creation succeeded
         - session: Session object for interacting with the environment
         - requestId: Unique identifier for this API request
         - errorMessage: Error description if creation failed

**`Throws`**

Error if API call fails or authentication is invalid.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create({ labels: { project: 'demo' } });
if (result.success) {
  await result.session.filesystem.readFile('/etc/hostname');
  await result.session.delete();
}
```

**`Remarks`**

**Behavior:**
- Creates a new isolated cloud runtime environment
- Automatically creates file transfer context if not provided
- Waits for context synchronization if contextSync is specified
- For VPC sessions, includes VPC-specific configuration
- Browser replay creates a separate recording context

**`See`**

[get](#get), [list](#list), [Session.delete](session.md#delete)

___

### delete

‚ñ∏ **delete**(`session`, `syncContext?`): `Promise`\<``DeleteResult``\>

Delete a session by session object.

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `session` | [`Session`](session.md) | `undefined` | The session to delete. |
| `syncContext` | `boolean` | `false` | Whether to sync context data (trigger file uploads) before deleting the session. Defaults to false. |

#### Returns

`Promise`\<``DeleteResult``\>

DeleteResult indicating success or failure and request ID

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();
if (result.success) {
  await agentBay.delete(result.session);
}
```

___

### get

‚ñ∏ **get**(`sessionId`): `Promise`\<`SessionResult`\>

Get a session by its ID.

This method retrieves a session by calling the GetSession API
and returns a SessionResult containing the Session object and request ID.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `sessionId` | `string` | The ID of the session to retrieve |

#### Returns

`Promise`\<`SessionResult`\>

Promise resolving to SessionResult with the Session instance, request ID, and success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const createResult = await agentBay.create();
if (createResult.success) {
  const result = await agentBay.get(createResult.session.sessionId);
  await result.session?.filesystem.readFile('/etc/hostname');
  await result.session?.delete();
}
```

### list

‚ñ∏ **list**(`labels?`, `page?`, `limit?`): `Promise`\<``SessionListResult``\>

Returns paginated list of session IDs filtered by labels.

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `labels` | `Record`\<`string`, `string`\> | `{}` | Optional labels to filter sessions (defaults to empty object) |
| `page?` | `number` | `undefined` | Optional page number for pagination (starting from 1, defaults to 1) |
| `limit` | `number` | `10` | Optional maximum number of items per page (defaults to 10) |

#### Returns

`Promise`\<``SessionListResult``\>

SessionListResult - Paginated list of session IDs that match the labels

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: "your_api_key" });
const result = await agentBay.list({ project: "demo" }, 1, 10);
if (result.success) {
  console.log(`Found ${result.sessionIds.length} sessions`);
}
```

___

### pauseAsync

‚ñ∏ **pauseAsync**(`session`, `timeout?`, `pollInterval?`): `Promise`\<`SessionPauseResult`\>

Asynchronously pause a session, putting it into a dormant state.

This method directly calls the PauseSessionAsync API without waiting for the session
to reach the PAUSED state.

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `session` | [`Session`](session.md) | `undefined` | The session to pause. |
| `timeout` | `number` | `600` | Timeout in seconds to wait for the session to pause. Defaults to 600 seconds. |
| `pollInterval` | `number` | `2.0` | Interval in seconds between status polls. Defaults to 2.0 seconds. |

#### Returns

`Promise`\<`SessionPauseResult`\>

SessionPauseResult indicating success or failure and request ID

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const session = (await agentBay.create()).session;
const pauseResult = await agentBay.pauseAsync(session);
await agentBay.resumeAsync(session);
await session.delete();
```

**`Remarks`**

**Behavior:**
- This method does not wait for the session to reach the PAUSED state
- It only submits the pause request to the API
- The session state transitions from RUNNING -> PAUSING -> PAUSED
- Paused sessions consume fewer resources but maintain their state

**`See`**

[resumeAsync](#resumeasync), [Session.pauseAsync](session.md#pauseasync)

___

### resumeAsync

‚ñ∏ **resumeAsync**(`session`, `timeout?`, `pollInterval?`): `Promise`\<`SessionResumeResult`\>

Asynchronously resume a session from a paused state.

This method directly calls the ResumeSessionAsync API without waiting for the session
to reach the RUNNING state.

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `session` | [`Session`](session.md) | `undefined` | The session to resume. |
| `timeout` | `number` | `600` | Timeout in seconds to wait for the session to resume. Defaults to 600 seconds. |
| `pollInterval` | `number` | `2.0` | Interval in seconds between status polls. Defaults to 2.0 seconds. |

#### Returns

`Promise`\<`SessionResumeResult`\>

SessionResumeResult indicating success or failure and request ID

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const session = (await agentBay.create()).session;
await agentBay.pauseAsync(session);
const resumeResult = await agentBay.resumeAsync(session);
await session.delete();
```

**`Remarks`**

**Behavior:**
- This method does not wait for the session to reach the RUNNING state
- It only submits the resume request to the API
- The session state transitions from PAUSED -> RESUMING -> RUNNING
- Only sessions in PAUSED state can be resumed

**`See`**

[pauseAsync](#pauseasync), [Session.resumeAsync](session.md#resumeasync)

## Related Resources

- [Session API Reference](session.md)
- [Context API Reference](context.md)





# Class: Command

## ‚ö° Related Tutorial

- [Command Execution Guide](../../../../../docs/guides/common-features/basics/command-execution.md) - Learn how to execute commands in sessions

## Overview

The Command module provides methods for executing shell commands within a session in the AgentBay cloud environment.
It supports both synchronous command execution with configurable timeouts.

Handles command execution operations in the AgentBay cloud environment.

## Table of contents


### Methods

- [executeCommand](#executecommand)

## Methods

### executeCommand

‚ñ∏ **executeCommand**(`command`, `timeoutMs?`): `Promise`\<`CommandResult`\>

Executes a shell command in the session environment.

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `command` | `string` | `undefined` | The shell command to execute. |
| `timeoutMs` | `number` | `1000` | Timeout in milliseconds. Defaults to 1000ms. |

#### Returns

`Promise`\<`CommandResult`\>

Promise resolving to CommandResult containing:
         - success: Whether the command executed successfully
         - output: Combined stdout and stderr output
         - requestId: Unique identifier for this API request
         - errorMessage: Error description if execution failed

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();
if (result.success) {
  const cmdResult = await result.session.command.executeCommand('echo "Hello"', 3000);
  console.log('Command output:', cmdResult.output);
  await result.session.delete();
}
```

**`Remarks`**

**Behavior:**
- Executes in a Linux shell environment
- Combines stdout and stderr in the output
- Default timeout is 1000ms (1 second)
- Command runs with session user permissions

**`See`**

[FileSystem.readFile](filesystem.md#readfile), [FileSystem.writeFile](filesystem.md#writefile)

## Best Practices

1. Always specify appropriate timeout values based on expected command duration
2. Handle command execution errors gracefully
3. Use absolute paths when referencing files in commands
4. Be aware that commands run with session user permissions
5. Clean up temporary files created by commands


## Related Resources

- [Session API Reference](session.md)
- [FileSystem API Reference](filesystem.md)





# Class: ContextManager

## üóÇÔ∏è Related Tutorial

- [Data Persistence Guide](../../../../../docs/guides/common-features/basics/data-persistence.md) - Learn about context management and data persistence

## Table of contents


### Methods

- [info](#info)
- [infoWithParams](#infowithparams)
- [sync](#sync)

## Methods

### info

‚ñ∏ **info**(): `Promise`\<``ContextInfoResult``\>

Gets information about context synchronization status for the current session.

#### Returns

`Promise`\<``ContextInfoResult``\>

Promise resolving to ContextInfoResult containing context status data and request ID

**`Throws`**

Error if the API call fails

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();
if (result.success) {
  const info = await result.session.context.info();
  console.log(`Context count: ${info.contextStatusData.length}`);
  await result.session.delete();
}
```

___

### infoWithParams

‚ñ∏ **infoWithParams**(`contextId?`, `path?`, `taskType?`): `Promise`\<``ContextInfoResult``\>

Gets information about context synchronization status with optional filter parameters.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `contextId?` | `string` | Optional context ID to filter results |
| `path?` | `string` | Optional path to filter results |
| `taskType?` | `string` | Optional task type to filter results (e.g., "upload", "download") |

#### Returns

`Promise`\<``ContextInfoResult``\>

Promise resolving to ContextInfoResult containing filtered context status data and request ID

**`Throws`**

Error if the API call fails

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();
if (result.success) {
  const info = await result.session.context.infoWithParams('SdkCtx-xxx', '/mnt/persistent');
  console.log(`Context status: ${info.contextStatusData[0]?.status}`);
  await result.session.delete();
}
```

___

### sync

‚ñ∏ **sync**(`contextId?`, `path?`, `mode?`, `callback?`, `maxRetries?`, `retryInterval?`): `Promise`\<``ContextSyncResult``\>

Synchronizes a context with the session. Supports both async and callback modes.

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `contextId?` | `string` | `undefined` | Optional context ID to synchronize. If provided, `path` must also be provided. |
| `path?` | `string` | `undefined` | Optional path where the context should be mounted. If provided, `contextId` must also be provided. |
| `mode?` | `string` | `undefined` | Optional synchronization mode (e.g., "upload", "download") |
| `callback?` | ``SyncCallback`` | `undefined` | Optional callback function. If provided, runs in background and calls callback when complete |
| `maxRetries` | `number` | `150` | Maximum number of retries for polling completion status (default: 150) |
| `retryInterval` | `number` | `1500` | Milliseconds to wait between retries (default: 1500) |

#### Returns

`Promise`\<``ContextSyncResult``\>

Promise resolving to ContextSyncResult with success status and request ID

**`Throws`**

Error if the API call fails

**`Throws`**

Error if `contextId` or `path` is provided without the other parameter.
              Both must be provided together, or both must be omitted.

**`Example`**

Sync all contexts (no parameters):
```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();
if (result.success) {
  const syncResult = await result.session.context.sync();
  console.log(`Sync: ${syncResult.success}`);
  await result.session.delete();
}
```

**`Example`**

Sync specific context with path:
```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();
if (result.success) {
  const ctxResult = await agentBay.context.get('my-context', true);
  const syncResult = await result.session.context.sync(ctxResult.context!.id, '/mnt/persistent', 'upload');
  console.log(`Sync: ${syncResult.success}`);
  await result.session.delete();
}
```

## Related Resources

- [Context API Reference](context.md)
- [Session API Reference](session.md)





# Interface: ContextSyncResult

Base interface for API responses

## Hierarchy

- ``ApiResponse``

  ‚Ü≥ **`ContextSyncResult`**

## Table of contents

### Properties

- `errorMessage`
- `requestId`

## Properties

```typescript
success: `boolean`
```


### errorMessage

‚Ä¢ `Optional` **errorMessage**: `string`

Optional error message if the operation failed

#### Overrides

`ApiResponse`.`errorMessage`

___

### requestId

‚Ä¢ `Optional` **requestId**: `string`

Optional request identifier for tracking API calls

#### Inherited from

`ApiResponse`.`requestId`

___

#### Overrides

`ApiResponse`.`success`




# Class: ContextService

## üíæ Related Tutorial

- [Data Persistence Guide](../../../../../docs/guides/common-features/basics/data-persistence.md) - Learn about context management and data persistence

Provides methods to manage persistent contexts in the AgentBay cloud environment.

## Table of contents


### Methods

- [clear](#clear)
- [clearAsync](#clearasync)
- [create](#create)
- [delete](#delete)
- [deleteFile](#deletefile)
- [get](#get)
- [list](#list)
- [listFiles](#listfiles)
- [update](#update)

## Methods

### clear

‚ñ∏ **clear**(`contextId`, `timeout?`, `pollInterval?`): `Promise`\<`ClearContextResult`\>

Synchronously clear the context's persistent data and wait for the final result.

This method wraps the `clearAsync` and `getClearStatus` polling logic,
providing the simplest and most direct way to handle clearing tasks.

The clearing process transitions through the following states:
- "clearing": Data clearing is in progress
- "available": Clearing completed successfully (final success state)

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `contextId` | `string` | `undefined` | Unique ID of the context to clear. |
| `timeout` | `number` | `60` | (Optional) Timeout in seconds to wait for task completion, default is 60 seconds. |
| `pollInterval` | `number` | `2.0` | (Optional) Interval in seconds between status polls, default is 2 seconds. |

#### Returns

`Promise`\<`ClearContextResult`\>

A ClearContextResult object containing the final task result.
         The status field will be "available" on success, or other states if interrupted.

**`Throws`**

APIError - If the task fails to complete within the specified timeout.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const getResult = await agentBay.context.get('my-context');
if (getResult.success) {
  const clearResult = await agentBay.context.clear(getResult.context.id);
  console.log('Context cleared:', clearResult.success);
  console.log('Final status:', clearResult.status);
}
```

___

### clearAsync

‚ñ∏ **clearAsync**(`contextId`): `Promise`\<`ClearContextResult`\>

Asynchronously initiate a task to clear the context's persistent data.

This is a non-blocking method that returns immediately after initiating the clearing task
on the backend. The context's state will transition to "clearing" while the operation
is in progress.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `contextId` | `string` | Unique ID of the context to clear. |

#### Returns

`Promise`\<`ClearContextResult`\>

A ClearContextResult object indicating the task has been successfully started,
         with status field set to "clearing".

**`Throws`**

APIError - If the backend API rejects the clearing request (e.g., invalid ID).

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const getResult = await agentBay.context.get('my-context');
if (getResult.success) {
  const clearResult = await agentBay.context.clearAsync(getResult.context.id);
  console.log('Clear task started:', clearResult.success);
  console.log('Status:', clearResult.status);
}
```

___

### create

‚ñ∏ **create**(`name`): `Promise`\<`ContextResult`\>

Creates a new context with the given name.
Corresponds to Python's create() method

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `name` | `string` | The name for the new context. |

#### Returns

`Promise`\<`ContextResult`\>

ContextResult with created context data and requestId

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.context.create('my-new-context');
if (result.success) {
  console.log(`Context ID: ${result.context.id}`);
  console.log(`Context Name: ${result.context.name}`);
}
```

___

### delete

‚ñ∏ **delete**(`context`): `Promise`\<`OperationResult`\>

Deletes the specified context.
Corresponds to Python's delete() method

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `context` | ``Context`` | The Context object to delete. |

#### Returns

`Promise`\<`OperationResult`\>

OperationResult with requestId

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const getResult = await agentBay.context.get('my-context');
if (getResult.success && getResult.context) {
  const deleteResult = await agentBay.context.delete(getResult.context);
  console.log('Context deleted:', deleteResult.success);
}
```

___

### deleteFile

‚ñ∏ **deleteFile**(`contextId`, `filePath`): `Promise`\<`OperationResult`\>

Delete a file in a context.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `contextId` | `string` | The ID of the context. |
| `filePath` | `string` | The path to the file to delete. |

#### Returns

`Promise`\<`OperationResult`\>

OperationResult indicating success or failure.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const contextResult = await agentBay.context.get('my-context');
if (contextResult.success) {
  const deleteResult = await agentBay.context.deleteFile(contextResult.context.id, '/data/file.txt');
  console.log('File deleted:', deleteResult.success);
}
```

___

### get

‚ñ∏ **get**(`name`, `create?`): `Promise`\<`ContextResult`\>

Retrieves an existing context or creates a new one.

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `name` | `string` | `undefined` | The name of the context to retrieve or create. |
| `create` | `boolean` | `false` | If true, creates the context if it doesn't exist. Defaults to false. |

#### Returns

`Promise`\<`ContextResult`\>

Promise resolving to ContextResult containing the Context object.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.context.get('my-context', true);
if (result.success) {
  console.log(`Context ID: ${result.context.id}`);
  console.log(`Context Name: ${result.context.name}`);
}
```

**`See`**

[update](#update), [list](#list)

### list

‚ñ∏ **list**(`params?`): `Promise`\<`ContextListResult`\>

Lists all available contexts with pagination support.
Corresponds to Python's list() method

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `params?` | `ContextListParams` | Optional parameters for listing contexts. |

#### Returns

`Promise`\<`ContextListResult`\>

ContextListResult with contexts list and pagination information

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.context.list({ maxResults: 10 });
if (result.success) {
  console.log(`Total contexts: ${result.totalCount}`);
  console.log(`Page has ${result.contexts.length} contexts`);
}
```

___

### listFiles

‚ñ∏ **listFiles**(`contextId`, `parentFolderPath`, `pageNumber?`, `pageSize?`): `Promise`\<`ContextFileListResult`\>

List files under a specific folder path in a context.

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `contextId` | `string` | `undefined` | The ID of the context. |
| `parentFolderPath` | `string` | `undefined` | The parent folder path to list files from. |
| `pageNumber` | `number` | `1` | Page number for pagination (default: 1). |
| `pageSize` | `number` | `50` | Number of files per page (default: 50). |

#### Returns

`Promise`\<`ContextFileListResult`\>

ContextFileListResult with file entries and total count.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const contextResult = await agentBay.context.get('my-context');
if (contextResult.success) {
  const listResult = await agentBay.context.listFiles(contextResult.context.id, '/data');
  console.log(`Found ${listResult.entries.length} files`);
  console.log(`Total count: ${listResult.count}`);
}
```

___

### update

‚ñ∏ **update**(`context`): `Promise`\<`OperationResult`\>

Updates a context's name.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `context` | ``Context`` | The Context object with updated name. |

#### Returns

`Promise`\<`OperationResult`\>

Promise resolving to OperationResult with success status.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const getResult = await agentBay.context.get('old-name');
if (getResult.success && getResult.context) {
  getResult.context.name = 'new-name';
  const updateResult = await agentBay.context.update(getResult.context);
  console.log('Context updated:', updateResult.success);
}
```

**`See`**

[get](#get), [list](#list)

## Related Resources

- [Session API Reference](session.md)
- [Context Manager API Reference](context-manager.md)





# Class: FileSystem

## üìÅ Related Tutorial

- [File Operations Guide](../../../../../docs/guides/common-features/basics/file-operations.md) - Complete guide to file system operations

Handles file operations in the AgentBay cloud environment.

## Table of contents


### Methods

- [createDirectory](#createdirectory)
- [downloadFile](#downloadfile)
- [editFile](#editfile)
- [listDirectory](#listdirectory)
- [moveFile](#movefile)
- [readFile](#readfile)
- [readMultipleFiles](#readmultiplefiles)
- [searchFiles](#searchfiles)
- [uploadFile](#uploadfile)
- [watchDirectory](#watchdirectory)
- [writeFile](#writefile)

## Methods

### createDirectory

‚ñ∏ **createDirectory**(`path`): `Promise`\<`BoolResult`\>

Creates a new directory at the specified path.
Corresponds to Python's create_directory() method

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `path` | `string` | Path to the directory to create. |

#### Returns

`Promise`\<`BoolResult`\>

BoolResult with creation result and requestId

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();
if (result.success) {
  const createResult = await result.session.fileSystem.createDirectory('/tmp/mydir');
  console.log('Directory created:', createResult.success);
  await result.session.delete();
}
```

___

### downloadFile

‚ñ∏ **downloadFile**(`remotePath`, `localPath`, `options?`): `Promise`\<`any`\>

Download a file from remote path to local path using pre-signed URLs.
This is a synchronous wrapper around the FileTransfer.download method.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `remotePath` | `string` | Remote file path to download from |
| `localPath` | `string` | Local file path to download to |
| `options?` | `Object` | Optional parameters |
| `options.overwrite?` | `boolean` | - |
| `options.pollInterval?` | `number` | - |
| `options.progressCb?` | (`bytesReceived`: `number`) => `void` | - |
| `options.wait?` | `boolean` | - |
| `options.waitTimeout?` | `number` | - |

#### Returns

`Promise`\<`any`\>

DownloadResult with download result and requestId

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create({ imageId: 'code_latest' });
if (result.success) {
  await result.session.fileSystem.writeFile('/workspace/remote.txt', 'Content to download');
  const downloadResult = await result.session.fileSystem.downloadFile('/workspace/remote.txt', '/tmp/local.txt');
  console.log('Download success:', downloadResult.success);
  await result.session.delete();
}
```

___

### editFile

‚ñ∏ **editFile**(`path`, `edits`, `dryRun?`): `Promise`\<`BoolResult`\>

Edits a file by replacing occurrences of oldText with newText.
Corresponds to Python's edit_file() method

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `path` | `string` | `undefined` | Path to the file to edit. |
| `edits` | \{ `newText`: `string` ; `oldText`: `string`  }[] | `undefined` | Array of edit operations, each containing oldText and newText. |
| `dryRun` | `boolean` | `false` | Optional: If true, preview changes without applying them. |

#### Returns

`Promise`\<`BoolResult`\>

BoolResult with edit result and requestId

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();
if (result.success) {
  await result.session.fileSystem.writeFile('/tmp/config.txt', 'DEBUG=false');
  const edits = [{ oldText: 'DEBUG=false', newText: 'DEBUG=true' }];
  const editResult = await result.session.fileSystem.editFile('/tmp/config.txt', edits);
  console.log('File edited:', editResult.success);
  await result.session.delete();
}
```

### listDirectory

‚ñ∏ **listDirectory**(`path`): `Promise`\<`DirectoryListResult`\>

Lists the contents of a directory.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `path` | `string` | Absolute path to the directory to list. |

#### Returns

`Promise`\<`DirectoryListResult`\>

Promise resolving to DirectoryListResult containing array of entries.

**`Example`**

```typescript
import { AgentBay } from 'wuying-agentbay-sdk';

const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();

if (result.success) {
  const session = result.session;

  // List directory contents
  const listResult = await session.fileSystem.listDirectory('/tmp');
  if (listResult.success) {
    console.log(`Found ${listResult.entries.length} entries`);
    for (const entry of listResult.entries) {
      console.log(`${entry.name} (${entry.isDirectory ? 'dir' : 'file'})`);
    }
  }

  await session.delete();
}
```

**`See`**

[readFile](#readfile), [writeFile](#writefile)

___

### moveFile

‚ñ∏ **moveFile**(`source`, `destination`): `Promise`\<`BoolResult`\>

Moves a file or directory from source to destination.
Corresponds to Python's move_file() method

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `source` | `string` | Path to the source file or directory. |
| `destination` | `string` | Path to the destination file or directory. |

#### Returns

`Promise`\<`BoolResult`\>

BoolResult with move result and requestId

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();
if (result.success) {
  await result.session.fileSystem.writeFile('/tmp/original.txt', 'Test content');
  const moveResult = await result.session.fileSystem.moveFile('/tmp/original.txt', '/tmp/moved.txt');
  console.log('File moved:', moveResult.success);
  await result.session.delete();
}
```

___

### readFile

‚ñ∏ **readFile**(`path`): `Promise`\<`FileContentResult`\>

Reads the entire content of a file.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `path` | `string` | Absolute path to the file to read. |

#### Returns

`Promise`\<`FileContentResult`\>

Promise resolving to FileContentResult containing:
         - success: Whether the read operation succeeded
         - content: String content of the file
         - requestId: Unique identifier for this API request
         - errorMessage: Error description if read failed

**`Throws`**

Error if the API call fails.

**`Example`**

```typescript
import { AgentBay } from 'wuying-agentbay-sdk';

const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();

if (result.success) {
  const session = result.session;

  // Read a text file
  const fileResult = await session.fileSystem.readFile('/etc/hostname');
  if (fileResult.success) {
    console.log(`Content: ${fileResult.content}`);
    // Output: Content: agentbay-session-xyz
  }

  await session.delete();
}
```

**`Remarks`**

**Behavior:**
- Automatically handles large files by reading in 60KB chunks
- Returns empty string for empty files
- Fails if path is a directory or doesn't exist
- Content is returned as UTF-8 string

**`See`**

[writeFile](#writefile), [listDirectory](#listdirectory)

___

### readMultipleFiles

‚ñ∏ **readMultipleFiles**(`paths`): `Promise`\<`MultipleFileContentResult`\>

Reads the content of multiple files.
Corresponds to Python's read_multiple_files() method

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `paths` | `string`[] | Array of file paths to read. |

#### Returns

`Promise`\<`MultipleFileContentResult`\>

MultipleFileContentResult with file contents and requestId

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();
if (result.success) {
  await result.session.fileSystem.writeFile('/tmp/file1.txt', 'Content 1');
  await result.session.fileSystem.writeFile('/tmp/file2.txt', 'Content 2');
  const readResult = await result.session.fileSystem.readMultipleFiles(['/tmp/file1.txt', '/tmp/file2.txt']);
  console.log(`Read ${Object.keys(readResult.contents).length} files`);
  await result.session.delete();
}
```

___

### searchFiles

‚ñ∏ **searchFiles**(`path`, `pattern`, `excludePatterns?`): `Promise`\<`FileSearchResult`\>

Searches for files in a directory that match a wildcard pattern.
Corresponds to Python's search_files() method

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `path` | `string` | `undefined` | Path to the directory to search in. |
| `pattern` | `string` | `undefined` | Wildcard pattern to match against file names. Supports * (any characters) and ? (single character). Examples: "*.py", "test_*", "*config*". |
| `excludePatterns` | `string`[] | `[]` | Optional: Array of wildcard patterns to exclude. |

#### Returns

`Promise`\<`FileSearchResult`\>

FileSearchResult with search results and requestId

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();
if (result.success) {
  await result.session.fileSystem.createDirectory('/tmp/test');
  await result.session.fileSystem.writeFile('/tmp/test/file1.py', "print('hello')");
  const searchResult = await result.session.fileSystem.searchFiles('/tmp/test', '*.py');
  console.log(`Found ${searchResult.matches.length} Python files`);
  await result.session.delete();
}
```

___

### uploadFile

‚ñ∏ **uploadFile**(`localPath`, `remotePath`, `options?`): `Promise`\<`any`\>

Upload a file from local to remote path using pre-signed URLs.
This is a synchronous wrapper around the FileTransfer.upload method.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `localPath` | `string` | Local file path to upload |
| `remotePath` | `string` | Remote file path to upload to |
| `options?` | `Object` | Optional parameters |
| `options.contentType?` | `string` | - |
| `options.pollInterval?` | `number` | - |
| `options.progressCb?` | (`bytesTransferred`: `number`) => `void` | - |
| `options.wait?` | `boolean` | - |
| `options.waitTimeout?` | `number` | - |

#### Returns

`Promise`\<`any`\>

UploadResult with upload result and requestId

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create({ imageId: 'code_latest' });
if (result.success) {
  const uploadResult = await result.session.fileSystem.uploadFile('/tmp/local.txt', '/workspace/remote.txt');
  console.log('Upload success:', uploadResult.success);
  await result.session.delete();
}
```

___

### watchDirectory

‚ñ∏ **watchDirectory**(`path`, `callback`, `interval?`, `signal?`): `Promise`\<`void`\>

Watch a directory for file changes and call the callback function when changes occur

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `path` | `string` | `undefined` | Directory path to monitor |
| `callback` | (`events`: ``FileChangeEvent``[]) => `void` | `undefined` | Function called when changes are detected |
| `interval` | `number` | `500` | Polling interval in milliseconds (default: 500, minimum: 100) |
| `signal?` | `AbortSignal` | `undefined` | Signal to abort the monitoring |

#### Returns

`Promise`\<`void`\>

Promise that resolves when monitoring stops

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();
if (result.success) {
  const testDir = '/tmp/watch_test';
  await result.session.fileSystem.createDirectory(testDir);
  const controller = new AbortController();
  const callback = (events) => console.log(`Detected ${events.length} changes`);
  await result.session.fileSystem.watchDirectory(testDir, callback, 1000, controller.signal);
  await result.session.delete();
}
```

___

### writeFile

‚ñ∏ **writeFile**(`path`, `content`, `mode?`): `Promise`\<`BoolResult`\>

Writes content to a file.

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `path` | `string` | `undefined` | Absolute path to the file to write. |
| `content` | `string` | `undefined` | String content to write to the file. |
| `mode` | `string` | `"overwrite"` | Write mode: "overwrite" (default) or "append". |

#### Returns

`Promise`\<`BoolResult`\>

Promise resolving to BoolResult with success status.

**`Example`**

```typescript
import { AgentBay } from 'wuying-agentbay-sdk';

const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();

if (result.success) {
  const session = result.session;

  // Write to a file (overwrite mode)
  const writeResult = await session.fileSystem.writeFile(
    '/tmp/test.txt',
    'Hello, AgentBay!'
  );
  if (writeResult.success) {
    console.log('File written successfully');
  }

  // Append to a file
  const appendResult = await session.fileSystem.writeFile(
    '/tmp/test.txt',
    '\nNew line',
    'append'
  );

  await session.delete();
}
```

**`Remarks`**

**Behavior:**
- Automatically handles large files by writing in 60KB chunks
- Creates parent directories if they don't exist
- "overwrite" mode replaces existing file content
- "append" mode adds content to the end of the file

**`See`**

[readFile](#readfile), [listDirectory](#listdirectory)

## Related Resources

- [Session API Reference](session.md)
- [Command API Reference](command.md)





# Interface: LoggerConfig

## üìù Related Tutorial

- [Logging Configuration Guide](../../../../../docs/guides/common-features/configuration/logging.md) - Configure logging for the SDK

Logger configuration options

**`Example`**

```typescript
import { AgentBay, setupLogger } from 'wuying-agentbay-sdk';

const agentBay = new AgentBay({ apiKey: 'your_api_key' });

async function demonstrateLogging() {
    try {
        // Configure logging with file output
        setupLogger({
            level: 'DEBUG',
            logFile: '/var/log/agentbay.log',
            maxFileSize: '100 MB',
            enableConsole: true
        });

        // Create a session - logs will be written to both console and file
        const result = await agentBay.create();
        if (result.success) {
            const session = result.session;
            console.log(`Session created: ${session.sessionId}`);
            await session.delete();
        }
    } catch (error) {
        console.error('Error:', error);
    }
}

demonstrateLogging().catch(console.error);
```

## Table of contents

### Properties

- `enableConsole`
- `level`
- `logFile`
- `maxFileSize`

## Properties

### enableConsole

‚Ä¢ `Optional` **enableConsole**: `boolean`

___

### level

‚Ä¢ `Optional` **level**: ``LogLevel``

___

### logFile

‚Ä¢ `Optional` **logFile**: `string`

___

### maxFileSize

‚Ä¢ `Optional` **maxFileSize**: `string`

## Related Resources

- [AgentBay API Reference](agentbay.md)





# Class: Session

## üîß Related Tutorial

- [Session Management Guide](../../../../../docs/guides/common-features/basics/session-management.md) - Detailed tutorial on session lifecycle and management

Represents a session in the AgentBay cloud environment.

## Table of contents


### Properties


### Methods

- [callMcpTool](#callmcptool)
- [delete](#delete)
- [getLabels](#getlabels)
- [getLink](#getlink)
- [getLinkAsync](#getlinkasync)
- [info](#info)
- [listMcpTools](#listmcptools)
- [pauseAsync](#pauseasync)
- [resumeAsync](#resumeasync)
- [setLabels](#setlabels)

## Properties

```typescript
agent: [`Agent`](../advanced/agent.md)
browser: [`Browser`](../../browser-use/browser.md)
code: [`Code`](../../codespace/code.md)
command: [`Command`](command.md)
computer: [`Computer`](../../computer-use/computer.md)
context: [`ContextManager`](context-manager.md)
enableBrowserReplay: `boolean` = `false`
fileSystem: [`FileSystem`](filesystem.md)
fileTransferContextId: ``null`` | `string` = `null`
httpPort: `string` = `""`
isVpc: `boolean` = `false`
mcpTools: `McpTool`[] = `[]`
mobile: [`Mobile`](../../mobile-use/mobile.md)
networkInterfaceIp: `string` = `""`
oss: [`Oss`](../advanced/oss.md)
recordContextId: ``null`` | `string` = `null`
resourceUrl: `string` = `""`
sessionId: `string`
token: `string` = `""`
```


## Methods

### callMcpTool

‚ñ∏ **callMcpTool**(`toolName`, `args`, `autoGenSession?`): `Promise`\<``McpToolResult``\>

Call an MCP tool and return the result in a format compatible with Agent.

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `toolName` | `string` | `undefined` | Name of the MCP tool to call |
| `args` | `any` | `undefined` | Arguments to pass to the tool |
| `autoGenSession` | `boolean` | `false` | Whether to automatically generate session if not exists (default: false) |

#### Returns

`Promise`\<``McpToolResult``\>

McpToolResult containing the response data

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();
if (result.success) {
  const shellResult = await result.session.callMcpTool('shell', { command: "echo 'Hello'" });
  console.log(`Output: ${shellResult.data}`);
  await result.session.delete();
}
```

**`Remarks`**

For press_keys tool, key names are automatically normalized to correct case format.
This improves case compatibility (e.g., "CTRL" -> "Ctrl", "tab" -> "Tab").

___

### delete

‚ñ∏ **delete**(`syncContext?`): `Promise`\<``DeleteResult``\>

Deletes the session and releases all associated resources.

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `syncContext` | `boolean` | `false` | Whether to synchronize context data before deletion. If true, uploads all context data to OSS. If false but browser replay is enabled, syncs only the recording context. Defaults to false. |

#### Returns

`Promise`\<``DeleteResult``\>

Promise resolving to DeleteResult containing:
         - success: Whether deletion succeeded
         - requestId: Unique identifier for this API request
         - errorMessage: Error description if deletion failed

**`Throws`**

Error if the API call fails or network issues occur.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();
if (result.success) {
  await result.session.fileSystem.writeFile('/tmp/data.txt', 'data');
  const deleteResult = await result.session.delete(true);
  console.log('Session deleted:', deleteResult.success);
}
```

**`Remarks`**

**Behavior:**
- If `syncContext=true`: Uploads all context data to OSS before deletion
- If `syncContext=false` but browser replay enabled: Syncs only recording context
- If `syncContext=false` and no browser replay: Deletes immediately without sync
- Continues with deletion even if context sync fails
- Releases all associated resources (browser, computer, mobile, etc.)

**Best Practices:**
- Use `syncContext=true` when you need to preserve context data for later retrieval
- For temporary sessions, use `syncContext=false` for faster cleanup
- Always call `delete()` when done to avoid resource leaks
- Handle deletion errors gracefully in production code

**`See`**

[info](#info), [ContextManager.sync](context-manager.md#sync)

___

### getLabels

‚ñ∏ **getLabels**(): `Promise`\<`OperationResult`\>

Gets the labels for this session.

#### Returns

`Promise`\<`OperationResult`\>

OperationResult containing the labels as data and request ID

**`Throws`**

Error if the operation fails (matching Python SessionError)

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();
if (result.success) {
  await result.session.setLabels({ project: 'demo', env: 'test' });
  const getResult = await result.session.getLabels();
  console.log('Labels:', JSON.stringify(getResult.data));
  await result.session.delete();
}
```

___

### getLink

‚ñ∏ **getLink**(`protocolType?`, `port?`, `options?`): `Promise`\<`OperationResult`\>

Retrieves an access link for the session.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `protocolType?` | `string` | Protocol type for the link (optional, reserved for future use) |
| `port?` | `number` | Specific port number to access (must be in range [30100, 30199]). If not specified, returns the default session link. |
| `options?` | `string` | - |

#### Returns

`Promise`\<`OperationResult`\>

Promise resolving to OperationResult containing:
         - success: Whether the operation succeeded
         - data: String URL for accessing the session
         - requestId: Unique identifier for this API request
         - errorMessage: Error description if operation failed

**`Throws`**

Error if the API call fails or port is out of valid range.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();
if (result.success) {
  const linkResult = await result.session.getLink();
  console.log(`Session link: ${linkResult.data}`);
  await result.session.delete();
}
```

**`Remarks`**

**Behavior:**
- Without port: Returns the default session access URL
- With port: Returns URL for accessing specific port-mapped service
- Port must be in range [30100, 30199] for port forwarding
- For ADB connections, use `session.mobile.getAdbUrl()` with appropriate ADB public key

**Best Practices:**
- Use default link for general session access
- Use port-specific links when you've started services on specific ports
- Validate port range before calling to avoid errors

**`See`**

[info](#info)

___

### getLinkAsync

‚ñ∏ **getLinkAsync**(`protocolType?`, `port?`, `options?`): `Promise`\<`OperationResult`\>

Asynchronously get a link associated with the current session.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `protocolType?` | `string` | Optional protocol type to use for the link |
| `port?` | `number` | Optional port to use for the link (must be in range [30100, 30199]) |
| `options?` | `string` | - |

#### Returns

`Promise`\<`OperationResult`\>

OperationResult containing the link as data and request ID

**`Throws`**

Error if the operation fails (matching Python SessionError)

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();
if (result.success) {
  const linkResult = await result.session.getLinkAsync(undefined, 30150);
  console.log(`Port link: ${linkResult.data}`);
  await result.session.delete();
}
```

___

### info

‚ñ∏ **info**(): `Promise`\<`OperationResult`\>

Retrieves detailed information about the current session.

#### Returns

`Promise`\<`OperationResult`\>

Promise resolving to OperationResult containing:
         - success: Whether the operation succeeded (always true if no exception)
         - data: SessionInfo object with the following fields:
           - sessionId (string): The session identifier
           - resourceUrl (string): URL for accessing the session
           - appId (string): Application ID (for desktop sessions)
           - authCode (string): Authentication code
           - connectionProperties (string): Connection configuration
           - resourceId (string): Resource identifier
           - resourceType (string): Type of resource (e.g., "Desktop")
           - ticket (string): Access ticket
         - requestId: Unique identifier for this API request
         - errorMessage: Error description if operation failed

**`Throws`**

Error if the API request fails or response is invalid.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();
if (result.success) {
  const infoResult = await result.session.info();
  console.log(`Session ID: ${infoResult.data.sessionId}`);
  console.log(`Resource URL: ${infoResult.data.resourceUrl}`);
  await result.session.delete();
}
```

**`Remarks`**

**Behavior:**
- This method calls the GetMcpResource API to retrieve session metadata
- The returned SessionInfo contains:
  - sessionId: The session identifier
  - resourceUrl: URL for accessing the session
  - Desktop-specific fields (appId, authCode, connectionProperties, etc.)
    are populated from the DesktopInfo section of the API response
- Session info is retrieved from the AgentBay API in real-time
- The resourceUrl can be used for browser-based access
- Desktop-specific fields (appId, authCode) are only populated for desktop sessions
- This method does not modify the session state

**`See`**

[delete](#delete), [getLink](#getlink)

___

### listMcpTools

‚ñ∏ **listMcpTools**(`imageId?`): `Promise`\<`McpToolsResult`\>

List MCP tools available for this session.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `imageId?` | `string` | Optional image ID, defaults to session's imageId or "linux_latest" |

#### Returns

`Promise`\<`McpToolsResult`\>

McpToolsResult containing tools list and request ID

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();
if (result.success) {
  const toolsResult = await result.session.listMcpTools();
  console.log(`Found ${toolsResult.tools.length} MCP tools`);
  await result.session.delete();
}
```

___

### pauseAsync

‚ñ∏ **pauseAsync**(`timeout?`, `pollInterval?`): `Promise`\<`SessionPauseResult`\>

Asynchronously pause this session, putting it into a dormant state.

This method calls the PauseSessionAsync API to initiate the pause operation and then polls
the GetSession API to check the session status until it becomes PAUSED or until timeout is reached.
During the paused state, resource usage and costs are reduced while session state is preserved.

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `timeout` | `number` | `600` | Timeout in seconds to wait for the session to pause. Defaults to 600 seconds. |
| `pollInterval` | `number` | `2.0` | Interval in seconds between status polls. Defaults to 2.0 seconds. |

#### Returns

`Promise`\<`SessionPauseResult`\>

Promise resolving to SessionPauseResult containing:
         - success: Whether the pause operation succeeded
         - requestId: Unique identifier for this API request
         - status: Final session status (should be "PAUSED" if successful)
         - errorMessage: Error description if pause failed

**`Throws`**

Error if the API call fails or network issues occur.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();
if (result.success) {
  const pauseResult = await result.session.pauseAsync();
  if (pauseResult.success) {
    console.log('Session paused successfully');
  }
}
```

**`Remarks`**

**Behavior:**
- Initiates pause operation through PauseSessionAsync API
- Polls session status until PAUSED state or timeout
- Session state transitions: RUNNING -> PAUSING -> PAUSED
- All session state is preserved during pause

**Important Notes:**
- Paused sessions cannot perform operations (deletion, task execution, etc.)
- Use [resumeAsync](#resumeasync) to restore the session to RUNNING state
- During pause, both resource usage and costs are lower
- If timeout is exceeded, returns with success=false

**`See`**

[resumeAsync](#resumeasync)

___

### resumeAsync

‚ñ∏ **resumeAsync**(`timeout?`, `pollInterval?`): `Promise`\<`SessionResumeResult`\>

Asynchronously resume this session from a paused state.

This method calls the ResumeSessionAsync API to initiate the resume operation and then polls
the GetSession API to check the session status until it becomes RUNNING or until timeout is reached.
After resuming, the session restores full functionality and can perform all operations normally.

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `timeout` | `number` | `600` | Timeout in seconds to wait for the session to resume. Defaults to 600 seconds. |
| `pollInterval` | `number` | `2.0` | Interval in seconds between status polls. Defaults to 2.0 seconds. |

#### Returns

`Promise`\<`SessionResumeResult`\>

Promise resolving to SessionResumeResult containing:
         - success: Whether the resume operation succeeded
         - requestId: Unique identifier for this API request
         - status: Final session status (should be "RUNNING" if successful)
         - errorMessage: Error description if resume failed

**`Throws`**

Error if the API call fails or network issues occur.

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.get('paused_session_id');
if (result.success) {
  const resumeResult = await result.session.resumeAsync();
  if (resumeResult.success) {
    console.log('Session resumed successfully');
  }
}
```

**`Remarks`**

**Behavior:**
- Initiates resume operation through ResumeSessionAsync API
- Polls session status until RUNNING state or timeout
- Session state transitions: PAUSED -> RESUMING -> RUNNING
- All previous session state is restored during resume

**Important Notes:**
- Only sessions in PAUSED state can be resumed
- After resume, the session can perform all operations normally
- Use [pauseAsync](#pauseasync) to put a session into PAUSED state
- If timeout is exceeded, returns with success=false

**`See`**

[pauseAsync](#pauseasync)

___

### setLabels

‚ñ∏ **setLabels**(`labels`): `Promise`\<`OperationResult`\>

Sets the labels for this session.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `labels` | `Record`\<`string`, `string`\> | The labels to set for the session. |

#### Returns

`Promise`\<`OperationResult`\>

OperationResult indicating success or failure with request ID

**`Throws`**

Error if the operation fails (matching Python SessionError)

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create();
if (result.success) {
  const setResult = await result.session.setLabels({ project: 'demo', env: 'test' });
  console.log('Labels set:', setResult.success);
  await result.session.delete();
}
```

## Related Resources

- [FileSystem API Reference](filesystem.md)
- [Command API Reference](command.md)
- [Context API Reference](context.md)
- [Context Manager API Reference](context-manager.md)
- [OSS API Reference](../../common-features/advanced/oss.md)





# Class: Computer

## üñ•Ô∏è Related Tutorial

- [Computer Use Guide](../../../../docs/guides/computer-use/README.md) - Automate desktop applications

## Overview

The Computer module provides comprehensive desktop automation capabilities including mouse operations,
keyboard input, screen capture, and window management. It enables automated UI testing and RPA workflows.


## Requirements

- Requires `windows_latest` image for computer use features

## Data Types

### MouseButton

Mouse button constants: Left, Right, Middle

### ScrollDirection

Scroll direction constants: Up, Down, Left, Right

### KeyModifier

Keyboard modifier keys: Ctrl, Alt, Shift, Win

## Important Notes

- Key names in PressKeys and ReleaseKeys are case-sensitive
- Coordinate validation: x and y must be non-negative integers
- Drag operation requires valid start and end coordinates
- Screenshot operations may have size limitations

## Table of contents


### Methods

- [activateWindow](#activatewindow)
- [clickMouse](#clickmouse)
- [closeWindow](#closewindow)
- [dragMouse](#dragmouse)
- [focusMode](#focusmode)
- [fullscreenWindow](#fullscreenwindow)
- [inputText](#inputtext)
- [listRootWindows](#listrootwindows)
- [listVisibleApps](#listvisibleapps)
- [maximizeWindow](#maximizewindow)
- [minimizeWindow](#minimizewindow)
- [moveMouse](#movemouse)
- [pressKeys](#presskeys)
- [releaseKeys](#releasekeys)
- [resizeWindow](#resizewindow)
- [restoreWindow](#restorewindow)
- [screenshot](#screenshot)
- [scroll](#scroll)
- [startApp](#startapp)
- [stopAppByCmd](#stopappbycmd)
- [stopAppByPID](#stopappbypid)
- [stopAppByPName](#stopappbypname)

## Methods

### activateWindow

‚ñ∏ **activateWindow**(`windowId`): `Promise`\<`BoolResult`\>

Activates the specified window.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `windowId` | `number` | ID of the window to activate |

#### Returns

`Promise`\<`BoolResult`\>

Promise resolving to result with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  const windows = await result.session.computer.listRootWindows();
  await result.session.computer.activateWindow(windows.windows[0].id);
  await result.session.delete();
}
```

___

### clickMouse

‚ñ∏ **clickMouse**(`x`, `y`, `button?`): `Promise`\<`BoolResult`\>

Click mouse at specified coordinates.

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `x` | `number` | `undefined` | X coordinate for the click |
| `y` | `number` | `undefined` | Y coordinate for the click |
| `button` | `string` | `MouseButton.LEFT` | Mouse button to click (default: 'left'). Valid values: 'left', 'right', 'middle', 'double_left' |

#### Returns

`Promise`\<`BoolResult`\>

Promise resolving to result with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  const clickResult = await result.session.computer.clickMouse(100, 100, 'left');
  console.log('Clicked:', clickResult.success);
  await result.session.delete();
}
```

___

### closeWindow

‚ñ∏ **closeWindow**(`windowId`): `Promise`\<`BoolResult`\>

Closes the specified window.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `windowId` | `number` | ID of the window to close |

#### Returns

`Promise`\<`BoolResult`\>

Promise resolving to result with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  await result.session.computer.startApp('notepad.exe');
  const win = await result.session.computer.getActiveWindow();
  await result.session.computer.closeWindow(win.window!.id);
  await result.session.delete();
}
```

___

### dragMouse

‚ñ∏ **dragMouse**(`fromX`, `fromY`, `toX`, `toY`, `button?`): `Promise`\<`BoolResult`\>

Drag mouse from one position to another.

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `fromX` | `number` | `undefined` | Starting X coordinate |
| `fromY` | `number` | `undefined` | Starting Y coordinate |
| `toX` | `number` | `undefined` | Ending X coordinate |
| `toY` | `number` | `undefined` | Ending Y coordinate |
| `button` | `string` | `MouseButton.LEFT` | Mouse button to use for drag (default: 'left'). Valid values: 'left', 'right', 'middle' |

#### Returns

`Promise`\<`BoolResult`\>

Promise resolving to result with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  const dragResult = await result.session.computer.dragMouse(100, 100, 300, 300, 'left');
  console.log('Dragged:', dragResult.success);
  await result.session.delete();
}
```

___

### focusMode

‚ñ∏ **focusMode**(`on`): `Promise`\<`BoolResult`\>

Toggles focus mode on or off.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `on` | `boolean` | Whether to enable (true) or disable (false) focus mode |

#### Returns

`Promise`\<`BoolResult`\>

Promise resolving to result with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  await result.session.computer.focusMode(true);
  await result.session.computer.focusMode(false);
  await result.session.delete();
}
```

___

### fullscreenWindow

‚ñ∏ **fullscreenWindow**(`windowId`): `Promise`\<`BoolResult`\>

Makes the specified window fullscreen.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `windowId` | `number` | ID of the window to make fullscreen |

#### Returns

`Promise`\<`BoolResult`\>

Promise resolving to result with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  await result.session.computer.startApp('notepad.exe');
  const win = await result.session.computer.getActiveWindow();
  await result.session.computer.fullscreenWindow(win.window!.id);
  await result.session.delete();
}
```

### inputText

‚ñ∏ **inputText**(`text`): `Promise`\<`BoolResult`\>

Input text at the current cursor position.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `text` | `string` | Text to input |

#### Returns

`Promise`\<`BoolResult`\>

Promise resolving to result with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  await result.session.computer.inputText('Hello AgentBay!');
  await result.session.delete();
}
```

___

### listRootWindows

‚ñ∏ **listRootWindows**(`timeoutMs?`): `Promise`\<`WindowListResult`\>

Lists all root windows.

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `timeoutMs` | `number` | `3000` | Timeout in milliseconds (default: 3000) |

#### Returns

`Promise`\<`WindowListResult`\>

Promise resolving to result containing array of root windows

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  const windows = await result.session.computer.listRootWindows();
  console.log(`Found ${windows.windows.length} windows`);
  await result.session.delete();
}
```

___

### listVisibleApps

‚ñ∏ **listVisibleApps**(): `Promise`\<`any`\>

Lists all visible applications.

#### Returns

`Promise`\<`any`\>

Promise resolving to result containing array of visible application processes

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  const apps = await result.session.computer.listVisibleApps();
  console.log(`Found ${apps.data.length} visible apps`);
  await result.session.delete();
}
```

___

### maximizeWindow

‚ñ∏ **maximizeWindow**(`windowId`): `Promise`\<`BoolResult`\>

Maximizes the specified window.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `windowId` | `number` | ID of the window to maximize |

#### Returns

`Promise`\<`BoolResult`\>

Promise resolving to result with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  await result.session.computer.startApp('notepad.exe');
  const win = await result.session.computer.getActiveWindow();
  await result.session.computer.maximizeWindow(win.window!.id);
  await result.session.delete();
}
```

___

### minimizeWindow

‚ñ∏ **minimizeWindow**(`windowId`): `Promise`\<`BoolResult`\>

Minimizes the specified window.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `windowId` | `number` | ID of the window to minimize |

#### Returns

`Promise`\<`BoolResult`\>

Promise resolving to result with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  await result.session.computer.startApp('notepad.exe');
  const win = await result.session.computer.getActiveWindow();
  await result.session.computer.minimizeWindow(win.window!.id);
  await result.session.delete();
}
```

___

### moveMouse

‚ñ∏ **moveMouse**(`x`, `y`): `Promise`\<`BoolResult`\>

Move mouse to specified coordinates.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `x` | `number` | X coordinate to move to |
| `y` | `number` | Y coordinate to move to |

#### Returns

`Promise`\<`BoolResult`\>

Promise resolving to result with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  await result.session.computer.moveMouse(300, 400);
  const pos = await result.session.computer.getCursorPosition();
  console.log(`Position: (${pos.x}, ${pos.y})`);
  await result.session.delete();
}
```

___

### pressKeys

‚ñ∏ **pressKeys**(`keys`, `hold?`): `Promise`\<`BoolResult`\>

Press one or more keys.

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `keys` | `string`[] | `undefined` | Array of key names to press |
| `hold` | `boolean` | `false` | Whether to hold the keys down (default: false) |

#### Returns

`Promise`\<`BoolResult`\>

Promise resolving to result with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  await result.session.computer.pressKeys(['Ctrl', 'c'], true);
  await result.session.computer.releaseKeys(['Ctrl', 'c']);
  await result.session.delete();
}
```

___

### releaseKeys

‚ñ∏ **releaseKeys**(`keys`): `Promise`\<`BoolResult`\>

Release previously pressed keys.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `keys` | `string`[] | Array of key names to release |

#### Returns

`Promise`\<`BoolResult`\>

Promise resolving to result with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  await result.session.computer.pressKeys(['Ctrl'], true);
  await result.session.computer.releaseKeys(['Ctrl']);
  await result.session.delete();
}
```

___

### resizeWindow

‚ñ∏ **resizeWindow**(`windowId`, `width`, `height`): `Promise`\<`BoolResult`\>

Resizes the specified window.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `windowId` | `number` | ID of the window to resize |
| `width` | `number` | New width of the window |
| `height` | `number` | New height of the window |

#### Returns

`Promise`\<`BoolResult`\>

Promise resolving to result with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  await result.session.computer.startApp('notepad.exe');
  const win = await result.session.computer.getActiveWindow();
  await result.session.computer.resizeWindow(win.window!.id, 800, 600);
  await result.session.delete();
}
```

___

### restoreWindow

‚ñ∏ **restoreWindow**(`windowId`): `Promise`\<`BoolResult`\>

Restores the specified window.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `windowId` | `number` | ID of the window to restore |

#### Returns

`Promise`\<`BoolResult`\>

Promise resolving to result with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  await result.session.computer.startApp('notepad.exe');
  const win = await result.session.computer.getActiveWindow();
  await result.session.computer.minimizeWindow(win.window!.id);
  await result.session.computer.restoreWindow(win.window!.id);
  await result.session.delete();
}
```

___

### screenshot

‚ñ∏ **screenshot**(): `Promise`\<`ScreenshotResult`\>

Take a screenshot.

#### Returns

`Promise`\<`ScreenshotResult`\>

Promise resolving to result containing screenshot URL

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  const screenshot = await result.session.computer.screenshot();
  console.log('Screenshot URL:', screenshot.data);
  await result.session.delete();
}
```

___

### scroll

‚ñ∏ **scroll**(`x`, `y`, `direction?`, `amount?`): `Promise`\<`BoolResult`\>

Scroll at specified coordinates.

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `x` | `number` | `undefined` | X coordinate to scroll at |
| `y` | `number` | `undefined` | Y coordinate to scroll at |
| `direction` | `string` | `ScrollDirection.UP` | Scroll direction (default: 'up'). Valid values: 'up', 'down', 'left', 'right' |
| `amount` | `number` | `1` | Scroll amount (default: 1) |

#### Returns

`Promise`\<`BoolResult`\>

Promise resolving to result with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  await result.session.computer.scroll(400, 300, 'up', 3);
  await result.session.delete();
}
```

___

### startApp

‚ñ∏ **startApp**(`startCmd`, `workDirectory?`, `activity?`): `Promise`\<`any`\>

Starts the specified application.

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `startCmd` | `string` | `undefined` | The command to start the application (e.g., 'notepad.exe', 'calculator:') |
| `workDirectory` | `string` | `""` | The working directory for the application (optional) |
| `activity` | `string` | `""` | The activity parameter (optional, primarily for mobile use) |

#### Returns

`Promise`\<`any`\>

Promise resolving to result containing array of started processes

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  const startResult = await result.session.computer.startApp('notepad.exe');
  console.log(`Started ${startResult.data.length} process(es)`);
  await result.session.delete();
}
```

___

### stopAppByCmd

‚ñ∏ **stopAppByCmd**(`cmd`): `Promise`\<`any`\>

Stops an application by stop command.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `cmd` | `string` | The command to stop the application |

#### Returns

`Promise`\<`any`\>

Promise resolving to result with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  await result.session.computer.startApp('notepad.exe');
  await result.session.computer.stopAppByCmd('taskkill /IM notepad.exe /F');
  await result.session.delete();
}
```

___

### stopAppByPID

‚ñ∏ **stopAppByPID**(`pid`): `Promise`\<`any`\>

Stops an application by process ID.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `pid` | `number` | The process ID to stop |

#### Returns

`Promise`\<`any`\>

Promise resolving to result with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  const startResult = await result.session.computer.startApp('notepad.exe');
  const pid = startResult.data[0].pid;
  await result.session.computer.stopAppByPID(pid);
  await result.session.delete();
}
```

___

### stopAppByPName

‚ñ∏ **stopAppByPName**(`pname`): `Promise`\<`any`\>

Stops an application by process name.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `pname` | `string` | The process name to stop (e.g., 'notepad.exe', 'chrome.exe') |

#### Returns

`Promise`\<`any`\>

Promise resolving to result with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: 'your_api_key' });
const result = await agentBay.create({ imageId: 'windows_latest' });
if (result.success) {
  await result.session.computer.startApp('notepad.exe');
  await result.session.computer.stopAppByPName('notepad.exe');
  await result.session.delete();
}
```

## Best Practices

1. Verify screen coordinates before mouse operations
2. Use appropriate delays between UI interactions
3. Handle window focus changes properly
4. Take screenshots for verification and debugging
5. Use keyboard shortcuts for efficient automation
6. Clean up windows and applications after automation





# Class: Mobile

## üì± Related Tutorial

- [Mobile Use Guide](../../../../docs/guides/mobile-use/README.md) - Automate mobile applications

## Overview

The Mobile module provides mobile device automation capabilities including touch gestures,
text input, app management, and screenshot capture. It supports Android device automation.


## Requirements

- Requires `mobile_latest` image for mobile automation features

## Table of contents


### Methods

- [configure](#configure)
- [inputText](#inputtext)
- [screenshot](#screenshot)
- [sendKey](#sendkey)
- [setAppBlacklist](#setappblacklist)
- [setAppWhitelist](#setappwhitelist)
- [setNavigationBarVisibility](#setnavigationbarvisibility)
- [setResolutionLock](#setresolutionlock)
- [setUninstallBlacklist](#setuninstallblacklist)
- [startApp](#startapp)
- [stopAppByCmd](#stopappbycmd)
- [swipe](#swipe)
- [tap](#tap)

## Methods

### configure

‚ñ∏ **configure**(`config`): `Promise`\<`OperationResult`\>

Configure mobile device settings based on MobileExtraConfig.
This method applies various mobile configuration settings including
resolution lock and app access management.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `config` | ``MobileExtraConfig`` | The mobile configuration to apply |

#### Returns

`Promise`\<`OperationResult`\>

OperationResult indicating success or failure

### inputText

‚ñ∏ **inputText**(`text`): `Promise`\<`BoolResult`\>

Input text at the current focus position.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `text` | `string` | Text to input |

#### Returns

`Promise`\<`BoolResult`\>

Promise resolving to BoolResult with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'mobile_latest' });
if (result.success) {
  const inputResult = await result.session.mobile.inputText('Hello Mobile');
  console.log('Text input successfully:', inputResult.success);
  await result.session.delete();
}
```

___

### screenshot

‚ñ∏ **screenshot**(): `Promise`\<`ScreenshotResult`\>

Take a screenshot of the current mobile screen.

#### Returns

`Promise`\<`ScreenshotResult`\>

Promise resolving to ScreenshotResult containing screenshot URL

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'mobile_latest' });
if (result.success) {
  const screenshotResult = await result.session.mobile.screenshot();
  console.log('Screenshot URL:', screenshotResult.data);
  await result.session.delete();
}
```

___

### sendKey

‚ñ∏ **sendKey**(`key`): `Promise`\<`BoolResult`\>

Send Android key code.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `key` | `number` | Android key code (e.g., 4 for BACK, 3 for HOME, 24 for VOLUME_UP) |

#### Returns

`Promise`\<`BoolResult`\>

Promise resolving to BoolResult with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'mobile_latest' });
if (result.success) {
  const keyResult = await result.session.mobile.sendKey(4);
  console.log('BACK key sent:', keyResult.success);
  await result.session.delete();
}
```

___

### setAppBlacklist

‚ñ∏ **setAppBlacklist**(`packageNames`): `Promise`\<`OperationResult`\>

Set app blacklist configuration.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `packageNames` | `string`[] | List of package names to blacklist |

#### Returns

`Promise`\<`OperationResult`\>

OperationResult indicating success or failure

___

### setAppWhitelist

‚ñ∏ **setAppWhitelist**(`packageNames`): `Promise`\<`OperationResult`\>

Set app whitelist configuration.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `packageNames` | `string`[] | List of package names to whitelist |

#### Returns

`Promise`\<`OperationResult`\>

OperationResult indicating success or failure

___

### setNavigationBarVisibility

‚ñ∏ **setNavigationBarVisibility**(`hide`): `Promise`\<`OperationResult`\>

Set navigation bar visibility for mobile devices.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `hide` | `boolean` | True to hide navigation bar, false to show navigation bar |

#### Returns

`Promise`\<`OperationResult`\>

OperationResult indicating success or failure

___

### setResolutionLock

‚ñ∏ **setResolutionLock**(`enable`): `Promise`\<`OperationResult`\>

Set display resolution lock for mobile devices.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `enable` | `boolean` | Whether to enable resolution lock |

#### Returns

`Promise`\<`OperationResult`\>

OperationResult indicating success or failure

___

### setUninstallBlacklist

‚ñ∏ **setUninstallBlacklist**(`packageNames`): `Promise`\<`OperationResult`\>

Set uninstall protection blacklist for mobile devices.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `packageNames` | `string`[] | List of Android package names to protect from uninstallation |

#### Returns

`Promise`\<`OperationResult`\>

OperationResult indicating success or failure

___

### startApp

‚ñ∏ **startApp**(`startCmd`, `workDirectory?`, `activity?`): `Promise`\<`ProcessResult`\>

Start an app.

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `startCmd` | `string` | `undefined` | Start command using "monkey -p" format (e.g., 'monkey -p com.android.settings') |
| `workDirectory` | `string` | `''` | Optional working directory for the app |
| `activity` | `string` | `''` | Optional activity name to launch |

#### Returns

`Promise`\<`ProcessResult`\>

Promise resolving to ProcessResult containing launched process information

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'mobile_latest' });
if (result.success) {
  const startResult = await result.session.mobile.startApp('monkey -p com.android.settings');
  console.log('App started:', startResult.success);
  await result.session.delete();
}
```

___

### stopAppByCmd

‚ñ∏ **stopAppByCmd**(`stopCmd`): `Promise`\<`BoolResult`\>

Stop app by command.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `stopCmd` | `string` | Package name of the app to stop (e.g., 'com.android.settings') |

#### Returns

`Promise`\<`BoolResult`\>

Promise resolving to BoolResult with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'mobile_latest' });
if (result.success) {
  await result.session.mobile.startApp('monkey -p com.android.settings');
  const stopResult = await result.session.mobile.stopAppByCmd('com.android.settings');
  console.log('App stopped:', stopResult.success);
  await result.session.delete();
}
```

___

### swipe

‚ñ∏ **swipe**(`startX`, `startY`, `endX`, `endY`, `durationMs?`): `Promise`\<`BoolResult`\>

Swipe from one position to another on the mobile screen.

#### Parameters

| Name | Type | Default value | Description |
| :------ | :------ | :------ | :------ |
| `startX` | `number` | `undefined` | Starting X coordinate |
| `startY` | `number` | `undefined` | Starting Y coordinate |
| `endX` | `number` | `undefined` | Ending X coordinate |
| `endY` | `number` | `undefined` | Ending Y coordinate |
| `durationMs` | `number` | `300` | Swipe duration in milliseconds. Default is 300 |

#### Returns

`Promise`\<`BoolResult`\>

Promise resolving to BoolResult with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'mobile_latest' });
if (result.success) {
  const swipeResult = await result.session.mobile.swipe(200, 400, 200, 100, 300);
  console.log('Swipe success:', swipeResult.success);
  await result.session.delete();
}
```

___

### tap

‚ñ∏ **tap**(`x`, `y`): `Promise`\<`BoolResult`\>

Tap at specified coordinates on the mobile screen.

#### Parameters

| Name | Type | Description |
| :------ | :------ | :------ |
| `x` | `number` | X coordinate for the tap |
| `y` | `number` | Y coordinate for the tap |

#### Returns

`Promise`\<`BoolResult`\>

Promise resolving to BoolResult with success status

**`Example`**

```typescript
const agentBay = new AgentBay({ apiKey: process.env.AGENTBAY_API_KEY });
const result = await agentBay.create({ imageId: 'mobile_latest' });
if (result.success) {
  const tapResult = await result.session.mobile.tap(100, 100);
  console.log('Tap success:', tapResult.success);
  await result.session.delete();
}
```

## Best Practices

1. Verify element coordinates before tap operations
2. Use appropriate swipe durations for smooth gestures
3. Wait for UI elements to load before interaction
4. Take screenshots for verification and debugging
5. Handle app installation and uninstallation properly
6. Configure app whitelists/blacklists for security


## Related Resources

- [Session API Reference](../common-features/basics/session.md)





# TypeScript SDK Examples

This directory contains TypeScript examples demonstrating various features and capabilities of the AgentBay SDK.

## üìÅ Directory Structure

The examples are organized by feature categories:

```
examples/
‚îú‚îÄ‚îÄ basic-usage.ts                 # Quick start single-file example
‚îú‚îÄ‚îÄ common-features/               # Features available across all environments
‚îÇ   ‚îú‚îÄ‚îÄ basics/                    # Essential features
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ session-creation/      # Session lifecycle management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ command-example/       # Command execution
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ filesystem-example/    # File operations and monitoring
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ context-management/    # Context creation and management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ data-persistence/      # Data persistence across sessions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ list_sessions/         # Session listing and filtering
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ get/                   # Session retrieval
‚îÇ   ‚îî‚îÄ‚îÄ advanced/                  # Advanced features
‚îÇ       ‚îú‚îÄ‚îÄ agent-module-example/  # AI-powered automation
‚îÇ       ‚îú‚îÄ‚îÄ vpc-session-example/   # Secure isolated network environments
‚îÇ       ‚îî‚îÄ‚îÄ archive-upload-mode-example/ # Archive upload mode
‚îú‚îÄ‚îÄ browser-use/                   # Browser automation (browser_latest)
‚îÇ   ‚îú‚îÄ‚îÄ browser/                   # Browser automation examples
‚îÇ   ‚îî‚îÄ‚îÄ extension-example/         # Browser extension management
‚îú‚îÄ‚îÄ computer-use/                  # Windows desktop automation (windows_latest)
‚îÇ   ‚îî‚îÄ‚îÄ ui-example/                # UI automation
‚îú‚îÄ‚îÄ mobile-use/                    # Mobile UI automation (mobile_latest)
‚îÇ   ‚îî‚îÄ‚îÄ mobile-get-adb-url/        # ADB URL retrieval
‚îî‚îÄ‚îÄ codespace/                     # Code execution (code_latest)
    ‚îî‚îÄ‚îÄ automation/                # Automation workflows
```

## üöÄ Quick Start

### Single-File Example

The fastest way to get started:

```bash
# Install dependencies
npm install wuying-agentbay-sdk

# Set your API key
export AGENTBAY_API_KEY=your_api_key_here

# Run the quick start example
npx ts-node basic-usage.ts
```

This example demonstrates:
- Initializing the AgentBay client
- Creating sessions
- Basic operations (commands, file operations)
- Session cleanup

## üìö Feature Categories

### [Common Features](common-features/basics/command-example/README.md)

Features available across all environment types (browser, computer, mobile, codespace).

**Basics:**
- **Session Management**: Create, configure, and manage cloud sessions
- **Command Execution**: Execute shell commands in cloud environments
- **File Operations**: Read, write, and manage files
- **Context Management**: Persistent data storage across sessions
- **Data Persistence**: Cross-session data sharing and synchronization

**Advanced:**
- **Agent Module**: AI-powered task automation with natural language
- **VPC Sessions**: Secure isolated network environments
- **Archive Upload**: Archive upload mode configuration

### [Browser Use](browser-use/browser/README.md)

Cloud-based browser automation with Playwright integration.

**Key Features:**
- Cookie and session persistence
- Stealth mode to avoid detection
- CAPTCHA handling capabilities
- Browser extension support
- Proxy configuration
- Custom viewport and fingerprinting


### [Mobile Use](mobile-use/mobile-get-adb-url/README.md)

Android mobile UI automation for app testing.

**Key Features:**
- ADB URL retrieval
- Mobile device connection
- Remote debugging

### [CodeSpace](codespace/automation/)

Cloud-based development environment for code execution.

**Key Features:**
- Automation workflows
- Shell command execution
- File system operations

## üìã Prerequisites

### Basic Requirements

- Node.js 16 or later
- TypeScript 4.5 or later
- Valid `AGENTBAY_API_KEY` environment variable

### Installation

```bash
# Install the SDK
npm install wuying-agentbay-sdk

# For browser examples, install Playwright
npm install playwright
npx playwright install chromium

# Install TypeScript and ts-node (if not already installed)
npm install -D typescript ts-node @types/node
```

## üéØ Running Examples

```bash
# Set your API key
export AGENTBAY_API_KEY=your_api_key_here

# Run any example with ts-node
npx ts-node basic-usage.ts
npx ts-node common-features/basics/session-creation/session-creation.ts

# Or compile and run
tsc basic-usage.ts
node basic-usage.js
```

## üí° Common Patterns

### Basic Session Creation

```typescript
import { AgentBay, CreateSessionParams } from 'wuying-agentbay-sdk';

async function main() {
  // Initialize client
  const apiKey = process.env.AGENTBAY_API_KEY!;
  const agentBay = new AgentBay(apiKey);
  
  // Create session
  const params: CreateSessionParams = {
    imageId: 'linux_latest',
  };
  
  const result = await agentBay.create(params);
  
  if (result.success) {
    const session = result.session;
    console.log(`Session created: ${session.sessionId}`);
    
    // Use session...
    
    // Cleanup
    await agentBay.delete(session);
  }
}

main().catch(console.error);
```

### File Operations

```typescript
// Write file
await session.fileSystem.writeFile('/tmp/test.txt', 'content');

// Read file
const result = await session.fileSystem.readFile('/tmp/test.txt');
if (result.success) {
  console.log(result.content);
}
```

### Command Execution

```typescript
const result = await session.command.executeCommand('ls -la');
if (result.success) {
  console.log(result.output);
}
```

### Browser Automation

```typescript
import { BrowserOption } from 'wuying-agentbay-sdk';
import { chromium } from 'playwright';

// Initialize browser
const option = new BrowserOption();
await session.browser.initializeAsync(option);

// Connect Playwright
const endpointUrl = session.browser.getEndpointUrl();
const browser = await chromium.connectOverCDP(endpointUrl);
const context = browser.contexts()[0];
const page = await context.newPage();

// Automate...
await page.goto('https://example.com');

await browser.close();
```

## üéì Learning Path

### For Beginners

1. Start with [basic-usage.ts](basic-usage.ts)
2. Explore [Common Features - Basics](common-features/basics/)
3. Try environment-specific examples based on your use case

### For Experienced Developers

1. Review [Common Features](common-features/) for SDK capabilities
2. Jump to your specific environment:
   - [Browser Use](browser-use/) for web automation
   - [Mobile Use](mobile-use/) for mobile automation
   - [CodeSpace](codespace/) for code execution
3. Explore [Advanced Features](common-features/advanced/) for integrations

## üìñ Best Practices

1. **Always Clean Up**: Delete sessions when done to free resources
2. **Error Handling**: Always check `result.success` before using data
3. **Async/Await**: Use async/await for cleaner asynchronous code
4. **Type Safety**: Leverage TypeScript's type system for better code quality
5. **Resource Limits**: Be aware of concurrent session limits

## üîç Example Index

### By Use Case

**Web Automation:**
- Browser stealth mode: `browser-use/browser/browser-stealth.ts`
- Cookie persistence: `browser-use/browser/browser-context-cookie-persistence.ts`
- CAPTCHA handling: `browser-use/browser/captcha_tongcheng.ts`

**Desktop Automation:**
- UI automation: `computer-use/ui-example/ui-example.ts`

**Mobile Automation:**
- ADB integration: `mobile-use/mobile-get-adb-url/index.ts`

**Code Execution:**
- Automation: `codespace/automation/automation-example.ts`

**Data Management:**
- File operations: `common-features/basics/filesystem-example/filesystem-example.ts`
- Context management: `common-features/basics/context-management/context-management.ts`
- Data persistence: `common-features/basics/data-persistence/data-persistence.ts`

**Advanced Features:**
- AI Agent: `common-features/advanced/agent-module-example/agent-module-example.ts`
- VPC sessions: `common-features/advanced/vpc-session-example/vpc-session-example.ts`

## üÜò Troubleshooting

### Resource Creation Delay

If you see "The system is creating resources" message:
- Wait 90 seconds and retry
- This is normal for resource initialization

### API Key Issues

Ensure your API key is properly set:
```bash
export AGENTBAY_API_KEY=your_api_key_here
# Verify
echo $AGENTBAY_API_KEY
```

### Module Issues

If you get module errors:
```bash
# Ensure dependencies are installed
npm install

# Clear cache and reinstall
rm -rf node_modules package-lock.json
npm install
```

### TypeScript Compilation Errors

If you get TypeScript errors:
```bash
# Ensure TypeScript is installed
npm install -D typescript

# Check TypeScript version
npx tsc --version

# Compile with type checking
npx tsc --noEmit
```

## üìö Related Documentation

- [TypeScript SDK Documentation](../../)
- [API Reference](../api/)
- [Quick Start Guide](../../../docs/quickstart/README.md)
- [Feature Guides](../../../docs/guides/README.md)

## ü§ù Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation](../../../docs/README.md)

---

üí° **Tip**: Start with `basic-usage.ts` for a quick overview, then explore category-specific examples based on your needs.





# TypeScript Browser Examples

This directory contains TypeScript examples demonstrating browser automation capabilities of the AgentBay SDK.

## Prerequisites

1. **Install TypeScript SDK**:
   ```bash
   npm install @wuying-org/agentbay-sdk
   ```

2. **Install Playwright**:
   ```bash
   npm install playwright
   npx playwright install chromium
   ```

3. **Set API Key**:
   ```bash
   export AGENTBAY_API_KEY=your_api_key_here
   ```

## Examples

### 1. basic-usage.ts

A basic example showing how to:
- Create a session with a browser-enabled image
- Initialize the browser with default options
- Connect to the browser using Playwright over CDP
- Navigate to a website and interact with it
- Proper cleanup of resources

**Run:**
```bash
ts-node basic-usage.ts
```

**Key Features:**
- Session creation and management
- Browser initialization
- CDP connection with Playwright
- Basic navigation
- Resource cleanup

### 2. browser-viewport.ts

Demonstrates custom viewport and screen configuration:
- Setting custom user agent
- Configuring viewport dimensions
- Setting screen dimensions
- Verifying browser configuration

**Run:**
```bash
ts-node browser-viewport.ts
```

**Key Features:**
- Custom user agent
- Viewport configuration
- Screen dimensions
- Configuration verification

### 3. browser-fingerprint-xxx.ts

Shows how to configure browser fingerprinting:
- Three construction methods: random generation, custom configuration, and local fingerprint sync
- Fingerprint persistence capabilities across sessions

**Run:**
```bash
ts-node browser-fingerprint-xxx.ts
```

### 4. browser-proxies.ts

Demonstrates proxy configuration:
- Custom proxy setup
- WuYing proxy strategies (restricted/polling)
- Proxy authentication

**Run:**
```bash
ts-node browser-proxies.ts
```

**Key Features:**
- Custom proxy configuration
- WuYing proxy integration
- Proxy authentication
- IP rotation strategies

### 5. browser-context-cookie-persistence.ts

Demonstrates cookie persistence across sessions:
- Creating sessions with Browser Context
- Setting cookies manually using Playwright
- Deleting sessions with context synchronization
- Verifying cookie persistence in new sessions

**Run:**
```bash
ts-node browser-context-cookie-persistence.ts
```

**Key Features:**
- Browser Context configuration
- Cookie persistence
- Cross-session data sharing
- Resource cleanup

### 6. browser-type-example.ts

Comprehensive example demonstrating browser type selection:
- Chrome browser initialization
- Chromium browser initialization
- Default browser (undefined) usage
- Browser configuration verification
- Type-safe TypeScript patterns

**Run:**
```bash
# Run full example (tests all browser types)
ts-node browser-type-example.ts

# Run quick example (Chrome only)
ts-node browser-type-example.ts --quick

# Run type-safe example (demonstrates TypeScript types)
ts-node browser-type-example.ts --type-safe
```

**Key Features:**
- Browser type selection for Chrome, Chromium, and default
- TypeScript type safety demonstration
- Configuration validation
- Browser detection and verification
- Multiple usage patterns (BrowserOptionClass vs plain object)
- Command-line options for different test modes

### 7. Game Automation Examples

**run-2048.ts** and **run-sudoku.ts** demonstrate:
- Complex interaction patterns
- Agent-based automation for games
- Advanced browser control
- AI-powered game solving

**Run:**
```bash
ts-node run-2048.ts
ts-node run-sudoku.ts
```

### 8. screenshot-example.ts

An example demonstrating screenshot capabilities:
- Creating a browser session with AgentBay
- Using Playwright to connect to the browser instance
- Taking screenshots using direct Playwright integration (Uint8Array data)
- Saving screenshots to local files
- Customizing screenshot options (full page, image format, quality)

**Run:**
```bash
ts-node screenshot-example.ts
```

**Expected Output:**
```
üì∏ AgentBay Browser Screenshot Demo (TypeScript)
==================================================
Initializing AgentBay client...
Creating a new session...
Session created with ID: sess-xxxxx
Browser initialized successfully
Endpoint URL: ws://...
üì∏ Taking screenshot...
‚ÑπÔ∏è  Note: Screenshot functionality requires Playwright TypeScript integration
‚úÖ Browser screenshot demo completed

üßπ Cleaning up session sess-xxxxx...
‚úÖ Session deleted successfully
```

## Browser Type Selection

When using computer use images, you can choose between Chrome and Chromium:

```typescript
import { BrowserOptionClass } from '@wuying-org/agentbay-sdk';

// Use Chrome
const option = new BrowserOptionClass(
  false,  // useStealth
  undefined,  // userAgent
  undefined,  // viewport
  undefined,  // screen
  undefined,  // fingerprint
  false,  // solveCaptchas
  undefined,  // proxies
  'chrome' as 'chrome'  // browserType
);

// Or use plain object
const option = { browserType: 'chrome' as 'chrome' };

// Use Chromium
const option = { browserType: 'chromium' as 'chromium' };

// Use default (undefined - let image decide)
const option = new BrowserOptionClass();
```

## Common Patterns

### Basic Browser Initialization

```typescript
import { AgentBay, CreateSessionParams, BrowserOptionClass } from '@wuying-org/agentbay-sdk';

const agentBay = new AgentBay(process.env.AGENTBAY_API_KEY!);
const params = new CreateSessionParams({ imageId: 'browser_latest' });
const result = await agentBay.create(params);

if (!result.success || !result.session) {
  throw new Error("Failed to create session");
}

const session = result.session;
const option = new BrowserOptionClass();
const success = await session.browser.initializeAsync(option);

if (!success) {
  throw new Error("Browser initialization failed");
}
```

### Connecting Playwright

```typescript
import { chromium } from 'playwright';

const endpointUrl = session.browser.getEndpointUrl();
const browser = await chromium.connectOverCDP(endpointUrl);
const context = browser.contexts()[0];
const page = await context.newPage();

// Use page...

await browser.close();
session.delete();
```

### Error Handling

```typescript
try {
  const success = await session.browser.initializeAsync(option);
  if (!success) {
    throw new Error("Initialization failed");
  }
  
  // Use browser...
  
} catch (error) {
  console.error(`Error: ${error.message}`);
} finally {
  session.delete();
}
```

### Type-Safe Configuration

```typescript
import { BrowserOption } from '@wuying-org/agentbay-sdk';

const option: BrowserOption = {
  browserType: 'chrome',  // Type-checked
  useStealth: true,
  viewport: { width: 1920, height: 1080 },
  fingerprint: {
    devices: ["desktop"],
    operatingSystems: ["windows", "macos"],
    locales: ["en-US"]
  }
};
```

## Troubleshooting

### "AGENTBAY_API_KEY not set"

Set your API key:
```bash
export AGENTBAY_API_KEY=your_api_key_here
```

### "Browser not initialized"

Ensure the browser is initialized before connecting:
```typescript
if (!session.browser.isInitialized()) {
  throw new Error("Browser must be initialized first");
}
```

### "Failed to connect over CDP"

Check that the browser initialization was successful:
```typescript
const success = await session.browser.initializeAsync(option);
console.log(`Initialization success: ${success}`);
```

### TypeScript Compilation Errors

Ensure you have the correct types:
```bash
npm install --save-dev @types/node
```

## Additional Resources

- [Browser API Reference](../../../api/browser-use/browser.md)
- [Browser Use Guide](../../../../../docs/guides/browser-use/README.md)
- [Core Features](../../../../../docs/guides/browser-use/core-features.md)
- [Advanced Features](../../../../../docs/guides/browser-use/advance-features.md)
- [Playwright Documentation](https://playwright.dev/docs/intro)

## Example Output

### Successful Execution

```
Creating session...
Session created: sess-xxxxx
Initializing browser...
Browser initialized successfully
CDP endpoint: ws://...
Connecting to browser...
Page title: Example Domain
Browser automation completed
Session deleted
```

### With Custom Configuration

```
Initializing browser with custom configuration...
User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)...
Viewport: 1920 x 1080
Screen: 1920 x 1080
Configuration verified successfully
```



# Extension Management Example

This example demonstrates comprehensive browser extension management functionality using the Wuying AgentBay SDK for TypeScript.

## Overview

The extension management system allows you to:
- Upload browser extensions (.zip files) to cloud storage
- List and manage existing extensions  
- Create extension configurations for browser sessions
- Integrate extensions with browser automation workflows
- Handle multiple extensions in a single session
- Implement complete development workflows

## File Structure

```
extension-example/
‚îú‚îÄ‚îÄ extension-example.ts    # Comprehensive extension management examples
‚îî‚îÄ‚îÄ README.md             # This documentation file
```

## Key Components

### 1. Extension Class
Represents a browser extension with ID, name, and creation timestamp.

```typescript
const extension = new Extension('ext_123', 'my-extension.zip', '2023-01-01');
```

### 2. ExtensionOption Class
Configuration for browser extension integration, encapsulating context ID and extension IDs.

```typescript
const option = new ExtensionOption('context_123', ['ext_1', 'ext_2']);
```

### 3. ExtensionsService Class
Main service for managing extensions with automatic context handling.

```typescript
const service = new ExtensionsService(agentBay, 'my_extensions');
```

## Examples Included

The `extension-example.ts` file contains comprehensive examples demonstrating:

### 1. Basic Extension Management
- Upload a single extension
- Create extension options
- Integrate with browser sessions
- Basic error handling

### 2. Multiple Extensions Handling
- Upload multiple extensions
- Create sessions with multiple extensions
- Batch operations

### 3. Extension Development Workflow
- Complete development lifecycle
- Testing and validation patterns
- Extension updates
- Development context management

### 4. Error Handling and Validation
- Proper validation patterns
- Common error scenarios
- Best practices for error management

## Quick Start

### Prerequisites

1. **API Key**: Set your AgentBay API key
   ```bash
   export AGENTBAY_API_KEY="your-api-key-here"
   ```

2. **Extension Files**: Prepare your browser extension ZIP files
   - Extensions must be in ZIP format
   - Update file paths in the example code

### Running the Example

```bash
# Navigate to the TypeScript directory
cd typescript

# Install dependencies
npm install

# Build the project
npm run build

# Run the extension example
node docs/examples/extension-example/extension-example.js
```

### Code Example

```typescript
import { AgentBay, ExtensionsService } from "wuying-agentbay-sdk";
import { CreateSessionParams, BrowserContext } from "wuying-agentbay-sdk";

// Initialize AgentBay client
const agentBay = new AgentBay({
  apiKey: process.env.AGENTBAY_API_KEY,
});

// Create extensions service
const extensionsService = new ExtensionsService(agentBay, "browser_extensions");

try {
  // Upload extension
  const extension = await extensionsService.create("/path/to/extension.zip");
  
  // Create extension option
  const extOption = extensionsService.createExtensionOption([extension.id]);
  
  // Create browser session with extension
  const sessionParams = new CreateSessionParams()
    .withLabels({ purpose: "extension_demo" })
    .withBrowserContext(new BrowserContext(
      "browser_session",
      true,
      extOption
    ));
  
  const sessionResult = await agentBay.create(sessionParams.toJSON());
  const session = sessionResult.session;
  
  console.log(`Session created with extension: ${session.sessionId}`);
  
} finally {
  // Clean up resources
  await extensionsService.cleanup();
}
```

## Extension Integration

### Browser Context Integration

Extensions are automatically synchronized to `/tmp/extensions/` in browser sessions:

```typescript
// Extension option contains all necessary configuration
const extOption = extensionsService.createExtensionOption(['ext_1', 'ext_2']);

// Use with BrowserContext
const browserContext = new BrowserContext(
  "browser_session",
  true,          // auto-upload
  extOption      // extension configuration
);
```

### Context Management

The service supports two context modes:

1. **Named Context**: Provide a specific context name
   ```typescript
   new ExtensionsService(agentBay, "my_extensions")
   ```

2. **Auto-Generated Context**: Let the service generate a context name
   ```typescript
   new ExtensionsService(agentBay) // Generates: extensions-{timestamp}
   ```

## API Reference

### ExtensionsService Methods

- `create(localPath: string)` - Upload new extension
- `list()` - List all extensions in context
- `update(extensionId: string, newLocalPath: string)` - Update existing extension
- `delete(extensionId: string)` - Delete extension
- `createExtensionOption(extensionIds: string[])` - Create browser integration option
- `cleanup()` - Clean up auto-created contexts

### ExtensionOption Methods

- `validate()` - Validate configuration
- `toString()` - String representation
- `toDisplayString()` - Human-readable description

## Error Handling

The examples demonstrate comprehensive error handling:

```typescript
try {
  const extension = await extensionsService.create(extensionPath);
  // Handle success
} catch (error) {
  if (error.message.includes('File not found')) {
    console.log('Extension file does not exist');
  } else if (error.message.includes('Invalid format')) {
    console.log('Extension must be a ZIP file');
  } else {
    console.log('Upload failed:', error.message);
  }
}
```

## File Requirements

- **Format**: Extensions must be in ZIP format (.zip)
- **Structure**: Standard Chrome extension structure with manifest.json
- **Size**: Check AgentBay documentation for size limits
- **Permissions**: Ensure proper file permissions for reading

## Common Use Cases

1. **Extension Development**: Upload, test, and iterate on extensions
2. **Automated Testing**: Test extensions in cloud browser environments
3. **Batch Operations**: Manage multiple extensions simultaneously
4. **CI/CD Integration**: Automate extension deployment workflows

## Troubleshooting

### Common Issues

1. **File Not Found**: Ensure extension paths are correct
2. **Invalid Format**: Only ZIP files are supported
3. **API Key Missing**: Set AGENTBAY_API_KEY environment variable
4. **Context Conflicts**: Use unique context names for different projects

### Best Practices

1. **Always cleanup**: Use try/finally blocks for resource cleanup
2. **Validate inputs**: Check file existence before upload
3. **Handle errors**: Implement proper error handling for all operations
4. **Use descriptive names**: Name contexts and sessions clearly

## Next Steps

- Explore the complete API documentation at `typescript/docs/api/browser-use/extension.md`
- Check browser automation examples for integration patterns
- Review the AgentBay SDK documentation for advanced features
- Consider implementing custom validation and testing workflows

## Related Resources

- [Extension API Reference](../../../api/browser-use/extension.md) - Complete API documentation
- [Session API Reference](../../../api/common-features/basics/session.md) - Browser session management
- [Context API Reference](../../../api/common-features/basics/context.md) - Context management
- [AgentBay SDK Documentation](../../../api/common-features/basics/agentbay.md) - Core SDK features



# Agent Module Example

This example demonstrates how to use the Agent module to execute AI-powered tasks using natural language descriptions.

## Overview

The Agent module allows you to execute complex tasks using human-readable instructions, monitor task status, and terminate running tasks. This capability extends the functionality of cloud sessions by adding AI-powered automation.

## Running the Example

1. Ensure you have the AgentBay SDK installed
2. Set the `AGENTBAY_API_KEY` environment variable with your valid API key
3. Run the example:

```bash
cd docs/examples/typescript
npx ts-node agent-module-example.ts
```

## What the Example Does

1. Initializes the AgentBay client with your API key
2. Creates a new session
3. Executes a simple task using the Agent module ("Calculate the square root of 144")
4. Displays the task results
5. Cleans up by deleting the session

## Key Concepts

- **Session Creation**: All Agent operations happen within a session context
- **Task Execution**: Tasks are executed using natural language descriptions
- **Result Handling**: Task results include success status, output, and error information
- **Resource Management**: Sessions should be properly deleted when no longer needed

## Next Steps

Try modifying the task description to perform different operations, such as:
- "Find the current weather in New York City"
- "Calculate the factorial of 10"
- "List the prime numbers between 1 and 100"




# Archive Upload Mode Context Sync Example

This directory contains examples demonstrating the Archive upload mode functionality for context synchronization in the AgentBay SDK.

## Overview

The Archive upload mode is designed for efficient file transfer by compressing files before uploading them to the context storage. This is particularly useful when:

- Working with large files
- Dealing with many files
- Optimizing bandwidth usage
- Reducing upload time for compressible content

## Files

### `archive-upload-mode-example.ts`

A comprehensive example that demonstrates:

1. **Context Creation**: Creating a context for Archive upload mode
2. **Sync Policy Configuration**: Setting up sync policy with Archive uploadMode
3. **Session Management**: Creating and managing sessions with context sync
4. **File Operations**: Writing files to the context path
5. **Context Info**: Retrieving context status information
6. **File Verification**: Verifying file information and properties
7. **Cleanup**: Proper session cleanup and error handling

## Key Features Demonstrated

### Archive Upload Mode Configuration

```typescript
// Configure sync policy with Archive upload mode
const syncPolicy = newSyncPolicy();
syncPolicy.uploadPolicy!.uploadMode = "Archive"; // Set to Archive mode

// Create context sync with Archive mode
const contextSync = newContextSync(
  contextId,
  "/tmp/archive-mode-test",
  syncPolicy
);
```

### Session Creation with Context Sync

```typescript
const sessionParams: CreateSessionParams = {
  labels: {
    example: `archive-mode-${uniqueId}`,
    type: "archive-upload-demo",
    uploadMode: "Archive"
  },
  contextSync: [contextSync]
};

const sessionResult = await agentBay.create(sessionParams);
```

### File Operations

```typescript
const fileSystem = new FileSystem(session);

// Write file to context path
const writeResult = await fileSystem.writeFile(filePath, fileContent, "overwrite");

// Get file information
const fileInfoResult = await fileSystem.getFileInfo(filePath);
```

### Context Information Retrieval

```typescript
// Get context status information
const infoResult = await session.context.info();

// Display context status details
infoResult.contextStatusData.forEach((status, index) => {
  console.log(`Context ID: ${status.contextId}`);
  console.log(`Path: ${status.path}`);
  console.log(`Status: ${status.status}`);
  console.log(`Task Type: ${status.taskType}`);
});
```

## Running the Example

### Prerequisites

1. **Environment Setup**: Set your AgentBay API key
   ```bash
   export AGENTBAY_API_KEY="your-api-key-here"
   ```

2. **Dependencies**: Ensure you have the AgentBay SDK installed
   ```bash
   npm install
   ```

### Execution

```bash
# Navigate to the project root
cd /path/to/wuying-agentbay-sdk

# Run the example
npx ts-node docs/example/archive-upload-mode-example.ts
```

### Expected Output

The example will output detailed logs showing:

```
üöÄ Archive Upload Mode Context Sync Example
============================================================

üì¶ Step 1: Creating context for Archive upload mode...
‚úÖ Context created successfully!
   Context ID: ctx_xxxxx
   Request ID: req_xxxxx

‚öôÔ∏è  Step 2: Configuring sync policy with Archive upload mode...
‚úÖ Sync policy configured with uploadMode: Archive

üîß Step 3: Creating context sync configuration...
‚úÖ Context sync created:
   Context ID: ctx_xxxxx
   Path: /tmp/archive-mode-test
   Upload Mode: Archive

üèóÔ∏è  Step 4: Creating session with Archive mode context sync...
‚úÖ Session created successfully!
   Session ID: sess_xxxxx
   Request ID: req_xxxxx
   App Instance ID: app_xxxxx

üìù Step 5: Creating test files in Archive mode context...
üìÑ Creating file: /tmp/archive-mode-test/test-file-5kb.txt
üìä File content size: 5120 bytes
‚úÖ File write successful!
   Request ID: req_xxxxx

üìä Step 6: Testing context info functionality...
‚úÖ Context info retrieved successfully!
   Request ID: req_xxxxx
   Context status data count: X

üìã Context status details:
   [0] Context ID: ctx_xxxxx
       Path: /tmp/archive-mode-test
       Status: Success
       Task Type: upload

üîç Step 7: Verifying file information...
‚úÖ File info retrieved successfully!
   Request ID: req_xxxxx
üìÑ File details:
   Size: 5120 bytes
   Is Directory: false
   Modified Time: 2025-10-22T09:52:00Z
   Mode: 644

üéâ Archive upload mode example completed successfully!
‚úÖ All operations completed without errors.

üßπ Step 8: Cleaning up session...
‚úÖ Session deleted successfully!
   Success: true
   Request ID: req_xxxxx
```

## Related Documentation

- [Context Sync Documentation](../../../../../../docs/guides/common-features/basics/data-persistence.md)
- [Session Management Guide](../../../../../../docs/guides/common-features/basics/session-management.md)
- [File Operations Guide](../../../../../../docs/guides/common-features/basics/file-operations.md)

## Troubleshooting

### Common Issues

1. **API Key Not Set**
   ```
   Warning: AGENTBAY_API_KEY environment variable not set
   ```
   **Solution**: Set the environment variable or update the API key in the code

2. **Context Creation Failed**
   ```
   Context creation failed: [error message]
   ```
   **Solution**: Check your API key and network connectivity

3. **Session Creation Failed**
   ```
   Session creation failed: [error message]
   ```
   **Solution**: Verify context sync configuration and try again

4. **File Operation Failed**
   ```
   File write failed: [error message]
   ```
   **Solution**: Check file path permissions and available disk space

## Support

For additional help:
- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../../../../../../README.md)



# VPC Session Example

This example demonstrates how to create and use VPC (Virtual Private Cloud) sessions with the AgentBay SDK.

## Overview

VPC sessions provide enhanced security and networking capabilities by running your cloud sessions within a private network environment. This example shows how to create a VPC session and use its available modules.

## Running the Example

1. Ensure you have the AgentBay SDK installed
2. Set the `AGENTBAY_API_KEY` environment variable with your valid API key
3. Run the example:

```bash
cd docs/examples/typescript
npx ts-node vpc-session-example.ts
```

## What the Example Does

1. Initializes the AgentBay client with your API key
2. Creates a new VPC session with specific parameters
3. Tests FileSystem operations by writing and reading a file
4. Tests Command operations by executing system commands
5. Cleans up by deleting the session

## Key Concepts

- **VPC Session Creation**: VPC sessions are created by setting the `isVpc` parameter to `true`
- **Module Availability**: VPC sessions have limited module availability compared to standard sessions
- **Resource Management**: VPC sessions should be properly deleted when no longer needed
- **Security**: VPC sessions provide network isolation for sensitive operations

## Available Modules in VPC Sessions

1. **FileSystem**: File and directory operations
2. **Command**: Command execution
3. **System Tools**: Specialized system-level tools
4. **Browser Tools**: Browser automation capabilities

## Next Steps

Try modifying the example to:
- Use context synchronization with VPC sessions
- Test different command executions
- Implement error handling for unavailable modules



# Archive Upload Mode Context Sync Example

This directory contains examples demonstrating the Archive upload mode functionality for context synchronization in the AgentBay SDK.

## Overview

The Archive upload mode is designed for efficient file transfer by compressing files before uploading them to the context storage. This is particularly useful when:

- Working with large files
- Dealing with many files
- Optimizing bandwidth usage
- Reducing upload time for compressible content

## Files

### `archive-upload-mode-example.ts`

A comprehensive example that demonstrates:

1. **Context Creation**: Creating a context for Archive upload mode
2. **Sync Policy Configuration**: Setting up sync policy with Archive uploadMode
3. **Session Management**: Creating and managing sessions with context sync
4. **File Operations**: Writing files to the context path
5. **Context Sync**: Synchronizing context before retrieving information
6. **Context Info**: Retrieving context status information
7. **File Listing**: Listing files in context sync directory
8. **Cleanup**: Proper session cleanup and error handling

## Key Features Demonstrated

### Archive Upload Mode Configuration

```typescript
import { UploadMode } from "wuying-agentbay-sdk";

// Configure sync policy with Archive upload mode
const syncPolicy = newSyncPolicy();
syncPolicy.uploadPolicy!.uploadMode = UploadMode.Archive; // Set to Archive mode

// Create context sync with Archive mode
const contextSync = newContextSync(
  contextId,
  "/tmp/archive-mode-test",
  syncPolicy
);
```

### Session Creation with Context Sync

```typescript
const sessionParams: CreateSessionParams = {
  labels: {
    example: `archive-mode-${uniqueId}`,
    type: "archive-upload-demo",
    uploadMode: UploadMode.Archive
  },
  contextSync: [contextSync]
};

const sessionResult = await agentBay.create(sessionParams);
```

### File Operations

```typescript
const fileSystem = new FileSystem(session);

// Write file to context path
const writeResult = await fileSystem.writeFile(filePath, fileContent, "overwrite");
```

### Context Sync and Information Retrieval

```typescript
// Call context sync before getting info
const syncResult = await session.context.sync();

// Get context status information after sync
const infoResult = await session.context.info();

// Display context status details
infoResult.contextStatusData.forEach((status, index) => {
  console.log(`Context ID: ${status.contextId}`);
  console.log(`Path: ${status.path}`);
  console.log(`Status: ${status.status}`);
  console.log(`Task Type: ${status.taskType}`);
});
```

### File Listing in Context Directory

```typescript
// List files in context sync directory
const listResult = await agentBay.context.listFiles(contextId, syncDirPath, 1, 10);

// Display file entries
listResult.entries.forEach((entry, index) => {
  console.log(`FilePath: ${entry.filePath}`);
  console.log(`FileType: ${entry.fileType}`);
  console.log(`FileName: ${entry.fileName}`);
  console.log(`Size: ${entry.size} bytes`);
});
```

## Running the Example

### Prerequisites

1. **Environment Setup**: Set your AgentBay API key
   ```bash
   export AGENTBAY_API_KEY="your-api-key-here"
   ```

2. **Dependencies**: Ensure you have the AgentBay SDK installed
   ```bash
   npm install
   ```

### Execution

```bash
# Navigate to the project root
cd /path/to/wuying-agentbay-sdk

# Run the example
npx ts-node docs/example/archive-upload-mode-example.ts
```

### Expected Output

The example will output detailed logs showing:

```
üöÄ Archive Upload Mode Context Sync Example
============================================================

üì¶ Step 1: Creating context for Archive upload mode...
‚úÖ Context created successfully!
   Context ID: ctx_xxxxx
   Request ID: req_xxxxx

‚öôÔ∏è  Step 2: Configuring sync policy with Archive upload mode...
‚úÖ Sync policy configured with uploadMode: Archive

üîß Step 3: Creating context sync configuration...
‚úÖ Context sync created:
   Context ID: ctx_xxxxx
   Path: /tmp/archive-mode-test
   Upload Mode: Archive

üèóÔ∏è  Step 4: Creating session with Archive mode context sync...
‚úÖ Session created successfully!
   Session ID: sess_xxxxx
   Request ID: req_xxxxx
   App Instance ID: app_xxxxx

üìù Step 5: Creating test files in Archive mode context...
üìÑ Creating file: /tmp/archive-mode-test/test-file-5kb.txt
üìä File content size: 5120 bytes
‚úÖ File write successful!
   Request ID: req_xxxxx

üìä Step 6: Testing context sync and info functionality...
üîÑ Calling context sync before getting info...
‚úÖ Context sync successful!
   Sync Request ID: req_xxxxx
üìã Calling context info after sync...
‚úÖ Context info retrieved successfully!
   Info Request ID: req_xxxxx
   Context status data count: X

üìã Context status details:
   [0] Context ID: ctx_xxxxx
       Path: /tmp/archive-mode-test
       Status: Success
       Task Type: upload

üîç Step 7: Listing files in context sync directory...
‚úÖ List files successful!
   Request ID: req_xxxxx
   Total files found: X

üìã Files in context sync directory:
   [0] FilePath: /tmp/archive-mode-test/test-file-5kb.txt
       FileType: file
       FileName: test-file-5kb.txt
       Size: 5120 bytes

üéâ Archive upload mode example completed successfully!
‚úÖ All operations completed without errors.

üßπ Step 8: Cleaning up session...
‚úÖ Session deleted successfully!
   Success: true
   Request ID: req_xxxxx
```

## Related Documentation

- [Context Sync Documentation](../../../../../../docs/guides/common-features/basics/data-persistence.md)
- [Session Management Guide](../../../../../../docs/guides/common-features/basics/session-management.md)
- [File Operations Guide](../../../../../../docs/guides/common-features/basics/file-operations.md)

## Troubleshooting

### Common Issues

1. **API Key Not Set**
   ```
   Warning: AGENTBAY_API_KEY environment variable not set
   ```
   **Solution**: Set the environment variable or update the API key in the code

2. **Context Creation Failed**
   ```
   Context creation failed: [error message]
   ```
   **Solution**: Check your API key and network connectivity

3. **Session Creation Failed**
   ```
   Session creation failed: [error message]
   ```
   **Solution**: Verify context sync configuration and try again

4. **File Operation Failed**
   ```
   File write failed: [error message]
   ```
   **Solution**: Check file path permissions and available disk space

## Support

For additional help:
- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../../../../../docs/api/README.md)



# Command Execution Example

This example demonstrates how to use the command execution features of the AgentBay SDK for TypeScript.

## Features Demonstrated

- Executing shell commands
- Setting custom timeouts for commands
- Running Python code
- Running JavaScript code
- Executing multi-line command sequences

## Running the Example

1. Make sure you have installed the AgentBay SDK:

```bash
npm install wuying-agentbay-sdk
```

2. Set your API key as an environment variable (recommended):

```bash
export AGENTBAY_API_KEY=your_api_key_here
```

3. Compile and run the example:

```bash
# Compile TypeScript
cd command-example
npx ts-node command-example.ts
```

## Code Explanation

The example demonstrates different ways to execute commands:

1. Basic shell command execution
2. Command execution with custom timeout
3. Running Python code
4. Running JavaScript code with custom timeout
5. Executing a multi-line shell command sequence

The code also demonstrates proper error handling and resource cleanup using try-finally.

For more details on command execution, see the [Command API Reference](../../../../api/common-features/basics/command.md) and [Command Execution Tutorial](../../../../../../docs/guides/common-features/basics/command-execution.md).




# Context Management Example

This example demonstrates how to use the Context Management features of the AgentBay SDK for TypeScript.

## Features Demonstrated

- Listing all contexts
- Getting or creating a context
- Creating a session with a context
- Updating a context
- Clearing context data (synchronous clear)
- Deleting a context

## Running the Example

1. Make sure you have installed the AgentBay SDK:

```bash
npm install wuying-agentbay-sdk
```

2. Set your API key as an environment variable (recommended):

```bash
export AGENTBAY_API_KEY=your_api_key_here
```

3. Compile and run the example:

```bash
# Compile TypeScript
cd context-management
npx ts-node context-management.ts
```

## Code Explanation

The example demonstrates a full lifecycle of context management:

1. Initialize the AgentBay client with an API key
2. List all existing contexts to see what's available
3. Get an existing context by name, or create it if it doesn't exist
4. Create a session using the context
5. Update the context's properties
6. Clear the context's persistent data (demonstrates synchronous clear method)
7. Clean up by deleting the session and context

Context management allows you to work with persistent storage areas that can be used across multiple sessions. This enables scenarios like:

- Preserving file system changes between sessions
- Maintaining application state across session restarts
- Sharing data between different sessions
- Creating templates for quick session initialization

For more details on context management, see the [Context API Reference](../../../../api/common-features/basics/context.md) and [Data Persistence Tutorial](../../../../../../docs/guides/common-features/basics/data-persistence.md).




# Data Persistence Examples

This directory contains examples demonstrating data persistence functionality in AgentBay SDK for TypeScript.

## Examples

### 1. `data-persistence.ts` - Basic Data Persistence

Demonstrates the fundamental data persistence features:

- Context creation for persistent storage
- File persistence across multiple sessions
- Context synchronization and file sharing
- Multi-session data verification

### 2. `context-sync-demo.ts` - Advanced Sync with Callbacks

Demonstrates the callback-based context synchronization:

- Async context sync operations
- Timing analysis and performance monitoring
- Status verification using `context.info()`
- Multiple sync operations and error handling
- Backward compatibility with traditional sync

### 3. `recycle-policy-example.ts` - Data Lifecycle Management

Demonstrates RecyclePolicy for controlling context data lifecycle:

- Using default RecyclePolicy (keeps data forever)
- Setting custom lifecycle durations (1 day, 3 days, etc.)
- Applying RecyclePolicy to specific paths
- Available lifecycle options

## Key Features

### Data Persistence

- **Context Creation**: Create persistent storage contexts
- **Cross-Session Persistence**: Data survives session deletion
- **File Synchronization**: Automatic sync of files to persistent storage
- **Multi-Session Access**: Access data from different sessions

### Context Sync Callbacks

- **Async Operations**: Non-blocking sync operations
- **Real-time Feedback**: Immediate notification on completion
- **Timing Information**: Detailed performance metrics
- **Error Handling**: Graceful handling of failures and timeouts
- **Status Monitoring**: Track sync progress and completion

### Data Lifecycle Management

- **RecyclePolicy**: Control how long context data is retained in the cloud
- **Lifecycle Options**: 1 day to forever (10 options available)
- **Path-Specific Policies**: Apply different lifecycles to different directories
- **Automatic Cleanup**: Data is automatically deleted after specified duration
- **Path Validation**: Ensures path safety (no wildcard patterns)

## Usage

### Basic Data Persistence

```bash
cd typescript/docs/examples/data-persistence
npx ts-node data-persistence.ts
```

### Context Sync Demo

```bash
cd typescript/docs/examples/data-persistence
npx ts-node context-sync-demo.ts
```

### RecyclePolicy Example

```bash
cd typescript/docs/examples/data-persistence
npx ts-node recycle-policy-example.ts
```

## Prerequisites

- AgentBay SDK installed
- Valid API key configured (via environment variable `AGENTBAY_API_KEY`)
- Network access to AgentBay services
- Node.js 16 or later
- TypeScript 4.5 or later

## Expected Behavior

All examples will:

1. Create a persistent context
2. Create a session with context synchronization
3. Write test data to the persistent storage
4. Demonstrate data persistence across sessions
5. Clean up resources

The callback example additionally shows:

- Async sync operations with timing
- Callback notifications
- Status monitoring
- Error handling scenarios

## Output

All examples provide detailed console output showing:

- Step-by-step progress
- Success/failure status for each operation
- Timing information (callback example)
- Data verification results
- Cleanup confirmation

## Notes

- Examples use temporary contexts that are cleaned up after execution
- File paths use `/tmp/` for demonstration purposes
- Timing may vary based on network conditions and file sizes
- The callback example includes timeout handling for robustness

## Related Documentation

- [Data Persistence Guide](../../../../../../docs/guides/common-features/basics/data-persistence.md) - Comprehensive guide on data persistence
- [Context Management](../context-management/README.md) - Context creation and management
- [File Operations](../filesystem-example/README.md) - File handling and management




# Context Sync Dual-Mode Example (TypeScript)

This example demonstrates the dual-mode `context.sync()` functionality in the TypeScript SDK, showing both asynchronous callback-based and synchronous await-based usage patterns.

## Features Demonstrated

- **Context Creation**: Creates persistent contexts for data storage
- **Test Data Generation**: Creates sample files and directories for sync testing
- **Dual-Mode Context Sync**: Shows both callback and await patterns
- **Session Management**: Proper session creation and cleanup
- **Error Handling**: Comprehensive error handling and cleanup
- **Timing Measurement**: Tracks sync operation duration
- **Concurrent Execution**: Demonstrates running multiple sync operations

## Usage Patterns

### 1. Async Mode with Callback

```typescript
// Immediate return with callback handling
const syncResult = await session.context.sync(
  undefined, // contextId
  undefined, // path
  undefined, // mode
  (success: boolean) => {
    if (success) {
      console.log("‚úÖ Context sync completed successfully");
    } else {
      console.log("‚ùå Context sync completed with failures");
    }
  }
);
```

### 2. Sync Mode with Await

```typescript
// Wait for completion before returning
const syncResult = await session.context.sync();
if (syncResult.success) {
  console.log("‚úÖ Context sync completed successfully");
} else {
  console.log("‚ùå Context sync completed with failures");
}
```

## Key Differences from Python Version

- **TypeScript/JavaScript**: Uses `Promise` and `async/await` instead of Python's `asyncio`
- **Callback Pattern**: Uses arrow functions for callbacks
- **Timing**: Uses `Date.now()` for millisecond precision timing
- **Error Handling**: Uses try/catch blocks with Promise-based error handling

## Running the Example

```bash
# From the typescript directory
npm run build
node dist/docs/examples/data-persistence/context-sync-demo.js
```

## Expected Output

```
üîÑ AgentBay Context Sync Dual-Mode Example (TypeScript)

============================================================
üîÑ Method 1: context_sync_with_callback (Async with callback)
============================================================
üîÑ Starting context sync with callback demo...

üì¶ Creating context for persistent storage...
‚úÖ Context created: sync-callback-demo

üì¶ Creating session with context sync...
‚úÖ Session created: session-123

üíæ Creating test data...
‚úÖ Created file: /tmp/sync_data/test_files/small.txt
‚úÖ Created file: /tmp/sync_data/test_files/medium.txt
‚úÖ Created file: /tmp/sync_data/config.json
üìä Created 3/3 test files

üìû Calling context.sync() with callback...
üì§ Sync initiation result: success=true, requestId=req-456
‚è≥ Waiting for callback to complete...
‚úÖ Context sync completed successfully in 2000ms
üóëÔ∏è  Deleting session from callback...
‚úÖ Session deleted successfully from callback

‚è≥ Sleeping 3 seconds before next demo...

============================================================
üîÑ Method 2: context_sync (Sync with await)
============================================================
üîÑ Starting context sync demo...

üì¶ Creating context for persistent storage...
‚úÖ Context created: sync-await-demo

üì¶ Creating session with context sync...
‚úÖ Session created: session-789

üíæ Creating test data...
‚úÖ Created file: /tmp/sync_data/test_files/small.txt
‚úÖ Created file: /tmp/sync_data/test_files/medium.txt
‚úÖ Created file: /tmp/sync_data/config.json
üìä Created 3/3 test files

‚è≥ Calling context.sync() with await...
‚úÖ Context sync completed successfully in 1500ms
üì§ Sync result: success=true, requestId=req-101
üóëÔ∏è  Deleting session...
‚úÖ Session deleted successfully

‚è≥ Waiting for callback demo to complete...

‚úÖ Context sync dual-mode example completed
```

## Configuration

The example uses default configuration values:

- **Max Retries**: 150 attempts
- **Retry Interval**: 1500ms (1.5 seconds)
- **Timeout**: ~5 minutes (150 √ó 1.5s)

## Error Handling

The example includes comprehensive error handling:

- Sync operation failures
- Session creation failures
- Session deletion failures
- Automatic cleanup on errors

## Integration with Session Deletion

The example demonstrates how `context.sync()` integrates with session deletion:

- Callback mode: Session deletion happens in the callback
- Await mode: Session deletion happens after sync completion
- Both modes avoid double-syncing by passing `false` to `session.delete()`




# Filesystem Operations Example

This example demonstrates how to use the AgentBay SDK to perform various filesystem operations within a session.

## Features Demonstrated

- Directory Operations:
  - Creating directories
  - Listing directory contents

- File Operations:
  - Writing files
  - Reading files
  - Getting file information
  - Editing file content
  - Moving/renaming files
  - Searching for files

- File Transfer Operations:
  - Uploading files from local to remote environment
  - Downloading files from remote to local environment
  - Progress tracking during file transfers

## Running the Examples

Make sure you have set your AgentBay API key as an environment variable:

```bash
export AGENTBAY_API_KEY="your-api-key-here"
```

### Basic Filesystem Operations

```bash
cd filesystem-example
npx ts-node filesystem-example.ts
```

### Directory Monitoring

```bash
cd filesystem-example
npx ts-node watch-directory-example.ts
```

### File Transfer Operations

```bash
cd filesystem-example
npx ts-node filesystem-filetransfer-example.ts
```

## Note

The example uses the `/tmp` directory for all operations to ensure it has the necessary permissions. Some operations might not be supported in all session types or environments. The example includes error handling to handle such cases gracefully.

File transfer operations require proper session context configuration for optimal performance. The examples demonstrate best practices for handling file transfers with progress tracking and error handling.



# Get API Example

This example demonstrates how to use the `get` API to retrieve a session by its ID.

## Description

The `get` API allows you to retrieve a session object by providing its session ID. This is useful when you have a session ID from a previous operation and want to access or manage that session.

## Prerequisites

- Node.js 16 or higher
- TypeScript 4.5 or higher
- Valid API key set in `AGENTBAY_API_KEY` environment variable
- wuying-agentbay-sdk package installed

## Installation

```bash
npm install wuying-agentbay-sdk
# or
yarn add wuying-agentbay-sdk
```

## Usage

```bash
# Set your API key
export AGENTBAY_API_KEY="your-api-key-here"

# Compile and run the example
npx ts-node main.ts
```

## Code Example

```typescript
import { AgentBay } from "wuying-agentbay-sdk";

async function main() {
  // Initialize AgentBay client
  const apiKey = process.env.AGENTBAY_API_KEY;
  const agentBay = new AgentBay({ apiKey });

  // Retrieve a session by ID
  const sessionId = "your-session-id";
  const result = await agentBay.get(sessionId);

  if (result.success && result.session) {
    console.log(`Retrieved session: ${result.session.sessionId}`);
    console.log(`Request ID: ${result.requestId}`);
    // Use the session for further operations
    // ...
  } else {
    console.error(`Failed to get session: ${result.errorMessage}`);
  }
}

main();
```

## API Reference

### get

```typescript
async get(sessionId: string): Promise<SessionResult>
```

Get a session by its ID.

**Parameters:**
- `sessionId` (string): The ID of the session to retrieve

**Returns:**
- `Promise<SessionResult>`: Promise resolving to result object containing:
  - `success` (boolean): Whether the operation succeeded
  - `session` (Session): The Session instance if successful
  - `requestId` (string): The API request ID
  - `errorMessage` (string): Error message if failed

## Expected Output

```
Creating a session...
Created session with ID: session-xxxxxxxxxxxxx

Retrieving session using Get API...
Successfully retrieved session:
  Session ID: session-xxxxxxxxxxxxx
  Request ID: DAD825FE-2CD8-19C8-BB30-CC3BA26B9398

Session is ready for use

Cleaning up...
Session session-xxxxxxxxxxxxx deleted successfully
```

## Notes

- The session ID must be valid and from an existing session
- The get API internally calls the GetSession API endpoint
- The returned session object can be used for all session operations (commands, files, etc.)
- Always clean up sessions when done to avoid resource waste

## Error Handling

The `get` method returns a `SessionResult` object with error information:

1. **Empty session_id**: Result will have `success: false`
   ```typescript
   const result = await agentBay.get("");
   if (!result.success) {
     console.error(`Error: ${result.errorMessage}`);  // "session_id is required"
   }
   ```

2. **Non-existent session**: Result will have `success: false`
   ```typescript
   const result = await agentBay.get("non-existent-session-id");
   if (!result.success) {
     console.error(`Error: ${result.errorMessage}`);  // "Failed to get session..."
   }
   ```

## TypeScript Support

This example is fully typed with TypeScript. The `get` method returns a typed `SessionResult` object with full IDE autocomplete support.

```typescript
import { AgentBay, Session } from "wuying-agentbay-sdk";

const agentBay = new AgentBay({ apiKey: "your-key" });
const session: Session = await agentBay.get("session-id");
// TypeScript knows all methods and properties of session
```





# List Sessions Example (TypeScript)

This example demonstrates how to use the `list()` API to query and filter sessions in AgentBay.

## Prerequisites

1. **Install dependencies**:
   ```bash
   npm install wuying-agentbay-sdk
   npm install -D typescript ts-node @types/node
   ```

2. **Set API Key**:
   ```bash
   export AGENTBAY_API_KEY='your-api-key-here'
   ```

## Running the Example

```bash
cd /path/to/wuying-agentbay-sdk/typescript/docs/examples/list_sessions
npx ts-node main.ts
```

## Key Features

- List all sessions
- Filter by single or multiple labels
- Pagination support
- Iterate through all pages

## API Usage

```typescript
import { AgentBay } from "wuying-agentbay-sdk";

const agentBay = new AgentBay(apiKey);

// List all sessions
const result = await agentBay.list();

// Filter by labels
const filtered = await agentBay.list({ project: "my-project" });

// With pagination
const page1 = await agentBay.list({ project: "my-project" }, 1, 10);
const page2 = await agentBay.list({ project: "my-project" }, 2, 10);
```

## Related Documentation

- [Session Management Guide](../../../../../../docs/guides/common-features/basics/session-management.md)
- [AgentBay API Reference](../../../../api/common-features/basics/agentbay.md)





# MCP Tool Direct Call Example (TypeScript)

This example demonstrates how to list available MCP tools and call them directly using the AgentBay TypeScript SDK.

## Prerequisites

- Node.js 16 or higher
- AgentBay TypeScript SDK installed (`npm install wuying-agentbay-sdk`)
- AgentBay API Key (set as environment variable `AGENTBAY_API_KEY`)

## Running the Example

```bash
# Set your API key
export AGENTBAY_API_KEY=your_api_key_here

# Run the example
cd typescript/docs/examples/common-features/advanced/mcp_tool_direct_call
npx ts-node main.ts
```

## What This Example Does

1. **Creates a Session**: Initializes an AgentBay session
2. **Lists MCP Tools**: Retrieves all available MCP tools using `session.listMcpTools()`
3. **Finds Shell Tool**: Locates the 'shell' tool and displays its details
4. **Calls Shell Tool**: Executes commands using `session.callMcpTool()`:
   - Echo command: `echo 'Hello from MCP Tool!'`
   - Directory command: `pwd`
   - Error handling: Invalid command demonstration
5. **Cleanup**: Properly deletes the session

## Expected Output

```
Initializing AgentBay client...

1. Creating session...
‚úì Session created successfully
  Session ID: sess-xxxxx
  Request ID: req-xxxxx

2. Listing available MCP tools...
‚úì Found 69 MCP tools
  Request ID: req-xxxxx

  Available tools (showing first 10):
  1. get_resource
     Description: The command to retrieve a wuying mcp runtime URL...
     Server: mcp-server

  2. system_screenshot
     Description: Captures a full-screen screenshot...
     Server: mcp-server

  ...

3. Finding 'shell' tool details...
‚úì Found 'shell' tool
  Description: Executes an shell command with timeout...
  Server: wuying_shell
  Input Schema:
    {
      "type": "object",
      "required": ["command", "timeout_ms"],
      "properties": {
        "command": {
          "type": "string",
          "description": "client input command"
        },
        "timeout_ms": {
          "type": "integer",
          "default": 1000,
          "description": "Command execution timeout (unit: milliseconds)..."
        }
      }
    }

4. Calling 'shell' tool...
‚úì Tool call successful
  Request ID: req-xxxxx
  Output:
    Hello from MCP Tool!

5. Calling 'shell' tool with different command...
‚úì Tool call successful
  Request ID: req-xxxxx
  Current directory:
    /home/wuying

6. Demonstrating error handling (invalid command)...
‚úì Error handled correctly
  Request ID: req-xxxxx
  Error message: Execution failed. Error code:127 Error message: sh: 1: this_command_does_not_exist_12345: not found

7. Cleaning up...
‚úì Session deleted successfully
  Request ID: req-xxxxx

============================================================
Example completed successfully!
============================================================
```

## Key API Methods

### `session.listMcpTools()`

Lists all available MCP tools for the session.

**Returns:** `Promise<McpToolsResult>` containing:
- `tools`: Array of `McpTool` objects
- `requestId`: API request identifier

### `session.callMcpTool(toolName, args)`

Calls an MCP tool directly.

**Parameters:**
- `toolName` (string): Name of the MCP tool
- `args` (Record<string, any>): Tool arguments

**Returns:** `Promise<McpToolResult>` containing:
- `success` (boolean): Whether the call succeeded
- `data` (string): Tool output
- `errorMessage` (string): Error message if failed
- `requestId` (string): API request identifier

## Use Cases

This direct MCP tool calling approach is useful when you need to:

1. **Discover Available Tools**: List all tools before deciding which to use
2. **Call Tools Directly**: Bypass module-specific wrappers for direct access
3. **Custom Tool Integration**: Build custom workflows with any available tool
4. **Tool Exploration**: Inspect tool schemas and test different arguments

## Related Documentation

- [Session API Reference](../../../../api/common-features/basics/session.md#callmcptool)
- [Common Features Guide](../../../../../../docs/guides/common-features/README.md)





# Session Creation and Management Example

This example demonstrates how to create, list, and delete sessions using the Wuying AgentBay SDK. It covers:

- Initializing the AgentBay client
- Creating a session with default parameters
- Listing all available sessions
- Creating multiple sessions
- Deleting sessions
- Verifying session deletion

This example is useful for understanding the session lifecycle and how to manage multiple sessions.

## Running the Example

```bash
cd session-creation
npx ts-node session-creation.ts
```

Make sure you have set the `AGENTBAY_API_KEY` environment variable or replace the placeholder in the code with your actual API key.

## Prerequisites

- Node.js installed
- TypeScript installed
- ts-node installed (`npm install -g ts-node`)
- Required dependencies installed (`npm install`)




# Session Pause and Resume Example

This example demonstrates how to pause and resume sessions using the Wuying AgentBay SDK. Pausing a session puts it into a dormant state, consuming fewer resources while maintaining its state. Resuming a session brings it back to an active state.

## Features Demonstrated

- Pausing and resuming sessions
- Handling non-existent session operations
- Using custom timeout and polling interval parameters
- Checking session status before and after operations
- Performing work in sessions before and after pause/resume cycles

## Running the Example

```bash
cd session-pause-resume
npx ts-node session-pause-resume.ts
```

Make sure you have set the `AGENTBAY_API_KEY` environment variable or replace the placeholder in the code with your actual API key.

## Prerequisites

- Node.js installed
- TypeScript installed
- ts-node installed (`npm install -g ts-node`)
- Required dependencies installed (`npm install`)

## Understanding Session States

When working with pause and resume operations, sessions can be in different states:

1. **RUNNING**: Session is active and ready to accept commands
2. **PAUSING**: Session is transitioning to paused state
3. **PAUSED**: Session is in dormant state, consuming fewer resources
4. **RESUMING**: Session is transitioning back to running state

The pause and resume operations are asynchronous, meaning they initiate the state transition and then poll for completion.

## Best Practices

1. **Always check operation results**: Verify that pause and resume operations succeeded
2. **Handle errors gracefully**: Non-existent sessions and other errors should be handled appropriately
3. **Use appropriate timeouts**: Custom timeout values can be used based on your specific requirements
4. **Verify session state**: Check session status before and after operations to ensure expected behavior
5. **Clean up resources**: Always delete sessions when done to avoid resource leaks

## Use Cases

- **Cost optimization**: Pause sessions during idle periods to reduce resource consumption
- **Long-running workflows**: Suspend sessions overnight or during maintenance windows
- **Development and testing**: Pause test environments when not actively working on them
- **Batch processing**: Pause and resume processing jobs based on system load



# Mobile GetAdbUrl Example

This example demonstrates how to retrieve an ADB (Android Debug Bridge) connection URL for a mobile session.

## Prerequisites

- Node.js 14 or higher
- AgentBay API key
- A mobile session (`mobile_latest` image)

## Installation

```bash
npm install @aliyun/wuying-agentbay-sdk
```

## Usage

1. Set your API key:
```bash
export AGENTBAY_API_KEY=your_api_key_here
```

2. Run the example:
```bash
npx ts-node index.ts
```

## Expected Output

```
=== Mobile GetAdbUrl Example ===

Creating mobile session...
‚úÖ Session created successfully
   Session ID: session-xxxxx
   Image ID: mobile_latest

Getting ADB connection URL...
‚úÖ ADB URL retrieved successfully
   URL: adb connect xx.xx.xx.xx:xxxxx
   Request ID: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

You can now connect to the mobile device using:
   adb connect xx.xx.xx.xx:xxxxx

=== Example completed successfully ===

Cleaning up session...
‚úÖ Session deleted successfully (RequestID: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx)
```

## Using the ADB Connection

Once you have the ADB URL, you can connect to the mobile device:

```bash
# Connect to the device
adb connect xx.xx.xx.xx:xxxxx

# Verify the connection
adb devices

# Now you can use standard ADB commands
adb shell
adb install app.apk
adb logcat
adb pull /sdcard/file.txt
adb push file.txt /sdcard/
```

## Important Notes

1. **Environment Requirement**: This method only works with `mobile_latest` image sessions
2. **ADB Public Key**: You need to provide your ADB public key for authentication
3. **Connection URL Format**: The returned URL is in the format `adb connect <IP>:<Port>`
4. **Session Cleanup**: Always delete the session when done to avoid resource leaks

## Error Handling

The example includes proper error handling for common scenarios:
- Missing API key
- Session creation failure
- ADB URL retrieval failure
- Session deletion issues

## See Also

- [Mobile API Documentation](../../../api/mobile-use/mobile.md)
- [Session Management Guide](../../../../../docs/guides/common-features/basics/session-management.md)
- [Mobile Use Guide](../../../../../docs/guides/mobile-use/README.md)






# Golang SDK Documentation


# AgentBay SDK for Golang

> Execute commands, manipulate files, and run code in cloud environments

## üì¶ Installation

```bash
go get github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay
```

## üöÄ Prerequisites

Before using the SDK, you need to:

1. Register an Alibaba Cloud account: [https://aliyun.com](https://aliyun.com)
2. Get API credentials: [AgentBay Console](https://agentbay.console.aliyun.com/service-management)
3. Set environment variable: `export AGENTBAY_API_KEY=your_api_key`

## üöÄ Quick Start
```go
package main

import (
    "fmt"
    "github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay"
)

func main() {
    // Create session
    client, err := agentbay.NewAgentBay("", nil)
    if err != nil {
        fmt.Printf("Initialization failed: %v\n", err)
        return
    }
    // Verified: ‚úì Client initialized successfully

    result, err := client.Create(nil)
    if err != nil {
        fmt.Printf("Session creation failed: %v\n", err)
        return
    }
    // Verified: ‚úì Session created with ID like "session-04bdwfj7u2a668axp"

    session := result.Session

    // Execute command
    cmdResult, err := session.Command.ExecuteCommand("ls -la")
    if err == nil {
        fmt.Printf("Command output: %s\n", cmdResult.Output)
    }
    // Verified: ‚úì Command executed successfully
    // Sample output: "ÊÄªËÆ° 100\ndrwxr-x--- 16 wuying wuying 4096..."

    // File operations
    session.FileSystem.WriteFile("/tmp/test.txt", "Hello World", "")
    fileResult, err := session.FileSystem.ReadFile("/tmp/test.txt")
    if err == nil {
        fmt.Printf("File content: %s\n", fileResult.Content)
    }
    // Verified: ‚úì File written and read successfully
    // Output: "File content: Hello World"
}
```

## üìñ Complete Documentation

### üÜï New Users
- [üìö Quick Start Tutorial](../docs/quickstart/README.md) - Get started in 5 minutes
- [üéØ Core Concepts](../docs/quickstart/basic-concepts.md) - Understanding cloud environments and sessions

### üöÄ Experienced Users
**Choose Your Cloud Environment:**
- üåê [Browser Use](../docs/guides/browser-use/README.md) - Web scraping, browser testing, form automation
- üñ•Ô∏è [Computer Use](../docs/guides/computer-use/README.md) - Windows desktop automation, UI testing
- üì± [Mobile Use](../docs/guides/mobile-use/README.md) - Android UI testing, mobile app automation
- üíª [CodeSpace](../docs/guides/codespace/README.md) - Code execution, development environments

**Additional Resources:**
- [üìñ Feature Guides](../docs/guides/README.md) - Complete feature introduction
- [üîß Go API Reference](docs/api/README.md) - Detailed API documentation
- [üíª Go Examples](docs/examples/README.md) - Complete example code
- [üìã Logging Configuration](../docs/guides/common-features/configuration/logging.md) - Configure logging levels and output

## üîß Core Features Quick Reference

### Session Management
```go
// Create session
result, _ := client.Create(nil)
session := result.Session
// Verified: ‚úì Session created successfully
```

### File Operations
```go
// Read and write files
session.FileSystem.WriteFile("/path/file.txt", "content", "")
result, _ := session.FileSystem.ReadFile("/path/file.txt")
content := result.Content
// Verified: ‚úì File operations work correctly
// Output: content contains the file's text content

// List directory
files, _ := session.FileSystem.ListDirectory("/path")
// Verified: ‚úì Returns list of FileInfo objects
```

### Command Execution
```go
// Execute command
result, _ := session.Command.ExecuteCommand("go run script.go")
fmt.Println(result.Output)
// Verified: ‚úì Command executed successfully
// Output contains the command's stdout
```

### Data Persistence
```go
// Create context
contextResult, _ := client.Context.Get("my-project", true)
context := contextResult.Context
// Verified: ‚úì Context created or retrieved successfully

// Create session with context
policy := agentbay.NewSyncPolicy()
contextSync := agentbay.NewContextSync(context.ID, "/tmp/data", policy)
params := agentbay.NewCreateSessionParams().AddContextSyncConfig(contextSync)
sessionResult, _ := client.Create(params)
// Verified: ‚úì Session created with context synchronization
// Data in /tmp/data will be synchronized to the context
```

## üÜò Get Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Complete Documentation](../docs/README.md)

## üìÑ License

This project is licensed under the Apache License 2.0 - see the [LICENSE](../LICENSE) file for details.




# AgentBay Go SDK API Reference

This directory is generated. Run `go run scripts/generate_api_docs.go` to refresh it.

## Browser Use

- `browser-use/browser.md` ‚Äì Browser

## Codespace

- `codespace/code.md` ‚Äì Code

## Common Features

- `common-features/basics/agentbay.md` ‚Äì AgentBay
- `common-features/basics/session.md` ‚Äì Session
- `common-features/basics/command.md` ‚Äì Command
- `common-features/basics/context.md` ‚Äì Context
- `common-features/basics/context-manager.md` ‚Äì Context Manager
- `common-features/basics/filesystem.md` ‚Äì File System
- `common-features/basics/context-sync.md` ‚Äì Context Sync
- `common-features/basics/logging.md` ‚Äì Logging
- `common-features/advanced/agent.md` ‚Äì Agent
- `common-features/advanced/oss.md` ‚Äì OSS

## Computer Use

- `computer-use/computer.md` ‚Äì Computer

## Mobile Use

- `mobile-use/mobile.md` ‚Äì Mobile





# Browser API Reference

## üåê Related Tutorial

- [Browser Use Guide](../../../../docs/guides/browser-use/README.md) - Complete guide to browser automation

## Overview

The Browser module provides comprehensive browser automation capabilities including navigation, element interaction,
screenshot capture, and content extraction. It enables automated testing and web scraping workflows.

## Requirements

- Requires `browser_latest` image for browser automation features

## Type Browser

```go
type Browser struct {
	session		SessionInterface
	endpointURL	string
	initialized	bool
	option		*BrowserOption
}
```

Browser provides browser-related operations for the session

### Methods

### Destroy

```go
func (b *Browser) Destroy() error
```

Destroy the browser instance

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
session.Browser.Initialize(browser.NewBrowserOption())
session.Browser.Destroy()
```

### GetEndpointURL

```go
func (b *Browser) GetEndpointURL() (string, error)
```

GetEndpointURL returns the endpoint URL if the browser is initialized

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("browser_latest"))
defer result.Session.Delete()
session.Browser.Initialize(browser.NewBrowserOption())
endpointURL, _ := session.Browser.GetEndpointURL()
```

### GetOption

```go
func (b *Browser) GetOption() *BrowserOption
```

GetOption returns the current BrowserOption used to initialize the browser, or nil if not set

**Example:**

```go
currentOption := session.Browser.GetOption()
if currentOption != nil && currentOption.UseStealth {

    // Stealth mode is enabled

}
```

### Initialize

```go
func (b *Browser) Initialize(option *BrowserOption) (bool, error)
```

Initialize initializes the browser instance with the given options. Returns true and nil error if
successful, false and error otherwise.

**Example:**

```go
option := browser.NewBrowserOption()
option.UseStealth = true
success, _ := session.Browser.Initialize(option)
```

### IsInitialized

```go
func (b *Browser) IsInitialized() bool
```

IsInitialized returns true if the browser was initialized, false otherwise

**Example:**

```go
if session.Browser.IsInitialized() {

    // Browser is ready

}
```

### Screenshot

```go
func (b *Browser) Screenshot(page playwright.Page, options *ScreenshotOptions) ([]byte, error)
```

Screenshot takes a screenshot of the specified page with enhanced options and error handling.
This method requires the caller to connect to the browser via Playwright or similar and pass the
page object to this method.

Parameters:
  - page: The Playwright Page object to take a screenshot of. This is a required parameter.
  - options: Screenshot options including:
  - FullPage (bool): Whether to capture the full scrollable page. Defaults to false.
  - Type (string): Image type, either "png" or "jpeg". Defaults to "png".
  - Quality (int): Quality of the image, between 0-100 (jpeg only). Defaults to 0.
  - Timeout (int): Maximum time in milliseconds. Defaults to 60000.

Returns:
  - []byte: Screenshot data as bytes.
  - error: Error if browser is not initialized or screenshot capture fails.

**Example:**

```go
// Connect to browser using Playwright

// pw, _ := playwright.Run()

// browser, _ := pw.Chromium.ConnectOverCDP(endpointURL)

// page, _ := browser.NewPage()

screenshotData, _ := session.Browser.Screenshot(page, nil)
```

### Related Functions

### NewBrowser

```go
func NewBrowser(session SessionInterface) *Browser
```

NewBrowser creates a new Browser instance

## Type BrowserFingerprint

```go
type BrowserFingerprint struct {
	Devices			[]string	`json:"devices,omitempty"`		// Device types: "desktop" or "mobile"
	OperatingSystems	[]string	`json:"operatingSystems,omitempty"`	// OS types: "windows", "macos", "linux", "android", "ios"
	Locales			[]string	`json:"locales,omitempty"`		// Locale identifiers
}
```

BrowserFingerprint represents browser fingerprint options

**Example:**

```go
fingerprint := &browser.BrowserFingerprint{
    Devices:          []string{"desktop"},
    OperatingSystems: []string{"windows", "macos"},
    Locales:          []string{"en-US", "en-GB"},
}
```

### Related Functions

### NewBrowserFingerprint

```go
func NewBrowserFingerprint(devices, operatingSystems, locales []string) (*BrowserFingerprint, error)
```

NewBrowserFingerprint creates a new BrowserFingerprint with validation

## Type BrowserOption

```go
type BrowserOption struct {
	UseStealth		bool			`json:"useStealth,omitempty"`		// Enable stealth mode
	UserAgent		*string			`json:"userAgent,omitempty"`		// Custom user agent
	Viewport		*BrowserViewport	`json:"viewport,omitempty"`		// Viewport configuration
	Screen			*BrowserScreen		`json:"screen,omitempty"`		// Screen configuration
	Fingerprint		*BrowserFingerprint	`json:"fingerprint,omitempty"`		// Fingerprint configuration
	SolveCaptchas		bool			`json:"solveCaptchas,omitempty"`	// Auto-solve captchas
	Proxies			[]*BrowserProxy		`json:"proxies,omitempty"`		// Proxy configurations
	ExtensionPath		*string			`json:"extensionPath,omitempty"`	// Path to extensions directory
	CmdArgs			[]string		`json:"cmdArgs,omitempty"`		// Additional command line arguments
	DefaultNavigateUrl	*string			`json:"defaultNavigateUrl,omitempty"`	// Default URL to navigate to when browser starts
	BrowserType		*string			`json:"browserType,omitempty"`		// Browser type: "chrome" or "chromium"
}
```

BrowserOption represents browser initialization options

**Example:**

```go
option := browser.NewBrowserOption()

// Custom user agent

ua := "Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.0.0"
option.UserAgent = &ua

// Viewport and screen

option.Viewport = &browser.BrowserViewport{Width: 1920, Height: 1080}
option.Screen = &browser.BrowserScreen{Width: 1920, Height: 1080}

// Stealth mode

option.UseStealth = true

// Validate configuration

if err := option.Validate(); err != nil {
    log.Fatalf("Invalid configuration: %v", err)
}
```

### Related Functions

### NewBrowserOption

```go
func NewBrowserOption() *BrowserOption
```

NewBrowserOption creates a new BrowserOption with default values and validation

**Example:**

```go
option := browser.NewBrowserOption()
option.UseStealth = true
```

## Type BrowserProxy

```go
type BrowserProxy struct {
	Type		string	`json:"type"`			// Type of proxy - "custom" or "wuying"
	Server		*string	`json:"server,omitempty"`	// Proxy server address (required for custom type)
	Username	*string	`json:"username,omitempty"`	// Proxy username (optional for custom type)
	Password	*string	`json:"password,omitempty"`	// Proxy password (optional for custom type)
	Strategy	*string	`json:"strategy,omitempty"`	// Strategy for wuying: "restricted" or "polling"
	PollSize	*int	`json:"pollsize,omitempty"`	// Pool size (optional for wuying with polling strategy)
}
```

BrowserProxy represents browser proxy configuration. Supports two types of proxy: custom proxy and
wuying proxy. Wuying proxy supports two strategies: restricted and polling.

**Example:**

```go
// Custom proxy

server := "proxy.example.com:8080"
username := "user"
password := "pass"
customProxy := &browser.BrowserProxy{
    Type:     "custom",
    Server:   &server,
    Username: &username,
    Password: &password,
}

// WuYing proxy with restricted strategy

strategy := "restricted"
wuyingProxy := &browser.BrowserProxy{
    Type:     "wuying",
    Strategy: &strategy,
}

// WuYing proxy with polling strategy

pollingStrategy := "polling"
pollSize := 10
pollingProxy := &browser.BrowserProxy{
    Type:     "wuying",
    Strategy: &pollingStrategy,
    PollSize: &pollSize,
}
```

### Related Functions

### NewBrowserProxy

```go
func NewBrowserProxy(proxyType string, server, username, password, strategy *string, pollSize *int) (*BrowserProxy, error)
```

NewBrowserProxy creates a new BrowserProxy with validation

## Type BrowserScreen

```go
type BrowserScreen struct {
	Width	int	`json:"width"`	// Screen width
	Height	int	`json:"height"`	// Screen height
}
```

BrowserScreen represents browser screen options

## Type BrowserViewport

```go
type BrowserViewport struct {
	Width	int	`json:"width"`	// Viewport width
	Height	int	`json:"height"`	// Viewport height
}
```

BrowserViewport represents browser viewport options

## Type LinkResult

```go
type LinkResult struct {
	Link string
}
```

SessionInterface defines a minimal interface for Browser to interact with Session This interface
allows us to avoid circular dependencies while still accessing necessary Session methods LinkResult
represents the result of GetLink call

## Type McpToolResult

```go
type McpToolResult struct {
	Success		bool
	Data		string
	ErrorMessage	string
}
```

McpToolResult represents the result of CallMcpTool call

## Type ScreenshotOptions

```go
type ScreenshotOptions struct {
	FullPage	bool
	Type		string	// "png" or "jpeg"
	Quality		int	// 0-100 for jpeg
	Timeout		int	// timeout in milliseconds
}
```

ScreenshotOptions represents options for taking screenshots

## Type SessionInterface

```go
type SessionInterface interface {
	GetAPIKey() string
	GetSessionID() string
	GetClient() *client.Client
	CallMcpToolForBrowser(toolName string, args interface{}) (*McpToolResult, error)
	GetLinkForBrowser(protocolType *string, port *int32, options *string) (*LinkResult, error)
	IsVPCEnabled() bool
	GetNetworkInterfaceIP() string
	GetHttpPortNumber() string
}
```

SessionInterface defines the interface that Session must implement for Browser

## Best Practices

1. Wait for page load completion before interacting with elements
2. Use appropriate selectors (CSS, XPath) for reliable element identification
3. Handle navigation timeouts and errors gracefully
4. Take screenshots for debugging and verification
5. Clean up browser resources after automation tasks

## Related Resources

- [Session API Reference](../common-features/basics/session.md)

---

*Documentation generated automatically from Go source code.*




# Code API Reference

## üíª Related Tutorial

- [Code Execution Guide](../../../../docs/guides/codespace/code-execution.md) - Execute code in isolated environments

## Overview

The Code module provides secure code execution capabilities in isolated environments.
It supports multiple programming languages including Python, JavaScript, and more.

## Requirements

- Requires `code_latest` image for code execution features

## Type Code

```go
type Code struct {
	Session interface {
		GetAPIKey() string
		GetClient() *mcp.Client
		GetSessionId() string
		IsVpc() bool
		NetworkInterfaceIp() string
		HttpPort() string
		FindServerForTool(toolName string) string
		CallMcpTool(toolName string, args interface{}, autoGenSession ...bool) (*models.McpToolResult, error)
	}
}
```

Code handles code execution operations in the AgentBay cloud environment.

### Methods

### RunCode

```go
func (c *Code) RunCode(code string, language string, timeoutS ...int) (*CodeResult, error)
```

RunCode executes code in the session environment. timeoutS: The timeout for the code execution in
seconds. Default is 60s. Note: Due to gateway limitations, each request cannot exceed 60 seconds.

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
sessionResult, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("code_latest"))
defer sessionResult.Session.Delete()
codeResult, _ := sessionResult.Session.Code.RunCode("print('Hello')", "python")
```

### Related Functions

### NewCode

```go
func NewCode(session interface {
	GetAPIKey() string
	GetClient() *mcp.Client
	GetSessionId() string
	IsVpc() bool
	NetworkInterfaceIp() string
	HttpPort() string
	FindServerForTool(toolName string) string
	CallMcpTool(toolName string, args interface{}, autoGenSession ...bool) (*models.McpToolResult, error)
}) *Code
```

NewCode creates a new Code instance

## Type CodeResult

```go
type CodeResult struct {
	models.ApiResponse	// Embedded ApiResponse
	Output			string
}
```

CodeResult represents the result of a code execution

## Best Practices

1. Validate code syntax before execution
2. Set appropriate execution timeouts
3. Handle execution errors and exceptions
4. Use proper resource limits to prevent resource exhaustion
5. Clean up temporary files after code execution

## Related Resources

- [Session API Reference](../common-features/basics/session.md)

---

*Documentation generated automatically from Go source code.*




# Agent API Reference

## ü§ñ Related Tutorial

- [Agent Modules Guide](../../../../../docs/guides/common-features/advanced/agent-modules.md) - Learn about agent modules and custom agents

## Type Agent

```go
type Agent struct {
	Session McpSession
}
```

Agent represents an agent to manipulate applications to complete specific tasks

### Methods

### ExecuteTask

```go
func (a *Agent) ExecuteTask(task string, maxTryTimes int) *ExecutionResult
```

ExecuteTask executes a specific task described in human language

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
sessionResult, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("windows_latest"))
defer sessionResult.Session.Delete()
result := sessionResult.Session.Agent.ExecuteTask("Find weather in NYC", 10)
```

### GetTaskStatus

```go
func (a *Agent) GetTaskStatus(taskID string) *QueryResult
```

GetTaskStatus gets the status of the task with the given task ID

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
sessionResult, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("windows_latest"))
defer sessionResult.Session.Delete()
execResult := sessionResult.Session.Agent.ExecuteTask("Find weather in NYC", 10)
statusResult := sessionResult.Session.Agent.GetTaskStatus(execResult.TaskID)
```

### TerminateTask

```go
func (a *Agent) TerminateTask(taskID string) *ExecutionResult
```

TerminateTask terminates a task with a specified task ID

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
sessionResult, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("windows_latest"))
defer sessionResult.Session.Delete()
execResult := sessionResult.Session.Agent.ExecuteTask("Find weather in NYC", 10)
terminateResult := sessionResult.Session.Agent.TerminateTask(execResult.TaskID)
```

### Related Functions

### NewAgent

```go
func NewAgent(session McpSession) *Agent
```

NewAgent creates a new Agent instance

## Type ExecutionResult

```go
type ExecutionResult struct {
	models.ApiResponse
	Success		bool	`json:"success"`
	ErrorMessage	string	`json:"error_message"`
	TaskID		string	`json:"task_id"`
	TaskStatus	string	`json:"task_status"`
}
```

ExecutionResult represents the result of task execution

## Type McpSession

```go
type McpSession interface {
	GetAPIKey() string
	GetSessionId() string
	CallMcpTool(toolName string, args interface{}, autoGenSession ...bool) (*models.McpToolResult, error)
}
```

McpSession interface defines the methods needed by Agent

## Type QueryResult

```go
type QueryResult struct {
	models.ApiResponse
	Success		bool	`json:"success"`
	Output		string	`json:"output"`
	ErrorMessage	string	`json:"error_message"`
}
```

QueryResult represents the result of query operations

## Related Resources

- [Session API Reference](../basics/session.md)

---

*Documentation generated automatically from Go source code.*




# OSS API Reference

## ‚òÅÔ∏è Related Tutorial

- [OSS Integration Guide](../../../../../docs/guides/common-features/advanced/oss-integration.md) - Integrate with Alibaba Cloud OSS for file storage

## Type DownloadResult

```go
type DownloadResult struct {
	models.ApiResponse
	LocalPath	string
}
```

DownloadResult represents the result of a file download operation

## Type EnvInitResult

```go
type EnvInitResult struct {
	models.ApiResponse
	Result	string
}
```

EnvInitResult represents the result of OSS environment initialization

## Type OSSManager

```go
type OSSManager struct {
	Session interface {
		GetAPIKey() string
		GetClient() *mcp.Client
		GetSessionId() string
		IsVpc() bool
		NetworkInterfaceIp() string
		HttpPort() string
		FindServerForTool(toolName string) string
		CallMcpTool(toolName string, args interface{}, autoGenSession ...bool) (*models.McpToolResult, error)
	}
}
```

OSSManager handles Object Storage Service operations in the AgentBay cloud environment

### Methods

### Download

```go
func (o *OSSManager) Download(bucket, object, path string) (*DownloadResult, error)
```

Download downloads an object from the specified OSS bucket to the given local path

Note: Before calling this API, you must call EnvInit to initialize the OSS environment.

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
result.Session.Oss.EnvInit("accessKeyId", "accessKeySecret", "token", "endpoint", "cn-hangzhou")
downloadResult, _ := result.Session.Oss.Download("my-bucket", "my-object", "/tmp/file.txt")
```

### DownloadAnonymous

```go
func (o *OSSManager) DownloadAnonymous(url, path string) (*DownloadResult, error)
```

DownloadAnonymous downloads a file from the specified URL to the given local path

Note: Before calling this API, you must call EnvInit to initialize the OSS environment.

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
result.Session.Oss.EnvInit("accessKeyId", "accessKeySecret", "token", "endpoint", "cn-hangzhou")
downloadResult, _ := result.Session.Oss.DownloadAnonymous("https://example.com/file.txt", "/tmp/file.txt")
```

### EnvInit

```go
func (o *OSSManager) EnvInit(accessKeyId, accessKeySecret, securityToken, endpoint, region string) (*EnvInitResult, error)
```

EnvInit initializes OSS environment variables with STS temporary credentials. All three credential
parameters (accessKeyId, accessKeySecret, securityToken) are required for security.

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
ossResult, _ := result.Session.Oss.EnvInit("stsAccessKeyId", "stsAccessKeySecret", "stsToken", "endpoint", "cn-hangzhou")
```

### Upload

```go
func (o *OSSManager) Upload(bucket, object, path string) (*UploadResult, error)
```

Upload uploads a local file or directory to the specified OSS bucket

Note: Before calling this API, you must call EnvInit to initialize the OSS environment.

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
result.Session.Oss.EnvInit("accessKeyId", "accessKeySecret", "token", "endpoint", "cn-hangzhou")
uploadResult, _ := result.Session.Oss.Upload("my-bucket", "my-object", "/tmp/file.txt")
```

### UploadAnonymous

```go
func (o *OSSManager) UploadAnonymous(url, path string) (*UploadResult, error)
```

UploadAnonymous uploads a local file or directory to the specified URL using HTTP PUT

Note: Before calling this API, you must call EnvInit to initialize the OSS environment.

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
result.Session.Oss.EnvInit("accessKeyId", "accessKeySecret", "token", "endpoint", "cn-hangzhou")
uploadResult, _ := result.Session.Oss.UploadAnonymous("https://example.com/upload", "/tmp/file.txt")
```

### Related Functions

### NewOss

```go
func NewOss(session interface {
	GetAPIKey() string
	GetClient() *mcp.Client
	GetSessionId() string
	IsVpc() bool
	NetworkInterfaceIp() string
	HttpPort() string
	FindServerForTool(toolName string) string
	CallMcpTool(toolName string, args interface{}, autoGenSession ...bool) (*models.McpToolResult, error)
}) *OSSManager
```

NewOss creates a new OSS manager instance

## Type UploadResult

```go
type UploadResult struct {
	models.ApiResponse
	URL	string
}
```

UploadResult represents the result of a file upload operation

## Related Resources

- [Session API Reference](../basics/session.md)
- [FileSystem API Reference](../basics/filesystem.md)

---

*Documentation generated automatically from Go source code.*




# AgentBay API Reference

## üöÄ Related Tutorial

- [First Session Tutorial](../../../../../docs/quickstart/first-session.md) - Get started with creating your first AgentBay session

## Type AgentBayConfig

```go
type AgentBayConfig struct {
	cfg	*Config
	envFile	string
}
```

AgentBayConfig holds optional configuration for the AgentBay client.

## Type AgentBay

```go
type AgentBay struct {
	APIKey	string
	Client	*mcp.Client
	Context	*ContextService
}
```

AgentBay represents the main client for interacting with the AgentBay cloud runtime environment.

### Methods

### Create

```go
func (a *AgentBay) Create(params *CreateSessionParams) (*SessionResult, error)
```

Create creates a new session in the AgentBay cloud environment. If params is nil, default parameters
will be used. Create creates a new AgentBay session with specified configuration.

Parameters:
  - params: Configuration parameters for the session (optional)
  - Labels: Key-value pairs for session metadata
  - ImageId: Custom image ID for the session environment
  - IsVpc: Whether to create a VPC session
  - PolicyId: Security policy ID
  - ExtraConfigs: Additional configuration options

Returns:
  - *SessionResult: Result containing Session object and request ID
  - error: Error if the operation fails

Behavior:

- Creates a new isolated cloud runtime environment - Waits for session to be ready before returning
- For VPC sessions, includes VPC-specific configuration

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
```

### Delete

```go
func (a *AgentBay) Delete(session *Session, syncContext ...bool) (*DeleteResult, error)
```

Delete deletes a session from the AgentBay cloud environment.

Parameters:
  - session: The session to delete
  - syncContext: Optional boolean to synchronize context data before deletion. If true, uploads all
    context data to OSS. Defaults to false.

Returns:
  - *DeleteResult: Result containing success status and request ID
  - error: Error if the operation fails

Behavior:

- If syncContext is true: Uploads all context data to OSS before deletion - If syncContext is false:
Deletes immediately without sync - Continues with deletion even if context sync fails - Releases all
associated resources

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
client.Delete(result.Session, true)
```

### Get

```go
func (a *AgentBay) Get(sessionID string) (*SessionResult, error)
```

Get retrieves a session by its ID. This method calls the GetSession API and returns a SessionResult
containing the Session object and request ID.

Parameters:
  - sessionID: The ID of the session to retrieve

Returns:
  - *SessionResult: Result containing the Session instance, request ID, and success status
  - error: An error if the operation fails

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
createResult, _ := client.Create(nil)
sessionID := createResult.Session.SessionID
result, _ := client.Get(sessionID)
defer result.Session.Delete()
```

### GetSession

```go
func (a *AgentBay) GetSession(sessionID string) (*GetSessionResult, error)
```

GetSession retrieves session information by session ID

### List

```go
func (a *AgentBay) List(labels map[string]string, page *int, limit *int32) (*SessionListResult, error)
```

List returns paginated list of session IDs filtered by labels.

Parameters:
  - labels: Optional labels to filter sessions (can be nil for no filtering)
  - page: Optional page number for pagination (starting from 1, nil or 0 for first page)
  - limit: Optional maximum number of items per page (nil or 0 uses default of 10)

Returns:
  - *SessionListResult: Paginated list of session IDs that match the labels
  - error: An error if the operation fails

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.List(nil, nil, nil)
```

### Pause

```go
func (ab *AgentBay) Pause(session *Session, timeout int, pollInterval float64) (*models.SessionPauseResult, error)
```

Pause synchronously pauses a session, putting it into a dormant state to reduce resource usage and
costs. Pause puts the session into a PAUSED state where computational resources are significantly
reduced. The session state is preserved and can be resumed later to continue work.

Parameters:
  - session: The session to pause.
  - timeout: Timeout in seconds to wait for the session to pause. Defaults to 600 seconds.
  - pollInterval: Interval in seconds between status polls. Defaults to 2.0 seconds.

Returns:
  - *models.SessionPauseResult: Result containing success status, request ID, and error message if
    any.
  - error: Error if the operation fails at the transport level

Behavior:

- Delegates to session's Pause method for actual implementation - Returns detailed result with
success status and request tracking

Exceptions:

- Returns error result (not Go error) for API-level errors like invalid session ID - Returns error
result for timeout conditions - Returns Go error for transport-level failures

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"))
result, _ := client.Create(nil)
defer result.Session.Delete()
pauseResult, _ := client.Pause(result.Session, 300, 2.0)
client.Resume(result.Session, 300, 2.0)
```

### Resume

```go
func (ab *AgentBay) Resume(session *Session, timeout int, pollInterval float64) (*models.SessionResumeResult, error)
```

Resume synchronously resumes a session from a paused state to continue work. Resume restores the
session from PAUSED state back to RUNNING state. All previous session state and data are preserved
during resume operation.

Parameters:
  - session: The session to resume.
  - timeout: Timeout in seconds to wait for the session to resume. Defaults to 600 seconds.
  - pollInterval: Interval in seconds between status polls. Defaults to 2.0 seconds.

Returns:
  - *models.SessionResumeResult: Result containing success status, request ID, and error message if
    any.
  - error: Error if the operation fails at the transport level

Behavior:

- Delegates to session's Resume method for actual implementation - Returns detailed result with
success status and request tracking

Exceptions:

- Returns error result (not Go error) for API-level errors like invalid session ID - Returns error
result for timeout conditions - Returns Go error for transport-level failures

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"))
result, _ := client.Create(nil)
defer result.Session.Delete()
client.Pause(result.Session, 300, 2.0)
resumeResult, _ := client.Resume(result.Session, 300, 2.0)
```

### Related Functions

### NewAgentBay

```go
func NewAgentBay(apiKey string, opts ...Option) (*AgentBay, error)
```

NewAgentBay creates a new AgentBay client. If apiKey is empty, it will look for the AGENTBAY_API_KEY
environment variable.

### NewAgentBayWithDefaults

```go
func NewAgentBayWithDefaults(apiKey string) (*AgentBay, error)
```

NewAgentBayWithDefaults creates a new AgentBay client using default configuration. This is a
convenience function that allows calling NewAgentBay without a config parameter.

## Type Option

```go
type Option func(*AgentBayConfig)
```

Option is a function that sets optional parameters for AgentBay client.

### Related Functions

### WithConfig

```go
func WithConfig(cfg *Config) Option
```

WithConfig returns an Option that sets the configuration for the AgentBay client.

### WithEnvFile

```go
func WithEnvFile(envFile string) Option
```

WithEnvFile returns an Option that sets a custom .env file path for the AgentBay client.

## Functions

### NewAgentBay

```go
func NewAgentBay(apiKey string, opts ...Option) (*AgentBay, error)
```

NewAgentBay creates a new AgentBay client. If apiKey is empty, it will look for the AGENTBAY_API_KEY
environment variable.

### NewAgentBayWithDefaults

```go
func NewAgentBayWithDefaults(apiKey string) (*AgentBay, error)
```

NewAgentBayWithDefaults creates a new AgentBay client using default configuration. This is a
convenience function that allows calling NewAgentBay without a config parameter.

### WithConfig

```go
func WithConfig(cfg *Config) Option
```

WithConfig returns an Option that sets the configuration for the AgentBay client.

### WithEnvFile

```go
func WithEnvFile(envFile string) Option
```

WithEnvFile returns an Option that sets a custom .env file path for the AgentBay client.

## Related Resources

- [Session API Reference](session.md)
- [Context API Reference](context.md)

---

*Documentation generated automatically from Go source code.*




# Command API Reference

## ‚ö° Related Tutorial

- [Command Execution Guide](../../../../../docs/guides/common-features/basics/command-execution.md) - Learn how to execute commands in sessions

## Overview

The Command module provides methods for executing shell commands within a session in the AgentBay cloud environment.
It supports both synchronous command execution with configurable timeouts.

Command templates for various AgentBay operations.

This module contains shell command templates used by different modules
to execute operations in remote environments.

Template naming convention:
- Use descriptive names that clearly indicate the operation
- Group templates by functionality (mobile, desktop, network, etc.)
- Use consistent parameter naming across similar templates

Parameter conventions:
- Use snake_case for parameter names
- Include descriptive parameter names (e.g., lock_switch, package_list)
- Document expected parameter types and values

## Type Command

```go
type Command struct {
	Session interface {
		GetAPIKey() string
		GetClient() *mcp.Client
		GetSessionId() string
		IsVpc() bool
		NetworkInterfaceIp() string
		HttpPort() string
		FindServerForTool(toolName string) string
		CallMcpTool(toolName string, args interface{}, autoGenSession ...bool) (*models.McpToolResult, error)
	}
}
```

Command handles command execution operations in the AgentBay cloud environment.

### Methods

### ExecuteCommand

```go
func (c *Command) ExecuteCommand(command string, timeoutMs ...int) (*CommandResult, error)
```

ExecuteCommand executes a shell command in the session environment.

Parameters:
  - command: The shell command to execute
  - timeoutMs: Timeout in milliseconds (optional, defaults to 1000ms)

Returns:
  - *CommandResult: Result containing command output and request ID
  - error: Error if the operation fails

Behavior:

- Executes in a Linux shell environment - Combines stdout and stderr in the output - Default timeout
is 1000ms (1 second) - Command runs with session user permissions

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
cmdResult, _ := result.Session.Command.ExecuteCommand("ls -la")
```

### Related Functions

### NewCommand

```go
func NewCommand(session interface {
	GetAPIKey() string
	GetClient() *mcp.Client
	GetSessionId() string
	IsVpc() bool
	NetworkInterfaceIp() string
	HttpPort() string
	FindServerForTool(toolName string) string
	CallMcpTool(toolName string, args interface{}, autoGenSession ...bool) (*models.McpToolResult, error)
}) *Command
```

NewCommand creates a new Command instance

## Type CommandResult

```go
type CommandResult struct {
	// Embed the basic API response structure
	models.ApiResponse
	// Output contains the command execution output
	Output	string
}
```

CommandResult represents the result of a command execution

## Functions

### GetMobileCommandTemplate

```go
func GetMobileCommandTemplate(templateName string) (string, bool)
```

GetMobileCommandTemplate returns a mobile command template by name

## Best Practices

1. Always specify appropriate timeout values based on expected command duration
2. Handle command execution errors gracefully
3. Use absolute paths when referencing files in commands
4. Be aware that commands run with session user permissions
5. Clean up temporary files created by commands

## Related Resources

- [Session API Reference](session.md)
- [FileSystem API Reference](filesystem.md)

---

*Documentation generated automatically from Go source code.*




# Context Manager API Reference

## üöÄ Related Tutorial

- [First Session Tutorial](../../../../../docs/quickstart/first-session.md) - Get started with creating your first AgentBay session

## Type ContextStatusData

```go
type ContextStatusData struct {
	ContextId	string	`json:"contextId"`
	Path		string	`json:"path"`
	ErrorMessage	string	`json:"errorMessage"`
	Status		string	`json:"status"`
	StartTime	int64	`json:"startTime"`
	FinishTime	int64	`json:"finishTime"`
	TaskType	string	`json:"taskType"`
}
```

ContextStatusData represents the parsed context status data

## Type ContextStatusItem

```go
type ContextStatusItem struct {
	Type	string	`json:"type"`
	Data	string	`json:"data"`
}
```

ContextStatusItem represents an item in the context status response

## Type ContextInfoResult

```go
type ContextInfoResult struct {
	models.ApiResponse
	Success			bool
	ContextStatusData	[]ContextStatusData	// Parsed context status data
	ErrorMessage		string
}
```

ContextInfoResult wraps context info result and RequestID

## Type ContextSyncResult

```go
type ContextSyncResult struct {
	models.ApiResponse
	Success		bool
	ErrorMessage	string
}
```

ContextSyncResult wraps context sync result and RequestID

## Type ContextManager

```go
type ContextManager struct {
	Session interface {
		GetAPIKey() string
		GetClient() *mcp.Client
		GetSessionId() string
	}
}
```

ContextManager handles context operations for a specific session.

### Methods

### Info

```go
func (cm *ContextManager) Info() (*ContextInfoResult, error)
```

Info retrieves context information for the current session.

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
info, _ := result.Session.Context.Info()
```

### InfoWithParams

```go
func (cm *ContextManager) InfoWithParams(contextId, path, taskType string) (*ContextInfoResult, error)
```

InfoWithParams retrieves context information for the current session with optional parameters.

### Sync

```go
func (cm *ContextManager) Sync() (*ContextSyncResult, error)
```

Sync synchronizes the context for the current session.

### SyncWithCallback

```go
func (cm *ContextManager) SyncWithCallback(contextId, path, mode string, callback SyncCallback, maxRetries int, retryInterval int) (*ContextSyncResult, error)
```

SyncWithCallback synchronizes the context with callback support (dual-mode). If callback is
provided, it runs in background and calls callback when complete. If callback is nil, it waits for
completion before returning.

Example (Synchronous mode - waits for completion):


package main

import (

	"fmt"

	"os"

	"github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay"

)

func main() {

	client, err := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)

	if err != nil {

		fmt.Printf("Error: %v\n", err)

		os.Exit(1)

	}

	result, err := client.Create(nil)

	if err != nil {

		fmt.Printf("Error: %v\n", err)

		os.Exit(1)

	}

	session := result.Session


	// Get or create a context

	contextResult, err := client.Context.Get("my-context", true)

	if err != nil {

		fmt.Printf("Error: %v\n", err)

		os.Exit(1)

	}


	// Synchronous mode: callback is nil, so it waits for completion

	syncResult, err := session.Context.SyncWithCallback(

		contextResult.ContextID,

		"/mnt/persistent",

		"upload",

		nil,  // No callback - synchronous mode

		10,   // maxRetries

		1000, // retryInterval in milliseconds

	)

	if err != nil {

		fmt.Printf("Error: %v\n", err)

		os.Exit(1)

	}

	fmt.Printf("Sync completed - Success: %v\n", syncResult.Success)


	// Output: No sync tasks found

	// Output: Sync completed - Success: true


	session.Delete()

}

Example (Asynchronous mode - with callback):


package main

import (

	"fmt"

	"os"

	"time"

	"github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay"

)

func main() {

	client, err := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)

	if err != nil {

		fmt.Printf("Error: %v\n", err)

		os.Exit(1)

	}

	result, err := client.Create(nil)

	if err != nil {

		fmt.Printf("Error: %v\n", err)

		os.Exit(1)

	}

	session := result.Session


	// Get or create a context

	contextResult, err := client.Context.Get("my-context", true)

	if err != nil {

		fmt.Printf("Error: %v\n", err)

		os.Exit(1)

	}


	// Asynchronous mode: with callback, returns immediately

	syncResult, err := session.Context.SyncWithCallback(

		contextResult.ContextID,

		"/mnt/persistent",

		"upload",

		func(success bool) {

			if success {

				fmt.Println("Context sync completed successfully")

			} else {

				fmt.Println("Context sync failed or timed out")

			}

		},

		150,  // maxRetries

		1500, // retryInterval in milliseconds

	)

	if err != nil {

		fmt.Printf("Error: %v\n", err)

		os.Exit(1)

	}

	fmt.Printf("Sync triggered - Success: %v\n", syncResult.Success)


	// Wait for callback to complete

	time.Sleep(5 * time.Second)


	// Output: Sync triggered - Success: true

	// Output: Context sync completed successfully


	session.Delete()

}

### SyncWithParams

```go
func (cm *ContextManager) SyncWithParams(contextId, path, mode string) (*ContextSyncResult, error)
```

SyncWithParams synchronizes the context for the current session with optional parameters.

### Related Functions

### NewContextManager

```go
func NewContextManager(session interface {
	GetAPIKey() string
	GetClient() *mcp.Client
	GetSessionId() string
}) *ContextManager
```

NewContextManager creates a new ContextManager object.

## Functions

### NewContextManager

```go
func NewContextManager(session interface {
	GetAPIKey() string
	GetClient() *mcp.Client
	GetSessionId() string
}) *ContextManager
```

NewContextManager creates a new ContextManager object.

## Related Resources

- [Session API Reference](session.md)
- [Context API Reference](context.md)

---

*Documentation generated automatically from Go source code.*




# Context Sync API Reference

## üöÄ Related Tutorial

- [First Session Tutorial](../../../../../docs/quickstart/first-session.md) - Get started with creating your first AgentBay session

## Type ContextSync

```go
type ContextSync struct {
	// ContextID is the ID of the context to synchronize
	ContextID	string	`json:"contextId"`
	// Path is the path where the context should be mounted
	Path	string	`json:"path"`
	// Policy defines the synchronization policy
	Policy	*SyncPolicy	`json:"policy,omitempty"`
}
```

ContextSync defines the context synchronization configuration

### Methods

### WithPolicy

```go
func (cs *ContextSync) WithPolicy(policy *SyncPolicy) (*ContextSync, error)
```

WithPolicy sets the policy and returns the context sync for chaining

### Related Functions

### NewContextSync

```go
func NewContextSync(contextID, path string, policy *SyncPolicy) (*ContextSync, error)
```

NewContextSync creates a new context sync configuration

## Type SyncPolicy

```go
type SyncPolicy struct {
	// UploadPolicy defines the upload policy
	UploadPolicy	*UploadPolicy	`json:"uploadPolicy,omitempty"`
	// DownloadPolicy defines the download policy
	DownloadPolicy	*DownloadPolicy	`json:"downloadPolicy,omitempty"`
	// DeletePolicy defines the delete policy
	DeletePolicy	*DeletePolicy	`json:"deletePolicy,omitempty"`
	// ExtractPolicy defines the extract policy
	ExtractPolicy	*ExtractPolicy	`json:"extractPolicy,omitempty"`
	// RecyclePolicy defines the recycle policy
	RecyclePolicy	*RecyclePolicy	`json:"recyclePolicy,omitempty"`
	// BWList defines the black and white list
	BWList	*BWList	`json:"bwList,omitempty"`
	// MappingPolicy defines the mapping policy for cross-platform context synchronization
	MappingPolicy	*MappingPolicy	`json:"mappingPolicy,omitempty"`
}
```

SyncPolicy defines the synchronization policy

### Related Functions

### NewSyncPolicy

```go
func NewSyncPolicy() *SyncPolicy
```

NewSyncPolicy creates a new sync policy with default values

## Type UploadPolicy

```go
type UploadPolicy struct {
	// AutoUpload enables automatic upload
	AutoUpload	bool	`json:"autoUpload"`
	// UploadStrategy defines the upload strategy
	UploadStrategy	UploadStrategy	`json:"uploadStrategy"`
	// UploadMode defines the upload mode
	UploadMode	UploadMode	`json:"uploadMode"`
}
```

UploadPolicy defines the upload policy for context synchronization

### Related Functions

### NewUploadPolicy

```go
func NewUploadPolicy() *UploadPolicy
```

NewUploadPolicy creates a new upload policy with default values

## Type DownloadPolicy

```go
type DownloadPolicy struct {
	// AutoDownload enables automatic download
	AutoDownload	bool	`json:"autoDownload"`
	// DownloadStrategy defines the download strategy
	DownloadStrategy	DownloadStrategy	`json:"downloadStrategy"`
}
```

DownloadPolicy defines the download policy for context synchronization

### Related Functions

### NewDownloadPolicy

```go
func NewDownloadPolicy() *DownloadPolicy
```

NewDownloadPolicy creates a new download policy with default values

## Type DeletePolicy

```go
type DeletePolicy struct {
	// SyncLocalFile enables synchronization of local file deletions
	SyncLocalFile bool `json:"syncLocalFile"`
}
```

DeletePolicy defines the delete policy for context synchronization

### Related Functions

### NewDeletePolicy

```go
func NewDeletePolicy() *DeletePolicy
```

NewDeletePolicy creates a new delete policy with default values

## Type ExtractPolicy

```go
type ExtractPolicy struct {
	// Extract enables file extraction
	Extract	bool	`json:"extract"`
	// DeleteSrcFile enables deletion of source file after extraction
	DeleteSrcFile	bool	`json:"deleteSrcFile"`
	// ExtractToCurrentFolder enables extraction to current folder
	ExtractToCurrentFolder	bool	`json:"extractToCurrentFolder"`
}
```

ExtractPolicy defines the extract policy for context synchronization

### Related Functions

### NewExtractPolicy

```go
func NewExtractPolicy() *ExtractPolicy
```

NewExtractPolicy creates a new extract policy with default values

## Type RecyclePolicy

```go
type RecyclePolicy struct {
	// Lifecycle defines how long the context data should be retained
	Lifecycle	Lifecycle	`json:"lifecycle"`
	// Paths specifies which directories or files should be subject to the recycle policy
	Paths	[]string	`json:"paths"`
}
```

RecyclePolicy defines the recycle policy for context synchronization

The RecyclePolicy determines how long context data should be retained and which paths are subject to
the policy.

Lifecycle field determines the data retention period:
  - Lifecycle1Day: Keep data for 1 day
  - Lifecycle3Days: Keep data for 3 days
  - Lifecycle5Days: Keep data for 5 days
  - Lifecycle10Days: Keep data for 10 days
  - Lifecycle15Days: Keep data for 15 days
  - Lifecycle30Days: Keep data for 30 days
  - Lifecycle90Days: Keep data for 90 days
  - Lifecycle180Days: Keep data for 180 days
  - Lifecycle360Days: Keep data for 360 days
  - LifecycleForever: Keep data permanently (default)

Paths field specifies which directories or files should be subject to the recycle policy:
  - Must use exact directory/file paths
  - Wildcard patterns (* ? [ ]) are NOT supported
  - Empty string "" means apply to all paths in the context
  - Multiple paths can be specified as a slice
  - Default: []string{""} (applies to all paths)

### Related Functions

### NewRecyclePolicy

```go
func NewRecyclePolicy() *RecyclePolicy
```

NewRecyclePolicy creates a new recycle policy with default values

## Type WhiteList

```go
type WhiteList struct {
	// Path is the path to include in the white list
	Path	string	`json:"path"`
	// ExcludePaths are the paths to exclude from the white list
	ExcludePaths	[]string	`json:"excludePaths,omitempty"`
}
```

WhiteList defines the white list configuration

## Type BWList

```go
type BWList struct {
	// WhiteLists defines the white lists
	WhiteLists []*WhiteList `json:"whiteLists,omitempty"`
}
```

BWList defines the black and white list configuration

## Type MappingPolicy

```go
type MappingPolicy struct {
	// Path is the original path from a different OS that should be mapped to the current context path
	Path string `json:"path"`
}
```

MappingPolicy defines the mapping policy for cross-platform context synchronization

### Related Functions

### NewMappingPolicy

```go
func NewMappingPolicy() *MappingPolicy
```

NewMappingPolicy creates a new mapping policy with default values

## Type UploadStrategy

```go
type UploadStrategy string
```

UploadStrategy defines the upload strategy for context synchronization

## Type DownloadStrategy

```go
type DownloadStrategy string
```

DownloadStrategy defines the download strategy for context synchronization

## Type UploadMode

```go
type UploadMode string
```

UploadMode defines the upload mode for context synchronization

## Type Lifecycle

```go
type Lifecycle string
```

Lifecycle defines the lifecycle options for recycle policy

## Functions

### NewContextSync

```go
func NewContextSync(contextID, path string, policy *SyncPolicy) (*ContextSync, error)
```

NewContextSync creates a new context sync configuration

### NewSyncPolicy

```go
func NewSyncPolicy() *SyncPolicy
```

NewSyncPolicy creates a new sync policy with default values

### NewUploadPolicy

```go
func NewUploadPolicy() *UploadPolicy
```

NewUploadPolicy creates a new upload policy with default values

### NewDownloadPolicy

```go
func NewDownloadPolicy() *DownloadPolicy
```

NewDownloadPolicy creates a new download policy with default values

### NewDeletePolicy

```go
func NewDeletePolicy() *DeletePolicy
```

NewDeletePolicy creates a new delete policy with default values

### NewExtractPolicy

```go
func NewExtractPolicy() *ExtractPolicy
```

NewExtractPolicy creates a new extract policy with default values

### NewRecyclePolicy

```go
func NewRecyclePolicy() *RecyclePolicy
```

NewRecyclePolicy creates a new recycle policy with default values

### NewMappingPolicy

```go
func NewMappingPolicy() *MappingPolicy
```

NewMappingPolicy creates a new mapping policy with default values

## Related Resources

- [Session API Reference](session.md)
- [Context API Reference](context.md)

---

*Documentation generated automatically from Go source code.*




# Context API Reference

## üöÄ Related Tutorial

- [First Session Tutorial](../../../../../docs/quickstart/first-session.md) - Get started with creating your first AgentBay session

## Type Context

```go
type Context struct {
	// ID is the unique identifier of the context.
	ID	string

	// Name is the name of the context.
	Name	string

	// CreatedAt is the date and time when the Context was created.
	CreatedAt	string

	// LastUsedAt is the date and time when the Context was last used.
	LastUsedAt	string
}
```

Context represents a persistent storage context in the AgentBay cloud environment.

## Type ContextResult

```go
type ContextResult struct {
	models.ApiResponse
	Success		bool
	ContextID	string
	Context		*Context
	ErrorMessage	string
}
```

ContextResult wraps context operation result and RequestID

## Type ContextListResult

```go
type ContextListResult struct {
	models.ApiResponse
	Success		bool
	Contexts	[]*Context
	NextToken	string
	MaxResults	int32
	TotalCount	int32
	ErrorMessage	string
}
```

ContextListResult wraps context list and RequestID

## Type ContextCreateResult

```go
type ContextCreateResult struct {
	models.ApiResponse
	ContextID	string
}
```

ContextCreateResult wraps context creation result and RequestID

## Type ContextModifyResult

```go
type ContextModifyResult struct {
	models.ApiResponse
	Success		bool
	ErrorMessage	string
}
```

ContextModifyResult wraps context modification result and RequestID

## Type ContextDeleteResult

```go
type ContextDeleteResult struct {
	models.ApiResponse
	Success		bool
	ErrorMessage	string
}
```

ContextDeleteResult wraps context deletion result and RequestID

## Type ContextClearResult

```go
type ContextClearResult struct {
	models.ApiResponse
	Success		bool
	Status		string	// Current status of the clearing task ("clearing", "available", etc.)
	ContextID	string
	ErrorMessage	string
}
```

ContextClearResult wraps context clear operation result and RequestID

## Type ContextService

```go
type ContextService struct {
	// AgentBay is the AgentBay instance.
	AgentBay *AgentBay
}
```

ContextService provides methods to manage persistent contexts in the AgentBay cloud environment.

### Methods

### Clear

```go
func (cs *ContextService) Clear(contextID string, timeoutSeconds int, pollIntervalSeconds float64) (*ContextClearResult, error)
```

Clear synchronously clears the context's persistent data and waits for the final result. This method
wraps the ClearAsync and GetClearStatus polling logic.

The clearing process transitions through the following states: - "clearing": Data clearing is in
progress - "available": Clearing completed successfully (final success state)

Parameters:
  - contextID: Unique ID of the context to clear
  - timeout: Timeout in seconds to wait for task completion (default: 60)
  - pollInterval: Interval in seconds between status polls (default: 2)

Returns a ContextClearResult object containing the final task result. The status field will be
"available" on success, or other states if interrupted.

### ClearAsync

```go
func (cs *ContextService) ClearAsync(contextID string) (*ContextClearResult, error)
```

ClearAsync asynchronously initiates a task to clear the context's persistent data. This is a
non-blocking method that returns immediately after initiating the clearing task. The context's state
will transition to "clearing" while the operation is in progress.

Parameters:
  - contextID: Unique ID of the context to clear

Returns:
  - *ContextClearResult: Result containing task status and request ID
  - error: Error if the operation fails

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
contextResult, _ := client.Context.Get("my-context", true)
clearResult, _ := client.Context.ClearAsync(contextResult.ContextID)
```

### Create

```go
func (cs *ContextService) Create(name string) (*ContextCreateResult, error)
```

Create creates a new context with the given name.

Parameters:
  - name: The name for the new context.

Returns:
  - *ContextCreateResult: A result object containing the created context ID and request ID.
  - error: An error if the operation fails.

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
createResult, _ := client.Context.Create("my-context")
```

### Delete

```go
func (cs *ContextService) Delete(context *Context) (*ContextDeleteResult, error)
```

Delete deletes the specified context.

Parameters:
  - context: The context object to delete

Returns:
  - *ContextDeleteResult: Result containing success status and request ID
  - error: Error if the operation fails

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
contextResult, _ := client.Context.Get("my-context", true)
client.Context.Delete(contextResult.Context)
```

### DeleteFile

```go
func (cs *ContextService) DeleteFile(contextID string, filePath string) (*ContextFileDeleteResult, error)
```

DeleteFile deletes a file in a context.

Parameters:
  - contextID: The ID of the context
  - filePath: The path to the file to delete

Returns:
  - *ContextFileDeleteResult: Result containing success status and request ID
  - error: Error if the operation fails

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
contextResult, _ := client.Context.Get("my-context", true)
client.Context.DeleteFile(contextResult.ContextID, "/data/file.txt")
```

### Get

```go
func (cs *ContextService) Get(name string, create bool) (*ContextResult, error)
```

Get gets a context by name. Optionally creates it if it doesn't exist. Get retrieves an existing
context or creates a new one.

Parameters:
  - name: The name of the context to retrieve or create
  - create: If true, creates the context if it doesn't exist

Returns:
  - *ContextResult: Result containing Context object and request ID
  - error: Error if the operation fails

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
contextResult, _ := client.Context.Get("my-context", true)
```

### GetClearStatus

```go
func (cs *ContextService) GetClearStatus(contextID string) (*ContextClearResult, error)
```

GetClearStatus queries the status of the clearing task. This method calls GetContext API directly
with contextID and parses the raw response to extract the state field, which indicates the current
clearing status.

Parameters:
  - contextID: Unique ID of the context to check

Returns:
  - *ContextClearResult: Result containing current task status and request ID
  - error: Error if the operation fails

State Transitions:
  - "clearing": Data clearing is in progress
  - "available": Clearing completed successfully (final success state)
  - "in-use": Context is being used
  - "pre-available": Context is being prepared

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
contextResult, _ := client.Context.Get("my-context", true)
statusResult, _ := client.Context.GetClearStatus(contextResult.ContextID)
```

### GetFileDownloadUrl

```go
func (cs *ContextService) GetFileDownloadUrl(contextID string, filePath string) (*ContextFileUrlResult, error)
```

GetFileDownloadUrl gets a presigned download URL for a file in a context.

Parameters:
  - contextID: The ID of the context
  - filePath: The path to the file in the context

Returns:
  - *ContextFileUrlResult: Result containing the presigned URL, expire time, and request ID
  - error: Error if the operation fails

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
contextResult, _ := client.Context.Get("my-context", true)
urlResult, _ := client.Context.GetFileDownloadUrl(contextResult.ContextID, "/data/file.txt")
```

### GetFileUploadUrl

```go
func (cs *ContextService) GetFileUploadUrl(contextID string, filePath string) (*ContextFileUrlResult, error)
```

GetFileUploadUrl gets a presigned upload URL for a file in a context.

Parameters:
  - contextID: The ID of the context
  - filePath: The path to the file in the context

Returns:
  - *ContextFileUrlResult: Result containing the presigned URL, expire time, and request ID
  - error: Error if the operation fails

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
contextResult, _ := client.Context.Get("my-context", true)
urlResult, _ := client.Context.GetFileUploadUrl(contextResult.ContextID, "/data/file.txt")
```

### List

```go
func (cs *ContextService) List(params *ContextListParams) (*ContextListResult, error)
```

List lists all available contexts with pagination support.

Parameters:
  - params: *ContextListParams (optional) - Pagination parameters. If nil, default values are used
    (MaxResults=10).

Returns:
  - *ContextListResult: A result object containing the list of Context objects, pagination info,
    and RequestID.
  - error: An error if the operation fails.

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Context.List(nil)
```

### ListFiles

```go
func (cs *ContextService) ListFiles(contextID string, parentFolderPath string, pageNumber int32, pageSize int32) (*ContextFileListResult, error)
```

ListFiles lists files under a specific folder path in a context.

Parameters:
  - contextID: The ID of the context
  - parentFolderPath: The parent folder path to list files from
  - pageNumber: The page number for pagination
  - pageSize: The number of items per page

Returns:
  - *ContextFileListResult: Result containing the list of files and request ID
  - error: Error if the operation fails

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
contextResult, _ := client.Context.Get("my-context", true)
fileList, _ := client.Context.ListFiles(contextResult.ContextID, "/", 1, 10)
```

### Update

```go
func (cs *ContextService) Update(context *Context) (*ContextModifyResult, error)
```

Update updates the specified context. Returns a result with success status. Update modifies an
existing context's properties.

Parameters:
  - context: Context object with updated properties

Returns:
  - *ContextModifyResult: Result containing success status and request ID
  - error: Error if the operation fails

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
contextResult, _ := client.Context.Get("my-context", true)
contextResult.Context.Name = "new-name"
client.Context.Update(contextResult.Context)
```

## Type ContextListParams

```go
type ContextListParams struct {
	MaxResults	int32	// Number of results per page
	NextToken	string	// Token for the next page
}
```

ContextListParams contains parameters for listing contexts

### Related Functions

### NewContextListParams

```go
func NewContextListParams() *ContextListParams
```

NewContextListParams creates a new ContextListParams with default values

## Type ContextFileUrlResult

```go
type ContextFileUrlResult struct {
	models.ApiResponse
	Success		bool
	Url		string
	ExpireTime	*int64
	ErrorMessage	string
}
```

ContextFileUrlResult represents a presigned URL operation result.

## Type ContextFileEntry

```go
type ContextFileEntry struct {
	FileID		string
	FileName	string
	FilePath	string
	FileType	string
	GmtCreate	string
	GmtModified	string
	Size		int64
	Status		string
}
```

ContextFileEntry represents a file item in a context.

## Type ContextFileListResult

```go
type ContextFileListResult struct {
	models.ApiResponse
	Success		bool
	Entries		[]*ContextFileEntry
	Count		*int32
	ErrorMessage	string
}
```

ContextFileListResult represents the result of listing files under a context path.

## Type ContextFileDeleteResult

```go
type ContextFileDeleteResult struct {
	models.ApiResponse
	Success		bool
	ErrorMessage	string
}
```

ContextFileDeleteResult represents the result of deleting a file in a context.

## Functions

### NewContextListParams

```go
func NewContextListParams() *ContextListParams
```

NewContextListParams creates a new ContextListParams with default values

## Related Resources

- [Session API Reference](session.md)
- [Context API Reference](context.md)

---

*Documentation generated automatically from Go source code.*




# File System API Reference

## üìÅ Related Tutorial

- [File Operations Guide](../../../../../docs/guides/common-features/basics/file-operations.md) - Complete guide to file system operations

## Type DirectoryEntry

```go
type DirectoryEntry struct {
	Name		string	`json:"name"`
	IsDirectory	bool	`json:"isDirectory"`
}
```

DirectoryEntry represents a directory entry

## Type DirectoryListResult

```go
type DirectoryListResult struct {
	models.ApiResponse
	Entries	[]*DirectoryEntry
}
```

DirectoryListResult wraps directory listing result and RequestID

## Type FileChangeEvent

```go
type FileChangeEvent struct {
	EventType	string	`json:"eventType"`	// "create", "modify", "delete"
	Path		string	`json:"path"`
	PathType	string	`json:"pathType"`	// "file", "directory"
}
```

FileChangeEvent represents a single file change event

### Methods

### String

```go
func (e *FileChangeEvent) String() string
```

String returns string representation of FileChangeEvent

## Type FileChangeResult

```go
type FileChangeResult struct {
	models.ApiResponse
	Events	[]*FileChangeEvent
	RawData	string
}
```

FileChangeResult wraps file change detection result

### Methods

### GetCreatedFiles

```go
func (r *FileChangeResult) GetCreatedFiles() []string
```

GetCreatedFiles returns list of created file paths

### GetDeletedFiles

```go
func (r *FileChangeResult) GetDeletedFiles() []string
```

GetDeletedFiles returns list of deleted file paths

### GetModifiedFiles

```go
func (r *FileChangeResult) GetModifiedFiles() []string
```

GetModifiedFiles returns list of modified file paths

### HasChanges

```go
func (r *FileChangeResult) HasChanges() bool
```

HasChanges checks if there are any file changes

## Type FileDirectoryResult

```go
type FileDirectoryResult struct {
	models.ApiResponse	// Embedded ApiResponse
	Success			bool
}
```

FileDirectoryResult wraps directory operation result and RequestID

## Type FileExistsResult

```go
type FileExistsResult struct {
	models.ApiResponse
	Exists	bool
}
```

FileExistsResult wraps file existence check result and RequestID

## Type FileInfo

```go
type FileInfo struct {
	Name		string	`json:"name"`
	Path		string	`json:"path"`
	Size		int64	`json:"size"`
	IsDirectory	bool	`json:"isDirectory"`
	ModTime		string	`json:"modTime"`
	Mode		string	`json:"mode"`
	Owner		string	`json:"owner,omitempty"`
	Group		string	`json:"group,omitempty"`
}
```

FileInfo represents file or directory information

## Type FileInfoResult

```go
type FileInfoResult struct {
	models.ApiResponse
	FileInfo	*FileInfo
}
```

FileInfoResult wraps file info result and RequestID

## Type FileReadResult

```go
type FileReadResult struct {
	models.ApiResponse	// Embedded ApiResponse
	Content			string
}
```

FileReadResult wraps file read operation result and RequestID

## Type FileSystem

```go
type FileSystem struct {
	Session interface {
		GetAPIKey() string
		GetClient() *mcp.Client
		GetSessionId() string
		IsVpc() bool
		NetworkInterfaceIp() string
		HttpPort() string
		FindServerForTool(toolName string) string
		CallMcpTool(toolName string, args interface{}, autoGenSession ...bool) (*models.McpToolResult, error)
	}
}
```

FileSystem handles file system operations in the AgentBay cloud environment.

### Methods

### CreateDirectory

```go
func (fs *FileSystem) CreateDirectory(path string) (*FileDirectoryResult, error)
```

CreateDirectory creates a new directory.

Parameters:
  - path: Absolute path to the directory to create

Returns:
  - *FileDirectoryResult: Result containing success status and request ID
  - error: Error if the operation fails

Behavior:

- Creates the directory and any necessary parent directories - Fails if the directory already exists
- Returns success if the directory is created successfully

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
createResult, _ := result.Session.FileSystem.CreateDirectory("/tmp/test_directory")
```

### EditFile

```go
func (fs *FileSystem) EditFile(path string, edits []map[string]string, dryRun bool) (*FileWriteResult, error)
```

EditFile edits a file with specified changes.

Parameters:
  - path: Absolute path to the file to edit
  - edits: Array of edit operations, each containing "oldText" and "newText" keys
  - dryRun: If true, preview changes without applying them

Returns:
  - *FileWriteResult: Result containing success status and request ID
  - error: Error if the operation fails

Behavior:

- Performs find-and-replace operations on the file content - In dry-run mode, shows what changes
would be made without applying them - All edits are applied sequentially in the order provided

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
result.Session.FileSystem.WriteFile("/tmp/test.txt", "Hello World", "overwrite")
edits := []map[string]string{{"oldText": "Hello", "newText": "Hi"}}
editResult, _ := result.Session.FileSystem.EditFile("/tmp/test.txt", edits, false)
```

### GetFileChange

```go
func (fs *FileSystem) GetFileChange(path string) (*FileChangeResult, error)
```

GetFileChange gets file change information for the specified directory path.

Parameters:
  - path: Absolute path to the directory to monitor

Returns:
  - *FileChangeResult: Result containing detected file changes and request ID
  - error: Error if the operation fails

Behavior:

- Detects file changes (create, modify, delete) since the last check - Returns empty Events array if
no changes detected - Automatically tracks the last checked state for the directory

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
result.Session.FileSystem.CreateDirectory("/tmp/watch_test")
result.Session.FileSystem.GetFileChange("/tmp/watch_test")
result.Session.FileSystem.WriteFile("/tmp/watch_test/file.txt", "content", "overwrite")
changeResult, _ := result.Session.FileSystem.GetFileChange("/tmp/watch_test")
```

### GetFileInfo

```go
func (fs *FileSystem) GetFileInfo(path string) (*FileInfoResult, error)
```

GetFileInfo gets information about a file or directory.

Parameters:
  - path: Absolute path to the file or directory

Returns:
  - *FileInfoResult: Result containing file information and request ID
  - error: Error if the operation fails

Behavior:

- Returns detailed information including size, permissions, modification time - Works for both files
and directories - Fails if the path doesn't exist

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
fileInfo, _ := result.Session.FileSystem.GetFileInfo("/etc/hostname")
```

### ListDirectory

```go
func (fs *FileSystem) ListDirectory(path string) (*DirectoryListResult, error)
```

ListDirectory lists the contents of a directory. ListDirectory lists all files and directories in a
directory.

Parameters:
  - path: Absolute path to the directory to list

Returns:
  - *DirectoryListResult: Result containing list of entries and request ID
  - error: Error if the operation fails

Behavior:

- Returns list of DirectoryEntry objects with name, type, size, and mtime - Entry types: "file" or
"directory" - Fails if path doesn't exist or is not a directory

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
listResult, _ := result.Session.FileSystem.ListDirectory("/tmp")
```

### MoveFile

```go
func (fs *FileSystem) MoveFile(source, destination string) (*FileWriteResult, error)
```

MoveFile moves a file or directory from source to destination.

Parameters:
  - source: Absolute path to the source file or directory
  - destination: Absolute path to the destination

Returns:
  - *FileWriteResult: Result containing success status and request ID
  - error: Error if the operation fails

Behavior:

- Moves files or directories to a new location - Can be used to rename files/directories - Fails if
source doesn't exist or destination already exists

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
result.Session.FileSystem.WriteFile("/tmp/old.txt", "content", "overwrite")
moveResult, _ := result.Session.FileSystem.MoveFile("/tmp/old.txt", "/tmp/new.txt")
```

### ReadFile

```go
func (fs *FileSystem) ReadFile(path string) (*FileReadResult, error)
```

ReadFile reads the contents of a file. Automatically handles large files by chunking. ReadFile reads
the entire content of a file.

Parameters:
  - path: Absolute path to the file to read

Returns:
  - *FileReadResult: Result containing file content and request ID
  - error: Error if the operation fails

Behavior:

- Automatically handles large files by reading in 50KB chunks - Returns empty string for empty files
- Fails if path is a directory or doesn't exist

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
fileResult, _ := result.Session.FileSystem.ReadFile("/etc/hostname")
```

### ReadMultipleFiles

```go
func (fs *FileSystem) ReadMultipleFiles(paths []string) (map[string]string, error)
```

ReadMultipleFiles reads multiple files and returns their contents as a map.

Parameters:
  - paths: Array of absolute paths to files to read

Returns:
  - map[string]string: Map with file paths as keys and their contents as values
  - error: Error if the operation fails

Behavior:

- Reads multiple files in a single operation - Returns a map with paths as keys and file contents as
values - Fails if any of the specified files don't exist

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
paths := []string{"/etc/hostname", "/etc/os-release"}
contents, _ := result.Session.FileSystem.ReadMultipleFiles(paths)
```

### SearchFiles

```go
func (fs *FileSystem) SearchFiles(path, pattern string, excludePatterns []string) (*SearchFilesResult, error)
```

SearchFiles searches for files matching a wildcard pattern.

Parameters:
  - path: Absolute path to the directory to search in
  - pattern: Wildcard pattern to match against file names. Supports * (any characters) and ? (single
    character). Examples: "*.txt", "test_*", "*config*"
  - excludePatterns: Array of wildcard patterns to exclude from results

Returns:
  - *SearchFilesResult: Result containing matching file paths and request ID
  - error: Error if the operation fails

Behavior:

- Recursively searches the directory and subdirectories - Supports wildcard patterns for matching -
Exclude patterns help filter out unwanted results

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
searchResult, _ := result.Session.FileSystem.SearchFiles("/tmp", "*.txt", []string{})
```

### WatchDirectory

```go
func (fs *FileSystem) WatchDirectory(
	path string,
	callback func([]*FileChangeEvent),
	interval time.Duration,
	stopCh <-chan struct{},
) *sync.WaitGroup
```

WatchDirectory watches a directory for file changes and calls the callback function when changes
occur.

Parameters:
  - path: Absolute path to the directory to watch
  - callback: Function called when changes are detected, receives array of FileChangeEvent
  - interval: Polling interval (e.g., 1*time.Second for 1 second)
  - stopCh: Channel to signal when to stop watching

Returns:
  - *sync.WaitGroup: WaitGroup that can be used to wait for monitoring to stop

Behavior:

- Continuously monitors directory for file changes at specified interval - Calls callback function
asynchronously when changes detected - Stops monitoring when stopCh is closed

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
result.Session.FileSystem.CreateDirectory("/tmp/watch")
stopCh := make(chan struct{})
wg := result.Session.FileSystem.WatchDirectory("/tmp/watch", func(events []*filesystem.FileChangeEvent) {}, 1*time.Second, stopCh)
close(stopCh)
wg.Wait()
```

### WatchDirectoryWithDefaults

```go
func (fs *FileSystem) WatchDirectoryWithDefaults(
	path string,
	callback func([]*FileChangeEvent),
	stopCh <-chan struct{},
) *sync.WaitGroup
```

WatchDirectoryWithDefaults watches a directory for file changes with default 500ms polling interval

### WriteFile

```go
func (fs *FileSystem) WriteFile(path, content string, mode string) (*FileWriteResult, error)
```

WriteFile writes content to a file. Automatically handles large files by chunking. WriteFile writes
content to a file.

Parameters:
  - path: Absolute path to the file to write
  - content: Content to write to the file
  - mode: Write mode ("overwrite" or "append")

Returns:
  - *FileWriteResult: Result containing success status and request ID
  - error: Error if the operation fails

Behavior:

- Automatically handles large content by writing in 50KB chunks - Creates parent directories if they
don't exist - "overwrite" mode replaces existing file content - "append" mode adds to existing file
content

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
writeResult, _ := result.Session.FileSystem.WriteFile("/tmp/test.txt", "Hello", "overwrite")
```

### Related Functions

### NewFileSystem

```go
func NewFileSystem(session interface {
	GetAPIKey() string
	GetClient() *mcp.Client
	GetSessionId() string
	IsVpc() bool
	NetworkInterfaceIp() string
	HttpPort() string
	FindServerForTool(toolName string) string
	CallMcpTool(toolName string, args interface{}, autoGenSession ...bool) (*models.McpToolResult, error)
}) *FileSystem
```

NewFileSystem creates a new FileSystem instance

## Type FileWriteResult

```go
type FileWriteResult struct {
	models.ApiResponse	// Embedded ApiResponse
	Success			bool
}
```

FileWriteResult wraps file write operation result and RequestID

## Type SearchFilesResult

```go
type SearchFilesResult struct {
	models.ApiResponse
	Results	[]string
}
```

SearchFilesResult wraps file search result and RequestID

## Related Resources

- [Session API Reference](session.md)
- [Command API Reference](command.md)

---

*Documentation generated automatically from Go source code.*




# Logging API Reference

## üöÄ Related Tutorial

- [First Session Tutorial](../../../../../docs/quickstart/first-session.md) - Get started with creating your first AgentBay session

## Type LoggerConfig

```go
type LoggerConfig struct {
	Level		string
	LogFile		string
	MaxFileSize	string
	EnableConsole	*bool
}
```

LoggerConfig holds configuration for file logging

## Functions

### SetLogLevel

```go
func SetLogLevel(level int)
```

SetLogLevel sets the global log level

**Example:**

```go
agentbay.SetLogLevel(agentbay.LOG_DEBUG)
```

### GetLogLevel

```go
func GetLogLevel() int
```

GetLogLevel returns the current global log level

**Example:**

```go
package main
import (
	"fmt"
	"github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay"
)
func main() {

	// Set log level to DEBUG

	agentbay.SetLogLevel(agentbay.LOG_DEBUG)

	// Check current level

	currentLevel := agentbay.GetLogLevel()
	fmt.Printf("Current log level: %d\n", currentLevel)
}
```

### SetupLogger

```go
func SetupLogger(config LoggerConfig)
```

SetupLogger configures the logger with file logging support

**Example:**

```go
config := agentbay.LoggerConfig{Level: "DEBUG", LogFile: "/tmp/agentbay.log"}
agentbay.SetupLogger(config)
```

### LogDebug

```go
func LogDebug(message string)
```

LogDebug logs a debug message

**Example:**

```go
agentbay.LogDebug("Processing request parameters")
```

### LogInfo

```go
func LogInfo(message string)
```

LogInfo logs an informational message

**Example:**

```go
agentbay.LogInfo("Session created successfully")
```

## Constants and Variables

### LOG_DEBUG, LOG_INFO, LOG_WARN, LOG_ERROR

```go
const (
	LOG_DEBUG	= iota
	LOG_INFO
	LOG_WARN
	LOG_ERROR
)
```

Log level constants

## Related Resources

- [Session API Reference](session.md)
- [Context API Reference](context.md)

---

*Documentation generated automatically from Go source code.*




# Session API Reference

## üîß Related Tutorial

- [Session Management Guide](../../../../../docs/guides/common-features/basics/session-management.md) - Detailed tutorial on session lifecycle and management

## Type Session

```go
type Session struct {
	AgentBay	*AgentBay
	SessionID	string
	ImageId		string	// ImageId used when creating this session

	// VPC-related information
	IsVpcEnabled		bool	// Whether this session uses VPC resources
	NetworkInterfaceIP	string	// Network interface IP for VPC sessions
	HttpPortNumber		string	// HTTP port for VPC sessions
	Token			string	// Token for VPC sessions

	// Resource URL for accessing the session
	ResourceUrl	string

	// File transfer context ID for file operations
	FileTransferContextID	string

	// Browser recording context ID
	RecordContextID	string

	// Browser replay enabled flag
	EnableBrowserReplay	bool

	// File, command and code handlers
	FileSystem	*filesystem.FileSystem
	Command		*command.Command
	Code		*code.Code
	Oss		*oss.OSSManager

	// Platform-specific automation modules
	Computer	*computer.Computer
	Mobile		*mobile.Mobile

	// Browser for web automation
	Browser	*browser.Browser

	// Agent for task execution
	Agent	*agent.Agent

	// Context management
	Context	*ContextManager

	// MCP tools available for this session
	McpTools	[]McpTool
}
```

Session represents a session in the AgentBay cloud environment.

### Methods

### Delete

```go
func (s *Session) Delete(syncContext ...bool) (*DeleteResult, error)
```

Delete deletes this session. Delete deletes the session and releases all associated resources.

Parameters:
  - syncContext: Optional boolean to synchronize context data before deletion. If true, uploads all
    context data to OSS. Defaults to false.

Returns:
  - *DeleteResult: Result containing success status and request ID
  - error: Error if the operation fails

Behavior:

- If syncContext is true: Uploads all context data to OSS before deletion - If syncContext is false:
Deletes immediately without sync - Continues with deletion even if context sync fails - Releases all
associated resources (browser, computer, mobile, etc.)

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
deleteResult, _ := result.Session.Delete()
```

### GetEnableBrowserReplay

```go
func (s *Session) GetEnableBrowserReplay() bool
```

GetEnableBrowserReplay returns whether browser replay is enabled for this session.

### GetLabels

```go
func (s *Session) GetLabels() (*LabelResult, error)
```

GetLabels gets the labels for this session.

Returns:
  - *LabelResult: Result containing labels as JSON string and request ID
  - error: Error if the operation fails

Behavior:

- Retrieves the labels that were previously set for this session - Returns labels as a JSON string -
Can be used to identify and filter sessions

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
labelResult, _ := result.Session.GetLabels()
```

### GetLink

```go
func (s *Session) GetLink(protocolType *string, port *int32, options *string) (*LinkResult, error)
```

GetLink gets the link for this session. GetLink retrieves an access link for the session.

Parameters:
  - protocolType: Protocol type for the link (optional, reserved for future use)
  - port: Specific port number to access (must be in range [30100, 30199])
  - options: Additional options (optional)

Returns:
  - *LinkResult: Result containing the access URL and request ID
  - error: Error if port is out of range or operation fails

Behavior:

- Without port: Returns the default session access URL - With port: Returns URL for accessing
specific port-mapped service - Port must be in range [30100, 30199] for port forwarding

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
port := int32(30100)
linkResult, _ := result.Session.GetLink(nil, &port, nil)
```

### GetToken

```go
func (s *Session) GetToken() string
```

GetToken returns the token for VPC sessions

### Info

```go
func (s *Session) Info() (*InfoResult, error)
```

Info gets information about this session. Info retrieves detailed information about the current
session.

Returns:
  - *InfoResult: Result containing SessionInfo object and request ID
  - error: Error if the operation fails or session not found

Behavior:

- Retrieves current session metadata from the backend - Includes resource URL, type, and connection
properties - Information is fetched in real-time from the API

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
infoResult, _ := result.Session.Info()
```

### ListMcpTools

```go
func (s *Session) ListMcpTools() (*McpToolsResult, error)
```

ListMcpTools lists MCP tools available for this session. It uses the ImageId from the session
creation, or "linux_latest" as default.

Returns:
  - *McpToolsResult: Result containing list of MCP tools and request ID
  - error: Error if the operation fails

Behavior:

- Uses the ImageId from session creation - Defaults to "linux_latest" if ImageId is empty -
Retrieves all available MCP tools for the specified image - Updates the session's McpTools field
with the retrieved tools

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
toolsResult, _ := result.Session.ListMcpTools()
```

### Pause

```go
func (s *Session) Pause(timeout int, pollInterval float64) (*models.SessionPauseResult, error)
```

Pause synchronously pauses this session, putting it into a dormant state to reduce resource
usage and costs. Pause puts the session into a PAUSED state where computational resources are
significantly reduced. The session state is preserved and can be resumed later to continue work.

Parameters:
  - timeout: Timeout in seconds to wait for the session to pause. Defaults to 600 seconds.
  - pollInterval: Interval in seconds between status polls. Defaults to 2.0 seconds.

Returns:
  - *models.SessionPauseResult: Result containing success status, request ID, and error message if
    any.
  - error: Error if the operation fails at the transport level

Behavior:

- Initiates pause operation through the PauseSessionAsync API - Polls session status until PAUSED
state or timeout - Returns detailed result with success status and request tracking

Exceptions:

- Returns error result (not Go error) for API-level errors like invalid session ID - Returns error
result for timeout conditions - Returns Go error for transport-level failures

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"))
result, _ := client.Create(nil)
defer result.Session.Delete()
pauseResult, _ := result.Session.Pause(300, 2.0)
```

### Resume

```go
func (s *Session) Resume(timeout int, pollInterval float64) (*models.SessionResumeResult, error)
```

Resume synchronously resumes this session from a paused state to continue work. Resume restores the
session from PAUSED state back to RUNNING state. All previous session state and data are preserved
during resume operation.

Parameters:
  - timeout: Timeout in seconds to wait for the session to resume. Defaults to 600 seconds.
  - pollInterval: Interval in seconds between status polls. Defaults to 2.0 seconds.

Returns:
  - *models.SessionResumeResult: Result containing success status, request ID, and error message if
    any.
  - error: Error if the operation fails at the transport level

Behavior:

- Initiates resume operation through the ResumeSessionAsync API - Polls session status until RUNNING
state or timeout - Returns detailed result with success status and request tracking

Exceptions:

- Returns error result (not Go error) for API-level errors like invalid session ID - Returns error
result for timeout conditions - Returns Go error for transport-level failures

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"))
result, _ := client.Create(nil)
defer result.Session.Delete()
result.Session.Pause(300, 2.0)
resumeResult, _ := result.Session.Resume(300, 2.0)
```

### SetLabels

```go
func (s *Session) SetLabels(labels map[string]string) (*LabelResult, error)
```

SetLabels sets the labels for this session.

Parameters:
  - labels: Labels to set for the session as a map of key-value pairs

Returns:
  - *LabelResult: Result containing request ID
  - error: Error if validation fails or operation fails

Behavior:

- Validates that labels map is not nil or empty - All keys and values must be non-empty strings
- Converts labels to JSON and sends to the backend - Labels can be used for session filtering and
organization

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(nil)
defer result.Session.Delete()
labels := map[string]string{"env": "test"}
labelResult, _ := result.Session.SetLabels(labels)
```

### Related Functions

### NewSession

```go
func NewSession(agentBay *AgentBay, sessionID string) *Session
```

NewSession creates a new Session object.

## Type CreateSessionParams

```go
type CreateSessionParams struct {
	// Labels are custom labels for the Session. These can be used for organizing and filtering sessions.
	Labels	map[string]string

	// ImageId specifies the image ID to use for the session.
	ImageId	string

	// ContextSync is a list of context synchronization configurations.
	// These configurations define how contexts should be synchronized and mounted.
	ContextSync	[]*ContextSync

	// IsVpc specifies whether to create a VPC-based session. Defaults to false.
	IsVpc	bool

	// PolicyId specifies the policy ID to apply when creating the session.
	PolicyId	string

	// ExtraConfigs contains extra configuration settings for different session types
	ExtraConfigs	*models.ExtraConfigs

	// Framework specifies the framework name for tracking (e.g., "langchain"). Empty string means direct call.
	Framework	string

	// EnableBrowserReplay specifies whether to enable browser recording for this session.
	EnableBrowserReplay	bool
}
```

CreateSessionParams provides a way to configure the parameters for creating a new session in the
AgentBay cloud environment.

### Methods

### AddContextSync

```go
func (p *CreateSessionParams) AddContextSync(contextID, path string, policy *SyncPolicy) *CreateSessionParams
```

AddContextSync adds a context sync configuration to the session parameters.

### AddContextSyncConfig

```go
func (p *CreateSessionParams) AddContextSyncConfig(contextSync *ContextSync) *CreateSessionParams
```

AddContextSyncConfig adds a pre-configured context sync to the session parameters.

### GetExtraConfigsJSON

```go
func (p *CreateSessionParams) GetExtraConfigsJSON() (string, error)
```

GetExtraConfigsJSON returns the extra configs as a JSON string.

### GetLabelsJSON

```go
func (p *CreateSessionParams) GetLabelsJSON() (string, error)
```

GetLabelsJSON returns the labels as a JSON string.

### WithContextSync

```go
func (p *CreateSessionParams) WithContextSync(contextSyncs []*ContextSync) *CreateSessionParams
```

WithContextSync sets the context sync configurations for the session parameters.

### WithEnableBrowserReplay

```go
func (p *CreateSessionParams) WithEnableBrowserReplay(enableBrowserReplay bool) *CreateSessionParams
```

WithEnableBrowserReplay sets the browser replay flag for the session parameters and returns the
updated parameters.

### WithExtraConfigs

```go
func (p *CreateSessionParams) WithExtraConfigs(extraConfigs *models.ExtraConfigs) *CreateSessionParams
```

WithExtraConfigs sets the extra configurations for the session parameters and returns the updated
parameters.

### WithImageId

```go
func (p *CreateSessionParams) WithImageId(imageId string) *CreateSessionParams
```

WithImageId sets the image ID for the session parameters and returns the updated parameters.

### WithIsVpc

```go
func (p *CreateSessionParams) WithIsVpc(isVpc bool) *CreateSessionParams
```

WithIsVpc sets the VPC flag for the session parameters and returns the updated parameters.

### WithLabels

```go
func (p *CreateSessionParams) WithLabels(labels map[string]string) *CreateSessionParams
```

WithLabels sets the labels for the session parameters and returns the updated parameters.

### WithPolicyId

```go
func (p *CreateSessionParams) WithPolicyId(policyId string) *CreateSessionParams
```

WithPolicyId sets the policy ID for the session parameters and returns the updated parameters.

### Related Functions

### NewCreateSessionParams

```go
func NewCreateSessionParams() *CreateSessionParams
```

NewCreateSessionParams creates a new CreateSessionParams with default values.

## Type SessionResult

```go
type SessionResult struct {
	models.ApiResponse
	Session		*Session
	Success		bool
	ErrorMessage	string
}
```

SessionResult wraps Session object and RequestID

## Type SessionListResult

```go
type SessionListResult struct {
	models.ApiResponse
	SessionIds	[]string	// Session IDs
	NextToken	string		// Token for the next page
	MaxResults	int32		// Number of results per page
	TotalCount	int32		// Total number of results
}
```

SessionListResult wraps Session list and RequestID

## Type InfoResult

```go
type InfoResult struct {
	models.ApiResponse
	Info	*SessionInfo
}
```

InfoResult wraps SessionInfo and RequestID

## Type LabelResult

```go
type LabelResult struct {
	models.ApiResponse
	Labels	string
}
```

LabelResult wraps label operation result and RequestID

## Type LinkResult

```go
type LinkResult struct {
	models.ApiResponse
	Link	string
}
```

LinkResult wraps link result and RequestID

## Type DeleteResult

```go
type DeleteResult struct {
	models.ApiResponse
	Success		bool
	ErrorMessage	string
}
```

DeleteResult wraps deletion operation result and RequestID

## Type McpToolsResult

```go
type McpToolsResult struct {
	models.ApiResponse
	Tools	[]McpTool
}
```

McpToolsResult wraps MCP tools list and RequestID

## Type McpTool

```go
type McpTool struct {
	Name		string			`json:"name"`		// Tool name
	Description	string			`json:"description"`	// Tool description
	InputSchema	map[string]interface{}	`json:"inputSchema"`	// Input parameter schema
	Server		string			`json:"server"`		// Server name that provides this tool
	Tool		string			`json:"tool"`		// Tool identifier
}
```

McpTool represents an MCP tool with complete information

### Methods

### GetName

```go
func (m *McpTool) GetName() string
```

GetName returns the tool name

### GetServer

```go
func (m *McpTool) GetServer() string
```

GetServer returns the server name that provides this tool

## Type SessionInfo

```go
type SessionInfo struct {
	SessionId		string
	ResourceUrl		string
	AppId			string
	AuthCode		string
	ConnectionProperties	string
	ResourceId		string
	ResourceType		string
	Ticket			string
}
```

SessionInfo contains information about a session.

## Functions

### NewSession

```go
func NewSession(agentBay *AgentBay, sessionID string) *Session
```

NewSession creates a new Session object.

### NewCreateSessionParams

```go
func NewCreateSessionParams() *CreateSessionParams
```

NewCreateSessionParams creates a new CreateSessionParams with default values.

## Related Resources

- [FileSystem API Reference](filesystem.md)
- [Command API Reference](command.md)
- [Context API Reference](context.md)
- [Context Manager API Reference](context-manager.md)
- [OSS API Reference](../advanced/oss.md)

---

*Documentation generated automatically from Go source code.*




# Computer API Reference

## üñ•Ô∏è Related Tutorial

- [Computer Use Guide](../../../../docs/guides/computer-use/README.md) - Automate desktop applications

## Overview

The Computer module provides comprehensive desktop automation capabilities including mouse operations,
keyboard input, screen capture, and window management. It enables automated UI testing and RPA workflows.

## Requirements

- Requires `windows_latest` image for computer use features

## Data Types

### MouseButton

Mouse button constants: Left, Right, Middle

### ScrollDirection

Scroll direction constants: Up, Down, Left, Right

### KeyModifier

Keyboard modifier keys: Ctrl, Alt, Shift, Win

## Important Notes

- Key names in PressKeys and ReleaseKeys are case-sensitive
- Coordinate validation: x and y must be non-negative integers
- Drag operation requires valid start and end coordinates
- Screenshot operations may have size limitations

## Type BoolResult

```go
type BoolResult struct {
	models.ApiResponse
	Success		bool	`json:"success"`
	ErrorMessage	string	`json:"error_message"`
}
```

BoolResult represents a boolean operation result

## Type Computer

```go
type Computer struct {
	Session interface {
		GetAPIKey() string
		GetClient() *mcp.Client
		GetSessionId() string
		IsVpc() bool
		NetworkInterfaceIp() string
		HttpPort() string
		FindServerForTool(toolName string) string
		CallMcpTool(toolName string, args interface{}, autoGenSession ...bool) (*models.McpToolResult, error)
	}
}
```

Computer handles computer UI automation operations in the AgentBay cloud environment. Provides
comprehensive desktop automation capabilities including mouse, keyboard, window management,
application management, and screen operations.

### Methods

### ActivateWindow

```go
func (c *Computer) ActivateWindow(windowID int) (*WindowResult, error)
```

ActivateWindow activates the specified window

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("windows_latest"))
defer result.Session.Delete()
windowList, _ := result.Session.Computer.ListRootWindows()
activateResult, _ := result.Session.Computer.ActivateWindow(windowList.Windows[0].WindowID)
```

### ClickMouse

```go
func (c *Computer) ClickMouse(x, y int, button MouseButton) *BoolResult
```

ClickMouse clicks the mouse at the specified coordinates

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("windows_latest"))
defer result.Session.Delete()
clickResult := result.Session.Computer.ClickMouse(500, 300, computer.MouseButtonLeft)
```

### CloseWindow

```go
func (c *Computer) CloseWindow(windowID int) (*WindowResult, error)
```

CloseWindow closes the specified window

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("windows_latest"))
defer result.Session.Delete()
windowList, _ := result.Session.Computer.ListRootWindows()
closeResult, _ := result.Session.Computer.CloseWindow(windowList.Windows[0].WindowID)
```

### DragMouse

```go
func (c *Computer) DragMouse(fromX, fromY, toX, toY int, button MouseButton) *BoolResult
```

DragMouse drags the mouse from one point to another

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("windows_latest"))
defer result.Session.Delete()
dragResult := result.Session.Computer.DragMouse(100, 100, 300, 300, computer.MouseButtonLeft)
```

### FocusMode

```go
func (c *Computer) FocusMode(on bool) (*WindowResult, error)
```

FocusMode toggles focus mode on or off

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("windows_latest"))
defer result.Session.Delete()
focusResult, _ := result.Session.Computer.FocusMode(true)
```

### FullscreenWindow

```go
func (c *Computer) FullscreenWindow(windowID int) (*WindowResult, error)
```

FullscreenWindow makes the specified window fullscreen

### GetActiveWindow

```go
func (c *Computer) GetActiveWindow(timeoutMs ...int) (*WindowDetailResult, error)
```

GetActiveWindow gets the currently active window

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("windows_latest"))
defer result.Session.Delete()
windowResult, _ := result.Session.Computer.GetActiveWindow()
```

### GetCursorPosition

```go
func (c *Computer) GetCursorPosition() *CursorPosition
```

GetCursorPosition gets the current cursor position

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("windows_latest"))
defer result.Session.Delete()
position := result.Session.Computer.GetCursorPosition()
```

### GetScreenSize

```go
func (c *Computer) GetScreenSize() *ScreenSize
```

GetScreenSize gets the size of the primary screen

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("windows_latest"))
defer result.Session.Delete()
screenSize := result.Session.Computer.GetScreenSize()
```

### InputText

```go
func (c *Computer) InputText(text string) *BoolResult
```

InputText inputs text into the active field

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("windows_latest"))
defer result.Session.Delete()
inputResult := result.Session.Computer.InputText("Hello World")
```

### ListRootWindows

```go
func (c *Computer) ListRootWindows(timeoutMs ...int) (*WindowListResult, error)
```

ListRootWindows lists all root windows

### MaximizeWindow

```go
func (c *Computer) MaximizeWindow(windowID int) (*WindowResult, error)
```

MaximizeWindow maximizes the specified window

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("windows_latest"))
defer result.Session.Delete()
windowList, _ := result.Session.Computer.ListRootWindows()
maxResult, _ := result.Session.Computer.MaximizeWindow(windowList.Windows[0].WindowID)
```

### MinimizeWindow

```go
func (c *Computer) MinimizeWindow(windowID int) (*WindowResult, error)
```

MinimizeWindow minimizes the specified window

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("windows_latest"))
defer result.Session.Delete()
windowList, _ := result.Session.Computer.ListRootWindows()
minResult, _ := result.Session.Computer.MinimizeWindow(windowList.Windows[0].WindowID)
```

### MoveMouse

```go
func (c *Computer) MoveMouse(x, y int) *BoolResult
```

MoveMouse moves the mouse cursor to specific coordinates

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("windows_latest"))
defer result.Session.Delete()
moveResult := result.Session.Computer.MoveMouse(300, 200)
```

### PressKeys

```go
func (c *Computer) PressKeys(keys []string, hold bool) *BoolResult
```

PressKeys presses multiple keyboard keys simultaneously

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("windows_latest"))
defer result.Session.Delete()
pressResult := result.Session.Computer.PressKeys([]string{"Ctrl", "c"}, false)
```

### ReleaseKeys

```go
func (c *Computer) ReleaseKeys(keys []string) *BoolResult
```

ReleaseKeys releases multiple keyboard keys

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("windows_latest"))
defer result.Session.Delete()
result.Session.Computer.PressKeys([]string{"Shift"}, true)
releaseResult := result.Session.Computer.ReleaseKeys([]string{"Shift"})
```

### ResizeWindow

```go
func (c *Computer) ResizeWindow(windowID int, width int, height int) (*WindowResult, error)
```

ResizeWindow resizes the specified window

### RestoreWindow

```go
func (c *Computer) RestoreWindow(windowID int) (*WindowResult, error)
```

RestoreWindow restores the specified window

### Screenshot

```go
func (c *Computer) Screenshot() *ScreenshotResult
```

Screenshot takes a screenshot of the current screen

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("windows_latest"))
defer result.Session.Delete()
screenshot := result.Session.Computer.Screenshot()
```

### Scroll

```go
func (c *Computer) Scroll(x, y int, direction ScrollDirection, amount int) *BoolResult
```

Scroll scrolls the mouse wheel at specific coordinates

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("windows_latest"))
defer result.Session.Delete()
scrollResult := result.Session.Computer.Scroll(400, 300, computer.ScrollDirectionDown, 5)
```

### Related Functions

### NewComputer

```go
func NewComputer(session interface {
	GetAPIKey() string
	GetClient() *mcp.Client
	GetSessionId() string
	IsVpc() bool
	NetworkInterfaceIp() string
	HttpPort() string
	FindServerForTool(toolName string) string
	CallMcpTool(toolName string, args interface{}, autoGenSession ...bool) (*models.McpToolResult, error)
}) *Computer
```

NewComputer creates a new Computer instance

## Type CursorPosition

```go
type CursorPosition struct {
	models.ApiResponse
	X		int	`json:"x"`
	Y		int	`json:"y"`
	ErrorMessage	string	`json:"error_message"`
}
```

CursorPosition represents the cursor position on screen

## Type MouseButton

```go
type MouseButton string
```

MouseButton represents mouse button types

## Type ScreenSize

```go
type ScreenSize struct {
	models.ApiResponse
	Width			int	`json:"width"`
	Height			int	`json:"height"`
	DpiScalingFactor	float64	`json:"dpiScalingFactor"`
	ErrorMessage		string	`json:"error_message"`
}
```

ScreenSize represents the screen dimensions

## Type ScreenshotResult

```go
type ScreenshotResult struct {
	models.ApiResponse
	Data		string	`json:"data"`
	ErrorMessage	string	`json:"error_message"`
}
```

ScreenshotResult represents the result of a screenshot operation

## Type ScrollDirection

```go
type ScrollDirection string
```

ScrollDirection represents scroll directions

## Type Window

```go
type Window struct {
	WindowID		int		`json:"window_id"`
	Title			string		`json:"title"`
	AbsoluteUpperLeftX	int		`json:"absolute_upper_left_x,omitempty"`
	AbsoluteUpperLeftY	int		`json:"absolute_upper_left_y,omitempty"`
	Width			int		`json:"width,omitempty"`
	Height			int		`json:"height,omitempty"`
	PID			int		`json:"pid,omitempty"`
	PName			string		`json:"pname,omitempty"`
	ChildWindows		[]Window	`json:"child_windows,omitempty"`
}
```

Window represents a window in the system

## Type WindowDetailResult

```go
type WindowDetailResult struct {
	models.ApiResponse
	Window	*Window
}
```

WindowDetailResult represents the result of getting window details

## Type WindowInfo

```go
type WindowInfo struct {
	WindowID	int	`json:"window_id"`
	Title		string	`json:"title"`
	PID		int	`json:"pid"`
	PName		string	`json:"pname"`
}
```

WindowInfo represents window information

## Type WindowListResult

```go
type WindowListResult struct {
	models.ApiResponse
	Windows	[]*WindowInfo
}
```

WindowListResult represents the result of listing windows

## Type WindowResult

```go
type WindowResult struct {
	models.ApiResponse
	Success	bool
}
```

WindowResult represents the result of a window action

## Best Practices

1. Verify screen coordinates before mouse operations
2. Use appropriate delays between UI interactions
3. Handle window focus changes properly
4. Take screenshots for verification and debugging
5. Use keyboard shortcuts for efficient automation
6. Clean up windows and applications after automation

---

*Documentation generated automatically from Go source code.*




# Mobile API Reference

## üì± Related Tutorial

- [Mobile Use Guide](../../../../docs/guides/mobile-use/README.md) - Automate mobile applications

## Overview

The Mobile module provides mobile device automation capabilities including touch gestures,
text input, app management, and screenshot capture. It supports Android device automation.

## Requirements

- Requires `mobile_latest` image for mobile automation features

## Type AdbUrlResult

```go
type AdbUrlResult struct {
	models.ApiResponse
	URL		string	`json:"url"`
	Success		bool	`json:"success"`
	ErrorMessage	string	`json:"error_message"`
}
```

AdbUrlResult represents the result of ADB URL retrieval operation

## Type BoolResult

```go
type BoolResult struct {
	models.ApiResponse
	Success		bool	`json:"success"`
	ErrorMessage	string	`json:"error_message"`
}
```

BoolResult represents a boolean operation result

## Type InstalledApp

```go
type InstalledApp struct {
	Name		string	`json:"name"`
	StartCmd	string	`json:"start_cmd"`
	StopCmd		string	`json:"stop_cmd,omitempty"`
	WorkDirectory	string	`json:"work_directory,omitempty"`
}
```

InstalledApp represents an installed application

## Type InstalledAppListResult

```go
type InstalledAppListResult struct {
	models.ApiResponse
	Apps		[]InstalledApp	`json:"apps"`
	ErrorMessage	string		`json:"error_message"`
}
```

InstalledAppListResult wraps installed app list and RequestID

## Type Mobile

```go
type Mobile struct {
	Session	interface {
		GetAPIKey() string
		GetClient() *mcp.Client
		GetSessionId() string
		GetImageID() string
		IsVpc() bool
		NetworkInterfaceIp() string
		HttpPort() string
		FindServerForTool(toolName string) string
		CallMcpTool(toolName string, args interface{}, autoGenSession ...bool) (*models.McpToolResult, error)
	}
	command	*command.Command
}
```

Mobile handles mobile UI automation operations and configuration in the AgentBay cloud environment.
Provides touch operations, UI element interactions, application management, screenshot capabilities,
and mobile environment configuration.

### Methods

### Configure

```go
func (m *Mobile) Configure(mobileConfig *models.MobileExtraConfig) error
```

Configure configures mobile settings from MobileExtraConfig

### GetAdbUrl

```go
func (m *Mobile) GetAdbUrl(adbkeyPub string) *AdbUrlResult
```

GetAdbUrl retrieves the ADB connection URL for the mobile environment. This method is only supported
in mobile environments (mobile_latest image). It uses the provided ADB public key to establish the
connection and returns the ADB connect URL.

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("mobile_latest"))
defer result.Session.Delete()
adbPubKey, _ := os.ReadFile(os.Getenv("HOME") + "/.android/adbkey.pub")
adbResult := result.Session.Mobile.GetAdbUrl(string(adbPubKey))
```

### GetAllUIElements

```go
func (m *Mobile) GetAllUIElements(timeoutMs int) *UIElementsResult
```

GetAllUIElements retrieves all UI elements within the specified timeout

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("mobile_latest"))
defer result.Session.Delete()
elementsResult := result.Session.Mobile.GetAllUIElements(5000)
```

### GetClickableUIElements

```go
func (m *Mobile) GetClickableUIElements(timeoutMs int) *UIElementsResult
```

GetClickableUIElements retrieves all clickable UI elements within the specified timeout

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("mobile_latest"))
defer result.Session.Delete()
elementsResult := result.Session.Mobile.GetClickableUIElements(5000)
```

### GetInstalledApps

```go
func (m *Mobile) GetInstalledApps(startMenu, desktop, ignoreSystemApps bool) *InstalledAppListResult
```

GetInstalledApps retrieves a list of installed applications

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("mobile_latest"))
defer result.Session.Delete()
appsResult := result.Session.Mobile.GetInstalledApps(true, true, true)
```

### InputText

```go
func (m *Mobile) InputText(text string) *BoolResult
```

InputText inputs text into the active field

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("mobile_latest"))
defer result.Session.Delete()
inputResult := result.Session.Mobile.InputText("Hello Mobile")
```

### Screenshot

```go
func (m *Mobile) Screenshot() *ScreenshotResult
```

Screenshot takes a screenshot of the current screen

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("mobile_latest"))
defer result.Session.Delete()
screenshot := result.Session.Mobile.Screenshot()
```

### SendKey

```go
func (m *Mobile) SendKey(key int) *BoolResult
```

SendKey sends a key press event

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("mobile_latest"))
defer result.Session.Delete()
keyResult := result.Session.Mobile.SendKey(4)
```

### SetAppBlacklist

```go
func (m *Mobile) SetAppBlacklist(packageNames []string) error
```

SetAppBlacklist sets app blacklist for mobile devices

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("mobile_latest"))
defer result.Session.Delete()
blockedApps := []string{"com.example.blockedapp"}
err := result.Session.Mobile.SetAppBlacklist(blockedApps)
```

### SetAppWhitelist

```go
func (m *Mobile) SetAppWhitelist(packageNames []string) error
```

SetAppWhitelist sets app whitelist for mobile devices

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("mobile_latest"))
defer result.Session.Delete()
allowedApps := []string{"com.android.calculator2"}
err := result.Session.Mobile.SetAppWhitelist(allowedApps)
```

### SetNavigationBarVisibility

```go
func (m *Mobile) SetNavigationBarVisibility(hide bool) error
```

SetNavigationBarVisibility sets navigation bar visibility for mobile devices

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("mobile_latest"))
defer result.Session.Delete()
err := result.Session.Mobile.SetNavigationBarVisibility(true)
```

### SetResolutionLock

```go
func (m *Mobile) SetResolutionLock(enable bool) error
```

SetResolutionLock sets display resolution lock for mobile devices

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("mobile_latest"))
defer result.Session.Delete()
err := result.Session.Mobile.SetResolutionLock(true)
```

### SetUninstallBlacklist

```go
func (m *Mobile) SetUninstallBlacklist(packageNames []string) error
```

SetUninstallBlacklist sets uninstall protection blacklist for mobile devices

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("mobile_latest"))
defer result.Session.Delete()
protectedApps := []string{"com.android.calculator2"}
err := result.Session.Mobile.SetUninstallBlacklist(protectedApps)
```

### StartApp

```go
func (m *Mobile) StartApp(startCmd, workDirectory, activity string) *ProcessListResult
```

StartApp starts a specified application

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("mobile_latest"))
defer result.Session.Delete()
processResult := result.Session.Mobile.StartApp("com.android.calculator2", "", "com.android.calculator2.Calculator")
```

### StopAppByCmd

```go
func (m *Mobile) StopAppByCmd(stopCmd string) *BoolResult
```

StopAppByCmd stops an application using the provided stop command

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("mobile_latest"))
defer result.Session.Delete()
stopResult := result.Session.Mobile.StopAppByCmd("com.android.calculator2")
```

### Swipe

```go
func (m *Mobile) Swipe(startX, startY, endX, endY, durationMs int) *BoolResult
```

Swipe performs a swipe gesture on the screen

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("mobile_latest"))
defer result.Session.Delete()
swipeResult := result.Session.Mobile.Swipe(100, 500, 900, 500, 300)
```

### Tap

```go
func (m *Mobile) Tap(x, y int) *BoolResult
```

Tap taps on the screen at specific coordinates

**Example:**

```go
client, _ := agentbay.NewAgentBay(os.Getenv("AGENTBAY_API_KEY"), nil)
result, _ := client.Create(agentbay.NewCreateSessionParams().WithImageId("mobile_latest"))
defer result.Session.Delete()
tapResult := result.Session.Mobile.Tap(500, 500)
```

### Related Functions

### NewMobile

```go
func NewMobile(session interface {
	GetAPIKey() string
	GetClient() *mcp.Client
	GetSessionId() string
	GetImageID() string
	IsVpc() bool
	NetworkInterfaceIp() string
	HttpPort() string
	FindServerForTool(toolName string) string
	CallMcpTool(toolName string, args interface{}, autoGenSession ...bool) (*models.McpToolResult, error)
}) *Mobile
```

NewMobile creates a new Mobile instance for UI automation

## Type Process

```go
type Process struct {
	PName	string	`json:"pname"`
	PID	int	`json:"pid"`
	CmdLine	string	`json:"cmdline,omitempty"`
}
```

Process represents a running process

## Type ProcessListResult

```go
type ProcessListResult struct {
	models.ApiResponse
	Processes	[]Process	`json:"processes"`
	ErrorMessage	string		`json:"error_message"`
}
```

ProcessListResult wraps process list and RequestID

## Type ScreenshotResult

```go
type ScreenshotResult struct {
	models.ApiResponse
	Data		string	`json:"data"`
	ErrorMessage	string	`json:"error_message"`
}
```

ScreenshotResult represents the result of a screenshot operation

## Type SessionWithCommand

```go
type SessionWithCommand interface {
	GetAPIKey() string
	GetClient() *mcp.Client
	GetSessionId() string
	IsVpc() bool
	NetworkInterfaceIp() string
	HttpPort() string
	FindServerForTool(toolName string) string
	CallMcpTool(toolName string, args interface{}, autoGenSession ...bool) (*models.McpToolResult, error)
	GetCommand() *command.Command
}
```

SessionWithCommand extends the basic session interface to include Command access

## Type UIBounds

```go
type UIBounds struct {
	Bottom	int	`json:"bottom"`
	Left	int	`json:"left"`
	Right	int	`json:"right"`
	Top	int	`json:"top"`
}
```

UIBounds represents the bounds of a UI element

## Type UIElement

```go
type UIElement struct {
	Bounds		*UIBounds	`json:"bounds,omitempty"`
	ClassName	string		`json:"className,omitempty"`
	ContentDesc	string		`json:"contentDesc,omitempty"`
	ElementID	string		`json:"elementId,omitempty"`
	Package		string		`json:"package,omitempty"`
	ResourceID	string		`json:"resourceId,omitempty"`
	Text		string		`json:"text,omitempty"`
	Type		string		`json:"type,omitempty"`
	Children	[]*UIElement	`json:"children,omitempty"`
}
```

UIElement represents a UI element structure

## Type UIElementsResult

```go
type UIElementsResult struct {
	models.ApiResponse
	Elements	[]*UIElement	`json:"elements"`
	ErrorMessage	string		`json:"error_message"`
}
```

UIElementsResult represents the result containing UI elements

## Best Practices

1. Verify element coordinates before tap operations
2. Use appropriate swipe durations for smooth gestures
3. Wait for UI elements to load before interaction
4. Take screenshots for verification and debugging
5. Handle app installation and uninstallation properly
6. Configure app whitelists/blacklists for security

## Related Resources

- [Session API Reference](../common-features/basics/session.md)

---

*Documentation generated automatically from Go source code.*




# Golang SDK Examples

This directory contains Golang examples demonstrating various features and capabilities of the AgentBay SDK.

## üìÅ Directory Structure

The examples are organized by feature categories:

```
examples/
‚îú‚îÄ‚îÄ basic_usage/                   # Quick start example
‚îú‚îÄ‚îÄ common-features/               # Features available across all environments
‚îÇ   ‚îú‚îÄ‚îÄ basics/                    # Essential features
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ session_creation/      # Session lifecycle management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ session_params/        # Session parameter configuration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ command_example/       # Command execution
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ filesystem_example/    # File operations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ watch_directory_example/ # Directory monitoring
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ context_management/    # Context creation and management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ context_sync_example/  # Context synchronization
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ context_sync_demo/     # Context sync demonstration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ data_persistence/      # Data persistence across sessions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ recycle_policy/        # Recycle policy configuration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ list_sessions/         # Session listing and filtering
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ get/                   # Session retrieval
‚îÇ   ‚îî‚îÄ‚îÄ advanced/                  # Advanced features
‚îÇ       ‚îú‚îÄ‚îÄ agent_module/          # AI-powered automation
‚îÇ       ‚îú‚îÄ‚îÄ vpc_session/           # Secure isolated network environments
‚îÇ       ‚îî‚îÄ‚îÄ archive-upload-mode-example/ # Archive upload mode
‚îú‚îÄ‚îÄ browser-use/                   # Browser automation (browser_latest)
‚îÇ   ‚îî‚îÄ‚îÄ browser/                   # Browser automation examples
‚îú‚îÄ‚îÄ computer-use/                  # Windows desktop automation (windows_latest)
‚îÇ   ‚îú‚îÄ‚îÄ application_window/        # Application and window management
‚îÇ   ‚îî‚îÄ‚îÄ ui_example/                # UI automation
‚îú‚îÄ‚îÄ mobile-use/                    # Mobile UI automation (mobile_latest)
‚îÇ   ‚îî‚îÄ‚îÄ mobile_get_adb_url/        # ADB URL retrieval
‚îî‚îÄ‚îÄ codespace/                     # Code execution (code_latest)
    ‚îú‚îÄ‚îÄ code_example/              # Code execution example
    ‚îî‚îÄ‚îÄ automation/                # Automation workflows
```

## üöÄ Quick Start

### Single-File Example

The fastest way to get started:

```bash
# Set your API key
export AGENTBAY_API_KEY=your_api_key_here

# Run the quick start example
cd basic_usage
go run main.go
```

This example demonstrates:
- Initializing the AgentBay client
- Creating sessions
- Basic operations (commands, file operations)
- Session cleanup

## üìö Feature Categories

### [Common Features](common-features/)

Features available across all environment types (browser, computer, mobile, codespace).

**Basics:**
- **Session Management**: Create, configure, and manage cloud sessions
- **Command Execution**: Execute shell commands in cloud environments
- **File Operations**: Read, write, and manage files
- **Context Management**: Persistent data storage across sessions
- **Data Persistence**: Cross-session data sharing and synchronization

**Advanced:**
- **Agent Module**: AI-powered task automation with natural language
- **VPC Sessions**: Secure isolated network environments
- **Archive Upload**: Archive upload mode configuration

### [Browser Use](browser-use/)

Cloud-based browser automation with Playwright integration.

**Key Features:**
- Custom browser configuration
- Command line arguments
- Browser type selection
- Stealth mode and fingerprinting


### [Mobile Use](mobile-use/)

Android mobile UI automation for app testing.

**Key Features:**
- ADB URL retrieval
- Mobile device connection
- Remote debugging

### [CodeSpace](codespace/)

Cloud-based development environment for code execution.

**Key Features:**
- Code execution
- Automation workflows
- Shell command execution

## üìã Prerequisites

### Basic Requirements

- Go 1.19 or later
- Valid `AGENTBAY_API_KEY` environment variable

### Installation

```bash
# Clone the repository
git clone https://github.com/aliyun/wuying-agentbay-sdk.git
cd wuying-agentbay-sdk/golang

# Install dependencies
go mod download
```

## üéØ Running Examples

```bash
# Set your API key
export AGENTBAY_API_KEY=your_api_key_here

# Run any example
cd docs/examples/basic_usage
go run main.go

# Or run from any example directory
cd docs/examples/common-features/basics/session_creation
go run main.go
```

## üí° Common Patterns

### Basic Session Creation

```go
package main

import (
    "context"
    "fmt"
    "os"
    
    "github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay"
)

func main() {
    // Initialize client
    apiKey := os.Getenv("AGENTBAY_API_KEY")
    client := agentbay.NewClient(apiKey)
    
    // Create session
    ctx := context.Background()
    params := &agentbay.CreateSessionParams{
        ImageID: "linux_latest",
    }
    
    result, err := client.Create(ctx, params)
    if err != nil {
        panic(err)
    }
    
    session := result.Session
    fmt.Printf("Session created: %s\n", session.SessionID)
    
    // Use session...
    
    // Cleanup
    defer client.Delete(ctx, session.SessionID)
}
```

### File Operations

```go
// Write file
err := session.FileSystem.WriteFile(ctx, "/tmp/test.txt", []byte("content"))

// Read file
content, err := session.FileSystem.ReadFile(ctx, "/tmp/test.txt")
if err == nil {
    fmt.Println(string(content))
}
```

### Command Execution

```go
result, err := session.Command.Execute(ctx, "ls -la")
if err == nil {
    fmt.Println(result.Output)
}
```

## üéì Learning Path

### For Beginners

1. Start with [basic_usage](basic_usage/)
2. Explore [Common Features - Basics](common-features/basics/)
3. Try environment-specific examples based on your use case

### For Experienced Developers

1. Review [Common Features](common-features/) for SDK capabilities
2. Jump to your specific environment:
   - [Browser Use](browser-use/) for web automation
   - [Mobile Use](mobile-use/) for mobile automation
   - [CodeSpace](codespace/) for code execution
3. Explore [Advanced Features](common-features/advanced/) for integrations

## üìñ Best Practices

1. **Always Clean Up**: Delete sessions when done to free resources
2. **Error Handling**: Always check errors before using results
3. **Context Usage**: Use context for cancellation and timeouts
4. **Resource Limits**: Be aware of concurrent session limits
5. **Defer Cleanup**: Use `defer` for session cleanup

## üîç Example Index

### By Use Case

**Web Automation:**
- Browser configuration: `browser-use/browser/custom_browser_config.go`
- Browser command args: `browser-use/browser/browser_command_args.go`

**Desktop Automation:**
- Application management: `computer-use/application_window/main.go`
- UI automation: `computer-use/ui_example/main.go`

**Mobile Automation:**
- ADB integration: `mobile-use/mobile_get_adb_url/main.go`

**Code Execution:**
- Code execution: `codespace/code_example/main.go`
- Automation: `codespace/automation/main.go`

**Data Management:**
- File operations: `common-features/basics/filesystem_example/main.go`
- Context management: `common-features/basics/context_management/main.go`
- Data persistence: `common-features/basics/data_persistence/main.go`

**Advanced Features:**
- AI Agent: `common-features/advanced/agent_module/main.go`
- VPC sessions: `common-features/advanced/vpc_session/main.go`

## üÜò Troubleshooting

### Resource Creation Delay

If you see "The system is creating resources" message:
- Wait 90 seconds and retry
- This is normal for resource initialization

### API Key Issues

Ensure your API key is properly set:
```bash
export AGENTBAY_API_KEY=your_api_key_here
# Verify
echo $AGENTBAY_API_KEY
```

### Module Issues

If you get module errors:
```bash
# Ensure dependencies are installed
go mod download

# Update dependencies
go mod tidy
```

## üìö Related Documentation

- [Golang SDK Documentation](../../)
- [API Reference](../api/)
- [Quick Start Guide](../../../docs/quickstart/README.md)
- [Feature Guides](../../../docs/guides/README.md)

## ü§ù Getting Help

- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation](../../../docs/README.md)

---

üí° **Tip**: Start with `basic_usage/` for a quick overview, then explore category-specific examples based on your needs.





# Basic Usage Example

This example demonstrates the basic usage of the Wuying AgentBay SDK, including:

- Initializing the AgentBay client
- Creating a session
- Executing commands
- Reading files
- Listing sessions
- Deleting sessions

## Running the Example

```bash
cd basic_usage
go run main.go
```

Make sure you have set the `AGENTBAY_API_KEY` environment variable or replace the placeholder in the code with your actual API key.




# Golang Browser Examples

This directory contains Golang examples demonstrating how to use the AgentBay Browser API.

## Prerequisites

1. **Install Golang SDK**:
   ```bash
   go get github.com/aliyun/wuying-agentbay-sdk/golang
   ```

2. **Install Playwright for Go**:
   ```bash
   go get github.com/playwright-community/playwright-go
   ```

3. **Install Playwright browsers**:
   ```bash
   go run github.com/playwright-community/playwright-go/cmd/playwright@latest install chromium
   ```

4. **Set API Key**:
   ```bash
   export AGENTBAY_API_KEY=your_api_key_here
   ```

## Examples

### 1. visit_aliyun.go

A basic example showing how to:
- Create a session with a browser-enabled image
- Initialize the browser with default options
- Connect to the browser using Playwright over CDP
- Navigate to a website and interact with it
- Take a screenshot

**Run:**
```bash
go run visit_aliyun.go
```

**Expected Output:**
```
Creating session...
Session created: sess-xxxxx
Initializing browser...
Browser CDP endpoint: ws://...
Starting Playwright...
Connecting to browser over CDP...
Navigating to https://www.aliyun.com...
Page title: ÈòøÈáå‰∫ë-ËÆ°ÁÆóÔºå‰∏∫‰∫ÜÊó†Ê≥ïËÆ°ÁÆóÁöÑ‰ª∑ÂÄº
Taking screenshot...
Screenshot saved to aliyun_screenshot.png
Browser automation completed successfully!
Deleting session...
```

### 2. custom_browser_config.go

An advanced example demonstrating:
- Custom user agent configuration
- Custom viewport and screen dimensions
- Browser type selection (Chrome vs Chromium)
- Verification of browser configuration

**Run:**
```bash
go run custom_browser_config.go
```

**Expected Output:**
```
Creating session...
Session created: sess-xxxxx
Initializing browser with custom configuration...
Connecting to browser over CDP...
Navigating to user agent detection site...

Verifying browser configuration:
Effective UA: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36...
Viewport: 1366 x 768
Screen: 1366 x 768

Browser configuration verified successfully!
Deleting session...
```

### 3. browser_screenshot

An example demonstrating screenshot capabilities:
- Creating a browser session with AgentBay
- Using Playwright to connect to the browser instance
- Taking screenshots using direct Playwright integration
- Saving screenshots to local files
- Customizing screenshot options (full page, image format, quality)

**Run:**
```bash
go run browser_screenshot
```

**Expected Output:**
```
Initializing AgentBay client...
Creating a new session...
Session created with ID: sess-xxxxx
Browser initialized successfully
Endpoint URL: ws://...
üì∏ Taking screenshot...
‚ÑπÔ∏è  Note: Screenshot functionality requires Playwright Go integration
‚úÖ Browser screenshot demo completed

üßπ Cleaning up session sess-xxxxx...
‚úÖ Session deleted successfully
```

## Key Browser APIs

### Browser Initialization

```go
// Create browser option with defaults
option := browser.NewBrowserOption()

// Initialize browser
success, err := session.Browser.Initialize(option)
if err != nil || !success {
    log.Fatalf("Browser initialization failed: %v", err)
}
```

### Custom Configuration

```go
option := browser.NewBrowserOption()

// Set custom user agent
customUA := "Mozilla/5.0 ..."
option.UserAgent = &customUA

// Set viewport
option.Viewport = &browser.BrowserViewport{
    Width:  1366,
    Height: 768,
}

// Set screen dimensions
option.Screen = &browser.BrowserScreen{
    Width:  1366,
    Height: 768,
}

// Choose browser type (for computer use images only)
chromeType := "chrome"
option.BrowserType = &chromeType  // "chrome" or "chromium"
```

### Getting CDP Endpoint

```go
endpointURL, err := session.Browser.GetEndpointURL()
if err != nil {
    log.Fatalf("Failed to get endpoint URL: %v", err)
}
```

### Connecting Playwright

```go
pw, err := playwright.Run()
if err != nil {
    log.Fatalf("Failed to start Playwright: %v", err)
}
defer pw.Stop()

browserInstance, err := pw.Chromium.ConnectOverCDP(endpointURL)
if err != nil {
    log.Fatalf("Failed to connect over CDP: %v", err)
}
defer browserInstance.Close()

context := browserInstance.Contexts()[0]
page, err := context.NewPage()
```

## Common Patterns

### Error Handling

Always check both error and success return values:

```go
success, err := session.Browser.Initialize(option)
if err != nil {
    log.Fatalf("Error: %v", err)
}
if !success {
    log.Fatal("Operation failed without error")
}
```

### Resource Cleanup

Use `defer` for proper resource cleanup:

```go
session := result.Session
defer session.Delete()  // Always clean up session

pw, err := playwright.Run()
defer pw.Stop()  // Always stop Playwright

browserInstance, err := pw.Chromium.ConnectOverCDP(endpointURL)
defer browserInstance.Close()  // Always close browser
```

### Pointer Values

Many BrowserOption fields use pointers to allow optional values:

```go
// String pointer
ua := "custom user agent"
option.UserAgent = &ua

// Struct pointer
option.Viewport = &browser.BrowserViewport{
    Width: 1920,
    Height: 1080,
}

// BrowserType uses pointer for optional selection
chromeType := "chrome"
option.BrowserType = &chromeType
```

## Troubleshooting

### "AGENTBAY_API_KEY environment variable not set"

Set your API key:
```bash
export AGENTBAY_API_KEY=your_api_key_here
```

### "Failed to connect over CDP"

Ensure the browser is initialized before connecting:
```go
success, err := session.Browser.Initialize(option)
if err != nil || !success {
    log.Fatal("Browser must be initialized first")
}
```

### "No browser contexts available"

The browser may not have started properly. Check initialization logs and ensure the browser image is available.

## Additional Resources

- [Browser Use Guide](../../../../../docs/guides/browser-use/README.md)
- [Core Features](../../../../../docs/guides/browser-use/core-features.md)
- [Advanced Features](../../../../../docs/guides/browser-use/advance-features.md)
- [Playwright Go Documentation](https://playwright.dev/docs/intro)



# Code Execution Example

This example demonstrates how to use the new **Code** module in the AgentBay SDK after the refactoring.

## What's New

In this refactored version:

- `RunCode` method has been moved from the `Command` module to a dedicated `Code` module
- Access code execution functionality via `session.Code.RunCode()` instead of `session.Command.RunCode()`
- The `Command` module now focuses only on shell command execution

## Features Demonstrated

1. **Python Code Execution**: Execute Python code in the cloud environment
2. **JavaScript Code Execution**: Execute JavaScript/Node.js code 
3. **Shell Command Execution**: Traditional command execution still works via `Command` module

## Usage

```go
// Create a session
session := /* ... create session ... */

// Execute Python code using the new Code module
codeResult, err := session.Code.RunCode(pythonCode, "python", 30)
if err != nil {
    log.Printf("Failed to run code: %v", err)
} else {
    fmt.Printf("Output: %s\n", codeResult.Output)
}

// Execute shell commands using the Command module
cmdResult, err := session.Command.ExecuteCommand("echo 'Hello!'", 5000)
```

## Running the Example

```bash
cd docs/examples/golang/code_example
go run main.go
```

Make sure you have set the `AGENTBAY_API_KEY` environment variable before running the example. 



# Agent Module Example

This example demonstrates how to use the Agent module to execute AI-powered tasks using natural language descriptions.

## Overview

The Agent module allows you to execute complex tasks using human-readable instructions, monitor task status, and terminate running tasks. This capability extends the functionality of cloud sessions by adding AI-powered automation.

## Running the Example

1. Ensure you have the AgentBay SDK installed
2. Set the `AGENTBAY_API_KEY` environment variable with your valid API key
3. Run the example:

```bash
cd docs/examples/golang/agent_module
go run main.go
```

## What the Example Does

1. Initializes the AgentBay client with your API key
2. Creates a new session
3. Executes a simple task using the Agent module ("Calculate the square root of 144")
4. Displays the task results
5. Cleans up by deleting the session

## Key Concepts

- **Session Creation**: All Agent operations happen within a session context
- **Task Execution**: Tasks are executed using natural language descriptions
- **Result Handling**: Task results include success status, output, and error information
- **Resource Management**: Sessions should be properly deleted when no longer needed

## Next Steps

Try modifying the task description to perform different operations, such as:
- "Find the current weather in New York City"
- "Calculate the factorial of 10"
- "List the prime numbers between 1 and 100"



# VPC Session Example

This example demonstrates how to create and use VPC (Virtual Private Cloud) sessions with the AgentBay SDK.

## Overview

VPC sessions provide enhanced security and networking capabilities by running your cloud sessions within a private network environment. This example shows how to create a VPC session and use its available modules.

## Running the Example

1. Ensure you have the AgentBay SDK installed
2. Set the `AGENTBAY_API_KEY` environment variable with your valid API key
3. Run the example:

```bash
cd docs/examples/golang/vpc_session
go run main.go
```

## What the Example Does

1. Initializes the AgentBay client with your API key
2. Creates a new VPC session with specific parameters
3. Tests FileSystem operations by writing and reading a file
4. Tests Command operations by executing system commands
5. Cleans up by deleting the session

## Key Concepts

- **VPC Session Creation**: VPC sessions are created by setting the `IsVpc` parameter to `true`
- **Module Availability**: VPC sessions have limited module availability compared to standard sessions
- **Resource Management**: VPC sessions should be properly deleted when no longer needed
- **Security**: VPC sessions provide network isolation for sensitive operations

## Available Modules in VPC Sessions

1. **FileSystem**: File and directory operations
2. **Command**: Command execution
3. **System Tools**: Specialized system-level tools
4. **Browser Tools**: Browser automation capabilities

## Next Steps

Try modifying the example to:
- Use context synchronization with VPC sessions
- Test different command executions
- Implement error handling for unavailable modules



## Archive Upload Mode Context Sync Example

This directory contains examples demonstrating the Archive upload mode functionality for context synchronization in the AgentBay Go SDK.

## Overview

The Archive upload mode is designed for efficient file transfer by compressing files before uploading them to the context storage. This is particularly useful when:

- Working with large files
- Dealing with many files
- Optimizing bandwidth usage
- Reducing upload time for compressible content

## Files

### `main.go`

A comprehensive example that demonstrates:

1. **Context Creation**: Creating a context for Archive upload mode
2. **Sync Policy Configuration**: Setting up sync policy with Archive uploadMode
3. **Session Management**: Creating and managing sessions with context sync
4. **File Operations**: Writing files to the context path
5. **Context Sync**: Synchronizing context before retrieving information
6. **Context Info**: Retrieving context status information
7. **File Listing**: Listing files in context sync directory
8. **Cleanup**: Proper session cleanup and error handling

## Key Features Demonstrated

### Archive Upload Mode Configuration

```go
// Configure sync policy with Archive upload mode
uploadPolicy := &agentbay.UploadPolicy{
    UploadMode: agentbay.UploadModeArchive, // Set to Archive mode
}
syncPolicy := &agentbay.SyncPolicy{
    UploadPolicy: uploadPolicy,
}

// Create context sync with Archive mode
contextSync := &agentbay.ContextSync{
    ContextID: contextResult.ContextID,
    Path:      "/tmp/archive-mode-test",
    Policy:    syncPolicy,
}
```

### Session Creation with Context Sync

```go
sessionParams := agentbay.NewCreateSessionParams().
    WithLabels(map[string]string{
        "example":    fmt.Sprintf("archive-mode-%s", uniqueID),
        "type":       "archive-upload-demo",
        "uploadMode": string(agentbay.UploadModeArchive),
    }).
    WithContextSync([]*agentbay.ContextSync{contextSync})

sessionResult, err := ab.Create(sessionParams)
```

### File Operations

```go
// Write file to context path
writeResult, err := session.FileSystem.WriteFile(filePath, fileContent, "overwrite")
```

### Context Sync and Information Retrieval

```go
// Call context sync before getting info
syncResult, err := session.Context.Sync()

// Get context status information after sync
infoResult, err := session.Context.Info()

// Display context status details
for index, status := range infoResult.ContextStatusData {
    fmt.Printf("Context ID: %s\n", status.ContextId)
    fmt.Printf("Path: %s\n", status.Path)
    fmt.Printf("Status: %s\n", status.Status)
    fmt.Printf("Task Type: %s\n", status.TaskType)
}
```

### File Listing in Context Directory

```go
// List files in context sync directory
listResult, err := ab.Context.ListFiles(contextID, syncDirPath, 1, 10)

// Display file entries
for index, entry := range listResult.Entries {
    fmt.Printf("FilePath: %s\n", entry.FilePath)
    fmt.Printf("FileType: %s\n", entry.FileType)
    fmt.Printf("FileName: %s\n", entry.FileName)
    fmt.Printf("Size: %d bytes\n", entry.Size)
}
```

## Running the Example

### Prerequisites

1. **Environment Setup**: Set your AgentBay API key
   ```bash
   export AGENTBAY_API_KEY="your-api-key-here"
   ```

2. **Dependencies**: Ensure you have the Go modules downloaded
   ```bash
   go mod tidy
   ```

### Execution

```bash
# Navigate to the example directory
cd golang/docs/examples/archive-upload-mode-example

# Run the example
go run main.go
```

### Expected Output

The example will output detailed logs showing:

```
üöÄ AgentBay Archive Upload Mode Context Sync Example
============================================================

üì¶ === Archive Upload Mode Context Sync Example ===

üì¶ Step 1: Creating context for Archive upload mode...
‚úÖ Context created successfully!
   Context ID: ctx_xxxxx
   Request ID: req_xxxxx

‚öôÔ∏è  Step 2: Configuring sync policy with Archive upload mode...
‚úÖ Sync policy configured with uploadMode: Archive

üîß Step 3: Creating context sync configuration...
‚úÖ Context sync created:
   Context ID: ctx_xxxxx
   Path: /tmp/archive-mode-test
   Upload Mode: Archive

üèóÔ∏è  Step 4: Creating session with Archive mode context sync...
‚úÖ Session created successfully!
   Session ID: sess_xxxxx
   Request ID: req_xxxxx
   App Instance ID: app_xxxxx

üìù Step 5: Creating test files in Archive mode context...
üìÑ Creating file: /tmp/archive-mode-test/test-file-5kb.txt
üìä File content size: 5120 bytes
‚úÖ File write successful!
   Request ID: req_xxxxx

üîÑ Step 6: Testing context sync functionality...
‚úÖ Context sync successful!
   Request ID: req_xxxxx

üìä Step 6.5: Testing context info functionality after sync...
‚úÖ Context info retrieved successfully!
   Request ID: req_xxxxx
   Context status data count: X

üìã Context status details:
   [0] Context ID: ctx_xxxxx
       Path: /tmp/archive-mode-test
       Status: Success
       Task Type: upload

üîç Step 7: Listing files in context sync directory...
‚úÖ List files successful!
   Request ID: req_xxxxx
   Total files found: X

üìã Files in context sync directory:
   [0] FilePath: /tmp/archive-mode-test/test-file-5kb.txt
       FileType: file
       FileName: test-file-5kb.txt
       Size: 5120 bytes

üéâ Archive upload mode example completed successfully!
‚úÖ All operations completed without errors.

üßπ Step 8: Cleaning up session...
‚úÖ Session deleted successfully!
   Success: true
   Request ID: req_xxxxx
```

## Related Documentation

- [Context Sync Documentation](../../../../../../docs/guides/common-features/basics/data-persistence.md)
- [Session Management Guide](../../../../../../docs/guides/common-features/basics/session-management.md)
- [File Operations Guide](../../../../../../docs/guides/common-features/basics/file-operations.md)

## Troubleshooting

### Common Issues

1. **API Key Not Set**
   ```
   Warning: AGENTBAY_API_KEY environment variable not set
   ```
   **Solution**: Set the environment variable or update the API key in the code

2. **Context Creation Failed**
   ```
   context creation failed: [error message]
   ```
   **Solution**: Check your API key and network connectivity

3. **Session Creation Failed**
   ```
   session creation failed: [error message]
   ```
   **Solution**: Verify context sync configuration and try again

4. **File Operation Failed**
   ```
   file write failed: [error message]
   ```
   **Solution**: Check file path permissions and available disk space

## Support

For additional help:
- [GitHub Issues](https://github.com/aliyun/wuying-agentbay-sdk/issues)
- [Documentation Home](../../../README.md)



# Command Execution Example

This example demonstrates how to use the command execution features of the AgentBay SDK for Golang.

## Features Demonstrated

- Executing shell commands
- Setting custom timeouts for commands
- Running Python code
- Running JavaScript code
- Executing multi-line command sequences

## Running the Example

1. Make sure you have installed the AgentBay SDK:

```bash
go get github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay
```

2. Set your API key as an environment variable (recommended):

```bash
export AGENTBAY_API_KEY=your_api_key_here
```

3. Run the example:

```bash
go run main.go
```

## Code Explanation

The example demonstrates different ways to execute commands:

1. Basic shell command execution
2. Command execution with custom timeout
3. Running Python code
4. Running JavaScript code with custom timeout
5. Executing a multi-line shell command sequence

The code also demonstrates proper session cleanup using defer.

For more details on command execution, see the [Command API Reference](../../../../../../typescript/docs/api/common-features/basics/command.md) and [Command Execution Tutorial](../../../../../../docs/guides/common-features/basics/command-execution.md). 



# Context Management Example

This example demonstrates how to use the Context Management features of the AgentBay SDK for Golang.

## Features Demonstrated

- Listing all contexts
- Getting or creating a context
- Creating a session with a context
- Updating a context
- Clearing context data (asynchronous and synchronous)
- Deleting a context

## Running the Example

1. Make sure you have installed the AgentBay SDK:

```bash
go get github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay
```

2. Set your API key as an environment variable (recommended):

```bash
export AGENTBAY_API_KEY=your_api_key_here
```

3. Run the example:

```bash
go run main.go
```

## Code Explanation

The example demonstrates a full lifecycle of context management:

1. Initialize the AgentBay client with an API key
2. List all existing contexts to see what's available
3. Get an existing context by name, or create it if it doesn't exist
4. Create a session using the context
5. Update the context's properties
6. Clear the context's persistent data (demonstrates both async and sync methods)
7. Clean up by deleting the session and context

For more details on context management, see the [Context API Reference](../../../../../../typescript/docs/api/common-features/basics/context.md) and [Data Persistence Tutorial](../../../../../../docs/guides/common-features/basics/data-persistence.md).



# Context Sync Dual-Mode Example (Go)

This example demonstrates the dual-mode `context.sync()` functionality in the Go SDK, showing both asynchronous callback-based and synchronous wait-based usage patterns.

## Features Demonstrated

- **Context Creation**: Creates persistent contexts for data storage
- **Test Data Generation**: Creates sample files and directories for sync testing
- **Dual-Mode Context Sync**: Shows both callback and wait patterns
- **Session Management**: Proper session creation and cleanup
- **Error Handling**: Comprehensive error handling and cleanup
- **Timing Measurement**: Tracks sync operation duration
- **Concurrent Execution**: Demonstrates running multiple sync operations

## Usage Patterns

### 1. Async Mode with Callback

```go
// Use callback mode - function returns immediately
syncResult, err := session.Context.SyncWithCallback(
    "", "", "", // contextId, path, mode
    func(success bool) {
        if success {
            fmt.Println("‚úÖ Context sync completed successfully")
        } else {
            fmt.Println("‚ùå Context sync completed with failures")
        }
        // Handle completion in callback
    },
    150, 1500, // maxRetries, retryInterval (milliseconds)
)
```

### 2. Sync Mode with Wait

```go
// Use wait mode - function waits for completion
syncResult, err := session.Context.SyncWithCallback("", "", "", nil, 150, 1500)
if err != nil {
    return fmt.Errorf("context sync failed: %w", err)
}

if syncResult.Success {
    fmt.Println("‚úÖ Context sync completed successfully")
} else {
    fmt.Println("‚ùå Context sync completed with failures")
}
```

## Configuration

The example uses default configuration values:

- **Max Retries**: 150 attempts
- **Retry Interval**: 1500 milliseconds (1.5 seconds)
- **Context Path**: `/tmp/sync_data`
- **Test Files**: Small, medium, and JSON configuration files

## Running the Example

```bash
# From the golang directory
go run docs/examples/data_persistence/context_sync_demo.go

# Or build and run
go build -o context_sync_demo docs/examples/data_persistence/context_sync_demo.go
./context_sync_demo
```

## Expected Output

```
üîÑ AgentBay Context Sync Dual-Mode Example (Go)

============================================================
üîÑ Method 1: context_sync_with_callback (Async with callback)
============================================================
üîÑ Starting context sync with callback demo...

üì¶ Creating context for persistent storage...
‚úÖ Context created: sync-callback-demo

üì¶ Creating session with context sync...
‚úÖ Session created: session-123

üíæ Creating test data...
‚úÖ Created file: /tmp/sync_data/test_files/small.txt
‚úÖ Created file: /tmp/sync_data/test_files/medium.txt
‚úÖ Created file: /tmp/sync_data/config.json
üìä Created 3/3 test files

üìû Calling context.sync() with callback...
üì§ Sync initiation result: success=true, requestId=req-456
‚è≥ Waiting for callback to complete...
‚úÖ Context sync completed successfully in 2.1s
üóëÔ∏è  Deleting session from callback...
‚úÖ Session deleted successfully from callback

‚è≥ Sleeping 3 seconds before next demo...

============================================================
üîÑ Method 2: context_sync (Sync with wait)
============================================================
üîÑ Starting context sync demo...

üì¶ Creating context for persistent storage...
‚úÖ Context created: sync-await-demo

üì¶ Creating session with context sync...
‚úÖ Session created: session-789

üíæ Creating test data...
‚úÖ Created file: /tmp/sync_data/test_files/small.txt
‚úÖ Created file: /tmp/sync_data/test_files/medium.txt
‚úÖ Created file: /tmp/sync_data/config.json
üìä Created 3/3 test files

‚è≥ Calling context.sync() with wait...
‚úÖ Context sync completed successfully in 1.5s
üì§ Sync result: success=true, requestId=req-101
üóëÔ∏è  Deleting session...
‚úÖ Session deleted successfully

‚è≥ Waiting for callback demo to complete...

‚úÖ Context sync dual-mode example completed
```

## Key Differences from Python/TypeScript

1. **Goroutines**: Uses `go` keyword for async execution instead of `asyncio` or `Promise`
2. **Callbacks**: Uses Go function types instead of lambda functions
3. **Error Handling**: Uses Go's explicit error handling with `error` return values
4. **Time Measurement**: Uses `time.Since()` for duration calculation
5. **Concurrency**: Uses goroutines and channels for concurrent execution

## API Reference

### ContextManager.SyncWithCallback

```go
func (cm *ContextManager) SyncWithCallback(
    contextId, path, mode string,
    callback SyncCallback,
    maxRetries, retryInterval int
) (*ContextSyncResult, error)
```

**Parameters:**

- `contextId`: Optional context ID to sync
- `path`: Optional path to sync
- `mode`: Optional sync mode (upload/download)
- `callback`: Callback function for async mode (nil for sync mode)
- `maxRetries`: Maximum number of polling attempts (default: 150)
- `retryInterval`: Interval between polls in milliseconds (default: 1500)

**Returns:**

- `*ContextSyncResult`: Contains success status and request ID
- `error`: Any error that occurred during sync initiation

### SyncCallback Type

```go
type SyncCallback func(success bool)
```

**Parameters:**

- `success`: `true` if sync completed successfully, `false` if failed or timed out

## Error Handling

The example includes comprehensive error handling for:

- Context creation failures
- Session creation failures
- File system operations
- Sync operation failures
- Session deletion failures

All errors are logged with appropriate context and the application continues execution where possible.

## Performance Considerations

- **Async Mode**: Returns immediately, allowing for concurrent operations
- **Sync Mode**: Blocks until completion, suitable for sequential workflows
- **Polling**: Configurable retry intervals and maximum attempts
- **Memory**: Efficient goroutine usage for background operations
- **Timeouts**: Built-in timeout protection to prevent infinite polling




# Context Synchronization Example

This example demonstrates how to use the Context Synchronization features of the AgentBay SDK for Golang.

## Features Demonstrated

- Creating and retrieving contexts
- Creating basic context sync configurations
- Creating advanced context sync configurations with policies
- Working with upload, download, and delete policies
- Using whitelist and blacklist configurations
- Creating sessions with multiple context synchronizations
- Managing context synchronization from a session
- Using the builder pattern for sync configurations

## Running the Example

1. Make sure you have installed the AgentBay SDK:

```bash
go get github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay
```

2. Set your API key as an environment variable (recommended):

```bash
export AGENTBAY_API_KEY=your_api_key_here
```

3. Run the example:

```bash
go run main.go
```

## Code Explanation

The example demonstrates a full lifecycle of context synchronization:

1. Create a new persistent context
2. Create basic and advanced context sync configurations
3. Configure upload, download, and delete policies
4. Set up whitelist and blacklist rules
5. Add multiple context sync configurations to a session
6. Create a session with context synchronizations
7. Interact with the context manager from a session
8. Use the builder pattern for creating context sync configurations
9. Clean up resources (session and context)

For more details on context synchronization, see the [Context API Reference](../../../../../../typescript/docs/api/common-features/basics/context.md) and [Data Persistence Tutorial](../../../../../../docs/guides/common-features/basics/data-persistence.md). 



# AgentBay SDK - Data Persistence Examples

This directory contains examples demonstrating data persistence functionality using the AgentBay SDK for Golang:

## Examples

### 1. `main.go` - Basic Data Persistence

Demonstrates fundamental data persistence features:

- Context creation for persistent storage
- File persistence across multiple sessions
- Context synchronization and file sharing
- Cross-session data verification

### 2. `recycle_policy_example.go` - Data Lifecycle Management

Demonstrates RecyclePolicy for controlling context data lifecycle:

- Using default RecyclePolicy (keeps data forever)
- Setting custom lifecycle durations (1 day, 3 days, etc.)
- Applying RecyclePolicy to specific paths
- Available lifecycle options

## Features Demonstrated

1. **Context Management**: Creating and managing contexts for persistent storage
2. **Multi-Session Persistence**: Writing data in one session and reading it in another
3. **File Operations**: Creating directories, writing JSON configs, logs, and data files
4. **Context Synchronization**: Automatic sync of data between sessions and cloud storage
5. **Error Handling**: Comprehensive error handling throughout the process
6. **Resource Cleanup**: Proper cleanup of sessions and contexts

## What This Example Does

1. **Step 1**: Creates a persistent context for data storage
2. **Step 2**: Creates the first session with context synchronization configured
3. **Step 3**: Writes various types of data (JSON config, logs, text files) in the first session
4. **Step 4**: Deletes the first session (with context sync to preserve data)
5. **Step 5**: Creates a second session with the same context sync configuration
6. **Step 6**: Verifies that all data from the first session is accessible in the second session
7. **Step 7**: Adds new data in the second session
8. **Step 8**: Cleans up all resources

## Expected Output

The example will show:
- Successful context creation
- File creation and writing in the first session
- Session deletion with context synchronization
- New session creation and data verification
- Confirmation that persistent data survives across sessions

## Prerequisites

- Valid AgentBay API key set in environment variable `AGENTBAY_API_KEY`
- Network connectivity to AgentBay services
- Golang environment set up with required dependencies

## Running the Example

```bash
# Set your API key
export AGENTBAY_API_KEY="your-api-key-here"

# Run the example
go run main.go
```

## Key Concepts

- **Context**: A persistent storage space that survives across sessions
- **Context Sync**: Configuration that determines how data is synchronized between sessions and cloud storage
- **Session**: A temporary compute environment that can mount contexts for data access
- **Sync Policy**: Rules governing when and how data is uploaded/downloaded during synchronization

This example is based on the Python data persistence example and demonstrates the same functionality using idiomatic Go patterns and the Golang AgentBay SDK.



# FileSystem Example

This example demonstrates how to use the AgentBay SDK's FileSystem module to perform various file operations in the cloud environment.

## Features Demonstrated

- Creating directories
- Writing files
- Reading files
- Getting file information
- Listing directory contents
- Editing files
- Searching for files
- Moving/renaming files

## Prerequisites

- Go 1.16 or later
- AgentBay API key (set as `AGENTBAY_API_KEY` environment variable)

## Running the Example

1. Set your API key:
   ```bash
   export AGENTBAY_API_KEY="your-api-key-here"
   ```

2. Run the example:
   ```bash
   go run main.go
   ```

## Expected Output

The example will create a session, perform various file system operations, and clean up afterwards. 
You should see output showing the results of each operation, including:

- Directory creation
- File creation and verification
- File content reading and display
- File information retrieval
- Directory listing
- File editing and content verification
- File search results
- File move/rename operation

## Notes

- All resources are cleaned up when the example completes
- The session is automatically deleted at the end of the example 



# Get API Example

This example demonstrates how to use the `Get` API to retrieve a session by its ID.

## Description

The `Get` API allows you to retrieve a session object by providing its session ID. This is useful when you have a session ID from a previous operation and want to access or manage that session.

## Prerequisites

- Go 1.21 or higher
- Valid API key set in `AGENTBAY_API_KEY` environment variable

## Usage

```bash
# Set your API key
export AGENTBAY_API_KEY="your-api-key-here"

# Run the example
go run main.go
```

## Code Example

```go
package main

import (
    "fmt"
    "log"
    "os"

    "github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay"
)

func main() {
    // Initialize AgentBay client
    apiKey := os.Getenv("AGENTBAY_API_KEY")
    client, err := agentbay.NewAgentBay(apiKey, nil)
    if err != nil {
        log.Fatalf("Failed to initialize AgentBay client: %v", err)
    }

    // Retrieve a session by ID
    sessionID := "your-session-id"
    result, err := client.Get(sessionID)
    if err != nil {
        log.Fatalf("Failed to get session: %v", err)
    }

    if !result.Success || result.Session == nil {
        log.Fatalf("Failed to get session: %s", result.ErrorMessage)
    }

    fmt.Printf("Retrieved session: %s\n", result.Session.SessionID)
    fmt.Printf("Request ID: %s\n", result.RequestID)

    // Use the session for further operations
    // ...
}
```

## API Reference

### Get

```go
func (a *AgentBay) Get(sessionID string) (*SessionResult, error)
```

Retrieves a session by its ID.

**Parameters:**
- `sessionID` (string): The ID of the session to retrieve

**Returns:**
- `*SessionResult`: Result object containing:
  - `Success` (bool): Whether the operation succeeded
  - `Session` (*Session): The Session instance if successful
  - `RequestID` (string): The API request ID
  - `ErrorMessage` (string): Error message if failed
- `error`: An error if a critical operation fails

## Expected Output

```
Creating a session...
Created session with ID: session-xxxxxxxxxxxxx

Retrieving session using Get API...
Successfully retrieved session:
  Session ID: session-xxxxxxxxxxxxx
  Request ID: DAD825FE-2CD8-19C8-BB30-CC3BA26B9398

Session is ready for use

Cleaning up...
Session session-xxxxxxxxxxxxx deleted successfully
```

## Notes

- The session ID must be valid and from an existing session
- The Get API internally calls the GetSession API endpoint
- The returned session object can be used for all session operations (commands, files, etc.)
- Always clean up sessions when done to avoid resource waste





# List Sessions Example (Golang)

This example demonstrates how to use the `List()` API to query and filter sessions in AgentBay.

## Prerequisites

1. **Set API Key**:
   ```bash
   export AGENTBAY_API_KEY='your-api-key-here'
   ```

2. **Install SDK** (if not already done):
   ```bash
   go get github.com/aliyun/wuying-agentbay-sdk/golang
   ```

## Running the Example

```bash
cd /path/to/wuying-agentbay-sdk/golang/docs/examples/list_sessions
go run main.go
```

## Key Features

- List all sessions
- Filter by single or multiple labels
- Pagination support
- Iterate through all pages

## API Usage

```go
import "github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay"

client, _ := agentbay.NewAgentBay(apiKey, nil)

// List all sessions
result, err := client.List(nil, nil, nil)

// Filter by labels
result, err = client.List(map[string]string{"project": "my-project"}, nil, nil)

// With pagination
page := 1
limit := int32(10)
result, err = client.List(
    map[string]string{"project": "my-project"},
    &page,
    &limit,
)
```

## Related Documentation

- [Session Management Guide](../../../../../../docs/guides/common-features/basics/session-management.md)
- [AgentBay API Reference](../../../../../../typescript/docs/api/common-features/basics/agentbay.md)





# MCP Tool Direct Call Example (Golang)

This example demonstrates how to list available MCP tools and call them using the AgentBay Golang SDK.

## Prerequisites

- Go 1.19 or higher
- AgentBay API Key (set as environment variable `AGENTBAY_API_KEY`)

## Running the Example

```bash
# Set your API key
export AGENTBAY_API_KEY=your_api_key_here

# Run the example
cd golang/docs/examples/mcp_tool_list_and_call
go run main.go
```

## What This Example Does

1. **Creates a Session**: Initializes an AgentBay session
2. **Lists MCP Tools**: Retrieves all available MCP tools
3. **Finds Shell Tool**: Locates the 'shell' tool and displays its details
4. **Calls Shell Tool**: Executes a simple echo command
5. **Demonstrates Flexibility**: Runs another command (pwd)
6. **Error Handling**: Shows how errors are handled
7. **Cleanup**: Properly deletes the session

## Expected Output

```
Initializing AgentBay client...

1. Creating session...
‚úì Session created successfully
  Session ID: sess-xxxxx
  Request ID: req-xxxxx

2. Listing available MCP tools...
‚úì Found XX MCP tools
  Request ID: req-xxxxx

  Available tools (showing first 10):
  1. shell
     Description: Execute shell commands
     Server: system
     Required params: command

  ...

3. Finding 'shell' tool details...
‚úì Found 'shell' tool
  Description: Execute shell commands
  Server: system
  Input Schema:
    {
      "type": "object",
      "properties": {
        "command": {
          "type": "string"
        },
        "timeout_ms": {
          "type": "integer"
        }
      },
      "required": ["command"]
    }

4. Calling 'shell' tool...
‚úì Tool call successful
  Request ID: req-xxxxx
  Output:
    Hello from MCP Tool!

5. Calling 'shell' tool with different command...
‚úì Tool call successful
  Request ID: req-xxxxx
  Current directory:
    /home/user

6. Demonstrating error handling (invalid command)...
‚úì Error handled correctly
  Request ID: req-xxxxx
  Error message: command not found...

7. Cleaning up...
‚úì Session deleted successfully
  Request ID: req-xxxxx

============================================================
Example completed successfully!
============================================================
```

## Key Points

- The `CallMcpTool` method is the unified API for calling any MCP tool
- Tool discovery is done via `ListMcpTools`
- Both VPC and non-VPC modes are supported automatically
- Proper error handling and cleanup are demonstrated





# Session Creation and Management Example

This example demonstrates comprehensive session creation and management using the Wuying AgentBay SDK. It covers various session types and configurations:

## Features Demonstrated

### 1. Basic Session Management
- Initializing the AgentBay client
- Creating a session with default parameters
- Listing all available sessions
- Creating multiple sessions
- Deleting sessions
- Verifying session deletion

### 2. Session with Labels
- Creating sessions with custom labels for organization
- Using labels for project management and environment tracking
- Retrieving and displaying session labels

### 3. Advanced Mobile Configuration Options

The example demonstrates comprehensive mobile session configuration using `MobileExtraConfig`. The following parameters are supported:

#### Core Configuration Parameters

- **`LockResolution`** (bool): Controls screen resolution behavior
  - `true`: Locks display resolution to prevent changes during session
  - `false`: Allows flexible resolution adjustments for different device types

- **`HideNavigationBar`** (bool): Controls system navigation bar visibility
  - `true`: Hides navigation bar for immersive full-screen experience
  - `false`: Shows navigation bar (default system behavior)

- **`UninstallBlacklist`** ([]string): List of package names protected from uninstallation
  - Prevents accidental or malicious removal of critical applications
  - Essential for system stability and security compliance
  - Example: `["com.android.systemui", "com.android.settings", "com.google.android.gms"]`

- **`AppManagerRule`** (*AppManagerRule): Application access control rules
  - **`RuleType`** (string): Either "White" (whitelist) or "Black" (blacklist)
  - **`AppPackageNameList`** ([]string): List of package names to allow or block

#### Configuration Examples

The example includes two configuration scenarios:

1. **Whitelist Mode**: Secure configuration with locked resolution, hidden navigation bar, and strict app control
2. **Blacklist Mode**: Flexible configuration with visible navigation bar and selective app blocking

#### JSON Structure

```json
{
  "mobile": {
    "lock_resolution": true,
    "hide_navigation_bar": true,
    "uninstall_blacklist": ["com.android.systemui", "com.android.settings"],
    "app_manager_rule": {
      "rule_type": "White",
      "app_package_name_list": ["com.allowed.app1", "com.allowed.app2"]
    }
  }
}

## Running the Example

```bash
cd session_creation
go run main.go
```

Make sure you have set the `AGENTBAY_API_KEY` environment variable or replace the placeholder in the code with your actual API key.




# Session Parameters Example

This example demonstrates how to use the session parameters features of the AgentBay SDK for Golang.

## Features Demonstrated

- Creating session parameters with custom labels
- Creating a session with custom labels
- Listing sessions by label filtering
- Implementing pagination with NextToken
- Cleaning up sessions

## Running the Example

1. Make sure you have installed the AgentBay SDK:

```bash
go get github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay
```

2. Set your API key as an environment variable (recommended):

```bash
export AGENTBAY_API_KEY=your_api_key_here
```

3. Run the example:

```bash
go run main.go
```

## Code Explanation

The example demonstrates session parameter usage:

1. Create session parameters with custom labels
2. Create a session using these parameters
3. List sessions filtered by a specific label
4. Demonstrate pagination by fetching the next page of results if available
5. Clean up by deleting the session

Session parameters allow you to customize how sessions are created and make it easier to find and manage them later. Custom labels are particularly useful for:

- Organizing sessions by project
- Tracking session owners
- Filtering sessions by purpose or state
- Implementing session management in multi-user environments

For more details on session parameters, see the [Session API Reference](../../../../../../typescript/docs/api/common-features/basics/session.md) and [Session Management Tutorial](../../../../../../docs/guides/common-features/basics/session-management.md).




# Session Pause and Resume Example

This example demonstrates how to use the `Pause` and `Resume` APIs to manage session lifecycle and reduce resource consumption.

## Description

The pause/resume feature allows you to temporarily suspend a session to reduce computational resource usage and costs, and then restore it later to continue work. This is particularly useful for long-running sessions where work may be intermittent.

## Prerequisites

- Go 1.21 or higher
- Valid API key set in `AGENTBAY_API_KEY` environment variable

## Usage

```bash
# Set your API key
export AGENTBAY_API_KEY="your-api-key-here"

# Run the example
go run main.go
```

## Code Example

```go
package main

import (
    "fmt"
    "log"
    "os"
    "time"

    "github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay"
)

func main() {
    // Initialize AgentBay client
    apiKey := os.Getenv("AGENTBAY_API_KEY")
    client, err := agentbay.NewAgentBay(apiKey, nil)
    if err != nil {
        log.Fatalf("Failed to initialize AgentBay client: %v", err)
    }

    // Create a session
    createResult, err := client.Create(nil)
    if err != nil {
        log.Fatalf("Failed to create session: %v", err)
    }
    session := createResult.Session
    defer session.Delete()

    // Perform some work
    commandResult, _ := session.Command.ExecuteCommand("echo 'Hello World'", 30000)
    fmt.Printf("Command output: %s\n", commandResult.Output)

    // Pause the session to save resources
    pauseResult, err := client.Pause(session, 300, 2.0)
    if err != nil {
        log.Fatalf("Failed to pause session: %v", err)
    }
    if !pauseResult.Success {
        log.Fatalf("Failed to pause session: %s", pauseResult.ErrorMessage)
    }
    fmt.Printf("Session paused (RequestID: %s)\n", pauseResult.RequestID)

    // Wait and verify session is paused
    time.Sleep(2 * time.Second)
    getResult, _ := client.GetSession(session.SessionID)
    fmt.Printf("Session status: %s\n", getResult.Data.Status)

    // Resume the session
    resumeResult, err := client.Resume(session, 300, 2.0)
    if err != nil {
        log.Fatalf("Failed to resume session: %v", err)
    }
    if !resumeResult.Success {
        log.Fatalf("Failed to resume session: %s", resumeResult.ErrorMessage)
    }
    fmt.Printf("Session resumed (RequestID: %s)\n", resumeResult.RequestID)

    // Continue working with the session
    commandResult, _ = session.Command.ExecuteCommand("echo 'Hello after resume'", 30000)
    fmt.Printf("Command output: %s\n", commandResult.Output)
}
```

## API Reference

### Pause

```go
func (ab *AgentBay) Pause(session *Session, timeout int, pollInterval float64) (*models.SessionPauseResult, error)
```

Synchronously pauses a session, putting it into a dormant state to reduce resource usage and costs.

**Parameters:**
- `session` (*Session): The session to pause
- `timeout` (int): Timeout in seconds to wait for the session to pause. Defaults to 600 seconds
- `pollInterval` (float64): Interval in seconds between status polls. Defaults to 2.0 seconds

**Returns:**
- `*models.SessionPauseResult`: Result object containing:
  - `Success` (bool): Whether the operation succeeded
  - `RequestID` (string): The API request ID
  - `ErrorMessage` (string): Error message if failed
  - `Status` (string): Final session status
- `error`: An error if a critical operation fails

### Resume

```go
func (ab *AgentBay) Resume(session *Session, timeout int, pollInterval float64) (*models.SessionResumeResult, error)
```

Synchronously resumes a session from a paused state to continue work.

**Parameters:**
- `session` (*Session): The session to resume
- `timeout` (int): Timeout in seconds to wait for the session to resume. Defaults to 600 seconds
- `pollInterval` (float64): Interval in seconds between status polls. Defaults to 2.0 seconds

**Returns:**
- `*models.SessionResumeResult`: Result object containing:
  - `Success` (bool): Whether the operation succeeded
  - `RequestID` (string): The API request ID
  - `ErrorMessage` (string): Error message if failed
  - `Status` (string): Final session status
- `error`: An error if a critical operation fails

## Expected Output

```
Creating a session...
Created session with ID: session-xxxxxxxxxxxxx

1. Verifying session is running...
Session status: RUNNING

2. Performing work on the session...
Command output: Hello from AgentBay session

3. Pausing the session...
Session paused successfully (RequestID: XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX)

4. Verifying session is paused...
Session status: PAUSED

5. Attempting work on paused session...
Expected: Command failed on paused session: ...

6. Resuming the session...
Session resumed successfully (RequestID: XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX)

7. Verifying session is running again...
Session status: RUNNING

8. Performing work on the resumed session...
Command output: Hello from resumed session

Example completed successfully!

Cleaning up...
Session session-xxxxxxxxxxxxx deleted successfully
```

## Notes

- Sessions in PAUSED state consume significantly fewer resources
- Operations on paused sessions will typically fail or wait until the session is resumed
- Both Pause and Resume are synchronous operations that wait for the session to reach the target state
- Use appropriate timeout values based on your workload requirements
- Always handle errors appropriately in production code



# Watch Directory Example (Go)

This example demonstrates how to use the `watch_directory` functionality in the AgentBay Go SDK to monitor file system changes in real-time.

## Features Demonstrated

- Creating an AgentBay session with `code_latest` ImageId
- Setting up directory monitoring with callback functions
- Detecting file creation, modification, and deletion events
- Using the `GetFileChange` method for one-time change detection
- Proper resource cleanup and session management

## Prerequisites

1. Go 1.18 or later
2. AgentBay API key set as environment variable `AGENTBAY_API_KEY`

## Running the Example

```bash
# Set your API key
export AGENTBAY_API_KEY="your-api-key-here"

# Run the example
go run main.go
```

## What the Example Does

1. **Initializes AgentBay**: Creates a client with your API key
2. **Creates Session**: Sets up a session with `code_latest` ImageId
3. **Sets Up Monitoring**: Starts watching a temporary directory for changes
4. **Demonstrates File Operations**:
   - Creates a new file
   - Modifies the file
   - Creates another file
   - Creates a subdirectory
   - Deletes a file
5. **Shows GetFileChange**: Demonstrates one-time change detection
6. **Cleanup**: Properly stops monitoring and deletes the session

## Expected Output

The example will show real-time detection of file changes with output like:

```
=== AgentBay Watch Directory Example ===
‚úÖ AgentBay client initialized
‚úÖ Session created with ID: sess_xxxxxxxxxx
üìÅ Created test directory: /tmp/agentbay-watch-example-xxxxxx
üëÄ Starting to watch directory: /tmp/agentbay-watch-example-xxxxxx
üìä Polling interval: 500ms
‚è≥ Waiting for monitoring to start...

üé¨ Demonstrating file operations...
üìù Creating a new file...

üîç Detected 1 file changes:
  - FileChangeEvent(eventType='create', path='/tmp/agentbay-watch-example-xxxxxx/example.txt', pathType='file')

‚úèÔ∏è  Modifying the file...

üîç Detected 1 file changes:
  - FileChangeEvent(eventType='modify', path='/tmp/agentbay-watch-example-xxxxxx/example.txt', pathType='file')

üìÑ Creating another file...
üìÇ Creating a subdirectory...
üóëÔ∏è  Deleting a file...

üîç Demonstrating GetFileChange method...
üìä GetFileChange result:
  - Request ID: req_xxxxxxxxxx
  - Events count: X
  - File change details:
    ‚Ä¢ Modified files: [...]
    ‚Ä¢ Created files: [...]
    ‚Ä¢ Deleted files: [...]

‚èπÔ∏è  Stopping directory monitoring...
‚úÖ Watch directory example completed successfully!
```

## Code Structure

### Key Components

1. **Session Management**:
   ```go
   sessionParams := &agentbay.CreateSessionParams{
       ImageId: "code_latest",
   }
   sessionResult, err := agentBay.Create(sessionParams)
   ```

2. **Directory Monitoring**:
   ```go
   callback := func(events []*filesystem.FileChangeEvent) {
       // Handle detected changes
   }
   
   stopChan := make(chan struct{})
   go func() {
       err := fileSystem.WatchDirectory(testDir, callback, 1000, stopChan)
   }()
   ```

3. **One-time Change Detection**:
   ```go
   result, err := fileSystem.GetFileChange(testDir)
   if err == nil && result.HasChanges() {
       // Process detected changes
   }
   ```

4. **Proper Cleanup**:
   ```go
   defer func() {
       _, err := agentBay.Delete(session)
   }()
   
   close(stopChan) // Stop monitoring
   ```

## Error Handling

The example includes comprehensive error handling for:
- AgentBay client initialization
- Session creation and deletion
- File operations
- Directory monitoring setup

## Performance Considerations

- **Polling Interval**: Set to 1000ms (1 second) for demonstration
- **Resource Management**: Proper cleanup prevents memory leaks
- **Callback Efficiency**: Keep callback functions lightweight

## Customization

You can modify the example to:
- Change the polling interval (minimum 100ms)
- Filter specific file types in the callback
- Monitor multiple directories simultaneously
- Add custom logging or processing logic

## Troubleshooting

### Common Issues

1. **API Key Not Set**: Ensure `AGENTBAY_API_KEY` environment variable is set
2. **Permission Errors**: Make sure the application has write access to `/tmp`
3. **Network Issues**: Check internet connectivity for AgentBay API access

### Debug Tips

- Enable verbose logging by adding debug prints
- Check the session ID in AgentBay dashboard
- Verify file operations are actually creating/modifying files
- Monitor system resources if running for extended periods 



# Mobile GetAdbUrl Example

This example demonstrates how to use the `GetAdbUrl` method to retrieve an ADB (Android Debug Bridge) connection URL for a mobile session.

## Prerequisites

- Go 1.18 or higher
- AgentBay API key (set as environment variable `AGENTBAY_API_KEY`)
- ADB public key (for production use)

## What This Example Does

1. Creates a mobile session using `mobile_latest` image
2. Calls `session.Mobile.GetAdbUrl()` with an ADB public key
3. Retrieves the ADB connection URL
4. Cleans up the session

## Important Notes

- **Mobile Environment Required**: The `GetAdbUrl` method only works with mobile sessions (`mobile_latest` image). Using other image types will result in an error.
- **ADB Public Key**: You need to provide your ADB public key. The example uses a desensitized placeholder key.
- **Connection URL Format**: The returned URL follows the format: `adb connect <IP>:<Port>`

## Running the Example

```bash
# Set your API key
export AGENTBAY_API_KEY=your_api_key_here

# Run the example
go run main.go
```

## Expected Output

```
=== Mobile GetAdbUrl Example ===

Creating mobile session...
‚úÖ Session created successfully
   Session ID: session-xxxxxxxxx
   Image ID: mobile_latest

Getting ADB connection URL...
‚úÖ ADB URL retrieved successfully
   URL: adb connect xx.xx.xx.xx:xxxxx
   Request ID: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

You can now connect to the mobile device using:
   adb connect xx.xx.xx.xx:xxxxx

Cleaning up session...
‚úÖ Session deleted successfully (RequestID: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx)

=== Example completed successfully ===
```

## Using the ADB Connection

Once you have the ADB connection URL, you can use it to connect to the mobile device:

```bash
# Connect to the mobile device
adb connect xx.xx.xx.xx:xxxxx

# Verify the connection
adb devices

# Now you can use standard ADB commands
adb shell
adb install app.apk
adb logcat
```

## Error Handling

The example includes error handling for common scenarios:

- Missing API key
- Session creation failure
- Non-mobile environment (wrong image type)
- ADB URL retrieval failure

## Related Documentation

- [Mobile API Documentation](../../../../../typescript/docs/api/mobile-use/mobile.md)
- [Session Creation Guide](../../common-features/basics/session_creation/README.md)
- [Basic Usage Example](../../basic_usage/README.md)





# Mobile Simulate Example

This example demonstrates how to use the mobile simulate feature to simulate different mobile devices across sessions.

## Features

- Upload mobile device information for simulation
- Create multiple sessions with the same simulated device configuration
- Verify device properties after simulation
- Proper session cleanup

## Prerequisites

- AgentBay API key set as environment variable `AGENTBAY_API_KEY`
- Mobile device information file (contact support team to obtain)

## Usage

```bash
# Set your API key
export AGENTBAY_API_KEY=your_api_key_here

# Navigate to the example directory
cd golang/docs/examples/mobile-use/mobile_simulate_basic_usage

# Run the example
go run main.go
```

## What This Example Does

1. **Upload Mobile Info**: Uploads a mobile device information file to create a simulate context
2. **First Session**: Creates a mobile session with the simulated device configuration
3. **Verify Device**: Checks the device model to confirm simulation is working
4. **Second Session**: Creates another session using the same simulated context
5. **Verify Consistency**: Confirms both sessions have the same device properties
6. **Cleanup**: Properly deletes both sessions

## Key Concepts

### Mobile Simulate Service

The `MobileSimulateService` is now part of the main `agentbay` package:

```go
import "github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay"

// Create mobile simulate service
simulateService, err := agentbay.NewMobileSimulateService(client)
if err != nil {
    log.Fatalf("Failed to create mobile simulate service: %v", err)
}
```

### Create Session with Mobile Simulate
Creates a session with mobile simulate configuration and the user's context:
```go
params := &agentbay.CreateSessionParams{
    ImageId:      "mobile_latest",
    ContextSyncs: []*agentbay.ContextSync{contextSync},
    ExtraConfigs: &models.ExtraConfigs{
        Mobile: &models.MobileExtraConfig{
            SimulateConfig: simulateService.GetSimulateConfig(),
        },
    },
}
```

### Simulate Modes

- `MobileSimulateModePropertiesOnly`: Only simulate device properties (build.prop)
- `MobileSimulateModeSensorsOnly`: Only simulate sensors information
- `MobileSimulateModePackagesOnly`: Only simulate installed packages
- `MobileSimulateModeServicesOnly`: Only simulate system services
- `MobileSimulateModeAll`: Simulate all aspects

## Output Example

```
=== Mobile Simulate Example ===

AgentBay client initialized
=== First Mobile Session ===
Uploading mobile info file for first time...
Mobile simulate context id uploaded successfully: ctx_abc123
Creating first session...
Session created with ID: sess_xyz789
Waiting for mobile simulate to complete...
Getting device model after mobile simulate...
First session device model: Pixel 6

Deleting first session...
First session deleted successfully (RequestID: req_123)

=== Second Mobile Session ===
Creating second session...
Session created with ID: sess_def456
Waiting for mobile simulate to complete...
Getting device model after mobile simulate...
Second session device model: Pixel 6

Deleting second session...
Second session deleted successfully (RequestID: req_456)

=== Example completed successfully ===
```

## Related Examples

- [Mobile Get ADB URL](../mobile_get_adb_url/README.md) - Get ADB connection URL for mobile sessions
- [Context Management](../../common-features/basics/context_management/README.md) - Learn about context persistence
- [Session Creation](../../common-features/basics/session_creation/README.md) - Basic session creation

## Notes

- The mobile info file path is relative to the example directory
- Wait time after session creation allows the simulation to complete
- The same context ID can be reused across multiple sessions
- Device properties persist across sessions using the same context





# Mobile Simulate with User Specific Context Example

This example demonstrates how to use the mobile simulate feature with a user specific context to simulate mobile devices across sessions.

## Overview

This example shows:
1. Getting a user specific context
2. Checking if the mobile dev info file exists in user's specific context
3. Uploading mobile dev info file to user's specific context if not exists
4. Creating a session with mobile simulate configuration and user's specific context
5. Waiting for mobile simulate to complete
6. Getting device model after mobile simulate
7. Deleting session with context sync

## Prerequisites

- Go 1.16 or higher
- AgentBay API key
- Mobile info file (contact support team for details)

## Setup

1. Set your API key as an environment variable:
```bash
export AGENTBAY_API_KEY=your_api_key_here
```

2. Ensure you have the mobile info file at `resource/mobile_info_model_a.json`

## Running the Example

```bash
cd golang/docs/examples/mobile-use/mobile_simulate_with_ctx
go run main.go
```

## What This Example Does

### 1. Create Mobile Simulate Service

The `MobileSimulateService` is now part of the main `agentbay` package:

```go
import "github.com/aliyun/wuying-agentbay-sdk/golang/pkg/agentbay"

// Create mobile simulate service
simulateService, err := agentbay.NewMobileSimulateService(client)
if err != nil {
    log.Fatalf("Failed to create mobile simulate service: %v", err)
}
```

### 2. Get User Specific Context
The example first gets or creates a user-specific context using a phone number as identifier:
```go
contextResult, err := client.Context.Get("13000000002", true)
```

### 3. Create Context Sync Configuration
Creates a context sync with a white list policy to sync specific paths:
```go
syncPolicy := &agentbay.SyncPolicy{
    BWList: &agentbay.BWList{
        WhiteLists: []*agentbay.WhiteList{
            {
                Path:         "/com.wuying.devinfo",
                ExcludePaths: []string{},
            },
        },
    },
}

contextSync := &agentbay.ContextSync{
    ContextID: context.ID,
    Path:      "/data/data",
    Policy:    syncPolicy,
}
```

### 4. Check and Upload Mobile Info
Checks if mobile dev info exists in the context, and uploads it if not:
```go
hasMobileInfo, err := simulateService.HasMobileInfo(contextSync)
if err != nil {
    log.Fatalf("Failed to check mobile info: %v", err)
}

if !hasMobileInfo {
    uploadResult := simulateService.UploadMobileInfo(string(mobileInfoContent), contextSync)
    if !uploadResult.Success {
        log.Fatalf("Failed to upload mobile info: %s", uploadResult.ErrorMessage)
    }
}
```

### 5. Configure Mobile Simulate
Set up the simulate service with desired configuration:
```go
simulateService.SetSimulateEnable(true)
simulateService.SetSimulateMode(models.MobileSimulateModePropertiesOnly)
```

### 6. Create Session with Mobile Simulate
Creates a session with mobile simulate configuration and the user's context:
```go
params := &agentbay.CreateSessionParams{
    ImageId:      "mobile_latest",
    ContextSyncs: []*agentbay.ContextSync{contextSync},
    ExtraConfigs: &models.ExtraConfigs{
        Mobile: &models.MobileExtraConfig{
            SimulateConfig: simulateService.GetSimulateConfig(),
        },
    },
}
```

### 7. Verify Mobile Simulate
Verifies the mobile simulate by checking the device model:
```go
result, err := session.Command.ExecuteCommand("getprop ro.product.model")
```

### 8. Delete Session with Context Sync
Deletes the session and syncs the context back:
```go
deleteResult, err := session.Delete(&agentbay.DeleteSessionParams{
    SyncContext: true,
})
```

## Expected Output

```
=== Mobile Simulate with User Specific Context Example ===

AgentBay client initialized
Getting a user specific context...
context.id = <context_id>, context.name = 13000000000
Checking or uploading mobile dev info file...
Mobile dev info uploaded successfully
Creating session...
Session created with ID: <session_id>
Session: <session_details>
Waiting 5 seconds for mobile simulate to complete...
Getting device model after mobile simulate...
Session device model: <device_model>

Deleting session...
Session deleted successfully (RequestID: <request_id>)

=== Example completed successfully ===
```

## Key Concepts

### User Specific Context
- Allows persisting mobile device information across sessions
- Identified by a unique identifier (e.g., phone number)
- Can be reused across multiple sessions

### Context Sync
- Synchronizes specific paths between local and remote contexts
- Uses white list policy to control what gets synced
- Supports sync on session creation and deletion

### Mobile Simulate Modes
- `PropertiesOnly`: Only simulates device properties
- `Full`: Full device simulation including hardware characteristics

## Notes

- The mobile info file contains device-specific information
- Contact the support team for guidance on obtaining mobile info files
- The context sync ensures device information persists across sessions
- Use `SyncContext: true` when deleting to save changes back to context

## Related Examples

- [Mobile Simulate Basic Usage](../mobile_simulate_basic_usage/README.md) - Basic mobile simulate without user context
- [Mobile Get ADB URL](../mobile_get_adb_url/README.md) - Getting ADB connection URL






# Cookbook Examples


# AgentBay SDK Cookbook

The AgentBay SDK Cookbook is a collection of practical examples and use cases demonstrating how to leverage the AgentBay SDK for various automation scenarios. Each cookbook showcases a specific application of the SDK, providing both basic implementations and integrations with popular frameworks like LangChain.

## Session Environments

Examples are organized by session environments. A session environment in AgentBay refers to an isolated cloud computing environment where specific types of operations can be performed safely and efficiently. Each environment provides specialized capabilities for different use cases.

Currently, two distinct session environments are implemented:

1. **browser** - A web browser session environment that provides capabilities for web automation, including form filling, web scraping, and UI interactions.
2. **codespace** - A code execution session environment that provides capabilities for running and testing code in isolated environments.

## Table of Contents

### Browser Environment

1. [Form-Filling Agent](./browser/form-filling-agent/) - Demonstrates browser automation capabilities by automatically filling HTML forms
2. [E-commerce Inspector](./browser/e-commerce-inspector/) - Automated product information extraction from e-commerce websites with AI-powered navigation

### Codespace Environment

3. [Auto Testing Agent](./codespace/auto-testing-agent/) - Shows how to automate Python testing workflows in cloud environments
4. [OpenAI Data Analysis](./codespace/openai-data-analysis/) - Demonstrates AI-powered data analysis using OpenAI function calling with AgentBay code execution
5. [AI Code Assistant](./codespace/ai-code-assistant/) - An interactive web-based AI code assistant with real-time Python execution and visualization powered by Alibaba Cloud Bailian

## Overview

The AgentBay SDK provides a comprehensive suite of tools for efficient interaction with AgentBay cloud environments. These cookbooks demonstrate real-world applications of the SDK across different domains:

### Form-Filling Agent
This cookbook demonstrates how to create a form-filling agent using the AgentBay SDK. The agent can:
- Upload an HTML form to AgentBay environment
- Open the form in a browser using AgentBay's browser capabilities
- Use natural language instructions to fill form fields
- Submit the form automatically

### E-commerce Inspector
This cookbook demonstrates how to create an e-commerce inspector agent using the AgentBay SDK. The agent can:
- Automatically navigate to product listing pages on e-commerce websites
- Extract product information (names, prices, links) using AI-powered extraction
- Handle popups, cookie banners, and overlays automatically
- Support batch inspection of multiple websites
- Save results as JSON files with screenshots for verification
- Built-in CAPTCHA solving support

### Auto Testing Agent
This cookbook demonstrates how to create a testing agent using LangChain and AgentBay SDK. The agent can:
- Scan Python projects to identify modules that need testing
- Generate test cases using LLMs based on project structure
- Execute tests in isolated AgentBay cloud sessions
- Save test results to local log files

### OpenAI Data Analysis
This cookbook demonstrates how to integrate OpenAI with AgentBay for automated data analysis. The example shows:
- Creating AgentBay sessions with `code_latest` image for Python code execution
- Uploading datasets to cloud environments for remote analysis
- Using OpenAI function calling to generate Python analytics code
- Executing AI-generated code in isolated AgentBay sessions
- Capturing matplotlib visualizations and analysis results
- Performing comprehensive e-commerce analytics including metrics, trends, and customer segmentation

### AI Code Assistant
This cookbook demonstrates how to build an interactive web-based AI code assistant using Next.js, AgentBay SDK, and Alibaba Cloud Bailian (DashScope). The application provides:
- Real-time AI chat interface with streaming responses
- Secure Python code execution in cloud environments
- Automatic chart generation and visualization display
- Pre-installed data science packages (pandas, numpy, matplotlib, scikit-learn, seaborn)
- Session persistence for continuous development workflow
- Dark mode UI with responsive design

## Framework Integration

Each cookbook is structured to support multiple agent frameworks. Currently, most examples include LangChain integration, with plans to expand to other frameworks. The projects follow a modular structure that separates core functionality from framework-specific integrations:

```
cookbook-name/
‚îú‚îÄ‚îÄ README.md              # Documentation
‚îú‚îÄ‚îÄ .env                   # Environment variables
‚îú‚îÄ‚îÄ common/                # Public core functionality
‚îÇ   ‚îî‚îÄ‚îÄ src/               # Framework-agnostic code
‚îî‚îÄ‚îÄ framework-name/        # Framework integration (e.g., langchain)
    ‚îú‚îÄ‚îÄ data/              # Data directory for outputs
    ‚îú‚îÄ‚îÄ src/               # Framework-specific code
    ‚îî‚îÄ‚îÄ requirements.txt   # Dependencies (for Python)
```

## Getting Started

To use any of these cookbooks:

1. Ensure you have the AgentBay SDK installed for your preferred language
2. Set up your environment variables, either through:
   - Exporting environment variables directly:
     ```bash
     export AGENTBAY_API_KEY=your_api_key_here
     ```
   - Or using the `.env` file in each cookbook directory (recommended)
3. Some cookbooks may require additional API keys, such as DashScope API key for LLM functionality
4. Navigate to the specific cookbook you're interested in
5. Follow the setup instructions in that cookbook's README.md
6. Run the example scripts to see the SDK in action

## Prerequisites

Before using the cookbooks, you need to:

1. Register an Alibaba Cloud account: [https://aliyun.com](https://aliyun.com)
2. Get APIKEY credentials: [AgentBay Console](https://agentbay.console.aliyun.com/service-management)
3. Install the required dependencies for each cookbook (usually Python packages)

## Contributing

If you'd like to contribute new cookbooks or improve existing ones, please follow the established structure and submit a pull request. Each cookbook should demonstrate a clear, practical use case for the AgentBay SDK.



# E-commerce Inspector Agent

This project demonstrates how to create an e-commerce inspector agent using the AgentBay SDK. The agent can automatically visit e-commerce websites, navigate to product listing pages, extract product information (names, prices, links), and save the results with screenshots.

## What It Does

**Input:** A URL to an e-commerce product listing page
```
https://waydoo.com/collections/all
```

**Output:** Structured product data + Screenshot

<table>
<tr>
<td width="50%">

**Screenshot of Product Listing Page**

![Product Listing Page](./assets/waydoo_screenshot.png)

</td>
<td width="50%">

**Extracted Product Information (JSON)**

```json
[
  {
    "name": "15L Waterproof Dry Bag Backpack",
    "price": "$22.90",
    "link": "/products/15l-waterproof-dry-bag-backpack"
  },
  {
    "name": "Evo 27\" Mast",
    "price": "$599.00",
    "link": "/products/waydoo-flyer-evo-27-mast"
  },
  {
    "name": "Evo 31\" Mast",
    "price": "$1,499.00",
    "link": "/products/waydoo-flyer-evo-31-mast"
  },
  {
    "name": "Evo 35\" Mast",
    "price": "$799.00",
    "link": "/products/waydoo-flyer-evo-35-mast"
  },
  {
    "name": "Tactical Backpack",
    "price": "$189.00",
    "link": "/products/tactical-backpack"
  },
  {
    "name": "Fireproof Safe Bag",
    "price": "$79.90",
    "link": "/products/fireproof-safe-bag"
  },
  {
    "name": "Board Bag",
    "price": "$149.00",
    "link": "/products/board-bag"
  },
  {
    "name": "Board Bag Pro",
    "price": "$169.00",
    "link": "/products/board-bag-pro"
  },
  {
    "name": "Flyer ONE Plus",
    "price": "$3,999.00",
    "link": "/products/flyer-one-plus"
  },
  {
    "name": "Flyer ONE",
    "price": "$3,499.00",
    "link": "/products/flyer-one"
  },
  {
    "name": "Wing Set",
    "price": "$899.00",
    "link": "/products/wing-set"
  },
  {
    "name": "Battery Charger",
    "price": "$299.00",
    "link": "/products/battery-charger"
  }
]
```

</td>
</tr>
</table>

## Features

- Automatically navigate to product listing pages
- Extract product information using AI-powered extraction
- Handle popups, cookie banners, and overlays automatically
- Support for multiple websites in batch
- Save results as JSON files with screenshots
- Normalize and validate product data
- Built-in CAPTCHA solving support

## Use Cases

- **Price Monitoring**: Track product prices across multiple e-commerce sites
- **Competitive Analysis**: Compare product offerings from different retailers
- **Product Aggregation**: Collect product information for comparison shopping
- **Market Research**: Analyze product catalogs and pricing strategies
- **Inventory Tracking**: Monitor product availability across sites

## Framework Integration Guides

This project is structured to support multiple agent frameworks. Please refer to the specific framework integration guide for detailed setup and usage instructions:

- [LangChain Integration Guide (Sync)](./sync/langchain/README.md) - Complete setup and usage instructions for LangChain framework (synchronous version)
- [LangChain Integration Guide (Async)](./async/langchain/README.md) - Complete setup and usage instructions for LangChain framework (asynchronous version)

## Project Structure

This project follows a modular structure that separates core functionality from framework-specific integrations:

```
e-commerce-inspector/
‚îú‚îÄ‚îÄ README.md            # This documentation
‚îú‚îÄ‚îÄ assets/              # Images and screenshots
‚îú‚îÄ‚îÄ sync/                # Synchronous implementation
‚îÇ   ‚îú‚îÄ‚îÄ common/          # Sync core functionality
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ src/         # Framework-agnostic code
‚îÇ   ‚îî‚îÄ‚îÄ langchain/       # Sync LangChain integration
‚îÇ       ‚îú‚îÄ‚îÄ README.md    # Integration documentation
‚îÇ       ‚îú‚îÄ‚îÄ requirements.txt # Dependencies
‚îÇ       ‚îî‚îÄ‚îÄ src/         # LangChain-specific code
‚îî‚îÄ‚îÄ async/               # Asynchronous implementation
    ‚îú‚îÄ‚îÄ common/          # Async core functionality
    ‚îÇ   ‚îî‚îÄ‚îÄ src/         # Framework-agnostic code
    ‚îî‚îÄ‚îÄ langchain/       # Async LangChain integration
        ‚îú‚îÄ‚îÄ README.md    # Integration documentation
        ‚îú‚îÄ‚îÄ requirements.txt # Dependencies
        ‚îî‚îÄ‚îÄ src/         # LangChain-specific code
```

### Common Module

The `common/` directories contain core functionality that can be used across different agent frameworks, with separate implementations for synchronous and asynchronous patterns.

### Framework Integration Modules

Framework-specific directories (like `sync/langchain/` and `async/langchain/`) contain the integration code that implements e-commerce inspection functionality using specific agent frameworks with different execution patterns.

## How It Works

1. **Session Creation**: Creates an AgentBay browser session with CAPTCHA solving enabled
2. **Navigation**: Navigates to the target e-commerce website
3. **Page Analysis**: Uses AI to identify and navigate to product listing pages
4. **Data Extraction**: Extracts product information using structured extraction with Pydantic schemas
5. **Data Validation**: Normalizes links and validates product data
6. **Result Storage**: Saves results as JSON files and captures screenshots for verification

## Technical Highlights

### AI-Powered Extraction

The agent uses AgentBay's `extract_async` method with Pydantic schemas to extract structured data:

```python
class ProductInfo(BaseModel):
    name: str = Field(..., description="Product name")
    price: Optional[str] = Field(None, description="Price text")
    link: str = Field(..., description="Relative path to product page")

class InspectionResult(BaseModel):
    products: List[ProductInfo] = Field(..., description="All products on the page")
```

### Automatic Navigation

The agent can automatically:
- Navigate to product listing pages (Shop, Store, Catalog, etc.)
- Close popups and cookie banners
- Retry extraction if the initial attempt fails
- Handle different page layouts and structures

### Data Normalization

- Converts relative URLs to absolute URLs
- Validates product data (name, price, link)
- Filters out invalid entries
- Ensures minimum quality standards

## Customization

You can customize the inspector behavior by:

1. **Modifying extraction instructions**: Update the instruction text in `inspector_tools.py`
2. **Adjusting validation rules**: Change the `is_valid_product` function
3. **Adding new sites**: Simply provide new URLs to inspect
4. **Customizing output format**: Modify the JSON serialization in `process_site`

## AgentBay SDK Features Used

- Session management with browser environments
- Browser initialization with custom screen size
- CAPTCHA solving capabilities
- AI-powered browser agent for navigation and extraction
- Structured data extraction with Pydantic schemas
- Screenshot capture for verification
- Async/await support for efficient execution

## Output Files

After running the inspector, you'll find the following files in the `./data/` directory:

- **`inspection_[domain].json`** - Structured product data (name, price, link)
- **`screenshot_[domain].png`** - Screenshot of the product listing page (viewport only, optimized for documentation)

## Prerequisites

Before using this cookbook, you need to:

1. Register an Alibaba Cloud account: [https://aliyun.com](https://aliyun.com)
2. Get APIKEY credentials: [AgentBay Console](https://agentbay.console.aliyun.com/service-management)
3. Get DashScope API key for LLM: [DashScope Console](https://bailian.console.aliyun.com/#/home)

## Contributing

If you'd like to contribute improvements or add support for new frameworks, please follow the established structure and submit a pull request.





# LangChain Integration

This directory contains the LangChain-specific integration for the e-commerce inspector agent.

## Sample Output

When the agent successfully inspects an e-commerce website, you will see output similar to the following:

```
Initializing LLM...
Initializing AgentBay session...
[DATE] [TIME] | AgentBay | INFO | [PID]:[TID] | agentbay.agentbay:create:625 | ‚úÖ API Response: CreateSession, RequestId=[REQUEST_ID]
Session created with ID: [SESSION_ID]
Browser initialized successfully

================================================================================
E-commerce Inspector Agent Ready!
================================================================================

--- Example 1: Inspect a single e-commerce website ---

> Entering new AgentExecutor chain...

Invoking: `inspect_website` with `{'url': 'https://waydoo.com/collections/all'}`

Acting: Navigate to the product listing page...
Extraction attempt 1/3 for https://waydoo.com/collections/all...
Extraction successful on attempt 1. Found 12 valid products.
Screenshot for https://waydoo.com/collections/all saved to: ./data/screenshot_waydoo.com.png
waydoo.com -> 12 items (with price: 12) saved: ./data/inspection_waydoo.com.json
Successfully inspected waydoo.com. Found 12 products. Results saved to: ./data/inspection_waydoo.com.json

Result:
Successfully inspected waydoo.com/collections/all and extracted product information. Found 12 products with prices and links. The results have been saved to ./data/inspection_waydoo.com.json and a screenshot has been captured for verification.

================================================================================
Inspection completed! Check the ./data directory for results.
================================================================================
```

## Setup

### 1. Create Virtual Environment

First, create a virtual environment to isolate project dependencies:

```bash
# Create virtual environment
python -m venv e-commerce-inspector-env

# Activate virtual environment
# On Windows:
e-commerce-inspector-env\Scripts\activate
# On macOS/Linux:
source e-commerce-inspector-env/bin/activate
```

### 2. Install Dependencies

Install the required packages:

```bash
# Update pip
pip install --upgrade pip

# Install dependencies
pip install -r requirements.txt
```

### 3. Configure Environment Variables

Set your API keys as environment variables:

```bash
export AGENTBAY_API_KEY="YOUR_AGENTBAY_API_KEY"
export DASHSCOPE_API_KEY="YOUR_DASHSCOPE_API_KEY"
```

You can get your AgentBay API key from the AgentBay platform dashboard:
1. Visit [AgentBay Console](https://agentbay.console.aliyun.com/service-management)
2. Sign up or log in to your Alibaba Cloud account
3. Navigate to the Service Management section
4. Create a new API KEY or select an existing one
5. Copy the API Key and set it as the value of `AGENTBAY_API_KEY`

For the DashScope API key, you need to register on the Alibaba Cloud DashScope platform:
1. Visit [DashScope Platform](https://bailian.console.aliyun.com/#/home)
2. Sign up or log in to your account
3. Navigate to the API Key management section
4. Copy the API Key and set it as the value of `DASHSCOPE_API_KEY`

## Structure

- [src/](./src/): Contains the LangChain-specific implementation
  - `inspector_tools.py`: Core inspection tools and utilities
  - `e_commerce_inspector.py`: Main inspector agent implementation
  - `e_commerce_inspector_example.py`: Example usage script
- `data/`: Output directory for inspection results (created automatically)
- [README.md](./README.md): This documentation file
- [requirements.txt](./requirements.txt): Python dependencies

## Integration Details

The LangChain integration uses the core functionality and wraps it in LangChain-specific components.

This demonstrates how to:
1. Use LangChain agents with AgentBay SDK
2. Create custom tools for e-commerce inspection
3. Structure the code to separate core functionality from framework-specific integration
4. Maintain clean separation of concerns between core logic and framework integration
5. Orchestrate inspection tasks using LangChain's agent framework

## LangChain Orchestration

The e-commerce inspector agent is orchestrated using LangChain's agent framework. This provides a flexible way to interact with the inspection functionality:

1. **Tool-based approach**: The agent exposes tools for inspecting websites
2. **Natural language interface**: Users can interact with the agent using natural language commands
3. **Automatic workflow**: The agent automatically determines the correct sequence of operations

### Available Tools

1. `inspect_website`: Inspect a single e-commerce website and extract product information
   - Input: URL of the website to inspect
   - Output: Summary of products found and file paths

2. `inspect_multiple_websites`: Inspect multiple e-commerce websites at once
   - Input: Comma-separated list of URLs
   - Output: Summary of all inspection results

### Running the Example Script

To run the LangChain orchestration example:

```bash
cd YOUR_PREFIX_PATH/cookbook/browser/e-commerce-inspector/langchain/
python src/e_commerce_inspector_example.py
```

This example script demonstrates:
1. Creating a LangChain e-commerce inspector agent
2. Inspecting a single e-commerce website
3. Extracting product names, prices, and links
4. Saving results to JSON files with screenshots

## Customization

You can customize the inspector behavior by:

### 1. Modify Extraction Instructions

Edit the instruction text in `inspector_tools.py`:

```python
instruction=(
    "Please extract all products on this page. "
    "Price can be a range (e.g., $199‚Äì$299) or 'from $199'. "
    # Add your custom instructions here
)
```

### 2. Adjust Validation Rules

Modify the `is_valid_product` function in `inspector_tools.py`:

```python
def is_valid_product(p: ProductInfo) -> bool:
    """Check if a product has valid information."""
    # Add your custom validation logic here
    has_name = bool(p.name and p.name.strip())
    has_valid_link = bool(p.link and p.link.strip())
    has_price = bool(p.price and p.price.strip())
    return has_name and (has_valid_link or has_price)
```

### 3. Change Output Directory

Specify a different output directory when creating the inspector:

```python
inspector = ECommerceInspector(
    llm=llm,
    agentbay_api_key=agentbay_api_key,
    output_dir="/path/to/your/output/directory"
)
```

### 4. Use Different LLM Models

You can use different LLM models by changing the model parameter:

```python
from langchain_community.chat_models import ChatTongyi

llm = ChatTongyi(
    model="qwen-max",  # or "qwen-turbo", "qwen-plus"
    dashscope_api_key=dashscope_api_key,
    temperature=0
)
```

## Advanced Usage

### Inspect Multiple Websites

You can inspect multiple websites in a single run:

```python
task = "Please inspect these websites: https://site1.com, https://site2.com, https://site3.com"
result = await inspector.run(task)
```

### Use as Context Manager

The inspector supports async context manager for automatic cleanup:

```python
async with ECommerceInspector(llm, agentbay_api_key, output_dir) as inspector:
    result = await inspector.run("Inspect https://example.com")
    # Session is automatically cleaned up when exiting the context
```

### Manual Session Management

If you need more control over the session lifecycle:

```python
inspector = ECommerceInspector(llm, agentbay_api_key, output_dir)
await inspector.initialize()
try:
    result = await inspector.run("Inspect https://example.com")
finally:
    await inspector.cleanup()
```

## Output Files

The inspector generates two types of files for each inspected website:

### 1. JSON File (inspection_[domain].json)

Contains the extracted product information:

```json
[
  {
    "name": "Product Name",
    "price": "$199.99",
    "link": "https://example.com/products/item1"
  },
  {
    "name": "Another Product",
    "price": "from $299.99",
    "link": "https://example.com/products/item2"
  }
]
```

### 2. Screenshot (screenshot_[domain].png)

A full-page screenshot of the product listing page for visual verification.

## Troubleshooting

If you encounter issues:

1. **API Key Issues**: Ensure your API keys are correct and properly set as environment variables
   ```bash
   echo $AGENTBAY_API_KEY
   echo $DASHSCOPE_API_KEY
   ```

2. **Network Connectivity**: Check that you have network connectivity to AgentBay services
   ```bash
   ping agentbay.console.aliyun.com
   ```

3. **Package Installation**: Verify that all required packages are installed
   ```bash
   pip list | grep -E "(wuying-agentbay-sdk|langchain|playwright)"
   ```

4. **Virtual Environment**: Check that you've activated your virtual environment before running the scripts
   ```bash
   which python  # Should point to your virtual environment
   ```

5. **Playwright Installation**: If you encounter browser-related issues, install Playwright browsers
   ```bash
   playwright install chromium
   ```

6. **Session Cleanup**: If sessions are not being cleaned up properly, you can manually delete them from the [AgentBay Console](https://agentbay.console.aliyun.com/session-management)

## Performance Tips

1. **Batch Processing**: Use `inspect_multiple_websites` for better efficiency when inspecting multiple sites
2. **Screen Size**: Adjust browser screen size in `BrowserScreen` for faster rendering
3. **Extraction Attempts**: Modify `max_steps` parameter in `ensure_listing_page` to control retry behavior
4. **CAPTCHA Handling**: Enable `solve_captchas=True` for sites with CAPTCHA protection

## Known Limitations

1. **Dynamic Content**: Some websites with heavy JavaScript may require additional wait time
2. **Anti-Bot Protection**: Some sites may have advanced anti-bot protection that requires additional configuration
3. **Rate Limiting**: Inspecting too many sites in quick succession may trigger rate limits
4. **Regional Restrictions**: Some sites may have geographical restrictions

## Next Steps

- Add support for more complex product extraction scenarios
- Implement price change tracking over time
- Add support for pagination to extract more products
- Integrate with databases for persistent storage
- Add email notifications for price changes





# E-commerce Inspector Agent - LangChain Integration (Sync)

This directory contains the LangChain-specific integration for the e-commerce inspector agent.

## Sample Output

When the agent successfully inspects an e-commerce website, you will see output similar to the following:

```
Initializing LLM...
Initializing AgentBay session...
[DATE] [TIME] | AgentBay | INFO | [PID]:[TID] | agentbay.agentbay:create:625 | ‚úÖ API Response: CreateSession, RequestId=[REQUEST_ID]
Session created with ID: [SESSION_ID]
Browser initialized successfully

================================================================================
E-commerce Inspector Agent Ready!
================================================================================

--- Example 1: Inspect a single e-commerce website ---

> Entering new AgentExecutor chain...

Invoking: `inspect_website` with `{'url': 'https://waydoo.com/collections/all'}`

Acting: Navigate to the product listing page...
Extraction attempt 1/3 for https://waydoo.com/collections/all...
Extraction successful on attempt 1. Found 12 valid products.
Screenshot for https://waydoo.com/collections/all saved to: ./data/screenshot_waydoo.com.png
waydoo.com -> 12 items (with price: 12) saved: ./data/inspection_waydoo.com.json
Successfully inspected waydoo.com. Found 12 products. Results saved to: ./data/inspection_waydoo.com.json

Result:
Successfully inspected waydoo.com/collections/all and extracted product information. Found 12 products with prices and links. The results have been saved to ./data/inspection_waydoo.com.json and a screenshot has been captured for verification.

================================================================================
Inspection completed! Check the ./data directory for results.
================================================================================
```

## Setup

### 1. Create Virtual Environment

First, create a virtual environment to isolate project dependencies:

```bash
# Create virtual environment
python -m venv e-commerce-inspector-env

# Activate virtual environment
# On Windows:
e-commerce-inspector-env\Scripts\activate
# On macOS/Linux:
source e-commerce-inspector-env/bin/activate
```

### 2. Install Dependencies

Install the required packages:

```bash
# Update pip
pip install --upgrade pip

# Install dependencies
pip install -r requirements.txt
```

### 3. Configure Environment Variables

Set your API keys as environment variables:

```bash
export AGENTBAY_API_KEY="YOUR_AGENTBAY_API_KEY"
export DASHSCOPE_API_KEY="YOUR_DASHSCOPE_API_KEY"
```

You can get your AgentBay API key from the AgentBay platform dashboard:
1. Visit [AgentBay Console](https://agentbay.console.aliyun.com/service-management)
2. Sign up or log in to your Alibaba Cloud account
3. Navigate to the Service Management section
4. Create a new API KEY or select an existing one
5. Copy the API Key and set it as the value of `AGENTBAY_API_KEY`

For the DashScope API key, you need to register on the Alibaba Cloud DashScope platform:
1. Visit [DashScope Platform](https://bailian.console.aliyun.com/#/home)
2. Sign up or log in to your account
3. Navigate to the API Key management section
4. Copy the API Key and set it as the value of `DASHSCOPE_API_KEY`

## Structure

- [src/](./src/): Contains the LangChain-specific implementation
  - `inspector_tools.py`: Core inspection tools and utilities
  - `e_commerce_inspector.py`: Main inspector agent implementation
  - `e_commerce_inspector_example.py`: Example usage script
- `data/`: Output directory for inspection results (created automatically)
- [README.md](./README.md): This documentation file
- [requirements.txt](./requirements.txt): Python dependencies

## Integration Details

The LangChain integration uses the core functionality and wraps it in LangChain-specific components.

This demonstrates how to:
1. Use LangChain agents with AgentBay SDK
2. Create custom tools for e-commerce inspection
3. Structure the code to separate core functionality from framework-specific integration
4. Maintain clean separation of concerns between core logic and framework integration
5. Orchestrate inspection tasks using LangChain's agent framework

## LangChain Orchestration

The e-commerce inspector agent is orchestrated using LangChain's agent framework. This provides a flexible way to interact with the inspection functionality:

1. **Tool-based approach**: The agent exposes tools for inspecting websites
2. **Natural language interface**: Users can interact with the agent using natural language commands
3. **Automatic workflow**: The agent automatically determines the correct sequence of operations

### Available Tools

1. `inspect_website`: Inspect a single e-commerce website and extract product information
   - Input: URL of the website to inspect
   - Output: Summary of products found and file paths

2. `inspect_multiple_websites`: Inspect multiple e-commerce websites at once
   - Input: Comma-separated list of URLs
   - Output: Summary of all inspection results

### Running the Example Script

To run the LangChain orchestration example:

```bash
cd YOUR_PREFIX_PATH/cookbook/browser/e-commerce-inspector/langchain/
python src/e_commerce_inspector_example.py
```

This example script demonstrates:
1. Creating a LangChain e-commerce inspector agent
2. Inspecting a single e-commerce website
3. Extracting product names, prices, and links
4. Saving results to JSON files with screenshots

## Customization

You can customize the inspector behavior by:

### 1. Modify Extraction Instructions

Edit the instruction text in `inspector_tools.py`:

```python
instruction=(
    "Please extract all products on this page. "
    "Price can be a range (e.g., $199‚Äì$299) or 'from $199'. "
    # Add your custom instructions here
)
```

### 2. Adjust Validation Rules

Modify the `is_valid_product` function in `inspector_tools.py`:

```python
def is_valid_product(p: ProductInfo) -> bool:
    """Check if a product has valid information."""
    # Add your custom validation logic here
    has_name = bool(p.name and p.name.strip())
    has_valid_link = bool(p.link and p.link.strip())
    has_price = bool(p.price and p.price.strip())
    return has_name and (has_valid_link or has_price)
```

### 3. Change Output Directory

Specify a different output directory when creating the inspector:

```python
inspector = ECommerceInspector(
    llm=llm,
    agentbay_api_key=agentbay_api_key,
    output_dir="/path/to/your/output/directory"
)
```

### 4. Use Different LLM Models

You can use different LLM models by changing the model parameter:

```python
from langchain_community.chat_models import ChatTongyi

llm = ChatTongyi(
    model="qwen-max",  # or "qwen-turbo", "qwen-plus"
    dashscope_api_key=dashscope_api_key,
    temperature=0
)
```

## Advanced Usage

### Inspect Multiple Websites

You can inspect multiple websites in a single run:

```python
task = "Please inspect these websites: https://site1.com, https://site2.com, https://site3.com"
result = inspector.run(task)
```

### Use as Context Manager

The inspector supports context manager for automatic cleanup:

```python
with ECommerceInspector(llm, agentbay_api_key, output_dir) as inspector:
    result = inspector.run("Inspect https://example.com")
    # Session is automatically cleaned up when exiting the context
```

### Manual Session Management

If you need more control over the session lifecycle:

```python
inspector.initialize()

result = inspector.run("Inspect https://example.com")

inspector.cleanup()
```

## Output Files

The inspector generates two types of files for each inspected website:

### 1. JSON File (inspection_[domain].json)

Contains the extracted product information:

```json
[
  {
    "name": "Product Name",
    "price": "$199.99",
    "link": "https://example.com/products/item1"
  },
  {
    "name": "Another Product",
    "price": "from $299.99",
    "link": "https://example.com/products/item2"
  }
]
```

### 2. Screenshot (screenshot_[domain].png)

A full-page screenshot of the product listing page for visual verification.

## Troubleshooting

If you encounter issues:

1. **API Key Issues**: Ensure your API keys are correct and properly set as environment variables
   ```bash
   echo $AGENTBAY_API_KEY
   echo $DASHSCOPE_API_KEY
   ```

2. **Network Connectivity**: Check that you have network connectivity to AgentBay services
   ```bash
   ping agentbay.console.aliyun.com
   ```

3. **Package Installation**: Verify that all required packages are installed
   ```bash
   pip list | grep -E "(wuying-agentbay-sdk|langchain|playwright)"
   ```

4. **Virtual Environment**: Check that you've activated your virtual environment before running the scripts
   ```bash
   which python  # Should point to your virtual environment
   ```

5. **Playwright Installation**: If you encounter browser-related issues, install Playwright browsers
   ```bash
   playwright install chromium
   ```

6. **Session Cleanup**: If sessions are not being cleaned up properly, you can manually delete them from the [AgentBay Console](https://agentbay.console.aliyun.com/session-management)

## Performance Tips

1. **Batch Processing**: Use `inspect_multiple_websites` for better efficiency when inspecting multiple sites
2. **Screen Size**: Adjust browser screen size in `BrowserScreen` for faster rendering
3. **Extraction Attempts**: Modify `max_steps` parameter in `ensure_listing_page` to control retry behavior
4. **CAPTCHA Handling**: Enable `solve_captchas=True` for sites with CAPTCHA protection

## Known Limitations

1. **Dynamic Content**: Some websites with heavy JavaScript may require additional wait time
2. **Anti-Bot Protection**: Some sites may have advanced anti-bot protection that requires additional configuration
3. **Rate Limiting**: Inspecting too many sites in quick succession may trigger rate limits
4. **Regional Restrictions**: Some sites may have geographical restrictions

## Next Steps

- Add support for more complex product extraction scenarios
- Implement price change tracking over time
- Add support for pagination to extract more products
- Integrate with databases for persistent storage
- Add email notifications for price changes





# Form-Filling Agent

This project demonstrates how to create a form-filling agent using the Agent-Bay SDK. The agent can automatically fill HTML forms with data based on natural language instructions.

## Features

- Uploads an HTML form to Agent-Bay environment
- Opens the form in a browser using Agent-Bay's browser capabilities
- Uses natural language instructions to fill form fields
- Submits the form automatically

## Framework Integration Guides

This project is structured to support multiple agent frameworks. Please refer to the specific framework integration guide for detailed setup and usage instructions:

- [LangChain Integration Guide (Sync)](./sync/langchain/README.md) - Complete setup and usage instructions for LangChain framework (synchronous version)
- [LangChain Integration Guide (Async)](./async/langchain/README.md) - Complete setup and usage instructions for LangChain framework (asynchronous version)

## Project Structure

This project follows a modular structure that separates core functionality from framework-specific integrations:

```
‚îú‚îÄ‚îÄ README.md            # Documentation
‚îú‚îÄ‚îÄ sync/                # Synchronous implementation
‚îÇ   ‚îú‚îÄ‚îÄ common/          # Sync core functionality
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ src/         # Framework-agnostic code
‚îÇ   ‚îî‚îÄ‚îÄ langchain/       # Sync LangChain integration
‚îÇ       ‚îú‚îÄ‚îÄ README.md    # Integration documentation
‚îÇ       ‚îú‚îÄ‚îÄ requirements.txt # Dependencies
‚îÇ       ‚îî‚îÄ‚îÄ src/         # LangChain-specific code
‚îî‚îÄ‚îÄ async/               # Asynchronous implementation
    ‚îú‚îÄ‚îÄ common/          # Async core functionality
    ‚îÇ   ‚îî‚îÄ‚îÄ src/         # Framework-agnostic code
    ‚îî‚îÄ‚îÄ langchain/       # Async LangChain integration
        ‚îú‚îÄ‚îÄ README.md    # Integration documentation
        ‚îú‚îÄ‚îÄ requirements.txt # Dependencies
        ‚îî‚îÄ‚îÄ src/         # LangChain-specific code
```

### Common Module

The `common/` directories contain core functionality that can be used across different agent frameworks, with separate implementations for synchronous and asynchronous patterns.

### Framework Integration Modules

Framework-specific directories (like `sync/langchain/` and `async/langchain/`) contain the integration code that implements form filling functionality using specific agent frameworks with different execution patterns.

## Customization

You can customize the form filling behavior by modifying the implementation in the framework-specific directories and providing your own forms and instructions.

## Agent-Bay SDK Features Used

- Session management
- File system operations (uploading files)
- Browser initialization and control
- BrowserAgent for natural language web automation



# LangChain Integration

This directory contains the LangChain-specific integration for the form-filling agent.

## Sample Output

When the agent successfully fills a form, you will see output similar to the following:

```
Creating LangChain form filling agent...
Creating AgentBay browser session...
[DATE] [TIME] | AgentBay | INFO | [PID]:[TID] | agentbay.context:get:400 | üîó API Call: GetContext
[DATE] [TIME] | AgentBay | INFO | [PID]:[TID] | agentbay.context:get:400 |   ‚îî‚îÄ AllowCreate=True, Name=[CONTEXT_NAME]
[DATE] [TIME] | AgentBay | INFO | [PID]:[TID] | agentbay.context:get:413 | ‚úÖ API Response received
[DATE] [TIME] | AgentBay | INFO | [PID]:[TID] | agentbay.agentbay:create:400 | Adding context sync for file transfer operations: ContextSync(context_id='[CONTEXT_ID]', path='[PATH]', policy=None)
[DATE] [TIME] | AgentBay | INFO | [PID]:[TID] | agentbay.agentbay:create:625 | ‚úÖ API Response: CreateSession, RequestId=[REQUEST_ID]
...
[DATE] [TIME] | AgentBay | INFO | [PID]:[TID] | agentbay.session:_call_mcp_tool_api:1063 | ‚úÖ API Response: CallMcpTool, RequestId=[REQUEST_ID]
[DATE] [TIME] | AgentBay | INFO | [PID]:[TID] | agentbay.session:_call_mcp_tool_api:1063 |   ‚îî‚îÄ tool=page_use_screenshot
[browser_screenshot] Output: {"success": true, "message": "Screenshot captured successfully", "file_path": "./data/filled_page_screenshot.png"}
Final result: I've completed all the requested steps:

1. Navigated to https://data.stats.gov.cn/easyquery.htm?cn=C01
2. Clicked the vertical bar chart icon
3. Waited for 2 seconds
4. Selected the column option
5. Waited for another 2 seconds
6. Saved a screenshot of the resulting page to ./data/filled_page_screenshot.png

The screenshot has been successfully captured and saved to the specified location.
```

## Setup

### 1. Create Virtual Environment

First, create a virtual environment to isolate project dependencies:

```bash
# Create virtual environment
python -m venv form-filling-agent-env

# Activate virtual environment
# On Windows:
form-filling-agent-env\Scripts\activate
# On macOS/Linux:
source form-filling-agent-env/bin/activate
```

### 2. Install Dependencies

Install the required packages:

```bash
# Update pip
pip install --upgrade pip
```

You can install dependencies using the requirements file:

```bash
pip install -r requirements.txt
```

### 3. Configure Environment Variables

Set your API keys as environment variables:

```bash
export AGENTBAY_API_KEY="YOUR_AGENTBAY_API_KEY"
export DASHSCOPE_API_KEY="YOUR_DASHSCOPE_API_KEY"
```

You can get your Agent-Bay API key from the Agent-Bay platform dashboard:
1. Visit [Agent-Bay Console](https://agentbay.console.aliyun.com/service-management)
2. Sign up or log in to your Alibaba Cloud account
3. Navigate to the Service Management section
4. Create a new API KEY or select an existing one
5. Copy the API Key and set it as the value of `AGENTBAY_API_KEY`

For the DashScope API key, you need to register on the Alibaba Cloud DashScope platform:
1. Visit [DashScope Platform](https://bailian.console.aliyun.com/#/home)
2. Sign up or log in to your account
3. Navigate to the API Key management section
4. Copy the API Key and set it as the value of `DASHSCOPE_API_KEY`

## Structure

- [src/](./src/): Contains the LangChain-specific implementation
- [README.md](./README.md): This documentation file

## Integration Details

The LangChain integration uses the core functionality from the [common](../common/) directory and wraps it in LangChain-specific components.

This demonstrates how to:
1. Use LangChain agents with Agent-Bay SDK
2. Structure the code to separate core functionality from framework-specific integration
3. Maintain clean separation of concerns between core logic and framework integration
4. Orchestrate form filling tasks using LangChain's agent framework

## LangChain Orchestration

The form filling agent can be orchestrated using LangChain's agent framework. This provides a more flexible way to interact with the form filling functionality:

1. **Tool-based approach**: The agent exposes tools for analyzing forms, setting filling instructions, and executing the filling process
2. **Natural language interface**: Users can interact with the agent using natural language commands
3. **Sequential workflow**: The agent can automatically determine the correct sequence of operations

### Available Tools

1. `analyze_form`: Analyze a form and suggest filling instructions
2. `fill_form_fields`: Prepare to fill form fields with provided instructions
3. `execute_form_filling`: Execute the form filling process

### Running the Example Script

To run the LangChain orchestration example:

```bash
cd YOUR_PREFIX_PATH/cookbook/browser/form-filling-agent/langchain/
python src/form_filling_agent_example.py
```

This example script demonstrates:
1. Creating a LangChain form filling agent
2. Analyzing a form and suggesting filling instructions
3. Filling the form with custom data
4. Executing the form filling process

## Troubleshooting

If you encounter issues:

1. Ensure your API key is correct and properly set in the `.env` file
2. Check that you have network connectivity to Agent-Bay services
3. Verify that all required packages are installed:
   ```bash
   pip list | grep -E "(wuying-agentbay-sdk|langchain)"
   ```
4. Check that you've activated your virtual environment before running the scripts



# LangChain Integration

This directory contains the LangChain-specific integration for the form-filling agent.

## Sample Output

When the agent successfully fills a form, you will see output similar to the following:

```
Creating LangChain form filling agent...
Creating AgentBay browser session...
[DATE] [TIME] | AgentBay | INFO | [PID]:[TID] | agentbay.context:get:400 | üîó API Call: GetContext
[DATE] [TIME] | AgentBay | INFO | [PID]:[TID] | agentbay.context:get:400 |   ‚îî‚îÄ AllowCreate=True, Name=[CONTEXT_NAME]
[DATE] [TIME] | AgentBay | INFO | [PID]:[TID] | agentbay.context:get:413 | ‚úÖ API Response received
[DATE] [TIME] | AgentBay | INFO | [PID]:[TID] | agentbay.agentbay:create:400 | Adding context sync for file transfer operations: ContextSync(context_id='[CONTEXT_ID]', path='[PATH]', policy=None)
[DATE] [TIME] | AgentBay | INFO | [PID]:[TID] | agentbay.agentbay:create:625 | ‚úÖ API Response: CreateSession, RequestId=[REQUEST_ID]
...
[DATE] [TIME] | AgentBay | INFO | [PID]:[TID] | agentbay.session:_call_mcp_tool_api:1063 | ‚úÖ API Response: CallMcpTool, RequestId=[REQUEST_ID]
[DATE] [TIME] | AgentBay | INFO | [PID]:[TID] | agentbay.session:_call_mcp_tool_api:1063 |   ‚îî‚îÄ tool=page_use_screenshot
[browser_screenshot] Output: {"success": true, "message": "Screenshot captured successfully", "file_path": "./data/filled_page_screenshot.png"}
Final result: I've completed all the requested steps:

1. Navigated to https://data.stats.gov.cn/easyquery.htm?cn=C01
2. Clicked the vertical bar chart icon
3. Waited for 2 seconds
4. Selected the column option
5. Waited for another 2 seconds
6. Saved a screenshot of the resulting page to ./data/filled_page_screenshot.png

The screenshot has been successfully captured and saved to the specified location.
```

## Setup

### 1. Create Virtual Environment

First, create a virtual environment to isolate project dependencies:

```bash
# Create virtual environment
python -m venv form-filling-agent-env

# Activate virtual environment
# On Windows:
form-filling-agent-env\Scripts\activate
# On macOS/Linux:
source form-filling-agent-env/bin/activate
```

### 2. Install Dependencies

Install the required packages:

```bash
# Update pip
pip install --upgrade pip
```

You can install dependencies using the requirements file:

```bash
pip install -r requirements.txt
```

### 3. Configure Environment Variables

Set your API keys as environment variables:

```bash
export AGENTBAY_API_KEY="YOUR_AGENTBAY_API_KEY"
export DASHSCOPE_API_KEY="YOUR_DASHSCOPE_API_KEY"
```

You can get your Agent-Bay API key from the Agent-Bay platform dashboard:
1. Visit [Agent-Bay Console](https://agentbay.console.aliyun.com/service-management)
2. Sign up or log in to your Alibaba Cloud account
3. Navigate to the Service Management section
4. Create a new API KEY or select an existing one
5. Copy the API Key and set it as the value of `AGENTBAY_API_KEY`

For the DashScope API key, you need to register on the Alibaba Cloud DashScope platform:
1. Visit [DashScope Platform](https://bailian.console.aliyun.com/#/home)
2. Sign up or log in to your account
3. Navigate to the API Key management section
4. Copy the API Key and set it as the value of `DASHSCOPE_API_KEY`

## Structure

- [src/](./src/): Contains the LangChain-specific implementation
- [README.md](./README.md): This documentation file

## Integration Details

The LangChain integration uses the core functionality from the [common](../common/) directory and wraps it in LangChain-specific components.

This demonstrates how to:
1. Use LangChain agents with Agent-Bay SDK
2. Structure the code to separate core functionality from framework-specific integration
3. Maintain clean separation of concerns between core logic and framework integration
4. Orchestrate form filling tasks using LangChain's agent framework

## LangChain Orchestration

The form filling agent can be orchestrated using LangChain's agent framework. This provides a more flexible way to interact with the form filling functionality:

1. **Tool-based approach**: The agent exposes tools for analyzing forms, setting filling instructions, and executing the filling process
2. **Natural language interface**: Users can interact with the agent using natural language commands
3. **Sequential workflow**: The agent can automatically determine the correct sequence of operations

### Available Tools

1. `analyze_form`: Analyze a form and suggest filling instructions
2. `fill_form_fields`: Prepare to fill form fields with provided instructions
3. `execute_form_filling`: Execute the form filling process

### Running the Example Script

To run the LangChain orchestration example:

```bash
cd YOUR_PREFIX_PATH/cookbook/browser/form-filling-agent/langchain/
python src/form_filling_agent_example.py
```

This example script demonstrates:
1. Creating a LangChain form filling agent
2. Analyzing a form and suggesting filling instructions
3. Filling the form with custom data
4. Executing the form filling process

## Troubleshooting

If you encounter issues:

1. Ensure your API key is correct and properly set in the `.env` file
2. Check that you have network connectivity to Agent-Bay services
3. Verify that all required packages are installed:
   ```bash
   pip list | grep -E "(wuying-agentbay-sdk|langchain)"
   ```
4. Check that you've activated your virtual environment before running the scripts



# ü§ñ AI Code Assistant

An intelligent web application that combines AI language models with cloud code execution, powered by **AgentBay** and **Alibaba Cloud Qwen**.

## üì∏ Screenshots

### Welcome Screen

![AI Code Assistant Welcome](./assets/welcome.png)

*Choose from multiple pre-built examples or type your own prompt*

### Code Execution in Progress

![Code Execution](./assets/processing.png)

*Real-time execution logs show AgentBay cloud session creation and code execution*

### Dashboard Visualization Result

![Dashboard Example](./assets/dashboard.png)

*AI-generated business dashboard with multiple chart types displayed inline*

## üåü Features

- **üí¨ Natural Language Interface** - Chat with AI to write and execute Python code
- **‚òÅÔ∏è Cloud Execution** - Run code securely in isolated AgentBay environments
- **üîÑ Session Management** - Persistent sessions with automatic cleanup
- **üìä Rich Output** - View code execution results, outputs, and errors
- **üé® Modern UI** - Clean, responsive interface built with Next.js and Tailwind CSS
- **üöÄ Powered by Qwen** - Leverages Alibaba Cloud's advanced language models

## üéØ Use Cases

- **Data Analysis** - Generate and analyze datasets with Python
- **Visualization** - Create charts and plots with matplotlib
- **Learning** - Experiment with Python code in a safe environment
- **Prototyping** - Quickly test algorithms and data processing logic
- **Code Generation** - Let AI write Python code for specific tasks

## üìã Prerequisites

Before you begin, ensure you have:

1. **Node.js 18+** installed
2. **AgentBay API Key** - Get it from [AgentBay Console](https://agentbay.console.aliyun.com/service-management)
3. **DashScope API Key** - Get it from [DashScope Console](https://dashscope.console.aliyun.com/)

## üöÄ Quick Start

### 1. Clone and Navigate

```bash
cd /path/to/wuying-agentbay-sdk/cookbook/codespace/ai-code-assistant
```

### 2. Install Dependencies

```bash
npm install
```

### 3. Configure Environment

Copy the example environment file and add your API keys:

```bash
cp .env.example .env
```

Edit `.env` and add your credentials:

```env
AGENTBAY_API_KEY=your_agentbay_api_key_here
DASHSCOPE_API_KEY=your_dashscope_api_key_here
DASHSCOPE_MODEL=qwen-max  # Optional: specify model
```

### 4. Run Development Server

```bash
npm run dev
```

Open [http://localhost:3000](http://localhost:3000) in your browser.

### 5. Try It Out!

Ask the AI assistant to:
- "Generate 100 random numbers and calculate their mean and standard deviation"
- "Create a bar chart showing monthly sales data"
- "Implement the Fibonacci sequence and display the first 20 numbers"

## üèóÔ∏è Architecture

### System Overview

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Browser   ‚îÇ ‚Üê‚îÄ‚îÄ‚Üí ‚îÇ  Next.js API ‚îÇ ‚Üê‚îÄ‚îÄ‚Üí ‚îÇ  DashScope  ‚îÇ
‚îÇ  (React UI) ‚îÇ      ‚îÇ   (Backend)  ‚îÇ      ‚îÇ  (Qwen AI)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚Üì
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   AgentBay    ‚îÇ
                    ‚îÇ  (Code Exec)  ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Key Components

#### 1. **Frontend** (`app/page.tsx`)
- React-based chat interface
- Message history management
- Real-time code execution results display
- Session tracking

#### 2. **API Route** (`app/api/chat/route.ts`)
- Handles chat requests
- Manages conversation flow
- Coordinates AI and code execution
- Error handling and logging

#### 3. **DashScope Client** (`lib/dashscope-client.ts`)
- Interfaces with Alibaba Cloud Qwen models
- Handles tool calling (function calling)
- Manages API communication

#### 4. **AgentBay Executor** (`lib/agentbay-executor.ts`)
- Creates and manages cloud sessions
- Executes Python code in isolated environments
- Session caching and cleanup
- Result processing

## üìñ How It Works

### Execution Flow

1. **User Input** ‚Üí User sends a message through the chat interface
2. **AI Processing** ‚Üí DashScope (Qwen) analyzes the request
3. **Tool Decision** ‚Üí AI decides if code execution is needed
4. **Code Generation** ‚Üí AI generates Python code
5. **Cloud Execution** ‚Üí Code runs in AgentBay sandbox
6. **Result Processing** ‚Üí Output/errors are captured
7. **AI Response** ‚Üí AI interprets results and responds to user

### Session Management

- Each user gets a unique session ID
- Sessions are reused for 10 minutes to maintain state
- Variables and data persist across executions within a session
- Automatic cleanup after timeout

### Tool Calling

The AI has access to an `execute_python` tool:

```typescript
{
  name: 'execute_python',
  description: 'Execute Python code in a secure cloud environment',
  parameters: {
    code: 'The Python code to execute'
  }
}
```

## üõ†Ô∏è Development

### Project Structure

```
ai-code-assistant/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ api/chat/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts          # Chat API endpoint
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx               # Main chat interface
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx             # App layout
‚îÇ   ‚îî‚îÄ‚îÄ globals.css            # Global styles
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ CodeBlock.tsx          # Code execution display
‚îÇ   ‚îî‚îÄ‚îÄ LoadingSpinner.tsx     # Loading animation
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ agentbay-executor.ts   # AgentBay integration
‚îÇ   ‚îî‚îÄ‚îÄ dashscope-client.ts    # DashScope API client
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ tailwind.config.js
‚îî‚îÄ‚îÄ next.config.js
```

### Adding Custom Tools

To add new capabilities, extend the tools array in `app/api/chat/route.ts`:

```typescript
const TOOLS = [
  {
    type: 'function',
    function: {
      name: 'your_tool_name',
      description: 'What your tool does',
      parameters: {
        type: 'object',
        properties: {
          // Define parameters
        },
        required: ['param1'],
      },
    },
  },
];
```

### Environment Variables

| Variable | Required | Description |
|----------|----------|-------------|
| `AGENTBAY_API_KEY` | Yes | AgentBay API key for code execution |
| `DASHSCOPE_API_KEY` | Yes | DashScope API key for AI models |
| `DASHSCOPE_MODEL` | No | Model to use (default: qwen-max) |

## üîí Security

- **Isolated Execution** - Code runs in isolated cloud containers
- **No Local Execution** - User code never runs on your server
- **Session Timeout** - Automatic cleanup of inactive sessions
- **API Key Protection** - Keys stored in environment variables only

## üé® Customization

### Changing the AI Model

Edit `.env`:

```env
DASHSCOPE_MODEL=qwen-plus  # Faster, more economical
DASHSCOPE_MODEL=qwen-max   # Most capable (default)
```

### Adjusting Session Timeout

Edit `lib/agentbay-executor.ts`:

```typescript
const SESSION_TIMEOUT = 15 * 60 * 1000; // 15 minutes
```

### Styling

The app uses Tailwind CSS. Customize colors in `tailwind.config.js` or modify component styles directly.

## üìä Performance

- **Session Reuse** - Reduces cold start time by 80%
- **Concurrent Requests** - Handles multiple users simultaneously
- **Fast Response** - Average response time: 2-4 seconds

## üêõ Troubleshooting

### Common Issues

**Problem**: "DASHSCOPE_API_KEY is required"
- **Solution**: Ensure `.env` file exists and contains your DashScope API key

**Problem**: "Failed to create session"
- **Solution**: Check your AgentBay API key and account quota

**Problem**: Code execution timeout
- **Solution**: Reduce code complexity or increase timeout in executor

### Debug Mode

Enable detailed logging:

```typescript
// In lib/agentbay-executor.ts
console.log('[AgentBay] Debug info:', ...);
```

## üìù Examples

### Example 1: Data Analysis

**User**: "Generate 1000 random numbers from a normal distribution and calculate statistics"

**AI generates and executes**:
```python
import numpy as np

data = np.random.normal(0, 1, 1000)
print(f"Mean: {np.mean(data):.4f}")
print(f"Std Dev: {np.std(data):.4f}")
print(f"Min: {np.min(data):.4f}")
print(f"Max: {np.max(data):.4f}")
```

### Example 2: Visualization

**User**: "Create a sine and cosine wave plot"

**AI generates and executes**:
```python
import matplotlib.pyplot as plt
import numpy as np

x = np.linspace(0, 2*np.pi, 100)
plt.plot(x, np.sin(x), label='sin(x)')
plt.plot(x, np.cos(x), label='cos(x)')
plt.legend()
plt.grid(True)
plt.show()
```

## ü§ù Contributing

Contributions are welcome! This is part of the AgentBay SDK cookbook.

1. Follow the existing code style
2. Add tests for new features
3. Update documentation
4. Submit a pull request

## üìÑ License

This project is part of the AgentBay SDK and is licensed under Apache License 2.0.

## üîó Related Resources

- [AgentBay Documentation](https://www.alibabacloud.com/help/agentbay)
- [DashScope Documentation](https://help.aliyun.com/zh/dashscope/)
- [AgentBay SDK GitHub](https://github.com/aliyun/wuying-agentbay-sdk)
- [Next.js Documentation](https://nextjs.org/docs)

## üí° Tips

- Use clear, specific prompts for better results
- Sessions persist for 10 minutes - reuse them for related tasks
- Check the code before execution in production use cases
- Monitor your API usage in the respective consoles

---

**Built with ‚ù§Ô∏è using AgentBay SDK and Alibaba Cloud Qwen**




# üöÄ Quick Setup Guide

Follow these steps to get the AI Code Assistant running in under 5 minutes.

## Step 1: Prerequisites Check

Ensure you have:
- ‚úÖ Node.js 18+ installed (`node --version`)
- ‚úÖ AgentBay API key
- ‚úÖ DashScope API key

## Step 2: Install Dependencies

```bash
npm install
```

Expected output:
```
added 300+ packages in 30s
```

## Step 3: Configure Environment

```bash
# Copy the example file
cp .env.example .env

# Edit the file with your credentials
# On macOS/Linux:
nano .env

# On Windows:
notepad .env
```

Add your keys:
```env
AGENTBAY_API_KEY=sk_xxxxx...
DASHSCOPE_API_KEY=sk_xxxxx...
DASHSCOPE_MODEL=qwen-max
```

## Step 4: Start the Development Server

```bash
npm run dev
```

You should see:
```
‚ñ≤ Next.js 14.2.0
- Local:        http://localhost:3000
‚úì Ready in 2.5s
```

## Step 5: Open in Browser

Navigate to: **http://localhost:3000**

## Step 6: Test It Out

Try these example prompts:

1. **Simple Math**
   ```
   Calculate the factorial of 10
   ```

2. **Data Analysis**
   ```
   Generate 100 random numbers and show me the distribution statistics
   ```

3. **Visualization**
   ```
   Create a line chart showing the Fibonacci sequence for the first 15 numbers
   ```

## Troubleshooting

### Issue: Port 3000 already in use

```bash
# Use a different port
npm run dev -- -p 3001
```

### Issue: Module not found errors

```bash
# Clear cache and reinstall
rm -rf node_modules package-lock.json
npm install
```

### Issue: API key errors

- Check that `.env` file exists in the project root
- Verify keys don't have extra spaces
- Restart the development server after editing `.env`

## What's Next?

- Check out the [README.md](./README.md) for detailed documentation
- Explore the code in `/app` and `/lib` directories
- Customize the UI in `/components`
- Add new AI tools in `/app/api/chat/route.ts`

## Support

Having issues?
1. Check the logs in your terminal
2. Look for errors in browser console (F12)
3. Refer to the troubleshooting section in README.md
4. Open an issue on GitHub

---

**Happy coding! üéâ**




# Auto Testing Agent

This project demonstrates how to create a testing agent using LangChain and Agent-Bay SDK. The agent can scan Python projects, generate test cases using LLMs, and execute them in isolated cloud environments.

## Features

- Scan Python projects to identify modules that need testing
- Generate test cases using LLMs based on project structure
- Execute tests in isolated AgentBay cloud environments
- Save test results to local log files
- Support for multiple agent frameworks (currently LangChain, with plans for others)

## Framework Integration Guides

This project is structured to support multiple agent frameworks. Please refer to the specific framework integration guide for detailed setup and usage instructions:

- [LangChain Integration Guide (Sync)](./sync/langchain/README.md) - Complete setup and usage instructions for LangChain framework (synchronous version)
- [LangChain Integration Guide (Async)](./async/langchain/README.md) - Complete setup and usage instructions for LangChain framework (asynchronous version)

## Project Structure

This project follows a modular structure that separates core functionality from framework-specific integrations:

```
‚îú‚îÄ‚îÄ README.md              # Documentation
‚îú‚îÄ‚îÄ sync/                  # Synchronous implementation
‚îÇ   ‚îú‚îÄ‚îÄ common/            # Sync core functionality
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sample_project/ # Sample project for testing
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ src/           # Framework-agnostic code
‚îÇ   ‚îî‚îÄ‚îÄ langchain/         # Sync LangChain integration
‚îÇ       ‚îú‚îÄ‚îÄ data/          # Output directory
‚îÇ       ‚îú‚îÄ‚îÄ src/           # LangChain-specific code
‚îÇ       ‚îî‚îÄ‚îÄ requirements.txt # Dependencies
‚îî‚îÄ‚îÄ async/                 # Asynchronous implementation
    ‚îú‚îÄ‚îÄ common/            # Async core functionality
    ‚îÇ   ‚îú‚îÄ‚îÄ sample_project/ # Sample project for testing
    ‚îÇ   ‚îî‚îÄ‚îÄ src/           # Framework-agnostic code
    ‚îî‚îÄ‚îÄ langchain/         # Async LangChain integration
        ‚îú‚îÄ‚îÄ data/          # Output directory
        ‚îú‚îÄ‚îÄ src/           # LangChain-specific code
        ‚îî‚îÄ‚îÄ requirements.txt # Dependencies
```

### Common Module

The `common/` directories contain all the core functionality that can be used across different agent frameworks, with separate implementations for synchronous and asynchronous patterns. This includes:

- Base testing agent class with shared functionality
- Project scanning and analysis capabilities
- Test case generation logic
- Session management with Agent-Bay
- Test execution and result saving functionality

### Framework Integration Modules

Framework-specific directories (like `sync/langchain/` and `async/langchain/`) contain the integration code that uses the core functionality from the common module and wraps it in framework-specific components.

## Customization

You can modify the code in the `common/sample_project/` directories to test with your own Python projects, and update the instructions in the example scripts to match your specific testing requirements.

## Agent-Bay SDK Features Used

- Session management
- File system operations (synchronizing project files)
- Command execution (running tests)
- Context management (isolated testing environments)



# LangChain Integration

This directory contains the LangChain-specific integration for the testing agent.

## Sample Output

When the agent successfully tests a Python project, you will see output similar to the following:

```
> Entering new AgentExecutor chain...

Invoking: `scan_project` with `/path/to/sample_project`

Project root: /path/to/sample_project

Directories:

Python files:
  calculator.py
    Classes:
      - Calculator (methods: add, subtract, multiply, divide)
    Functions: add, subtract, multiply, divide, is_even

Invoking: `generate_tests` with `Project root: /path/to/sample_project...`

Generated 1 test case files:
test_calculator.py

Invoking: `execute_tests` with `test_calculator.py`

Session created with ID: session-xxxxxxxxxxxxxxxxx
Uploaded calculator.py to AgentBay environment at calculator.py
Executing test case test_calculator.py

.......................
----------------------------------------------------------------------
Ran 23 tests in 0.001s

OK

Final result: The testing process for the Python project has been completed successfully:

1. **Project Scanning**: I scanned the project structure at the specified path and found a single Python file `calculator.py` containing:
   - A `Calculator` class with methods: `add`, `subtract`, `multiply`, `divide`
   - Standalone functions: `add`, `subtract`, `multiply`, `divide`, `is_even`

2. **Test Generation**: Based on the project structure, I generated a test file `test_calculator.py` that covers all the functions and class methods.

3. **Test Execution**: All tests passed successfully:
   - 23 tests were executed in 0.001 seconds
   - All tests passed (1/1 test files passed)
   - No failures or errors were detected

The project's calculator functionality is working correctly according to the generated test cases.
```

## Setup

### 1. Create Virtual Environment

First, create a virtual environment to isolate project dependencies:

```bash
# Create virtual environment
python -m venv auto-testing-agent-env

# Activate virtual environment
# On Windows:
auto-testing-agent-env\Scripts\activate
# On macOS/Linux:
source auto-testing-agent-env/bin/activate
```

### 2. Install Dependencies

Install the required packages:

```bash
# Upgrade pip
pip install --upgrade pip
```

You can install dependencies using the requirements file:

```bash
pip install -r requirements.txt
```

### 3. Configure Environment Variables

Set your API keys as environment variables:

```bash
export AGENTBAY_API_KEY="YOUR_AGENTBAY_API_KEY"
export DASHSCOPE_API_KEY="YOUR_DASHSCOPE_API_KEY"
```

You can get your Agent-Bay API key from the Agent-Bay platform dashboard:
1. Visit [Agent-Bay Console](https://agentbay.console.aliyun.com/service-management)
2. Sign up or log in to your Alibaba Cloud account
3. Navigate to the Service Management section
4. Create a new API KEY or select an existing one
5. Copy the API Key and set it as the value of `AGENTBAY_API_KEY`

For the DashScope API key, you need to register on the Alibaba Cloud DashScope platform:
1. Visit [DashScope Platform](https://bailian.console.aliyun.com/#/home)
2. Sign up or log in to your account
3. Navigate to the API Key management section
4. Create a new API Key and copy it for use as `DASHSCOPE_API_KEY`

## Structure

- [src/](./src/): Contains the LangChain-specific implementation
- `data/`: Data directory for outputs (test results, etc.) - created automatically when running tests
- [README.md](./README.md): This documentation file

## Integration Details

The LangChain integration uses the core functionality from the [common](../common/) directory and wraps it in LangChain-specific components.

This demonstrates how to:
1. Use LangChain agents with Agent-Bay SDK
2. Structure the code to separate core functionality from framework-specific integration
3. Maintain clean separation of concerns between core logic and framework integration
4. Orchestrate testing tasks using LangChain's agent framework

## LangChain Orchestration

The testing agent can be orchestrated using LangChain's agent framework. This provides a more flexible way to interact with the testing functionality:

1. **Tool-based approach**: The agent exposes tools for scanning projects, generating tests, and executing them
2. **Natural language interface**: Users can interact with the agent using natural language commands
3. **Sequential workflow**: The agent can automatically determine the correct sequence of operations

### Available Tools

1. `scan_project`: Scan a project directory to identify Python files that need testing
2. `generate_tests`: Generate test cases for the loaded project using LLM
3. `execute_tests`: Execute generated test cases in AgentBay session
4. `save_results`: Save test results to a local log file

### Running the Example Script

To run the LangChain orchestration example:

```bash
cd YOUR_PREFIX_PATH/cookbook/codespace/auto-testing-agent/langchain/
python src/auto_testing_agent_example.py
```

This example script demonstrates:
1. Creating a LangChain testing agent
2. Scanning a project structure
3. Generating tests using LLM
4. Executing the tests in AgentBay session
5. Saving the results to a log file

```

## Troubleshooting

If you encounter issues:

1. Ensure your API key is correct and properly set in the `.env` file
2. Check that you have network connectivity to Agent-Bay services
3. Verify that all required packages are installed:
   ```bash
   pip list | grep -E "(wuying-agentbay-sdk|langchain)"
   ```
4. Check that you've activated your virtual environment before running the scripts
5. Make sure the project path specified in PROJECT_PATH exists and contains Python files



# LangChain Integration

This directory contains the LangChain-specific integration for the testing agent.

## Sample Output

When the agent successfully tests a Python project, you will see output similar to the following:

```
> Entering new AgentExecutor chain...

Invoking: `scan_project` with `/path/to/sample_project`

Project root: /path/to/sample_project

Directories:

Python files:
  calculator.py
    Classes:
      - Calculator (methods: add, subtract, multiply, divide)
    Functions: add, subtract, multiply, divide, is_even

Invoking: `generate_tests` with `Project root: /path/to/sample_project...`

Generated 1 test case files:
test_calculator.py

Invoking: `execute_tests` with `test_calculator.py`

Session created with ID: session-xxxxxxxxxxxxxxxxx
Uploaded calculator.py to AgentBay environment at calculator.py
Executing test case test_calculator.py

.......................
----------------------------------------------------------------------
Ran 23 tests in 0.001s

OK

Final result: The testing process for the Python project has been completed successfully:

1. **Project Scanning**: I scanned the project structure at the specified path and found a single Python file `calculator.py` containing:
   - A `Calculator` class with methods: `add`, `subtract`, `multiply`, `divide`
   - Standalone functions: `add`, `subtract`, `multiply`, `divide`, `is_even`

2. **Test Generation**: Based on the project structure, I generated a test file `test_calculator.py` that covers all the functions and class methods.

3. **Test Execution**: All tests passed successfully:
   - 23 tests were executed in 0.001 seconds
   - All tests passed (1/1 test files passed)
   - No failures or errors were detected

The project's calculator functionality is working correctly according to the generated test cases.
```

## Setup

### 1. Create Virtual Environment

First, create a virtual environment to isolate project dependencies:

```bash
# Create virtual environment
python -m venv auto-testing-agent-env

# Activate virtual environment
# On Windows:
auto-testing-agent-env\Scripts\activate
# On macOS/Linux:
source auto-testing-agent-env/bin/activate
```

### 2. Install Dependencies

Install the required packages:

```bash
# Upgrade pip
pip install --upgrade pip
```

You can install dependencies using the requirements file:

```bash
pip install -r requirements.txt
```

### 3. Configure Environment Variables

Set your API keys as environment variables:

```bash
export AGENTBAY_API_KEY="YOUR_AGENTBAY_API_KEY"
export DASHSCOPE_API_KEY="YOUR_DASHSCOPE_API_KEY"
```

You can get your Agent-Bay API key from the Agent-Bay platform dashboard:
1. Visit [Agent-Bay Console](https://agentbay.console.aliyun.com/service-management)
2. Sign up or log in to your Alibaba Cloud account
3. Navigate to the Service Management section
4. Create a new API KEY or select an existing one
5. Copy the API Key and set it as the value of `AGENTBAY_API_KEY`

For the DashScope API key, you need to register on the Alibaba Cloud DashScope platform:
1. Visit [DashScope Platform](https://bailian.console.aliyun.com/#/home)
2. Sign up or log in to your account
3. Navigate to the API Key management section
4. Create a new API Key and copy it for use as `DASHSCOPE_API_KEY`

## Structure

- [src/](./src/): Contains the LangChain-specific implementation
- `data/`: Data directory for outputs (test results, etc.) - created automatically when running tests
- [README.md](./README.md): This documentation file

## Integration Details

The LangChain integration uses the core functionality from the [common](../common/) directory and wraps it in LangChain-specific components.

This demonstrates how to:
1. Use LangChain agents with Agent-Bay SDK
2. Structure the code to separate core functionality from framework-specific integration
3. Maintain clean separation of concerns between core logic and framework integration
4. Orchestrate testing tasks using LangChain's agent framework

## LangChain Orchestration

The testing agent can be orchestrated using LangChain's agent framework. This provides a more flexible way to interact with the testing functionality:

1. **Tool-based approach**: The agent exposes tools for scanning projects, generating tests, and executing them
2. **Natural language interface**: Users can interact with the agent using natural language commands
3. **Sequential workflow**: The agent can automatically determine the correct sequence of operations

### Available Tools

1. `scan_project`: Scan a project directory to identify Python files that need testing
2. `generate_tests`: Generate test cases for the loaded project using LLM
3. `execute_tests`: Execute generated test cases in AgentBay session
4. `save_results`: Save test results to a local log file

### Running the Example Script

To run the LangChain orchestration example:

```bash
cd YOUR_PREFIX_PATH/cookbook/codespace/auto-testing-agent/langchain/
python src/auto_testing_agent_example.py
```

This example script demonstrates:
1. Creating a LangChain testing agent
2. Scanning a project structure
3. Generating tests using LLM
4. Executing the tests in AgentBay session
5. Saving the results to a log file

```

## Troubleshooting

If you encounter issues:

1. Ensure your API key is correct and properly set in the `.env` file
2. Check that you have network connectivity to Agent-Bay services
3. Verify that all required packages are installed:
   ```bash
   pip list | grep -E "(wuying-agentbay-sdk|langchain)"
   ```
4. Check that you've activated your virtual environment before running the scripts
5. Make sure the project path specified in PROJECT_PATH exists and contains Python files



# OpenAI Data Analysis with AgentBay

This project demonstrates how to integrate AgentBay with OpenAI to perform automated data analysis using the `code_latest` system image. The example showcases e-commerce sales analytics with AI-generated Python code executed in secure cloud environments.

## Features

- Create and manage AgentBay sessions with `code_latest` image
- Upload datasets to AgentBay cloud environments
- Use OpenAI function calling to generate and execute Python code remotely
- Capture matplotlib visualizations from cloud execution
- Perform comprehensive data analysis including metrics, trends, and visualizations
- Handle stdout, stderr, and error reporting from remote execution

## Framework Integration Guides

This project is structured to support multiple agent frameworks. Please refer to the specific framework integration guide for detailed setup and usage instructions:

- [OpenAI Integration Guide (Sync)](./sync/openai/README.md) - Complete setup and usage instructions for OpenAI function calling (synchronous version)
- [OpenAI Integration Guide (Async)](./async/openai/README.md) - Complete setup and usage instructions for OpenAI function calling (asynchronous version)

## Project Structure

This project follows a modular structure that separates core functionality from framework-specific integrations:

```
‚îú‚îÄ‚îÄ README.md              # This documentation
‚îú‚îÄ‚îÄ .env.example           # Environment variable template
‚îú‚îÄ‚îÄ sync/                  # Synchronous implementation
‚îÇ   ‚îú‚îÄ‚îÄ common/            # Sync shared resources
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ data/          # Sample datasets
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ src/           # Data generation scripts
‚îÇ   ‚îî‚îÄ‚îÄ openai/            # Sync OpenAI integration
‚îÇ       ‚îú‚îÄ‚îÄ README.md      # Integration documentation
‚îÇ       ‚îú‚îÄ‚îÄ requirements.txt # Dependencies
‚îÇ       ‚îî‚îÄ‚îÄ src/           # OpenAI-specific code
‚îî‚îÄ‚îÄ async/                 # Asynchronous implementation
    ‚îú‚îÄ‚îÄ common/            # Async shared resources
    ‚îÇ   ‚îú‚îÄ‚îÄ data/          # Sample datasets
    ‚îÇ   ‚îî‚îÄ‚îÄ src/           # Data generation scripts
    ‚îî‚îÄ‚îÄ openai/            # Async OpenAI integration
        ‚îú‚îÄ‚îÄ README.md      # Integration documentation
        ‚îú‚îÄ‚îÄ requirements.txt # Dependencies
        ‚îî‚îÄ‚îÄ src/           # OpenAI-specific code
```

### Common Module

The `common/` directories contain shared resources that can be used across different framework integrations, with separate implementations for synchronous and asynchronous patterns:

- **Sample dataset**: Synthetic e-commerce sales data with 5000+ orders
- **Data generator**: Script to create custom datasets with configurable parameters

### Framework Integration Modules

Framework-specific directories (like `sync/openai/` and `async/openai/`) contain integration code that demonstrates how to use AgentBay with specific AI frameworks and tools using different execution patterns.

## Use Case

This example demonstrates automated e-commerce sales analytics including:

- **Sales Performance Metrics**: Calculate total revenue, order count, and average order value
- **Category Analysis**: Identify best-selling product categories and revenue distribution
- **Time-based Trends**: Analyze monthly revenue patterns and detect seasonality
- **Customer Segmentation**: Break down sales by customer tier (Premium, Regular, New)
- **Geographic Analysis**: Compare performance across regions and cities
- **Visualization**: Generate professional charts and graphs using matplotlib

## Dataset Description

The synthetic e-commerce dataset includes:

- **5000+ sample orders** spanning 2023-2024
- **6 product categories**: Electronics, Clothing, Home & Garden, Books, Sports, Toys
- **3 customer segments**: Premium (15%), Regular (60%), New (25%)
- **4 geographic regions**: North America, Europe, Asia Pacific, Latin America
- **15 data columns**: Date, OrderID, ProductID, ProductName, Category, Brand, UnitPrice, Quantity, TotalAmount, CustomerID, CustomerSegment, Region, City, PaymentMethod, ShippingMethod

## Customization

You can modify the data generation script to create custom datasets:

- Adjust the number of records in `generate_ecommerce_data.py`
- Add or modify product categories and pricing ranges
- Change customer segment distributions
- Customize geographic regions and cities

You can also modify the analysis prompt in the main script to perform different types of analysis on the dataset.

## AgentBay SDK Features Used

This example demonstrates the following AgentBay SDK capabilities:

- **Session Management**: Create and manage sessions with `code_latest` image using `agentbay.create(CreateSessionParams(image_id="code_latest"))`
- **File Upload**: Upload datasets to cloud environments using `session.file_system.upload_file()`
- **Code Execution**: Run Python code remotely using `session.code.run_code()` API
- **File Download**: Download generated visualizations using `session.file_system.download_file()`
- **Resource Management**: Automatic session cleanup with `session.delete()`

## Learn More

- [AgentBay SDK Documentation](https://help.aliyun.com/zh/agentbay/)
- [OpenAI Function Calling Guide](https://platform.openai.com/docs/guides/function-calling)
- [AgentBay Console](https://agentbay.console.aliyun.com/)




# Alibaba Cloud Bailian Integration for AgentBay Data Analysis

## üéØ What This Example Demonstrates

This integration showcases the power of combining Alibaba Cloud Bailian's (DashScope) function calling capabilities with AgentBay's cloud runtime environment to perform automated data analysis. The example demonstrates how to:

- Upload a sales dataset to AgentBay's cloud environment
- Use Bailian LLM to analyze the data and generate Python code dynamically
- Execute the generated code in the cloud without any local setup
- Retrieve and visualize the analysis results automatically

### üìä Example Output

Below is an actual visualization generated by this example, showing the top 5 e-commerce product categories by revenue:

![Sales Analysis Result](./assets/sales_analysis.png)

**What you're seeing:** This horizontal bar chart was automatically generated by asking Alibaba Cloud Bailian to analyze the e-commerce sales dataset. The AI wrote the Python code, executed it in AgentBay's cloud environment, and returned this visualization‚Äîall without any manual coding or local environment setup.

**Key Metrics from This Analysis:**
- **Total Revenue:** $1,058,080.92
- **Total Orders:** 5,000
- **Average Order Value:** $211.62
- **Top Category:** Home & Garden ($337,763.90)

---

This integration demonstrates how to use Alibaba Cloud Bailian's function calling feature with AgentBay to perform automated data analysis in cloud environments.

## Overview

This example shows how to:

1. Create an AgentBay CodeSpace environment for Python code execution
2. Upload datasets to the cloud environment
3. Use Bailian's function calling to generate Python code dynamically
4. Execute the generated code in the remote CodeSpace
5. Capture and download visualization results automatically

## Prerequisites

- Python 3.8 or higher
- AgentBay API key (get it from [AgentBay Console](https://agentbay.console.aliyun.com/service-management))
- Alibaba Cloud DashScope API key (get it from [DashScope Console](https://dashscope.console.aliyun.com/))

## Installation

1. **Set up a Python virtual environment** (recommended):

```bash
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
```

2. **Install dependencies**:

```bash
pip install -r requirements.txt
```

Or install manually:

```bash
pip install openai wuying-agentbay-sdk
```

**Note**: For local development, you can install the SDK from the local path:

```bash
pip install /path/to/wuying-agentbay-sdk/python
```

## Configuration

1. **Copy the environment template**:

```bash
cd ..  # Go to openai-data-analysis directory
cp .env.example .env
```

2. **Edit `.env` and add your API keys**:

```bash
AGENTBAY_API_KEY=your_agentbay_api_key_here
DASHSCOPE_API_KEY=your_dashscope_api_key_here
DASHSCOPE_MODEL=qwen3-max
```

3. **Load environment variables**:

```bash
export $(cat .env | xargs)
```

Or source them in your shell:

```bash
source .env  # If your .env uses export statements
```

## Usage

### 1. Generate Sample Data

First, generate the synthetic e-commerce dataset:

```bash
cd ../common/src
python generate_ecommerce_data.py
```

This will create `ecommerce_sales.csv` in the current directory with 5000 sample orders.

### 2. Run the Analysis

Execute the main analysis script:

```bash
cd ../../openai/src
python agentbay_openai_sales_analysis.py
```

The script will:
1. Initialize AgentBay and OpenAI clients
2. Create a new AgentBay CodeSpace environment
3. Upload the dataset to the CodeSpace
4. Send an analysis request to OpenAI
5. Execute the generated Python code in the remote CodeSpace
6. Download and save the visualization as `sales_analysis.png`
7. Clean up the session

### Expected Output

```
================================================================================
AgentBay + Alibaba Cloud Bailian Integration: E-commerce Sales Analysis
================================================================================

üöÄ Initializing AgentBay client...
üì¶ Creating AgentBay CodeSpace environment...
‚úì Session created: sess_xxxxx

üì§ Uploading dataset to AgentBay session...
‚úì Uploaded to /home/user/ecommerce_sales.csv

üîç Validating dataset...
‚úì Dataset validation results:
  Total rows: 5000
  Total columns: 15
  Date range: 2023-01-01 to 2024-12-31
  Total revenue: $1,089,178.68
  Categories: Electronics, Clothing, Home & Garden, Books, Sports, Toys

ü§ñ Starting AI-powered sales analysis...
================================================================================
User Request: Analyze the e-commerce sales dataset...
================================================================================

Waiting for the LLM to respond...

LLM Response: (tool call)

Tool Used: execute_python
Code to Execute:
--------------------------------------------------------------------------------
import pandas as pd
import matplotlib.pyplot as plt
...
--------------------------------------------------------------------------------

üîß Executing Python code in AgentBay session...

================================================================================
Analysis Results:
================================================================================
‚úì Visualization saved to sales_analysis.png

Analysis Output:
Total revenue: $1089178.68
Total orders: 5000
Average order value: $217.84
...

üßπ Cleaning up...
‚úì Session deleted

‚úì Demo completed successfully!
```

## Code Walkthrough

### Main Components

#### 1. System Prompt

The system prompt provides context to the LLM about:
- Its role as a data analyst
- Dataset structure and columns
- Execution environment (AgentBay CodeSpace with pre-installed data science packages)
- Available packages (pandas, numpy, matplotlib, etc.)
- Guidelines for code generation

#### 2. Function Definition

The `execute_python` function is defined in the Bailian tools schema, allowing the LLM to generate code that will be executed remotely.

#### 3. Code Execution

The `execute_python_code()` function uses AgentBay's native `run_code` API:
- Appends matplotlib save commands to the generated code
- Executes code using `session.code.run_code()` API
- Detects saved plots and downloads them using `session.file_system.download_file()`
- Returns structured results (result, error, png_path)

#### 4. Workflow

```python
# 1. Create CodeSpace session
params = CreateSessionParams(image_id="code_latest")  # CodeSpace environment
result = agentbay.create(params)
session = result.session

# 2. Upload dataset
session.file_system.upload_file(local_path, remote_path)

# 3. Call Bailian with function calling
completion = llm_client.chat.completions.create(
    model=MODEL_NAME,
    messages=[...],
    tools=TOOLS,
    tool_choice="auto"
)

# 4. Execute generated code using run_code API
result = session.code.run_code(code_with_save, "python", timeout_s=60)

# 5. Download visualization if generated
if "PLOT_SAVED:" in result.result:
    download_result = session.file_system.download_file(
        '/tmp/output.png',
        'sales_analysis.png'
    )

# 6. Cleanup
session.delete()
```

## Customization

### Modify Analysis Query

You can change the analysis request in `agentbay_openai_sales_analysis.py`:

```python
analysis_request = (
    'Your custom analysis request here...'
)
```

### Change Dataset

To use a different dataset:

1. Modify `generate_ecommerce_data.py` to generate your desired data structure
2. Update the system prompt to reflect the new dataset structure
3. Regenerate the data and run the analysis

### Adjust LLM Model

Set the `DASHSCOPE_MODEL` environment variable or modify the default in the script:

```python
MODEL_NAME = os.environ.get("DASHSCOPE_MODEL", "qwen3-max")
```

Available Bailian models:
- `qwen3-max`: Most capable model (default)
- `qwen-turbo`: Faster responses
- `qwen-plus`: Balanced performance

## Troubleshooting

### Issue: "Failed to create session"

**Solution**: Check that your AGENTBAY_API_KEY is valid and you have sufficient quota.

### Issue: "Bailian API error"

**Solution**: Verify your DASHSCOPE_API_KEY is correctly set and you have access to the DashScope service.

### Issue: "Dataset file not found"

**Solution**: Make sure you've run `generate_ecommerce_data.py` first to create the dataset.

### Issue: "No visualization was generated"

**Solution**: Check the code execution output for errors. Ensure the LLM-generated code includes matplotlib plotting commands.

### Issue: "Code execution timeout"

**Solution**: The script has a 60-second timeout. For larger datasets or complex analyses, you may need to increase the `timeout_s` parameter in `session.code.run_code()`.

## Technical Details

### Remote Code Execution

The code execution mechanism uses AgentBay's native `run_code` API:

1. Appends matplotlib save commands to the user's code
2. Executes code using `session.code.run_code(code, "python", timeout_s=60)`
3. Checks execution result for success/failure
4. Detects saved plots by looking for "PLOT_SAVED:" marker in output
5. Downloads visualization files using `session.file_system.download_file()`
6. Returns structured output with result text, error (if any), and local PNG path

### File Upload

Files are uploaded using the AgentBay SDK's `file_system.upload_file()` method:

```python
result = session.file_system.upload_file(
    local_path="./ecommerce_sales.csv",
    remote_path="/home/user/ecommerce_sales.csv"
)
```

### Session Management

Sessions are automatically managed:
- Created as isolated CodeSpace environments for secure code execution
- Cleaned up in a `finally` block to ensure resource release
- Each session is isolated from others for security

## Learn More

- [AgentBay SDK Documentation](https://help.aliyun.com/zh/agentbay/)
- [Alibaba Cloud Bailian (DashScope) Documentation](https://help.aliyun.com/zh/dashscope/)
- [AgentBay Python SDK Reference](https://github.com/aliyun/alibabacloud-agentbay-sdk)

## License

This example is provided as-is for demonstration purposes.




# Alibaba Cloud Bailian Integration for AgentBay Data Analysis

## üéØ What This Example Demonstrates

This integration showcases the power of combining Alibaba Cloud Bailian's (DashScope) function calling capabilities with AgentBay's cloud runtime environment to perform automated data analysis. The example demonstrates how to:

- Upload a sales dataset to AgentBay's cloud environment
- Use Bailian LLM to analyze the data and generate Python code dynamically
- Execute the generated code in the cloud without any local setup
- Retrieve and visualize the analysis results automatically

### üìä Example Output

Below is an actual visualization generated by this example, showing the top 5 e-commerce product categories by revenue:

![Sales Analysis Result](./assets/sales_analysis.png)

**What you're seeing:** This horizontal bar chart was automatically generated by asking Alibaba Cloud Bailian to analyze the e-commerce sales dataset. The AI wrote the Python code, executed it in AgentBay's cloud environment, and returned this visualization‚Äîall without any manual coding or local environment setup.

**Key Metrics from This Analysis:**
- **Total Revenue:** $1,058,080.92
- **Total Orders:** 5,000
- **Average Order Value:** $211.62
- **Top Category:** Home & Garden ($337,763.90)

---

This integration demonstrates how to use Alibaba Cloud Bailian's function calling feature with AgentBay to perform automated data analysis in cloud environments.

## Overview

This example shows how to:

1. Create an AgentBay CodeSpace environment for Python code execution
2. Upload datasets to the cloud environment
3. Use Bailian's function calling to generate Python code dynamically
4. Execute the generated code in the remote CodeSpace
5. Capture and download visualization results automatically

## Prerequisites

- Python 3.8 or higher
- AgentBay API key (get it from [AgentBay Console](https://agentbay.console.aliyun.com/service-management))
- Alibaba Cloud DashScope API key (get it from [DashScope Console](https://dashscope.console.aliyun.com/))

## Installation

1. **Set up a Python virtual environment** (recommended):

```bash
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
```

2. **Install dependencies**:

```bash
pip install -r requirements.txt
```

Or install manually:

```bash
pip install openai wuying-agentbay-sdk
```

**Note**: For local development, you can install the SDK from the local path:

```bash
pip install /path/to/wuying-agentbay-sdk/python
```

## Configuration

1. **Copy the environment template**:

```bash
cd ..  # Go to openai-data-analysis directory
cp .env.example .env
```

2. **Edit `.env` and add your API keys**:

```bash
AGENTBAY_API_KEY=your_agentbay_api_key_here
DASHSCOPE_API_KEY=your_dashscope_api_key_here
DASHSCOPE_MODEL=qwen3-max
```

3. **Load environment variables**:

```bash
export $(cat .env | xargs)
```

Or source them in your shell:

```bash
source .env  # If your .env uses export statements
```

## Usage

### 1. Generate Sample Data

First, generate the synthetic e-commerce dataset:

```bash
cd ../common/src
python generate_ecommerce_data.py
```

This will create `ecommerce_sales.csv` in the current directory with 5000 sample orders.

### 2. Run the Analysis

Execute the main analysis script:

```bash
cd ../../openai/src
python agentbay_openai_sales_analysis.py
```

The script will:
1. Initialize AgentBay and OpenAI clients
2. Create a new AgentBay CodeSpace environment
3. Upload the dataset to the CodeSpace
4. Send an analysis request to OpenAI
5. Execute the generated Python code in the remote CodeSpace
6. Download and save the visualization as `sales_analysis.png`
7. Clean up the session

### Expected Output

```
================================================================================
AgentBay + Alibaba Cloud Bailian Integration: E-commerce Sales Analysis
================================================================================

üöÄ Initializing AgentBay client...
üì¶ Creating AgentBay CodeSpace environment...
‚úì Session created: sess_xxxxx

üì§ Uploading dataset to AgentBay session...
‚úì Uploaded to /home/user/ecommerce_sales.csv

üîç Validating dataset...
‚úì Dataset validation results:
  Total rows: 5000
  Total columns: 15
  Date range: 2023-01-01 to 2024-12-31
  Total revenue: $1,089,178.68
  Categories: Electronics, Clothing, Home & Garden, Books, Sports, Toys

ü§ñ Starting AI-powered sales analysis...
================================================================================
User Request: Analyze the e-commerce sales dataset...
================================================================================

Waiting for the LLM to respond...

LLM Response: (tool call)

Tool Used: execute_python
Code to Execute:
--------------------------------------------------------------------------------
import pandas as pd
import matplotlib.pyplot as plt
...
--------------------------------------------------------------------------------

üîß Executing Python code in AgentBay session...

================================================================================
Analysis Results:
================================================================================
‚úì Visualization saved to sales_analysis.png

Analysis Output:
Total revenue: $1089178.68
Total orders: 5000
Average order value: $217.84
...

üßπ Cleaning up...
‚úì Session deleted

‚úì Demo completed successfully!
```

## Code Walkthrough

### Main Components

#### 1. System Prompt

The system prompt provides context to the LLM about:
- Its role as a data analyst
- Dataset structure and columns
- Execution environment (AgentBay CodeSpace with pre-installed data science packages)
- Available packages (pandas, numpy, matplotlib, etc.)
- Guidelines for code generation

#### 2. Function Definition

The `execute_python` function is defined in the Bailian tools schema, allowing the LLM to generate code that will be executed remotely.

#### 3. Code Execution

The `execute_python_code()` function uses AgentBay's native `run_code` API:
- Appends matplotlib save commands to the generated code
- Executes code using `session.code.run_code()` API
- Detects saved plots and downloads them using `session.file_system.download_file()`
- Returns structured results (result, error, png_path)

#### 4. Workflow

```python
# 1. Create CodeSpace session
params = CreateSessionParams(image_id="code_latest")  # CodeSpace environment
result = agentbay.create(params)
session = result.session

# 2. Upload dataset
session.file_system.upload_file(local_path, remote_path)

# 3. Call Bailian with function calling
completion = llm_client.chat.completions.create(
    model=MODEL_NAME,
    messages=[...],
    tools=TOOLS,
    tool_choice="auto"
)

# 4. Execute generated code using run_code API
result = session.code.run_code(code_with_save, "python", timeout_s=60)

# 5. Download visualization if generated
if "PLOT_SAVED:" in result.result:
    download_result = session.file_system.download_file(
        '/tmp/output.png',
        'sales_analysis.png'
    )

# 6. Cleanup
session.delete()
```

## Customization

### Modify Analysis Query

You can change the analysis request in `agentbay_openai_sales_analysis.py`:

```python
analysis_request = (
    'Your custom analysis request here...'
)
```

### Change Dataset

To use a different dataset:

1. Modify `generate_ecommerce_data.py` to generate your desired data structure
2. Update the system prompt to reflect the new dataset structure
3. Regenerate the data and run the analysis

### Adjust LLM Model

Set the `DASHSCOPE_MODEL` environment variable or modify the default in the script:

```python
MODEL_NAME = os.environ.get("DASHSCOPE_MODEL", "qwen3-max")
```

Available Bailian models:
- `qwen3-max`: Most capable model (default)
- `qwen-turbo`: Faster responses
- `qwen-plus`: Balanced performance

## Troubleshooting

### Issue: "Failed to create session"

**Solution**: Check that your AGENTBAY_API_KEY is valid and you have sufficient quota.

### Issue: "Bailian API error"

**Solution**: Verify your DASHSCOPE_API_KEY is correctly set and you have access to the DashScope service.

### Issue: "Dataset file not found"

**Solution**: Make sure you've run `generate_ecommerce_data.py` first to create the dataset.

### Issue: "No visualization was generated"

**Solution**: Check the code execution output for errors. Ensure the LLM-generated code includes matplotlib plotting commands.

### Issue: "Code execution timeout"

**Solution**: The script has a 60-second timeout. For larger datasets or complex analyses, you may need to increase the `timeout_s` parameter in `session.code.run_code()`.

## Technical Details

### Remote Code Execution

The code execution mechanism uses AgentBay's native `run_code` API:

1. Appends matplotlib save commands to the user's code
2. Executes code using `session.code.run_code(code, "python", timeout_s=60)`
3. Checks execution result for success/failure
4. Detects saved plots by looking for "PLOT_SAVED:" marker in output
5. Downloads visualization files using `session.file_system.download_file()`
6. Returns structured output with result text, error (if any), and local PNG path

### File Upload

Files are uploaded using the AgentBay SDK's `file_system.upload_file()` method:

```python
result = session.file_system.upload_file(
    local_path="./ecommerce_sales.csv",
    remote_path="/home/user/ecommerce_sales.csv"
)
```

### Session Management

Sessions are automatically managed:
- Created as isolated CodeSpace environments for secure code execution
- Cleaned up in a `finally` block to ensure resource release
- Each session is isolated from others for security

## Learn More

- [AgentBay SDK Documentation](https://help.aliyun.com/zh/agentbay/)
- [Alibaba Cloud Bailian (DashScope) Documentation](https://help.aliyun.com/zh/dashscope/)
- [AgentBay Python SDK Reference](https://github.com/aliyun/alibabacloud-agentbay-sdk)

## License

This example is provided as-is for demonstration purposes.


