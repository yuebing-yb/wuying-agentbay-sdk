# DO NOT EDIT THIS FILE MANUALLY.
# This file is auto-generated by scripts/generate_sync.py

import logging
from typing import Any, Dict

from ..page_agent import PageAgent


def run(
    agent: PageAgent, _logger: logging.Logger, config: Dict[str, Any]
) -> dict:
    agent.goto("https://browserbase.github.io/stagehand-eval-sites/sites/amazon/")
    observations1 = agent.observe(
        instruction="Find and click the 'Add to Cart' button",
    )

    if not observations1:
        return {
            "_success": False,
            "error": "Step 1 Failed: Could not find 'Add to Cart' button.",
        }

    agent.act(observations1[0])

    observations2 = agent.observe(
        instruction="Find and click the 'Proceed to checkout' button",
    )

    if not observations2:
        return {
            "_success": False,
            "error": "Step 2 Failed: Could not find 'Proceed to checkout' button.",
        }

    _logger.info("Found 'Proceed to checkout' button. Executing action...")
    agent.act(observations2[0])

    page = agent.get_current_page()
    expected_url_prefix = (
        "https://browserbase.github.io/stagehand-eval-sites/sites/amazon/sign-in.html"
    )

    if page.url.startswith(expected_url_prefix):
        _logger.info("âœ… Validation passed: Reached the expected sign-in page.")
        return {"_success": True}
    else:
        error_msg = f"Validation failed: Final URL mismatch. Expected prefix: '{expected_url_prefix}', Got: '{page.url}'"
        _logger.error(error_msg)
        return {"_success": False, "error": error_msg}
