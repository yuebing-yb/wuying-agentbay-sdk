import time
# DO NOT EDIT THIS FILE MANUALLY.
# This file is auto-generated from the _async directory.

"""
示例：后台新增商品（表单填报）
打开管理后台
通过变量注入填写表单并提交
重点：ActOptions.variagentbayles 批量字段
"""

import os
from agentbay import AgentBay
from agentbay import CreateSessionParams
from agentbay import BrowserOption
from agentbay import ActOptions


def main():
    api_key = os.getenv("AGENTBAY_API_KEY")
    if not api_key:
        print("Error: AGENTBAY_API_KEY not set")
        return
    agentbay = AgentBay(api_key=api_key)
    session_result = agentbay.create(CreateSessionParams(image_id="browser_latest"))
    session = session_result.session
    try:
        if not session.browser.initialize(BrowserOption()):
            print("Browser init failed")
            return
        agent = session.browser.agent

        agent.navigate("https://httpbin.org/forms/post")
        agent.act(
            ActOptions(
                action="填写披萨订单表单并提交",
                variables={
                    "Customer name": "John Doe",
                    "Telephone": "1234567890", 
                    "E-mail address": "john@example.com",
                    "Pizza Size": "large",
                    "Pizza Toppings": "bacon,cheese",
                    "Delivery instructions": "Please ring the doorbell",
                },
            )
        )
        time.sleep(2)
    finally:
        try:
            session.browser.agent.close()
        except Exception:
            pass
        agentbay.delete(session)


if __name__ == "__main__":
    main()
