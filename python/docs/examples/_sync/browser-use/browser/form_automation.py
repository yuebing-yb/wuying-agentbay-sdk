# DO NOT EDIT THIS FILE MANUALLY.
# This file is auto-generated from the _async directory.

"""
Example demonstrating form automation with AgentBay SDK.

This example shows how to:
- Fill out web forms automatically
- Handle different input types (text, checkbox, radio, select)
- Submit forms
- Validate form submissions
- Handle form errors
"""

import os

from agentbay import AgentBay
from agentbay import CreateSessionParams
from agentbay import BrowserOption

from playwright.sync_api import sync_playwright


def fill_simple_form(page):
    """Fill out a simple form with various input types."""
    print("\nüìù Filling out a simple form...")
    
    # Navigate to a form page (example)
    page.goto("https://www.example.com/form")  # Replace with actual form URL
    
    # Fill text input
    page.fill('input[name="username"]', "test_user")
    print("‚úÖ Filled username field")
    
    # Fill email input
    page.fill('input[type="email"]', "test@example.com")
    print("‚úÖ Filled email field")
    
    # Fill password input
    page.fill('input[type="password"]', "SecurePassword123")
    print("‚úÖ Filled password field")
    
    # Select from dropdown
    page.select_option('select[name="country"]', "US")
    print("‚úÖ Selected country")
    
    # Check checkbox
    page.check('input[type="checkbox"][name="terms"]')
    print("‚úÖ Checked terms checkbox")
    
    # Select radio button
    page.check('input[type="radio"][value="male"]')
    print("‚úÖ Selected radio button")
    
    # Fill textarea
    page.fill('textarea[name="comments"]', "This is a test comment")
    print("‚úÖ Filled textarea")


def submit_and_validate_form(page):
    """Submit a form and validate the result."""
    print("\nüöÄ Submitting form...")
    
    # Click submit button
    page.click('button[type="submit"]')
    
    # Wait for navigation or response
    try:
        page.wait_for_load_state("networkidle", timeout=10000)
        print("‚úÖ Form submitted successfully")
        
        # Check for success message
        success_selector = ".success-message, .alert-success"
        if page.query_selector(success_selector):
            message = page.text_content(success_selector)
            print(f"‚úÖ Success message: {message}")
            return True
        
        # Check for error message
        error_selector = ".error-message, .alert-error"
        if page.query_selector(error_selector):
            message = page.text_content(error_selector)
            print(f"‚ùå Error message: {message}")
            return False
            
    except Exception as e:
        print(f"‚ùå Form submission failed: {e}")
        return False
    
    return True


def handle_dynamic_form(page):
    """Handle a form with dynamic fields."""
    print("\nüîÑ Handling dynamic form...")
    
    # Wait for form to load
    page.wait_for_selector('form', timeout=10000)
    
    # Get all input fields dynamically
    inputs = page.query_selector_all('input[type="text"]')
    print(f"Found {len(inputs)} text input fields")
    
    # Fill each field
    for i, input_field in enumerate(inputs):
        field_name = input_field.get_attribute("name")
        input_field.fill(f"value_{i}")
        print(f"‚úÖ Filled field '{field_name}'")


def main():
    """Main function demonstrating form automation."""
    api_key = os.getenv("AGENTBAY_API_KEY")
    if not api_key:
        print("‚ùå Error: AGENTBAY_API_KEY environment variable not set")
        return
    
    agent_bay = AgentBay(api_key=api_key)
    session = None
    
    try:
        print("=" * 60)
        print("Form Automation Example")
        print("=" * 60)
        
        # Create browser session
        print("\nCreating browser session...")
        params = CreateSessionParams(image_id="browser_latest")
        result = agent_bay.create(params)
        
        if not result.success or not result.session:
            print(f"‚ùå Failed to create session: {result.error_message}")
            return
        
        session = result.session
        print(f"‚úÖ Session created: {session.session_id}")
        
        # Initialize browser
        browser_option = BrowserOption()
        if not session.browser.initialize(browser_option):
            print("‚ùå Failed to initialize browser")
            return
        
        print("‚úÖ Browser initialized")
        
        # Get browser endpoint
        endpoint_url = session.browser.get_endpoint_url()
        
        with sync_playwright() as p:
            browser = p.chromium.connect_over_cdp(endpoint_url)
            context = browser.contexts[0]
            page = context.new_page()
            
            # Example 1: Fill simple form
            # Note: Replace with actual form URL for testing
            print("\n" + "=" * 60)
            print("Example 1: Simple Form Filling")
            print("=" * 60)
            print("‚ö†Ô∏è  This example requires a real form URL")
            print("Replace the URL in the code with an actual form for testing")
            
            # Example 2: Form with validation
            print("\n" + "=" * 60)
            print("Example 2: Form Validation")
            print("=" * 60)
            print("‚ö†Ô∏è  This example demonstrates form validation handling")
            
            # Example 3: Dynamic form handling
            print("\n" + "=" * 60)
            print("Example 3: Dynamic Form Handling")
            print("=" * 60)
            print("‚ö†Ô∏è  This example demonstrates handling dynamically generated forms")
            
            browser.close()
        
        print("\n‚úÖ Form automation examples completed")
        print("\nüí° Tip: Replace example URLs with real forms to test functionality")
        
    except Exception as e:
        print(f"\n‚ùå Error: {e}")
        
    finally:
        if session:
            print("\nüßπ Cleaning up session...")
            agent_bay.delete(session)
            print("‚úÖ Session deleted")


if __name__ == "__main__":
    main()

