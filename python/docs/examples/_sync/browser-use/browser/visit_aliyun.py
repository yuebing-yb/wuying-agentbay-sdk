# DO NOT EDIT THIS FILE MANUALLY.
# This file is auto-generated from the _async directory.

"""
Example demonstrating AIBrowser capabilites with AgentBay SDK.
This example shows how to use AIBrowser to visit aliyun.com, including:
- Create AIBrowser session
- Use playwright to connect to AIBrowser instance through CDP protocol
- Utilize playwright to visit aliyun.com
"""

import os
import time
from agentbay import AgentBay
from agentbay import CreateSessionParams
from agentbay import BrowserOption

from playwright.sync_api import sync_playwright

def main():
    # Get API key from environment variable
    api_key = os.getenv("AGENTBAY_API_KEY")
    if not api_key:
        print("Error: AGENTBAY_API_KEY environment variable not set")
        return

    # Initialize AgentBay client
    print("Initializing AgentBay client...")
    agent_bay = AgentBay(api_key=api_key)

    # Create a session
    print("Creating a new session...")
    params = CreateSessionParams(
        image_id="browser_latest",  # Specify the image ID
    )
    session_result = agent_bay.create(params)

    if session_result.success:
        session = session_result.session
        print(f"Session created with ID: {session.session_id}")

        if session.browser.initialize(BrowserOption()):
            print("Browser initialized successfully")
            endpoint_url = session.browser.get_endpoint_url()
            print("endpoint_url =", endpoint_url)

            with sync_playwright() as p:
                browser = p.chromium.connect_over_cdp(endpoint_url)
                context = browser.contexts[0]
                page = context.new_page()
                page.goto("https://www.aliyun.com")
                print("page.title() =", page.title())

                page.wait_for_timeout(5000)

                # Modify page font to Microsoft YaHei
                page.evaluate("""
                    document.body.style.fontFamily = 'Microsoft YaHei';
                """)

                page.wait_for_timeout(5000)

                # Scale page content to 200%
                page.evaluate("""
                    document.body.style.transform = 'scale(2)';
                    document.body.style.transformOrigin = 'top left';
                """)

                page.wait_for_timeout(10000)
                browser.close()
        session.delete()

if __name__ == "__main__":
    main()
