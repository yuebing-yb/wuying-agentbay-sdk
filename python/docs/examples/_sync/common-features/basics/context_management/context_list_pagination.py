# DO NOT EDIT THIS FILE MANUALLY.
# This file is auto-generated from the _async directory.

import os
import sys

sys.path.append(os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__)))))

from agentbay import AgentBay, AgentBayError, ContextListParams

def list_contexts(agent_bay, max_results=10, next_token=None):
    """åˆ—å‡ºä¸Šä¸‹æ–‡ï¼Œæ”¯æŒåˆ†é¡µ"""
    print(f"Listing contexts (max: {max_results})...")
    
    params = ContextListParams(max_results=max_results, next_token=next_token)
    result = agent_bay.context.list(params)
    
    if result.success:
        print(f"Found {len(result.contexts)} contexts (Total: {result.total_count or 'Unknown'})")
        for i, ctx in enumerate(result.contexts, 1):
            print(f" {i}. {ctx.name} ({ctx.id})")
            if ctx.created_at:
                print(f"    Created: {ctx.created_at}")
        
        if result.next_token:
            print(f"Has more results (next_token: {result.next_token[:20]}...)")
        return result
    else:
        print(f"Failed to list contexts: {result.error_message}")
        return None

def create_context(agent_bay, name):
    """åˆ›å»ºæ–°çš„ä¸Šä¸‹æ–‡"""
    print(f"Creating context: {name}")
    
    result = agent_bay.context.get(name=name, create=True)
    
    if result.success:
        print(f"âœ… Context created successfully!")
        print(f"   ID: {result.context.id}")
        print(f"   Name: {result.context.name}")
        return result.context
    else:
        print(f"âŒ Failed to create context: {result.error_message}")
        return None

def get_context_details(agent_bay, context_name):
    """è·å–ä¸Šä¸‹æ–‡è¯¦ç»†ä¿¡æ¯"""
    print(f"Getting context details for: {context_name}")
    
    result = agent_bay.context.get(name=context_name)
    
    if result.success:
        ctx = result.context
        print(f"ğŸ“‹ Context Details:")
        print(f"   ID: {ctx.id}")
        print(f"   Name: {ctx.name}")
        print(f"   Created: {ctx.created_at or 'Unknown'}")
        print(f"   Last Used: {ctx.last_used_at or 'Unknown'}")
        return ctx
    else:
        print(f"âŒ Failed to get context: {result.error_message}")
        return None

def demo_basic_usage(agent_bay):
    """æ¼”ç¤ºåŸºç¡€ç”¨æ³•"""
    print("\n=== Basic Context Listing ===")
    list_contexts(agent_bay, max_results=5)

def demo_pagination(agent_bay):
    """æ¼”ç¤ºåˆ†é¡µåŠŸèƒ½"""
    print("\n=== Pagination Demo ===")
    result = list_contexts(agent_bay, max_results=3)
    
    if result and result.next_token:
        print("\nGetting next page...")
        list_contexts(agent_bay, max_results=3, next_token=result.next_token)

def demo_create_context(agent_bay):
    """æ¼”ç¤ºåˆ›å»ºä¸Šä¸‹æ–‡"""
    print("\n=== Create Context Demo ===")
    import time
    context_name = f"demo-context-{int(time.time())}"
    
    created_ctx = create_context(agent_bay, context_name)
    
    if created_ctx:
        print("\nGetting details of newly created context...")
        get_context_details(agent_bay, created_ctx.name)

def main():
    api_key = os.environ.get("AGENTBAY_API_KEY") or "your_api_key_here"
    agent_bay = AgentBay(api_key=api_key)
    
    try:
        # æ¼”ç¤ºæ‰€æœ‰åŠŸèƒ½
        demo_basic_usage(agent_bay)
        demo_pagination(agent_bay)
        demo_create_context(agent_bay)
        
    except AgentBayError as e:
        print(f"AgentBay error: {e}")
    except Exception as e:
        print(f"Unexpected error: {e}")

if __name__ == "__main__":
    main()