# DO NOT EDIT THIS FILE MANUALLY.
# This file is auto-generated from the _async directory.

import os
import time

from agentbay import AgentBay, CreateSessionParams


# NOTE: Beta feature. Volume API and volume mounting behavior may change in future releases.
def main() -> None:
    api_key = os.getenv("AGENTBAY_API_KEY")
    if not api_key:
        raise RuntimeError("AGENTBAY_API_KEY environment variable is not set")

    client = AgentBay(api_key=api_key)
    image_id = "imgc-0ab5ta4mgqs15qxjf"
    volume_name = f"beta-volume-example-{int(time.time() * 1000)}"

    vol_result = client.beta_volume.create(name=volume_name, image_id=image_id)
    if not vol_result.success or not vol_result.volume:
        raise RuntimeError(f"Failed to create/get volume: {vol_result.error_message}")

    volume_id = vol_result.volume.id
    try:
        params = CreateSessionParams(image_id=image_id, volume=volume_id)
        session_result = client.create(params)
        if not session_result.success or not session_result.session:
            raise RuntimeError(f"Failed to create session: {session_result.error_message}")

        session = session_result.session
        session.delete()
    finally:
        client.beta_volume.delete(volume_id=volume_id)


if __name__ == "__main__":
    main()


